<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Review Report</title>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Source Code Pro', monospace;
            line-height: 1.5;
            margin: 0;
            padding: 0;
            background-color: #0d1117;
            color: #e6edf3;
            font-size: 14px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: #161b22;
            min-height: 100vh;
        }
        .header {
            background: #21262d;
            border-bottom: 1px solid #30363d;
            padding: 20px 30px;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .header h1 {
            margin: 0;
            font-size: 1.8em;
            font-weight: 600;
            color: #f0f6fc;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .header .meta {
            margin-top: 10px;
            color: #8b949e;
            font-size: 0.9em;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .content {
            padding: 30px;
        }
        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: #21262d;
            border: 1px solid #30363d;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        .stat-number {
            font-size: 1.8em;
            font-weight: 600;
            color: #58a6ff;
            margin-bottom: 5px;
        }
        .stat-label {
            color: #8b949e;
            font-size: 0.8em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .section {
            margin-bottom: 30px;
        }
        .section h2 {
            color: #f0f6fc;
            border-bottom: 1px solid #30363d;
            padding-bottom: 8px;
            margin-bottom: 15px;
            font-size: 1.2em;
            font-weight: 600;
        }
        .commits-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            overflow: hidden;
        }
        .commits-table th,
        .commits-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #21262d;
        }
        .commits-table th {
            background-color: #161b22;
            font-weight: 600;
            color: #f0f6fc;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .commits-table tr:hover {
            background-color: #21262d;
        }
        .commits-table tr:last-child td {
            border-bottom: none;
        }
        .commit-hash {
            font-family: 'SF Mono', 'Monaco', monospace;
            background: #21262d;
            color: #58a6ff;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            border: 1px solid #30363d;
            text-decoration: none;
            transition: all 0.2s;
        }
        .commit-hash:hover {
            background: #30363d;
            color: #79c0ff;
            border-color: #58a6ff;
            text-decoration: none;
        }
        .commit-message {
            color: #e6edf3;
            max-width: 400px;
        }
        .commit-author {
            color: #8b949e;
            font-size: 0.9em;
        }
        .commit-date {
            color: #8b949e;
            font-size: 0.85em;
        }
        .files-list {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .files-list ul {
            margin: 0;
            padding-left: 0;
            list-style: none;
        }
        .files-list li {
            margin-bottom: 3px;
            font-family: 'SF Mono', 'Monaco', monospace;
            font-size: 0.9em;
            color: #8b949e;
            padding: 2px 0;
        }
        .files-list li:before {
            content: "📄 ";
            margin-right: 8px;
        }
        .commit-detail {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .commit-header {
            background: #161b22;
            padding: 15px 20px;
            border-bottom: 1px solid #30363d;
        }
        .commit-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 8px;
            color: #f0f6fc;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .commit-hash-large {
            font-family: 'SF Mono', 'Monaco', monospace;
            background: #21262d;
            color: #58a6ff;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.9em;
            border: 1px solid #30363d;
            text-decoration: none;
            transition: all 0.2s;
        }
        .commit-hash-large:hover {
            background: #30363d;
            color: #79c0ff;
            border-color: #58a6ff;
            text-decoration: none;
        }
        .commit-meta {
            color: #8b949e;
            font-size: 0.85em;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .commit-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .diff-container {
            background: #0d1117;
            overflow-x: auto;
            font-size: 12px;
            max-height: 600px;
            overflow-y: auto;
        }
        .file-header {
            background: #21262d;
            padding: 8px 15px;
            font-family: 'SF Mono', 'Monaco', monospace;
            font-size: 0.85em;
            border-bottom: 1px solid #30363d;
            color: #f0f6fc;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .file-icon {
            color: #58a6ff;
        }
        .hunk-header {
            background: #161b22;
            padding: 6px 15px;
            font-family: 'SF Mono', 'Monaco', monospace;
            font-size: 0.8em;
            color: #8b949e;
            border-bottom: 1px solid #21262d;
        }
        .line {
            display: flex;
            font-family: 'SF Mono', 'Monaco', monospace;
            font-size: 12px;
            line-height: 1.2;
            border-bottom: 1px solid #21262d;
            min-height: 18px;
        }
        .line:last-child {
            border-bottom: none;
        }
        .line-number {
            width: 40px;
            padding: 1px 6px;
            text-align: right;
            background: #161b22;
            border-right: 1px solid #30363d;
            color: #8b949e;
            user-select: none;
            font-size: 0.75em;
            min-width: 40px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
        }
        .line-content {
            flex: 1;
            padding: 1px 8px;
            white-space: pre-wrap;
            word-break: break-all;
            display: flex;
            align-items: center;
        }
        .github-link {
            margin-left: 8px;
            opacity: 0;
            transition: opacity 0.2s;
            color: #58a6ff;
            text-decoration: none;
            font-size: 0.8em;
            position: relative;
        }
        .line:hover .github-link {
            opacity: 1;
        }
        .github-link:hover {
            color: #79c0ff;
            text-decoration: underline;
        }
        .github-link::after {
            content: attr(href);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #21262d;
            color: #e6edf3;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7em;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 1000;
            border: 1px solid #30363d;
        }
        .github-link:hover::after {
            opacity: 1;
        }
        .line.added {
            background: #0d4429;
        }
        .line.added .line-number {
            background: #1a472a;
            color: #3fb950;
        }
        .line.added .line-content {
            color: #a2d2a2;
        }
        .line.removed {
            background: #490202;
        }
        .line.removed .line-number {
            background: #5d1a1a;
            color: #f85149;
        }
        .line.removed .line-content {
            color: #ffa198;
        }
        .line.context .line-number {
            color: #6e7681;
        }
        .line.context .line-content {
            color: #e6edf3;
        }
        .toggle-button {
            background: #238636;
            color: #ffffff;
            border: 1px solid #2ea043;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            margin: 8px 0;
            font-family: inherit;
            transition: all 0.2s;
        }
        .toggle-button:hover {
            background: #2ea043;
            border-color: #3fb950;
        }
        .toggle-button.secondary {
            background: #21262d;
            border-color: #30363d;
            color: #8b949e;
        }
        .toggle-button.secondary:hover {
            background: #30363d;
            color: #e6edf3;
        }
        .collapsible {
            display: none;
        }
        .collapsible.show {
            display: block;
        }
        .commit-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .badge.feat {
            background: #1a472a;
            color: #3fb950;
        }
        .badge.fix {
            background: #490202;
            color: #f85149;
        }
        .badge.chore {
            background: #21262d;
            color: #8b949e;
        }
        .badge.docs {
            background: #1c2128;
            color: #58a6ff;
        }
        .badge.refactor {
            background: #2d1b69;
            color: #a5a3ff;
        }
        .scroll-to-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #238636;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            font-size: 18px;
            display: none;
            z-index: 1000;
        }
        .scroll-to-top:hover {
            background: #2ea043;
        }
        .scroll-to-top.show {
            display: block;
        }
        @media (max-width: 768px) {
            .content {
                padding: 15px;
            }
            .header {
                padding: 15px 20px;
            }
            .header .meta {
                flex-direction: column;
                gap: 5px;
            }
            .commits-table {
                font-size: 0.8em;
            }
            .commits-table th,
            .commits-table td {
                padding: 8px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔍 Code Review</h1>
            <div class="meta">
                <div class="meta-item">
                    <span>📊</span>
                    <span><strong>Range:</strong> <code>ca959ab7</code> → <code>82120869</code></span>
                </div>
                <div class="meta-item">
                    <span>📁</span>
                    <span><strong>Path:</strong> <code>rs/node_rewards/canister, rs/node_rewards, rs/registry/node_provider_rewards</code></span>
                </div>
                <div class="meta-item">
                    <span>⏰</span>
                    <span><strong>Generated:</strong> 2025-10-18 20:33</span>
                </div>
            </div>
        </div>
        
        <div class="content">
            <div class="section">
                <h2>📊 Summary</h2>
                <div class="summary">
                    <div class="stat-card">
                        <div class="stat-number">14</div>
                        <div class="stat-label">Commits</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">53</div>
                        <div class="stat-label">Files Changed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">0</div>
                        <div class="stat-label">Lines Added</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">0</div>
                        <div class="stat-label">Lines Removed</div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2>📝 Commits</h2>
                <table class="commits-table">
                    <thead>
                        <tr>
                            <th>Hash</th>
                            <th>Message</th>
                            <th>Author</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><a href="https://github.com/dfinity/ic/commit/46e8847699a9d2eba30bb47872b977e083f9d385" class="commit-hash" target="_blank">46e8847699a9d2eba30bb47872b977e083f9d385</a></td>
                            <td>
                                <span class="badge chore">chore</span>
                                <span class="commit-message">chore(node-rewards-canister): RecurringSyncTask for updating registry and node metrics (#7239)</span>
                            </td>
                            <td><span class="commit-author">pietrodimarco-dfinity</span></td>
                            <td><span class="commit-date">2025-10-15</span></td>
                        </tr>
                        <tr>
                            <td><a href="https://github.com/dfinity/ic/commit/0987d0ef4394c7934186a042046d297ee7b6242d" class="commit-hash" target="_blank">0987d0ef4394c7934186a042046d297ee7b6242d</a></td>
                            <td>
                                <span class="badge chore">chore</span>
                                <span class="commit-message">chore(node-rewards-canister): Address pending TODOs (#7222)</span>
                            </td>
                            <td><span class="commit-author">pietrodimarco-dfinity</span></td>
                            <td><span class="commit-date">2025-10-14</span></td>
                        </tr>
                        <tr>
                            <td><a href="https://github.com/dfinity/ic/commit/55d5612325bfea80a32845c0eec023ed58c4d173" class="commit-hash" target="_blank">55d5612325bfea80a32845c0eec023ed58c4d173</a></td>
                            <td>
                                <span class="badge feat">feat</span>
                                <span class="commit-message">feat(node-rewards-canister): Compute rewards over single day for all node providers (#7071)</span>
                            </td>
                            <td><span class="commit-author">pietrodimarco-dfinity</span></td>
                            <td><span class="commit-date">2025-10-13</span></td>
                        </tr>
                        <tr>
                            <td><a href="https://github.com/dfinity/ic/commit/2851d16acbe87159f58348a9c9f4e10f34f488b9" class="commit-hash" target="_blank">2851d16acbe87159f58348a9c9f4e10f34f488b9</a></td>
                            <td>
                                <span class="badge fix">fix</span>
                                <span class="commit-message">fix(node-rewards-canister): Discard DayUtc type in favor of NaiveDate (#6981)</span>
                            </td>
                            <td><span class="commit-author">pietrodimarco-dfinity</span></td>
                            <td><span class="commit-date">2025-09-30</span></td>
                        </tr>
                        <tr>
                            <td><a href="https://github.com/dfinity/ic/commit/d161192b1376423686e5a826b7affb0da7bc868c" class="commit-hash" target="_blank">d161192b1376423686e5a826b7affb0da7bc868c</a></td>
                            <td>
                                <span class="badge chore">chore</span>
                                <span class="commit-message">chore(ICP_Ledger): FI-1845: Remove ICP ledger notify-method feature (#6717)</span>
                            </td>
                            <td><span class="commit-author">Mathias Björkqvist</span></td>
                            <td><span class="commit-date">2025-09-26</span></td>
                        </tr>
                        <tr>
                            <td><a href="https://github.com/dfinity/ic/commit/ef7cd8fdf88c3fae338854a378cf284522d8357c" class="commit-hash" target="_blank">ef7cd8fdf88c3fae338854a378cf284522d8357c</a></td>
                            <td>
                                <span class="badge fix">fix</span>
                                <span class="commit-message">fix(node-rewards-canister): Consolidate DayUtc type (#6853)</span>
                            </td>
                            <td><span class="commit-author">pietrodimarco-dfinity</span></td>
                            <td><span class="commit-date">2025-09-25</span></td>
                        </tr>
                        <tr>
                            <td><a href="https://github.com/dfinity/ic/commit/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57" class="commit-hash" target="_blank">2f56f172a1ea9dfac0c2fc6889454c38bb88ff57</a></td>
                            <td>
                                <span class="badge chore">chore</span>
                                <span class="commit-message">chore: bump rust to 1.89 (#6758)</span>
                            </td>
                            <td><span class="commit-author">Nikola Milosavljevic</span></td>
                            <td><span class="commit-date">2025-09-24</span></td>
                        </tr>
                        <tr>
                            <td><a href="https://github.com/dfinity/ic/commit/626ccf507254cc6b72ae126ae4d7f7ba22b52406" class="commit-hash" target="_blank">626ccf507254cc6b72ae126ae4d7f7ba22b52406</a></td>
                            <td>
                                <span class="badge chore">chore</span>
                                <span class="commit-message">chore(nns): Release notes (#6641)</span>
                            </td>
                            <td><span class="commit-author">pietrodimarco-dfinity</span></td>
                            <td><span class="commit-date">2025-09-16</span></td>
                        </tr>
                        <tr>
                            <td><a href="https://github.com/dfinity/ic/commit/ed7dbb0a280cf0e25b712b651a05997d3ce24f92" class="commit-hash" target="_blank">ed7dbb0a280cf0e25b712b651a05997d3ce24f92</a></td>
                            <td>
                                <span class="badge feat">feat</span>
                                <span class="commit-message">feat(NRC): Refactor NRC to compute daily rewards (#6730)</span>
                            </td>
                            <td><span class="commit-author">pietrodimarco-dfinity</span></td>
                            <td><span class="commit-date">2025-09-15</span></td>
                        </tr>
                        <tr>
                            <td><a href="https://github.com/dfinity/ic/commit/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3" class="commit-hash" target="_blank">b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3</a></td>
                            <td>
                                <span class="badge chore">chore</span>
                                <span class="commit-message">chore: bumping edition to 2024 (#6715)</span>
                            </td>
                            <td><span class="commit-author">Nikola Milosavljevic</span></td>
                            <td><span class="commit-date">2025-09-12</span></td>
                        </tr>
                        <tr>
                            <td><a href="https://github.com/dfinity/ic/commit/0226e886d73fa5396d39d71d297e2527cb8cb43f" class="commit-hash" target="_blank">0226e886d73fa5396d39d71d297e2527cb8cb43f</a></td>
                            <td>
                                <span class="badge feat">feat</span>
                                <span class="commit-message">feat(NRC): Refactor rewards calculator to compute daily rewards (#6724)</span>
                            </td>
                            <td><span class="commit-author">pietrodimarco-dfinity</span></td>
                            <td><span class="commit-date">2025-09-12</span></td>
                        </tr>
                        <tr>
                            <td><a href="https://github.com/dfinity/ic/commit/861616d46ded00091fecbfe01f441b38b56b483c" class="commit-hash" target="_blank">861616d46ded00091fecbfe01f441b38b56b483c</a></td>
                            <td>
                                <span class="badge fix">fix</span>
                                <span class="commit-message">fix(NRC): Remove API types from proto (#6693)</span>
                            </td>
                            <td><span class="commit-author">pietrodimarco-dfinity</span></td>
                            <td><span class="commit-date">2025-09-11</span></td>
                        </tr>
                        <tr>
                            <td><a href="https://github.com/dfinity/ic/commit/c4bf3da835f3407818b706cf2f7ae4485c7e032f" class="commit-hash" target="_blank">c4bf3da835f3407818b706cf2f7ae4485c7e032f</a></td>
                            <td>
                                <span class="badge chore">chore</span>
                                <span class="commit-message">chore(PocketIC): replace EmptyConfig by better readable enumerations (#6630)</span>
                            </td>
                            <td><span class="commit-author">mraszyk</span></td>
                            <td><span class="commit-date">2025-09-10</span></td>
                        </tr>
                        <tr>
                            <td><a href="https://github.com/dfinity/ic/commit/db65a720ff4db47302d04d426e9abc414e73774b" class="commit-hash" target="_blank">db65a720ff4db47302d04d426e9abc414e73774b</a></td>
                            <td>
                                <span class="badge chore">chore</span>
                                <span class="commit-message">chore(nns): Release notes (#6532)</span>
                            </td>
                            <td><span class="commit-author">pietrodimarco-dfinity</span></td>
                            <td><span class="commit-date">2025-09-06</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="section">
                <h2>📁 Files Changed</h2>
                <div class="files-list">
                    <ul><li><code>rs/node_rewards/canister/BUILD.bazel</code></li><li><code>rs/node_rewards/canister/CHANGELOG.md</code></li><li><code>rs/node_rewards/canister/Cargo.toml</code></li><li><code>rs/node_rewards/canister/api/BUILD.bazel</code></li><li><code>rs/node_rewards/canister/api/Cargo.toml</code></li><li><code>rs/node_rewards/canister/api/src/api_native_conversion.rs</code></li><li><code>rs/node_rewards/canister/api/src/lib.rs</code></li><li><code>rs/node_rewards/canister/api/src/provider_rewards_calculation.rs</code></li><li><code>rs/node_rewards/canister/api/src/providers_rewards.rs</code></li><li><code>rs/node_rewards/canister/node-rewards-canister.did</code></li><li><code>rs/node_rewards/canister/proto/rewards_calculator/pb/v1/types.proto</code></li><li><code>rs/node_rewards/canister/protobuf/BUILD.bazel</code></li><li><code>rs/node_rewards/canister/protobuf/Cargo.toml</code></li><li><code>rs/node_rewards/canister/protobuf/src/conversions.rs</code></li><li><code>rs/node_rewards/canister/protobuf/src/gen/rewards_calculator.pb.v1.rs</code></li><li><code>rs/node_rewards/canister/protobuf/src/lib.rs</code></li><li><code>rs/node_rewards/canister/protobuf/src/pb/ic_node_rewards/mod.rs</code></li><li><code>rs/node_rewards/canister/protobuf/src/pb/mod.rs</code></li><li><code>rs/node_rewards/canister/protobuf/src/pb/rewards_calculator/mod.rs</code></li><li><code>rs/node_rewards/canister/protobuf_generator/src/lib.rs</code></li><li><code>rs/node_rewards/canister/protobuf_generator/src/main.rs</code></li><li><code>rs/node_rewards/canister/src/canister/mod.rs</code></li><li><code>rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs</code></li><li><code>rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs</code></li><li><code>rs/node_rewards/canister/src/canister/test/sync_all.rs</code></li><li><code>rs/node_rewards/canister/src/canister/test/test_utils.rs</code></li><li><code>rs/node_rewards/canister/src/chrono_utils.rs</code></li><li><code>rs/node_rewards/canister/src/gen/ic_node_rewards.pb.v1.rs</code></li><li><code>rs/node_rewards/canister/src/lib.rs</code></li><li><code>rs/node_rewards/canister/src/main.rs</code></li><li><code>rs/node_rewards/canister/src/metrics.rs</code></li><li><code>rs/node_rewards/canister/src/metrics/tests.rs</code></li><li><code>rs/node_rewards/canister/src/pb/mod.rs</code></li><li><code>rs/node_rewards/canister/src/registry_querier.rs</code></li><li><code>rs/node_rewards/canister/src/registry_querier/tests.rs</code></li><li><code>rs/node_rewards/canister/src/storage.rs</code></li><li><code>rs/node_rewards/canister/src/telemetry.rs</code></li><li><code>rs/node_rewards/canister/src/timer_tasks.rs</code></li><li><code>rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs</code></li><li><code>rs/node_rewards/canister/tests/regisry_sync_test.rs</code></li><li><code>rs/node_rewards/rewards_calculation/BUILD.bazel</code></li><li><code>rs/node_rewards/rewards_calculation/Cargo.toml</code></li><li><code>rs/node_rewards/rewards_calculation/src/lib.rs</code></li><li><code>rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs</code></li><li><code>rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs</code></li><li><code>rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs</code></li><li><code>rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs</code></li><li><code>rs/node_rewards/rewards_calculation/src/rewards_calculator/mod.rs</code></li><li><code>rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs</code></li><li><code>rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs</code></li><li><code>rs/node_rewards/rewards_calculation/src/types.rs</code></li><li><code>rs/registry/node_provider_rewards/src/lib.rs</code></li><li><code>rs/registry/node_provider_rewards/src/logs.rs</code></li>
                    </ul>
                </div>
            </div>
            
            <div class="section">
                <h2>🔍 Detailed Changes</h2>
                <div class="commit-detail">
                    <div class="commit-header">
                        <div class="commit-title">
                            <a href="https://github.com/dfinity/ic/commit/46e8847699a9d2eba30bb47872b977e083f9d385" class="commit-hash-large" target="_blank">46e8847699a9d2eba30bb47872b977e083f9d385</a>
                            <span class="badge chore">chore</span>
                        </div>
                        <div class="commit-meta">
                            <span>👤 pietrodimarco-dfinity &lt;124565147+pietrodimarco-dfinity@users.noreply.github.com&gt;</span>
                            <span>📅 2025-10-15</span>
                            <span>📁 14 files</span>
                        </div>
                        <div style="margin-top: 8px; color: #e6edf3; font-size: 0.9em;">
                            chore(node-rewards-canister): RecurringSyncTask for updating registry and node metrics (#7239)
                        </div>
                        <div class="commit-actions">
                            <button class="toggle-button secondary" onclick="toggleFiles('files-0')">📁 Files (14)</button>
                            <button class="toggle-button" onclick="toggleDiff('diff-0')">🔍 Code Changes</button>
                        </div>
                        <div id="files-0" class="collapsible">
                            <div class="files-list">
                                <ul><li>rs/node_rewards/canister/BUILD.bazel</li><li>rs/node_rewards/canister/Cargo.toml</li><li>rs/node_rewards/canister/src/canister/mod.rs</li><li>rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs</li><li>rs/node_rewards/canister/src/canister/test/sync_all.rs</li><li>rs/node_rewards/canister/src/canister/test/test_utils.rs</li><li>rs/node_rewards/canister/src/lib.rs</li><li>rs/node_rewards/canister/src/main.rs</li><li>rs/node_rewards/canister/src/metrics.rs</li><li>rs/node_rewards/canister/src/metrics/tests.rs</li><li>rs/node_rewards/canister/src/storage.rs</li><li>rs/node_rewards/canister/src/timer_tasks.rs</li><li>rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs</li><li>rs/node_rewards/canister/tests/regisry_sync_test.rs</li></ul></div></div>
                        <div id="diff-0" class="collapsible">
                            <div class="diff-container">
                                <div class="line context"><span class="line-number">1</span><span class="line-content">commit 46e8847699a9d2eba30bb47872b977e083f9d385</span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content">Author: pietrodimarco-dfinity &lt;124565147+pietrodimarco-dfinity@users.noreply.github.com&gt;</span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content">Date:   Wed Oct 15 09:11:56 2025 +0200</span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content">    chore(node-rewards-canister): RecurringSyncTask for updating registry and node metrics (#7239)</span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content">    Changes:</span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content">    - Syncing registry and metrics with RecurringSyncTask instead of custom</span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content">    implementation</span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content">    - Timer syncs registry and metrics every hr + 5 min (to fetch asap</span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">    metrics for yesterday)</span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content">    - Simplified metrics syncing: Metrics manager does not handle retries</span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content">    but relies on timer</span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content">    - Added `last_day_synced` check to prevent computing rewards in case of</span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content">    missing metrics</span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content">diff --git a/rs/node_rewards/canister/BUILD.bazel b/rs/node_rewards/canister/BUILD.bazel</span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content">index 0e5213753b..0c8cddbb19 100644</span></div>
<div class="file-header">--- a/rs/node_rewards/canister/BUILD.bazel</div>
<div class="file-header">+++ b/rs/node_rewards/canister/BUILD.bazel</div>
<div class="hunk-header">@@ -9,6 +9,7 @@ DEPENDENCIES = [</div>
<div class="line context"><span class="line-number">9</span><span class="line-content">     &quot;//rs/interfaces/registry&quot;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/BUILD.bazel#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content">     &quot;//rs/nervous_system/canisters&quot;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/BUILD.bazel#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content">     &quot;//rs/nervous_system/common&quot;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/BUILD.bazel#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+12</span><span class="line-content">    &quot;//rs/nervous_system/timer_task&quot;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/BUILD.bazel#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content">     &quot;//rs/nns/constants&quot;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/BUILD.bazel#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content">     &quot;//rs/node_rewards/canister/api&quot;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/BUILD.bazel#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content">     &quot;//rs/node_rewards/rewards_calculation&quot;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/BUILD.bazel#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content">diff --git a/rs/node_rewards/canister/Cargo.toml b/rs/node_rewards/canister/Cargo.toml<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/BUILD.bazel#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content">index 68435759ce..784e76ca25 100644<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/BUILD.bazel#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/Cargo.toml</div>
<div class="file-header">+++ b/rs/node_rewards/canister/Cargo.toml</div>
<div class="hunk-header">@@ -24,6 +24,7 @@ ic-management-canister-types = { workspace = true }</div>
<div class="line context"><span class="line-number">24</span><span class="line-content"> ic-metrics-encoder = &quot;1.1.1&quot;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/Cargo.toml#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">25</span><span class="line-content"> ic-nervous-system-canisters = { path = &quot;../../nervous_system/canisters&quot; }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/Cargo.toml#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">26</span><span class="line-content"> ic-nervous-system-common = { path = &quot;../../nervous_system/common&quot; }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/Cargo.toml#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+27</span><span class="line-content">ic-nervous-system-timer-task = { path = &quot;../../nervous_system/timer_task&quot; }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/Cargo.toml#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">28</span><span class="line-content"> ic-nns-constants = { path = &quot;../../nns/constants&quot; }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/Cargo.toml#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">29</span><span class="line-content"> ic-node-rewards-canister-api = { path = &quot;./api&quot; }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/Cargo.toml#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">30</span><span class="line-content"> ic-registry-canister-client = { path = &quot;../../registry/canister-client&quot; }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/Cargo.toml#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">31</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/canister/mod.rs b/rs/node_rewards/canister/src/canister/mod.rs<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/Cargo.toml#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">32</span><span class="line-content">index f8f23e02d2..6377f80946 100644<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/Cargo.toml#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/canister/mod.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/canister/mod.rs</div>
<div class="hunk-header">@@ -1,10 +1,9 @@</div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> use crate::chrono_utils::last_unix_timestamp_nanoseconds;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use crate::metrics::MetricsManager;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use crate::registry_querier::RegistryQuerier;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-4</span><span class="line-content">use crate::storage::VM;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+4</span><span class="line-content">use crate::storage::{NaiveDateStorable, VM};<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use chrono::{DateTime, NaiveDate};<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use ic_base_types::{PrincipalId, SubnetId};<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content">use ic_interfaces_registry::ZERO_REGISTRY_VERSION;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> use ic_node_rewards_canister_api::monthly_rewards::{<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content">     GetNodeProvidersMonthlyXdrRewardsRequest, GetNodeProvidersMonthlyXdrRewardsResponse,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content">     NodeProvidersMonthlyXdrRewards,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -24,12 +23,13 @@ use ic_registry_keys::{</div>
<div class="line context"><span class="line-number">23</span><span class="line-content">     DATA_CENTER_KEY_PREFIX, NODE_OPERATOR_RECORD_KEY_PREFIX, NODE_REWARDS_TABLE_KEY,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">24</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">25</span><span class="line-content"> use ic_registry_node_provider_rewards::{RewardsPerNodeProvider, calculate_rewards_v0};<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+26</span><span class="line-content">use ic_stable_structures::StableCell;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">27</span><span class="line-content"> use ic_types::{RegistryVersion, Time};<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">28</span><span class="line-content"> use rewards_calculation::performance_based_algorithm::results::RewardsCalculatorResults;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">29</span><span class="line-content"> use rewards_calculation::performance_based_algorithm::v1::RewardsCalculationV1;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">30</span><span class="line-content"> use rewards_calculation::types::{NodeMetricsDailyRaw, RewardableNode};<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">31</span><span class="line-content"> use std::cell::RefCell;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-32</span><span class="line-content">use std::collections::{BTreeMap, HashSet};<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+32</span><span class="line-content">use std::collections::BTreeMap;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">33</span><span class="line-content"> use std::rc::Rc;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">34</span><span class="line-content"> use std::sync::Arc;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">35</span><span class="line-content"> use std::thread::LocalKey;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -38,13 +38,13 @@ use std::thread::LocalKey;</div>
<div class="line context"><span class="line-number">38</span><span class="line-content"> mod test;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">39</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">40</span><span class="line-content"> #[cfg(target_arch = &quot;wasm32&quot;)]<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-41</span><span class="line-content">fn current_time() -&gt; Time {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+41</span><span class="line-content">pub fn current_time() -&gt; Time {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">42</span><span class="line-content">     let current_time = ic_cdk::api::time();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">43</span><span class="line-content">     Time::from_nanos_since_unix_epoch(current_time)<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">44</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">45</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">46</span><span class="line-content"> #[cfg(not(any(target_arch = &quot;wasm32&quot;)))]<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-47</span><span class="line-content">fn current_time() -&gt; Time {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+47</span><span class="line-content">pub fn current_time() -&gt; Time {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">48</span><span class="line-content">     ic_types::time::current_time()<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">49</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">50</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -54,7 +54,7 @@ fn current_time() -&gt; Time {</div>
<div class="line context"><span class="line-number">54</span><span class="line-content"> pub struct NodeRewardsCanister {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">55</span><span class="line-content">     registry_client: Arc&lt;dyn CanisterRegistryClient&gt;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">56</span><span class="line-content">     metrics_manager: Rc&lt;MetricsManager&lt;VM&gt;&gt;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-57</span><span class="line-content">    last_metrics_update: RegistryVersion,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+57</span><span class="line-content">    last_day_synced: &amp;&#x27;static LocalKey&lt;RefCell&lt;StableCell&lt;Option&lt;NaiveDateStorable&gt;, VM&gt;&gt;&gt;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">58</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">59</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">60</span><span class="line-content"> /// Internal methods<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -62,11 +62,12 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">62</span><span class="line-content">     pub fn new(<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">63</span><span class="line-content">         registry_client: Arc&lt;dyn CanisterRegistryClient&gt;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">64</span><span class="line-content">         metrics_manager: Rc&lt;MetricsManager&lt;VM&gt;&gt;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+65</span><span class="line-content">        last_day_synced: &amp;&#x27;static LocalKey&lt;RefCell&lt;StableCell&lt;Option&lt;NaiveDateStorable&gt;, VM&gt;&gt;&gt;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">66</span><span class="line-content">     ) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">67</span><span class="line-content">         Self {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-67</span><span class="line-content">            last_metrics_update: registry_client.get_latest_version(),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">68</span><span class="line-content">             registry_client,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">69</span><span class="line-content">             metrics_manager,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+70</span><span class="line-content">            last_day_synced,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">71</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">72</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">73</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -87,6 +88,18 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">88</span><span class="line-content">             .map_err(|e| format!(&quot;Failed to get registry value: {:?}&quot;, e))<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">89</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">90</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+91</span><span class="line-content">    pub fn get_last_day_synced(&amp;self) -&gt; Option&lt;NaiveDate&gt; {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+92</span><span class="line-content">        self.last_day_synced<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+93</span><span class="line-content">            .with_borrow(|last_day_synced| last_day_synced.get().clone().map(|d| d.0))<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+94</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L94" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+95</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+96</span><span class="line-content">    pub fn set_last_day_synced(&amp;self, last_day_synced: NaiveDate) {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L96" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+97</span><span class="line-content">        self.last_day_synced.with_borrow_mut(|cell| {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+98</span><span class="line-content">            cell.set(Some(NaiveDateStorable(last_day_synced)))<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L98" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+99</span><span class="line-content">                .expect(&quot;Could not set last day synced&quot;);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+100</span><span class="line-content">        });<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L100" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+101</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L101" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+102</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">103</span><span class="line-content">     pub async fn schedule_registry_sync(<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">104</span><span class="line-content">         canister: &amp;&#x27;static LocalKey&lt;RefCell&lt;NodeRewardsCanister&gt;&gt;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L104" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">105</span><span class="line-content">     ) -&gt; Result&lt;RegistryVersion, String&gt; {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L105" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -95,50 +108,52 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">108</span><span class="line-content">         registry_client.sync_registry_stored().await<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L108" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">109</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L109" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">110</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L110" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-98</span><span class="line-content">    pub async fn schedule_metrics_sync(canister: &amp;&#x27;static LocalKey&lt;RefCell&lt;NodeRewardsCanister&gt;&gt;) {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L98" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-99</span><span class="line-content">        let (registry_client, metrics_manager, pre_sync_version) = canister.with(|canister| {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+111</span><span class="line-content">    pub async fn schedule_metrics_sync(<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L111" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+112</span><span class="line-content">        canister: &amp;&#x27;static LocalKey&lt;RefCell&lt;NodeRewardsCanister&gt;&gt;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L112" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+113</span><span class="line-content">    ) -&gt; Result&lt;(), String&gt; {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L113" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+114</span><span class="line-content">        let (registry_client, metrics_manager) = canister.with(|canister| {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L114" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">115</span><span class="line-content">             (<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L115" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">116</span><span class="line-content">                 canister.borrow().get_registry_client(),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L116" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">117</span><span class="line-content">                 canister.borrow().get_metrics_manager(),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L117" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-103</span><span class="line-content">                canister.borrow().last_metrics_update,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">118</span><span class="line-content">             )<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L118" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">119</span><span class="line-content">         });<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L119" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-106</span><span class="line-content">        let post_sync_version = registry_client.get_latest_version();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L106" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">120</span><span class="line-content">         let registry_querier = RegistryQuerier::new(registry_client.clone());<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L120" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+121</span><span class="line-content">        let version = registry_client.get_latest_version();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L121" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+122</span><span class="line-content">        let subnets_list = registry_querier.subnets_list(version);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L122" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+123</span><span class="line-content">        let last_day_synced: NaiveDate =<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L123" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+124</span><span class="line-content">            metrics_manager.update_subnets_metrics(subnets_list).await?;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L124" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+125</span><span class="line-content">        canister.with_borrow(|canister| {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L125" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+126</span><span class="line-content">            canister.set_last_day_synced(last_day_synced);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L126" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+127</span><span class="line-content">        });<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L127" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">128</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L128" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-109</span><span class="line-content">        let mut subnets_list: HashSet&lt;SubnetId&gt; = HashSet::default();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L109" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-110</span><span class="line-content">        let mut version = if pre_sync_version == ZERO_REGISTRY_VERSION {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L110" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-111</span><span class="line-content">            // If the pre-sync version is 0, we consider all subnets from the post-sync version<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L111" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-112</span><span class="line-content">            post_sync_version<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L112" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-113</span><span class="line-content">        } else {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L113" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-114</span><span class="line-content">            pre_sync_version<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L114" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-115</span><span class="line-content">        };<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L115" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-116</span><span class="line-content">        while version &lt;= post_sync_version {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L116" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-117</span><span class="line-content">            subnets_list.extend(registry_querier.subnets_list(version));<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L117" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+129</span><span class="line-content">        Ok(())<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L129" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+130</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L130" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">131</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L131" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-119</span><span class="line-content">            // Increment the version to sync the next one<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L119" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-120</span><span class="line-content">            version = version.increment();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L120" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+132</span><span class="line-content">    fn validate_reward_period(<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L132" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+133</span><span class="line-content">        &amp;self,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L133" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+134</span><span class="line-content">        from_date: &amp;NaiveDate,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L134" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+135</span><span class="line-content">        to_date: &amp;NaiveDate,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L135" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+136</span><span class="line-content">    ) -&gt; Result&lt;(), String&gt; {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L136" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+137</span><span class="line-content">        let last_day_synced = self<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L137" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+138</span><span class="line-content">            .get_last_day_synced()<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L138" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+139</span><span class="line-content">            .ok_or(&quot;Metrics and registry are not synced up&quot;)?;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L139" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+140</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L140" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+141</span><span class="line-content">        if last_day_synced &lt; *to_date {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L141" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+142</span><span class="line-content">            return Err(&quot;Metrics and registry are not synced up to to_date&quot;.to_string());<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L142" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">143</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L143" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">144</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L144" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-123</span><span class="line-content">        metrics_manager<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L123" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-124</span><span class="line-content">            .update_subnets_metrics(subnets_list.into_iter().collect())<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L124" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-125</span><span class="line-content">            .await;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L125" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-126</span><span class="line-content">        metrics_manager.retry_failed_subnets().await;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L126" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-127</span><span class="line-content">        canister.with_borrow_mut(|canister| {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L127" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-128</span><span class="line-content">            canister.last_metrics_update = post_sync_version;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L128" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-129</span><span class="line-content">        });<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L129" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-130</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L130" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+145</span><span class="line-content">        if from_date &gt; to_date {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L145" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+146</span><span class="line-content">            return Err(&quot;from_date must be before to_date&quot;.to_string());<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+147</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L147" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">148</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L148" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-132</span><span class="line-content">    fn validate_reward_period(from_date: &amp;NaiveDate, to_date: &amp;NaiveDate) -&gt; Result&lt;(), String&gt; {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L132" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">149</span><span class="line-content">         let today =<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">150</span><span class="line-content">             DateTime::from_timestamp_nanos(current_time().as_nanos_since_unix_epoch() as i64)<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L150" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">151</span><span class="line-content">                 .date_naive();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L151" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-136</span><span class="line-content">        if from_date &gt; to_date {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L136" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-137</span><span class="line-content">            return Err(&quot;from_date must be before to_date&quot;.to_string());<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L137" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-138</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L138" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+152</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L152" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">153</span><span class="line-content">         if to_date &gt;= &amp;today {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L153" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">154</span><span class="line-content">             return Err(&quot;to_date must be earlier than today&quot;.to_string());<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L154" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">155</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L155" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+156</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L156" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">157</span><span class="line-content">         Ok(())<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L157" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">158</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L158" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">159</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L159" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -148,7 +163,7 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">163</span><span class="line-content">     ) -&gt; Result&lt;RewardsCalculatorResults, String&gt; {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L163" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">164</span><span class="line-content">         let start_day = NaiveDate::try_from(request.from_day)?;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L164" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">165</span><span class="line-content">         let end_day = NaiveDate::try_from(request.to_day)?;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L165" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-151</span><span class="line-content">        Self::validate_reward_period(&amp;start_day, &amp;end_day)?;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L151" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+166</span><span class="line-content">        self.validate_reward_period(&amp;start_day, &amp;end_day)?;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L166" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">167</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L167" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">168</span><span class="line-content">         RewardsCalculationV1::calculate_rewards(&amp;start_day, &amp;end_day, self)<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L168" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">169</span><span class="line-content">             .map_err(|e| format!(&quot;Could not calculate rewards: {e:?}&quot;))<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L169" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -262,20 +277,10 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">277</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L277" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">278</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L278" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">279</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L279" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-265</span><span class="line-content">    pub async fn get_node_providers_rewards(<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L265" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+280</span><span class="line-content">    pub fn get_node_providers_rewards(<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L280" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">281</span><span class="line-content">         canister: &amp;&#x27;static LocalKey&lt;RefCell&lt;NodeRewardsCanister&gt;&gt;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L281" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">282</span><span class="line-content">         request: GetNodeProvidersRewardsRequest,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L282" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">283</span><span class="line-content">     ) -&gt; GetNodeProvidersRewardsResponse {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L283" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-269</span><span class="line-content">        NodeRewardsCanister::schedule_registry_sync(canister)<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L269" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-270</span><span class="line-content">            .await<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L270" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-271</span><span class="line-content">            .map_err(|e| {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L271" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-272</span><span class="line-content">                format!(<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L272" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-273</span><span class="line-content">                    &quot;Could not sync registry store to latest version, \<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L273" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-274</span><span class="line-content">                    please try again later: {:?}&quot;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L274" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-275</span><span class="line-content">                    e<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L275" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-276</span><span class="line-content">                )<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L276" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-277</span><span class="line-content">            })?;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L277" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-278</span><span class="line-content">        NodeRewardsCanister::schedule_metrics_sync(canister).await;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/mod.rs#L278" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">284</span><span class="line-content">         let result = canister.with_borrow(|canister| canister.calculate_rewards(request))?;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L284" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">285</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L285" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">286</span><span class="line-content">         let rewards_xdr_permyriad = result<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L286" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">287</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs b/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L287" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">288</span><span class="line-content">index d24a62132c..27f3eaed95 100644<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/mod.rs#L288" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs</div>
<div class="hunk-header">@@ -1,8 +1,11 @@</div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> use crate::canister::NodeRewardsCanister;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content">use crate::canister::test::test_utils::{CANISTER_TEST, VM, setup_thread_local_canister_for_test};<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+2</span><span class="line-content">use crate::canister::test::test_utils::{<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+3</span><span class="line-content">    CANISTER_TEST, LAST_DAY_SYNCED, VM, setup_thread_local_canister_for_test,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+4</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use crate::chrono_utils::{last_unix_timestamp_nanoseconds, to_native_date};<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use crate::metrics::MetricsManager;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> use crate::pb::v1::{NodeMetrics, SubnetMetricsKey, SubnetMetricsValue};<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content">use crate::storage::NaiveDateStorable;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> use futures_util::FutureExt;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> use ic_nervous_system_canisters::registry::fake::FakeRegistry;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> use ic_node_rewards_canister_api::providers_rewards::{<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -299,6 +302,7 @@ fn setup_data_for_test_rewards_calculation(</div>
<div class="line context"><span class="line-number">302</span><span class="line-content">             }],<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L302" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">303</span><span class="line-content">         },<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L303" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">304</span><span class="line-content">     );<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L304" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+305</span><span class="line-content">    LAST_DAY_SYNCED.with_borrow_mut(|cell| cell.set(Some(NaiveDateStorable(day2))).unwrap());<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L305" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">306</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L306" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">307</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L307" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">308</span><span class="line-content"> #[test]<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L308" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -308,7 +312,6 @@ fn test_get_node_providers_rewards() {</div>
<div class="line context"><span class="line-number">312</span><span class="line-content">     let (fake_registry, metrics_manager) = setup_thread_local_canister_for_test();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L312" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">313</span><span class="line-content">     setup_data_for_test_rewards_calculation(fake_registry, metrics_manager);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L313" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">314</span><span class="line-content">     NodeRewardsCanister::schedule_registry_sync(&amp;CANISTER_TEST).now_or_never();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L314" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-311</span><span class="line-content">    NodeRewardsCanister::schedule_metrics_sync(&amp;CANISTER_TEST).now_or_never();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L311" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">315</span><span class="line-content">     let from = to_native_date(&quot;2024-01-01&quot;);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L315" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">316</span><span class="line-content">     let to = to_native_date(&quot;2024-01-02&quot;);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L316" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">317</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L317" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -317,9 +320,7 @@ fn test_get_node_providers_rewards() {</div>
<div class="line context"><span class="line-number">320</span><span class="line-content">         to_day: to.into(),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L320" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">321</span><span class="line-content">     };<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L321" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">322</span><span class="line-content">     let result_endpoint =<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L322" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-320</span><span class="line-content">        NodeRewardsCanister::get_node_providers_rewards(&amp;CANISTER_TEST, request.clone())<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L320" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-321</span><span class="line-content">            .now_or_never()<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L321" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-322</span><span class="line-content">            .unwrap();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L322" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+323</span><span class="line-content">        NodeRewardsCanister::get_node_providers_rewards(&amp;CANISTER_TEST, request.clone());<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L323" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">324</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L324" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">325</span><span class="line-content">     let expected = NodeProvidersRewards {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L325" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">326</span><span class="line-content">         rewards_xdr_permyriad: btreemap! {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L326" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">327</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/canister/test/sync_all.rs b/rs/node_rewards/canister/src/canister/test/sync_all.rs<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L327" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">328</span><span class="line-content">index ba53d290a5..385c8bce20 100644<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L328" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/canister/test/sync_all.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/canister/test/sync_all.rs</div>
<div class="hunk-header">@@ -38,6 +38,7 @@ fn sync_all() {</div>
<div class="line context"><span class="line-number">38</span><span class="line-content">         .unwrap();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">39</span><span class="line-content">     NodeRewardsCanister::schedule_metrics_sync(&amp;CANISTER_TEST)<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">40</span><span class="line-content">         .now_or_never()<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+41</span><span class="line-content">        .unwrap()<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">42</span><span class="line-content">         .unwrap();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">43</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">44</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -94,14 +95,15 @@ fn test_sync_non_zero_registry_version() {</div>
<div class="line context"><span class="line-number">95</span><span class="line-content">         subnet_id(8),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">96</span><span class="line-content">         subnet_id(9),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L96" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">97</span><span class="line-content">     ];<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-97</span><span class="line-content">    add_subnet_list(fake_registry.clone(), subnets_second_sync[..3].to_vec());<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/test/sync_all.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-98</span><span class="line-content">    add_subnet_list(fake_registry.clone(), subnets_second_sync[3..].to_vec());<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/test/sync_all.rs#L98" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+98</span><span class="line-content">    add_subnet_list(fake_registry.clone(), subnets_second_sync.clone());<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L98" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">99</span><span class="line-content">     sync_all();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">100</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L100" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">101</span><span class="line-content">     let registry_client = CANISTER_TEST.with_borrow(|canister| canister.get_registry_client());<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L101" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">102</span><span class="line-content">     let metrics_manager = CANISTER_TEST.with_borrow(|canister| canister.get_metrics_manager());<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">103</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-104</span><span class="line-content">    let expected_version = RegistryVersion::from(3);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/test/sync_all.rs#L104" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+104</span><span class="line-content">    let expected_version = RegistryVersion::from(2);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L104" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+105</span><span class="line-content">    assert_eq!(expected_version, registry_client.get_latest_version());<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L105" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+106</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L106" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">107</span><span class="line-content">     // From NON ZERO_REGISTRY_VERSION, we expect all subnets to be synced.<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L107" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">108</span><span class="line-content">     let expected_subnets: Vec&lt;SubnetId&gt; = subnets_first_sync<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L108" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">109</span><span class="line-content">         .into_iter()<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L109" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -114,6 +116,5 @@ fn test_sync_non_zero_registry_version() {</div>
<div class="line context"><span class="line-number">116</span><span class="line-content">         .map(|(k, _)| k.subnet_id.unwrap().into())<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L116" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">117</span><span class="line-content">         .collect::&lt;Vec&lt;_&gt;&gt;();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L117" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">118</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L118" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-117</span><span class="line-content">    assert_eq!(expected_version, registry_client.get_latest_version());<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/test/sync_all.rs#L117" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">119</span><span class="line-content">     assert_eq!(expected_subnets, got_subnets);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L119" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">120</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L120" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">121</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/canister/test/test_utils.rs b/rs/node_rewards/canister/src/canister/test/test_utils.rs<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L121" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">122</span><span class="line-content">index 248313de41..d2fc2470c5 100644<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/sync_all.rs#L122" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/canister/test/test_utils.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/canister/test/test_utils.rs</div>
<div class="hunk-header">@@ -1,7 +1,7 @@</div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> #![allow(deprecated)]<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use crate::canister::NodeRewardsCanister;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use crate::metrics::MetricsManager;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-4</span><span class="line-content">use crate::storage::METRICS_MANAGER;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/test/test_utils.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+4</span><span class="line-content">use crate::storage::{METRICS_MANAGER, NaiveDateStorable};<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use ic_cdk::api::call::CallResult;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use ic_management_canister_types::NodeMetricsHistoryRecord;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> use ic_nervous_system_canisters::registry::fake::FakeRegistry;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -11,7 +11,7 @@ use ic_registry_canister_client::{</div>
<div class="line context"><span class="line-number">11</span><span class="line-content">     test_registry_data_stable_memory_impl,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> use ic_stable_structures::memory_manager::{MemoryId, MemoryManager, VirtualMemory};<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-14</span><span class="line-content">use ic_stable_structures::{DefaultMemoryImpl, StableBTreeMap};<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/test/test_utils.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+14</span><span class="line-content">use ic_stable_structures::{DefaultMemoryImpl, StableBTreeMap, StableCell};<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> use std::cell::RefCell;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> use std::rc::Rc;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content"> use std::sync::Arc;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -23,12 +23,18 @@ thread_local! {</div>
<div class="line context"><span class="line-number">23</span><span class="line-content">         let mgr = MemoryManager::init(DefaultMemoryImpl::default());<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">24</span><span class="line-content">         StableBTreeMap::init(mgr.get(MemoryId::new(0)))<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">25</span><span class="line-content">     });<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+26</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+27</span><span class="line-content">    pub static LAST_DAY_SYNCED: RefCell&lt;StableCell&lt;Option&lt;NaiveDateStorable&gt;, VM&gt;&gt; = RefCell::new({<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+28</span><span class="line-content">        let mgr = MemoryManager::init(DefaultMemoryImpl::default());<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+29</span><span class="line-content">        StableCell::init(mgr.get(MemoryId::new(1)), None).expect(&quot;Could not initialize last_day_synced&quot;)<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+30</span><span class="line-content">    });<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+31</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">32</span><span class="line-content">     // Dummy value b/c we can&#x27;t do direct assignment using values defined above.<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">33</span><span class="line-content">     pub(crate) static CANISTER_TEST: RefCell&lt;NodeRewardsCanister&gt; = {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">34</span><span class="line-content">         let registry_store = Arc::new(StableCanisterRegistryClient::&lt;TestState&gt;::new(Arc::new(FakeRegistry::default())));<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">35</span><span class="line-content">         let metrics_manager = METRICS_MANAGER.with(|m| m.clone());<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">36</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-31</span><span class="line-content">        RefCell::new(NodeRewardsCanister::new(registry_store, metrics_manager))<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/canister/test/test_utils.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+37</span><span class="line-content">        RefCell::new(NodeRewardsCanister::new(registry_store, metrics_manager, &amp;LAST_DAY_SYNCED))<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">38</span><span class="line-content">     };<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">39</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">40</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -50,6 +56,7 @@ pub(crate) fn setup_thread_local_canister_for_test() -&gt; (Arc&lt;FakeRegistry&gt;, Rc&lt;M</div>
<div class="line context"><span class="line-number">56</span><span class="line-content">         ))<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">57</span><span class="line-content">         .clone(),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">58</span><span class="line-content">         metrics_manager.clone(),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+59</span><span class="line-content">        &amp;LAST_DAY_SYNCED,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">60</span><span class="line-content">     );<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">61</span><span class="line-content">     CANISTER_TEST.with_borrow_mut(|c| *c = canister);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">62</span><span class="line-content">     (fake_registry, metrics_manager)<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">63</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/lib.rs b/rs/node_rewards/canister/src/lib.rs<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">64</span><span class="line-content">index a1161a5093..a7d9af7516 100644<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/canister/test/test_utils.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/lib.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/lib.rs</div>
<div class="hunk-header">@@ -5,7 +5,9 @@</div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> // 4. Structure makes boundaries clear and easy to enforce<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> // 5. Simple Organization<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content">use crate::storage::NaiveDateStorable;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> use candid::Principal;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+10</span><span class="line-content">use chrono::{Datelike, NaiveDate};<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> use ic_base_types::{PrincipalId, SubnetId};<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> use ic_management_canister_types::NodeMetrics;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> use ic_stable_structures::Storable;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -20,6 +22,7 @@ pub mod pb;</div>
<div class="line context"><span class="line-number">22</span><span class="line-content"> pub mod registry_querier;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">23</span><span class="line-content"> pub mod storage;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">24</span><span class="line-content"> pub mod telemetry;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+25</span><span class="line-content">pub mod timer_tasks;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">26</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">27</span><span class="line-content"> // Maximum sizes for the storable types chosen as result of test `max_bound_size`<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">28</span><span class="line-content"> const MAX_BYTES_SUBNET_ID_STORED: u32 = 33;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -54,6 +57,28 @@ impl KeyRange for pb::v1::SubnetMetricsKey {</div>
<div class="line context"><span class="line-number">57</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">58</span><span class="line-content"> //------------ Storable Implementations ------------//<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">59</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+60</span><span class="line-content">impl Storable for NaiveDateStorable {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+61</span><span class="line-content">    fn to_bytes(&amp;self) -&gt; Cow&lt;&#x27;_, [u8]&gt; {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+62</span><span class="line-content">        // We&#x27;ll store it as a 32-bit integer: number of days since a fixed epoch.<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+63</span><span class="line-content">        // NaiveDate stores dates internally as (year, ordinal_day), but we can easily<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+64</span><span class="line-content">        // reconstruct it from a serializable integer.<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+65</span><span class="line-content">        let days = self.0.num_days_from_ce();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+66</span><span class="line-content">        Cow::Owned(days.to_be_bytes().to_vec())<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+67</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+68</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+69</span><span class="line-content">    fn from_bytes(bytes: Cow&lt;[u8]&gt;) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+70</span><span class="line-content">        let mut arr = [0u8; 4];<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+71</span><span class="line-content">        arr.copy_from_slice(&amp;bytes);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+72</span><span class="line-content">        let days = i32::from_be_bytes(arr);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+73</span><span class="line-content">        Self(NaiveDate::from_num_days_from_ce_opt(days).unwrap())<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+74</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+75</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+76</span><span class="line-content">    const BOUND: Bound = Bound::Bounded {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+77</span><span class="line-content">        max_size: 4,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+78</span><span class="line-content">        is_fixed_size: true,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+79</span><span class="line-content">    };<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+80</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+81</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">82</span><span class="line-content"> impl Storable for pb::v1::SubnetIdKey {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">83</span><span class="line-content">     fn to_bytes(&amp;self) -&gt; std::borrow::Cow&lt;&#x27;_, [u8]&gt; {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">84</span><span class="line-content">         Cow::Owned(self.encode_to_vec())<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">85</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/main.rs b/rs/node_rewards/canister/src/main.rs<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">86</span><span class="line-content">index 7b9de699a8..47345c2b4a 100644<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/lib.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/main.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/main.rs</div>
<div class="hunk-header">@@ -1,10 +1,13 @@</div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> use ic_cdk::api::in_replicated_execution;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use ic_cdk::{init, post_upgrade, pre_upgrade, query, update};<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use ic_nervous_system_canisters::registry::RegistryCanister;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+4</span><span class="line-content">use ic_nervous_system_timer_task::{RecurringSyncTask, TimerTaskMetricsRegistry};<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use ic_nns_constants::GOVERNANCE_CANISTER_ID;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use ic_node_rewards_canister::canister::NodeRewardsCanister;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-6</span><span class="line-content">use ic_node_rewards_canister::storage::{METRICS_MANAGER, RegistryStoreStableMemoryBorrower};<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content">use ic_node_rewards_canister::telemetry;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+7</span><span class="line-content">use ic_node_rewards_canister::storage::{<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content">    LAST_DAY_SYNCED, METRICS_MANAGER, RegistryStoreStableMemoryBorrower,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+9</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+10</span><span class="line-content">use ic_node_rewards_canister::timer_tasks::HourlySyncTask;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> use ic_node_rewards_canister_api::monthly_rewards::{<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">     GetNodeProvidersMonthlyXdrRewardsRequest, GetNodeProvidersMonthlyXdrRewardsResponse,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -17,7 +20,6 @@ use ic_node_rewards_canister_api::providers_rewards::{</div>
<div class="line context"><span class="line-number">20</span><span class="line-content"> use ic_registry_canister_client::StableCanisterRegistryClient;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">21</span><span class="line-content"> use std::cell::RefCell;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">22</span><span class="line-content"> use std::sync::Arc;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-20</span><span class="line-content">use std::time::Duration;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">23</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">24</span><span class="line-content"> fn main() {}<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">25</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -33,8 +35,10 @@ thread_local! {</div>
<div class="line context"><span class="line-number">35</span><span class="line-content">         });<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">36</span><span class="line-content">         let metrics_manager = METRICS_MANAGER.with(|m| m.clone());<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">37</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-36</span><span class="line-content">        RefCell::new(NodeRewardsCanister::new(registry_store, metrics_manager))<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+38</span><span class="line-content">        RefCell::new(NodeRewardsCanister::new(registry_store, metrics_manager, &amp;LAST_DAY_SYNCED))<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">39</span><span class="line-content">     };<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+40</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+41</span><span class="line-content">    static METRICS_REGISTRY: RefCell&lt;TimerTaskMetricsRegistry&gt; = RefCell::new(TimerTaskMetricsRegistry::default());<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">42</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">43</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">44</span><span class="line-content"> #[init]<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -50,42 +54,8 @@ fn post_upgrade() {</div>
<div class="line context"><span class="line-number">54</span><span class="line-content">     schedule_timers();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">55</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">56</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-53</span><span class="line-content">// The frequency of regular registry syncs.  This is set to 1 hour to avoid<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-54</span><span class="line-content">// making too many requests.  Before meaningful calculations are made, however, the<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-55</span><span class="line-content">// registry data should be updated.<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-56</span><span class="line-content">const SYNC_INTERVAL_SECONDS: Duration = Duration::from_secs(60 * 60); // 1 hour<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-57</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-58</span><span class="line-content">fn schedule_timers() {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-59</span><span class="line-content">    ic_cdk_timers::set_timer_interval(SYNC_INTERVAL_SECONDS, move || {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-60</span><span class="line-content">        ic_cdk::futures::spawn_017_compat(async move {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-61</span><span class="line-content">            telemetry::PROMETHEUS_METRICS.with_borrow_mut(|m| m.mark_last_sync_start());<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-62</span><span class="line-content">            let mut instruction_counter = telemetry::InstructionCounter::default();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-63</span><span class="line-content">            instruction_counter.lap();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-64</span><span class="line-content">            let registry_sync_result = NodeRewardsCanister::schedule_registry_sync(&amp;CANISTER).await;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-65</span><span class="line-content">            let registry_sync_instructions = instruction_counter.lap();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-66</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-67</span><span class="line-content">            let mut metrics_sync_instructions: u64 = 0;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-68</span><span class="line-content">            match registry_sync_result {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-69</span><span class="line-content">                Ok(_) =&gt; {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-70</span><span class="line-content">                    instruction_counter.lap();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-71</span><span class="line-content">                    NodeRewardsCanister::schedule_metrics_sync(&amp;CANISTER).await;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-72</span><span class="line-content">                    metrics_sync_instructions = instruction_counter.lap();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-73</span><span class="line-content">                    ic_cdk::println!(&quot;Successfully synced subnets metrics and local registry&quot;);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-74</span><span class="line-content">                }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-75</span><span class="line-content">                Err(e) =&gt; {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-76</span><span class="line-content">                    ic_cdk::println!(&quot;Failed to sync local registry: {:?}&quot;, e)<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-77</span><span class="line-content">                }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-78</span><span class="line-content">            }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-79</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-80</span><span class="line-content">            telemetry::PROMETHEUS_METRICS.with_borrow_mut(|m| {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-81</span><span class="line-content">                m.record_last_sync_instructions(<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-82</span><span class="line-content">                    instruction_counter.sum(),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-83</span><span class="line-content">                    registry_sync_instructions,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-84</span><span class="line-content">                    metrics_sync_instructions,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-85</span><span class="line-content">                )<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-86</span><span class="line-content">            });<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-87</span><span class="line-content">        });<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-88</span><span class="line-content">    });<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+57</span><span class="line-content">pub fn schedule_timers() {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+58</span><span class="line-content">    HourlySyncTask::new(&amp;CANISTER).schedule(&amp;METRICS_REGISTRY);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">59</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">60</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">61</span><span class="line-content"> fn panic_if_caller_not_governance() {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -109,11 +79,11 @@ async fn get_node_providers_monthly_xdr_rewards(</div>
<div class="line context"><span class="line-number">79</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">80</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">81</span><span class="line-content"> #[update]<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-112</span><span class="line-content">async fn get_node_providers_rewards(<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L112" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+82</span><span class="line-content">fn get_node_providers_rewards(<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">83</span><span class="line-content">     request: GetNodeProvidersRewardsRequest,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">84</span><span class="line-content"> ) -&gt; GetNodeProvidersRewardsResponse {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">85</span><span class="line-content">     panic_if_caller_not_governance();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-116</span><span class="line-content">    NodeRewardsCanister::get_node_providers_rewards(&amp;CANISTER, request).await<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/main.rs#L116" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+86</span><span class="line-content">    NodeRewardsCanister::get_node_providers_rewards(&amp;CANISTER, request)<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">87</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">88</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">89</span><span class="line-content"> #[query]<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">90</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/metrics.rs b/rs/node_rewards/canister/src/metrics.rs<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">91</span><span class="line-content">index 28b03e43ca..856be90a5e 100644<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/main.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/metrics.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/metrics.rs</div>
<div class="hunk-header">@@ -53,7 +53,6 @@ where</div>
<div class="line context"><span class="line-number">53</span><span class="line-content">     pub(crate) client: Box&lt;dyn ManagementCanisterClient&gt;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">54</span><span class="line-content">     pub(crate) subnets_metrics:<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">55</span><span class="line-content">         RefCell&lt;StableBTreeMap&lt;SubnetMetricsKey, SubnetMetricsValue, Memory&gt;&gt;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-56</span><span class="line-content">    pub(crate) subnets_to_retry: RefCell&lt;StableBTreeMap&lt;SubnetIdKey, RetryCount, Memory&gt;&gt;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">56</span><span class="line-content">     pub(crate) last_timestamp_per_subnet: RefCell&lt;StableBTreeMap&lt;SubnetIdKey, UnixTsNanos, Memory&gt;&gt;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">57</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">58</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -61,38 +60,21 @@ impl&lt;Memory&gt; MetricsManager&lt;Memory&gt;</div>
<div class="line context"><span class="line-number">60</span><span class="line-content"> where<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">61</span><span class="line-content">     Memory: ic_stable_structures::Memory + &#x27;static,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">62</span><span class="line-content"> {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-64</span><span class="line-content">    pub async fn retry_failed_subnets(&amp;self) {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-65</span><span class="line-content">        let subnets_to_retry: Vec&lt;SubnetId&gt; = self<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-66</span><span class="line-content">            .subnets_to_retry<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-67</span><span class="line-content">            .borrow()<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-68</span><span class="line-content">            .keys()<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-69</span><span class="line-content">            .map(|key| key.into())<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-70</span><span class="line-content">            .collect();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-71</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-72</span><span class="line-content">        if !subnets_to_retry.is_empty() {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-73</span><span class="line-content">            ic_cdk::println!(&quot;Retrying metrics for subnets: {:?}&quot;, subnets_to_retry);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-74</span><span class="line-content">            self.update_subnets_metrics(subnets_to_retry).await;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-75</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-76</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-77</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">63</span><span class="line-content">     /// Fetches subnets metrics for the specified subnets from their last stored timestamp.<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">64</span><span class="line-content">     async fn fetch_subnets_metrics(<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">65</span><span class="line-content">         &amp;self,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-81</span><span class="line-content">        last_timestamp_per_subnet: &amp;BTreeMap&lt;SubnetId, Option&lt;UnixTsNanos&gt;&gt;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+66</span><span class="line-content">        last_timestamp_per_subnet: &amp;BTreeMap&lt;SubnetId, UnixTsNanos&gt;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">67</span><span class="line-content">     ) -&gt; BTreeMap&lt;SubnetId, CallResult&lt;Vec&lt;NodeMetricsHistoryRecord&gt;&gt;&gt; {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">68</span><span class="line-content">         let mut subnets_history = Vec::new();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+69</span><span class="line-content">        ic_cdk::println!(<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+70</span><span class="line-content">            &quot;Updating node metrics for {} subnets&quot;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+71</span><span class="line-content">            last_timestamp_per_subnet.keys().count()<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+72</span><span class="line-content">        );<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">73</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">74</span><span class="line-content">         for (subnet_id, last_stored_ts) in last_timestamp_per_subnet {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-86</span><span class="line-content">            let refresh_ts = last_stored_ts.unwrap_or_default();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-87</span><span class="line-content">            ic_cdk::println!(<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-88</span><span class="line-content">                &quot;Updating node metrics for subnet {}: Refreshing metrics from timestamp {}&quot;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-89</span><span class="line-content">                subnet_id,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-90</span><span class="line-content">                refresh_ts<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-91</span><span class="line-content">            );<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-92</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">75</span><span class="line-content">             let args = NodeMetricsHistoryArgs {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">76</span><span class="line-content">                 subnet_id: subnet_id.get().0,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-95</span><span class="line-content">                start_at_timestamp_nanos: refresh_ts,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+77</span><span class="line-content">                start_at_timestamp_nanos: *last_stored_ts,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">78</span><span class="line-content">             };<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">79</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">80</span><span class="line-content">             subnets_history<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -105,20 +87,33 @@ where</div>
<div class="line context"><span class="line-number">87</span><span class="line-content">             .collect()<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">88</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">89</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-108</span><span class="line-content">    /// Updates the stored subnets metrics from remote management canisters.<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L108" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-109</span><span class="line-content">    ///<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L109" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-110</span><span class="line-content">    /// This function fetches the nodes metrics for the given subnets from the management canisters<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L110" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-111</span><span class="line-content">    /// updating the local metrics with the fetched metrics.<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L111" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-112</span><span class="line-content">    pub async fn update_subnets_metrics(&amp;self, subnets: Vec&lt;SubnetId&gt;) {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L112" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-113</span><span class="line-content">        let last_timestamp_per_subnet: BTreeMap&lt;SubnetId, _&gt; = subnets<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L113" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+90</span><span class="line-content">    fn last_timestamp_per_subnet(&amp;self, subnets: Vec&lt;SubnetId&gt;) -&gt; BTreeMap&lt;SubnetId, UnixTsNanos&gt; {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+91</span><span class="line-content">        subnets<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">92</span><span class="line-content">             .into_iter()<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">93</span><span class="line-content">             .map(|subnet| {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-116</span><span class="line-content">                let last_timestamp = self.last_timestamp_per_subnet.borrow().get(&amp;subnet.into());<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L116" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+94</span><span class="line-content">                let last_timestamp = self<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L94" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+95</span><span class="line-content">                    .last_timestamp_per_subnet<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+96</span><span class="line-content">                    .borrow()<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L96" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+97</span><span class="line-content">                    .get(&amp;subnet.into())<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+98</span><span class="line-content">                    .unwrap_or_default();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L98" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">99</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">100</span><span class="line-content">                 (subnet, last_timestamp)<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L100" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">101</span><span class="line-content">             })<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L101" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-120</span><span class="line-content">            .collect();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L120" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+102</span><span class="line-content">            .collect()<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+103</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">104</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L104" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+105</span><span class="line-content">    /// Updates the stored subnets metrics from remote management canisters.<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L105" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+106</span><span class="line-content">    ///<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L106" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+107</span><span class="line-content">    /// This function fetches the nodes metrics for the given subnets from the management canisters<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L107" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+108</span><span class="line-content">    /// updating the local metrics with the fetched metrics.<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L108" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+109</span><span class="line-content">    /// If all subnets metrics are fetched successfully, it returns the last date<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L109" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+110</span><span class="line-content">    /// for which metrics were updated.<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L110" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+111</span><span class="line-content">    pub async fn update_subnets_metrics(<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L111" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+112</span><span class="line-content">        &amp;self,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L112" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+113</span><span class="line-content">        subnets: Vec&lt;SubnetId&gt;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L113" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+114</span><span class="line-content">    ) -&gt; Result&lt;NaiveDate, String&gt; {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L114" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+115</span><span class="line-content">        let mut success = true;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L115" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+116</span><span class="line-content">        let last_timestamp_per_subnet = self.last_timestamp_per_subnet(subnets.clone());<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L116" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">117</span><span class="line-content">         let subnets_metrics = self.fetch_subnets_metrics(&amp;last_timestamp_per_subnet).await;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L117" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">118</span><span class="line-content">         for (subnet_id, call_result) in subnets_metrics {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L118" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">119</span><span class="line-content">             match call_result {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L119" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -154,30 +149,30 @@ where</div>
<div class="line context"><span class="line-number">149</span><span class="line-content">                             );<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">150</span><span class="line-content">                         }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L150" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">151</span><span class="line-content">                     }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L151" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-157</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L157" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-158</span><span class="line-content">                    self.subnets_to_retry.borrow_mut().remove(&amp;subnet_id.into());<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L158" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">152</span><span class="line-content">                 }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L152" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">153</span><span class="line-content">                 Err((_, e)) =&gt; {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L153" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+154</span><span class="line-content">                    success = false;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L154" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">155</span><span class="line-content">                     ic_cdk::println!(<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L155" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">156</span><span class="line-content">                         &quot;Error fetching metrics for subnet {}: ERROR: {}&quot;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L156" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">157</span><span class="line-content">                         subnet_id,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L157" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">158</span><span class="line-content">                         e<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L158" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">159</span><span class="line-content">                     );<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L159" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-166</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L166" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-167</span><span class="line-content">                    // The call failed, will retry fetching metrics for this subnet.<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L167" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-168</span><span class="line-content">                    let mut retry_count = self<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L168" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-169</span><span class="line-content">                        .subnets_to_retry<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L169" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-170</span><span class="line-content">                        .borrow()<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L170" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-171</span><span class="line-content">                        .get(&amp;subnet_id.into())<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L171" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-172</span><span class="line-content">                        .unwrap_or_default();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L172" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-173</span><span class="line-content">                    retry_count += 1;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L173" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-174</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L174" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-175</span><span class="line-content">                    self.subnets_to_retry<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L175" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-176</span><span class="line-content">                        .borrow_mut()<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L176" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-177</span><span class="line-content">                        .insert(subnet_id.into(), retry_count);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics.rs#L177" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">160</span><span class="line-content">                 }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L160" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">161</span><span class="line-content">             }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L161" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">162</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L162" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+163</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L163" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+164</span><span class="line-content">        if success {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L164" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+165</span><span class="line-content">            let max_ts_update = self<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L165" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+166</span><span class="line-content">                .last_timestamp_per_subnet(subnets)<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L166" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+167</span><span class="line-content">                .into_values()<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L167" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+168</span><span class="line-content">                .max()<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L168" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+169</span><span class="line-content">                .unwrap_or_default();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L169" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+170</span><span class="line-content">            let last_day_update = DateTime::from_timestamp_nanos(max_ts_update as i64).date_naive();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L170" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+171</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L171" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+172</span><span class="line-content">            Ok(last_day_update)<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L172" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+173</span><span class="line-content">        } else {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L173" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+174</span><span class="line-content">            Err(&quot;Failed to update metrics&quot;.to_string())<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L174" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+175</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L175" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">176</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L176" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">177</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L177" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">178</span><span class="line-content">     /// Computes daily node metrics for a specific date.<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L178" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">179</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/metrics/tests.rs b/rs/node_rewards/canister/src/metrics/tests.rs<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L179" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">180</span><span class="line-content">index ff67195b52..ec29535588 100644<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics.rs#L180" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/metrics/tests.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/metrics/tests.rs</div>
<div class="hunk-header">@@ -41,7 +41,6 @@ impl MetricsManager&lt;VM&gt; {</div>
<div class="line context"><span class="line-number">41</span><span class="line-content">         Self {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">42</span><span class="line-content">             client: Box::new(client),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">43</span><span class="line-content">             subnets_metrics: RefCell::new(crate::storage::stable_btreemap_init(MemoryId::new(0))),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-44</span><span class="line-content">            subnets_to_retry: RefCell::new(crate::storage::stable_btreemap_init(MemoryId::new(1))),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">44</span><span class="line-content">             last_timestamp_per_subnet: RefCell::new(crate::storage::stable_btreemap_init(<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">45</span><span class="line-content">                 MemoryId::new(2),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">46</span><span class="line-content">             )),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -74,7 +73,7 @@ async fn subnet_metrics_added_correctly() {</div>
<div class="line context"><span class="line-number">73</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">74</span><span class="line-content">     let subnet_1 = subnet_id(1);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">75</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-77</span><span class="line-content">    mm.update_subnets_metrics(vec![subnet_1]).await;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+76</span><span class="line-content">    mm.update_subnets_metrics(vec![subnet_1]).await.unwrap();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">77</span><span class="line-content">     for i in 0..days {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">78</span><span class="line-content">         let key = SubnetMetricsKey {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">79</span><span class="line-content">             timestamp_nanos: i * ONE_DAY_NANOS,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -84,29 +83,6 @@ async fn subnet_metrics_added_correctly() {</div>
<div class="line context"><span class="line-number">83</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">84</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">85</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-87</span><span class="line-content">#[tokio::test]<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-88</span><span class="line-content">async fn subnets_to_retry_filled() {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-89</span><span class="line-content">    let subnet_1 = subnet_id(1);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-90</span><span class="line-content">    let mut mock = mock::MockCanisterClient::new();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-91</span><span class="line-content">    mock.expect_node_metrics_history()<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-92</span><span class="line-content">        .times(1)<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-93</span><span class="line-content">        .return_const(CallResult::Err((<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-94</span><span class="line-content">            RejectionCode::Unknown,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L94" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-95</span><span class="line-content">            &quot;Error&quot;.to_string(),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-96</span><span class="line-content">        )));<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L96" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-97</span><span class="line-content">    mock.expect_node_metrics_history()<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-98</span><span class="line-content">        .times(1)<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L98" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-99</span><span class="line-content">        .return_const(CallResult::Ok(node_metrics_history_gen(2)));<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-100</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L100" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-101</span><span class="line-content">    let mm = MetricsManager::new_test(mock);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L101" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-102</span><span class="line-content">    mm.update_subnets_metrics(vec![subnet_1]).await;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-103</span><span class="line-content">    assert_eq!(mm.subnets_to_retry.borrow().get(&amp;subnet_1.into()), Some(1));<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-104</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L104" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-105</span><span class="line-content">    // Retry the subnet and success<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L105" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-106</span><span class="line-content">    mm.update_subnets_metrics(vec![subnet_1]).await;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L106" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-107</span><span class="line-content">    assert_eq!(mm.subnets_to_retry.borrow().get(&amp;subnet_1.into()), None);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L107" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-108</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L108" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-109</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L109" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">86</span><span class="line-content"> #[tokio::test]<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">87</span><span class="line-content"> async fn multiple_subnets_metrics_added_correctly() {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">88</span><span class="line-content">     let days = 30;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -118,7 +94,9 @@ async fn multiple_subnets_metrics_added_correctly() {</div>
<div class="line context"><span class="line-number">94</span><span class="line-content">     let subnet_1 = subnet_id(1);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L94" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">95</span><span class="line-content">     let subnet_2 = subnet_id(2);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">96</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L96" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-121</span><span class="line-content">    mm.update_subnets_metrics(vec![subnet_1, subnet_2]).await;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L121" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+97</span><span class="line-content">    mm.update_subnets_metrics(vec![subnet_1, subnet_2])<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+98</span><span class="line-content">        .await<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L98" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+99</span><span class="line-content">        .unwrap();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">100</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L100" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">101</span><span class="line-content">     for subnet in &amp;[subnet_1, subnet_2] {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L101" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">102</span><span class="line-content">         for i in 0..days {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -134,48 +112,6 @@ async fn multiple_subnets_metrics_added_correctly() {</div>
<div class="line context"><span class="line-number">112</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L112" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">113</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L113" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">114</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L114" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-137</span><span class="line-content">#[tokio::test]<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L137" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-138</span><span class="line-content">async fn retry_count_increments_on_failure() {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L138" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-139</span><span class="line-content">    let mut mock = mock::MockCanisterClient::new();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L139" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-140</span><span class="line-content">    mock.expect_node_metrics_history()<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L140" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-141</span><span class="line-content">        .return_const(CallResult::Err((<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L141" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-142</span><span class="line-content">            RejectionCode::Unknown,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L142" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-143</span><span class="line-content">            &quot;Temporary error&quot;.to_string(),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L143" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-144</span><span class="line-content">        )));<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L144" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-145</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L145" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-146</span><span class="line-content">    let mm = MetricsManager::new_test(mock);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-147</span><span class="line-content">    let subnet_1 = subnet_id(1);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L147" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-148</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L148" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-149</span><span class="line-content">    for retry_attempt in 1..=3 {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-150</span><span class="line-content">        mm.update_subnets_metrics(vec![subnet_1]).await;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L150" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-151</span><span class="line-content">        assert_eq!(<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L151" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-152</span><span class="line-content">            mm.subnets_to_retry.borrow().get(&amp;subnet_1.into()),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L152" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-153</span><span class="line-content">            Some(retry_attempt),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L153" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-154</span><span class="line-content">            &quot;Retry count should be {retry_attempt}&quot;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L154" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-155</span><span class="line-content">        );<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L155" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-156</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L156" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-157</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L157" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-158</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L158" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-159</span><span class="line-content">#[tokio::test]<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L159" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-160</span><span class="line-content">async fn no_metrics_added_when_call_fails() {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L160" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-161</span><span class="line-content">    let mut mock = mock::MockCanisterClient::new();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L161" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-162</span><span class="line-content">    let subnet_1 = subnet_id(1);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L162" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-163</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L163" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-164</span><span class="line-content">    mock.expect_node_metrics_history()<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L164" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-165</span><span class="line-content">        .return_const(CallResult::Err((<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L165" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-166</span><span class="line-content">            RejectionCode::Unknown,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L166" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-167</span><span class="line-content">            &quot;Error&quot;.to_string(),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L167" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-168</span><span class="line-content">        )));<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L168" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-169</span><span class="line-content">    let mm = MetricsManager::new_test(mock);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L169" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-170</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L170" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-171</span><span class="line-content">    mm.update_subnets_metrics(vec![subnet_1]).await;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L171" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-172</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L172" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-173</span><span class="line-content">    assert!(<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L173" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-174</span><span class="line-content">        mm.subnets_metrics.borrow().is_empty(),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L174" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-175</span><span class="line-content">        &quot;Metrics should be empty after a failed call&quot;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L175" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-176</span><span class="line-content">    );<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L176" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-177</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L177" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-178</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L178" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">115</span><span class="line-content"> #[tokio::test]<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L115" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">116</span><span class="line-content"> async fn partial_failures_are_handled_correctly() {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L116" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">117</span><span class="line-content">     let subnet_1 = subnet_id(1);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L117" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -191,17 +127,9 @@ async fn partial_failures_are_handled_correctly() {</div>
<div class="line context"><span class="line-number">127</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L127" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">128</span><span class="line-content">     let mm = MetricsManager::new_test(mock);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L128" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">129</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L129" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-194</span><span class="line-content">    mm.update_subnets_metrics(vec![subnet_1, subnet_2]).await;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L194" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+130</span><span class="line-content">    let res = mm.update_subnets_metrics(vec![subnet_1, subnet_2]).await;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L130" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">131</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L131" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-196</span><span class="line-content">    assert_eq!(<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L196" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-197</span><span class="line-content">        mm.subnets_to_retry.borrow().get(&amp;subnet_1.into()),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L197" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-198</span><span class="line-content">        Some(1),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L198" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-199</span><span class="line-content">        &quot;Subnet 1 should be in retry list&quot;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L199" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-200</span><span class="line-content">    );<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L200" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-201</span><span class="line-content">    assert!(<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L201" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-202</span><span class="line-content">        mm.subnets_to_retry.borrow().get(&amp;subnet_2.into()).is_none(),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L202" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-203</span><span class="line-content">        &quot;Subnet 2 should not be in retry list&quot;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L203" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-204</span><span class="line-content">    );<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L204" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+132</span><span class="line-content">    assert!(res.is_err());<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L132" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">133</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L133" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">134</span><span class="line-content">     let key = SubnetMetricsKey {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L134" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">135</span><span class="line-content">         timestamp_nanos: 0,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L135" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -320,7 +248,7 @@ async fn _daily_metrics_correct_different_update_size(size: usize) {</div>
<div class="line context"><span class="line-number">248</span><span class="line-content">     let mm = MetricsManager::new_test(mock);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L248" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">249</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L249" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">250</span><span class="line-content">     for _ in 0..MAX_TIMES {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L250" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-323</span><span class="line-content">        mm.update_subnets_metrics(vec![subnet_id(1)]).await;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L323" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+251</span><span class="line-content">        mm.update_subnets_metrics(vec![subnet_id(1)]).await.unwrap();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L251" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">252</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L252" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">253</span><span class="line-content">     let daily_metrics: Vec&lt;Vec&lt;NodeMetricsDailyRaw&gt;&gt; =<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L253" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">254</span><span class="line-content">         mm.metrics_by_subnet(&amp;day_start).into_values().collect();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L254" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -400,7 +328,9 @@ async fn daily_metrics_correct_2_subs() {</div>
<div class="line context"><span class="line-number">328</span><span class="line-content">     let mm = MetricsManager::new_test(mock);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L328" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">329</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L329" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">330</span><span class="line-content">     for _ in 0..MAX_TIMES {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L330" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-403</span><span class="line-content">        mm.update_subnets_metrics(vec![subnet_1, subnet_2]).await;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L403" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+331</span><span class="line-content">        mm.update_subnets_metrics(vec![subnet_1, subnet_2])<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L331" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+332</span><span class="line-content">            .await<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L332" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+333</span><span class="line-content">            .unwrap();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L333" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">334</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L334" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">335</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L335" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">336</span><span class="line-content">     let mut node_1_daily_metrics = Vec::new();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L336" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -497,7 +427,8 @@ async fn daily_metrics_correct_overlapping_days() {</div>
<div class="line context"><span class="line-number">427</span><span class="line-content">     let mm = MetricsManager::new_test(mock);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L427" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">428</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L428" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">429</span><span class="line-content">     for _ in 0..MAX_TIMES {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L429" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-500</span><span class="line-content">        mm.update_subnets_metrics(vec![subnet_id(1), subnet_id(2)])<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/metrics/tests.rs#L500" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+430</span><span class="line-content">        let _ = mm<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L430" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+431</span><span class="line-content">            .update_subnets_metrics(vec![subnet_id(1), subnet_id(2)])<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L431" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">432</span><span class="line-content">             .await;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L432" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">433</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L433" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">434</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L434" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">435</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/storage.rs b/rs/node_rewards/canister/src/storage.rs<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L435" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">436</span><span class="line-content">index d3ad21846c..fbd31b61fd 100644<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/metrics/tests.rs#L436" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/storage.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/storage.rs</div>
<div class="hunk-header">@@ -3,17 +3,20 @@ use ic_registry_canister_client::{</div>
<div class="line context"><span class="line-number">3</span><span class="line-content">     RegistryDataStableMemory, StorableRegistryKey, StorableRegistryValue,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use ic_stable_structures::memory_manager::{MemoryId, MemoryManager, VirtualMemory};<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-6</span><span class="line-content">use ic_stable_structures::{DefaultMemoryImpl, StableBTreeMap, Storable};<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/storage.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+6</span><span class="line-content">use ic_stable_structures::{DefaultMemoryImpl, StableBTreeMap, StableCell, Storable};<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> use std::cell::RefCell;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> use std::rc::Rc;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> const REGISTRY_STORE_MEMORY_ID: MemoryId = MemoryId::new(0);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> const SUBNETS_METRICS_MEMORY_ID: MemoryId = MemoryId::new(1);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> const LAST_TIMESTAMP_PER_SUBNET_MEMORY_ID: MemoryId = MemoryId::new(2);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-13</span><span class="line-content">const SUBNETS_TO_RETRY_MEMORY_ID: MemoryId = MemoryId::new(3);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/storage.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+13</span><span class="line-content">const LAST_DAY_SYNCED_MEMORY_ID: MemoryId = MemoryId::new(3);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> pub type VM = VirtualMemory&lt;DefaultMemoryImpl&gt;;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+17</span><span class="line-content">#[derive(Clone)]<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+18</span><span class="line-content">pub struct NaiveDateStorable(pub chrono::NaiveDate);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+19</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">20</span><span class="line-content"> pub fn stable_btreemap_init&lt;K: Storable + Clone + Ord, V: Storable&gt;(<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">21</span><span class="line-content">     memory_id: MemoryId,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">22</span><span class="line-content"> ) -&gt; StableBTreeMap&lt;K, V, VM&gt; {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -30,7 +33,6 @@ thread_local! {</div>
<div class="line context"><span class="line-number">33</span><span class="line-content">     pub static METRICS_MANAGER: Rc&lt;MetricsManager&lt;VM&gt;&gt; = {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">34</span><span class="line-content">         let metrics_manager = MetricsManager {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">35</span><span class="line-content">             client: Box::new(ICCanisterClient),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-33</span><span class="line-content">            subnets_to_retry: RefCell::new(stable_btreemap_init(SUBNETS_TO_RETRY_MEMORY_ID)),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/src/storage.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">36</span><span class="line-content">             subnets_metrics: RefCell::new(stable_btreemap_init(SUBNETS_METRICS_MEMORY_ID)),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">37</span><span class="line-content">             last_timestamp_per_subnet: RefCell::new(stable_btreemap_init(LAST_TIMESTAMP_PER_SUBNET_MEMORY_ID)),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">38</span><span class="line-content">         };<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -38,6 +40,10 @@ thread_local! {</div>
<div class="line context"><span class="line-number">40</span><span class="line-content">         Rc::new(metrics_manager)<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">41</span><span class="line-content">     };<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">42</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+43</span><span class="line-content">    pub static LAST_DAY_SYNCED: RefCell&lt;StableCell&lt;Option&lt;NaiveDateStorable&gt;, VM&gt;&gt; = RefCell::new(MEMORY_MANAGER.with_borrow(|mm|<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+44</span><span class="line-content">            StableCell::init(mm.get(LAST_DAY_SYNCED_MEMORY_ID), None).expect(&quot;Could not initialize last_day_synced&quot;)<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+45</span><span class="line-content">        ));<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+46</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">47</span><span class="line-content">     static REGISTRY_DATA_STORE_BTREE_MAP: RefCell&lt;StableBTreeMap&lt;StorableRegistryKey, StorableRegistryValue, VM&gt;&gt;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">48</span><span class="line-content">         = RefCell::new(MEMORY_MANAGER.with_borrow(|mm|<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">49</span><span class="line-content">             StableBTreeMap::init(mm.get(REGISTRY_STORE_MEMORY_ID))<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">50</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/timer_tasks.rs b/rs/node_rewards/canister/src/timer_tasks.rs<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">51</span><span class="line-content">new file mode 100644<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">52</span><span class="line-content">index 0000000000..76ec46638e<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/storage.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- /dev/null</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/timer_tasks.rs</div>
<div class="hunk-header">@@ -0,0 +1,66 @@</div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">use crate::canister::{NodeRewardsCanister, current_time};<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+2</span><span class="line-content">use ic_nervous_system_timer_task::RecurringSyncTask;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+3</span><span class="line-content">use std::cell::RefCell;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+4</span><span class="line-content">use std::thread::LocalKey;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+5</span><span class="line-content">use std::time::Duration;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+6</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+7</span><span class="line-content">const SECS_PER_HOUR: u64 = 3600;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+9</span><span class="line-content">// This offset makes sure that the first sync of the day happens at 00:05, times that guarantees<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+10</span><span class="line-content">// All the subnets have collected metrics for the previous day<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+11</span><span class="line-content">const SYNC_OFFSET: u64 = 5 * 60; // 5 minutes in seconds<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+12</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+13</span><span class="line-content">#[derive(Copy, Clone)]<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+14</span><span class="line-content">pub struct HourlySyncTask {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+15</span><span class="line-content">    canister: &amp;&#x27;static LocalKey&lt;RefCell&lt;NodeRewardsCanister&gt;&gt;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+16</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+17</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+18</span><span class="line-content">impl HourlySyncTask {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+19</span><span class="line-content">    pub fn new(canister: &amp;&#x27;static LocalKey&lt;RefCell&lt;NodeRewardsCanister&gt;&gt;) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+20</span><span class="line-content">        Self { canister }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+21</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+22</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+23</span><span class="line-content">    fn default_delay() -&gt; Duration {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+24</span><span class="line-content">        let now_secs = current_time().as_secs_since_unix_epoch();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+25</span><span class="line-content">        let since_hour = now_secs % SECS_PER_HOUR;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+26</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+27</span><span class="line-content">        // Target is delaying execution until the next hour plus SYNC_OFFSET.<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+28</span><span class="line-content">        let next_sync_target_secs = if since_hour &lt; SYNC_OFFSET {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+29</span><span class="line-content">            now_secs - since_hour + SYNC_OFFSET<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+30</span><span class="line-content">        } else {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+31</span><span class="line-content">            now_secs - since_hour + SECS_PER_HOUR + SYNC_OFFSET<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+32</span><span class="line-content">        };<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+33</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+34</span><span class="line-content">        Duration::from_secs(next_sync_target_secs - now_secs)<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+35</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+36</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+37</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+38</span><span class="line-content">impl RecurringSyncTask for HourlySyncTask {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+39</span><span class="line-content">    fn execute(self) -&gt; (Duration, Self) {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+40</span><span class="line-content">        ic_cdk::futures::spawn_017_compat(async move {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+41</span><span class="line-content">            match NodeRewardsCanister::schedule_registry_sync(self.canister).await {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+42</span><span class="line-content">                Ok(_) =&gt; {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+43</span><span class="line-content">                    ic_cdk::println!(&quot;Successfully synced local registry&quot;);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+44</span><span class="line-content">                    match NodeRewardsCanister::schedule_metrics_sync(self.canister).await {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+45</span><span class="line-content">                        Ok(_) =&gt; {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+46</span><span class="line-content">                            ic_cdk::println!(&quot;Successfully synced subnets metrics&quot;)<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+47</span><span class="line-content">                        }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+48</span><span class="line-content">                        Err(e) =&gt; {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+49</span><span class="line-content">                            ic_cdk::println!(&quot;Failed to sync subnets metrics: {:?}&quot;, e)<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+50</span><span class="line-content">                        }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+51</span><span class="line-content">                    }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+52</span><span class="line-content">                }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+53</span><span class="line-content">                Err(e) =&gt; {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+54</span><span class="line-content">                    ic_cdk::println!(&quot;Failed to sync local registry: {:?}&quot;, e)<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+55</span><span class="line-content">                }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+56</span><span class="line-content">            };<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+57</span><span class="line-content">        });<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+58</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+59</span><span class="line-content">        (Self::default_delay(), self)<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+60</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+61</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+62</span><span class="line-content">    fn initial_delay(&amp;self) -&gt; Duration {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+63</span><span class="line-content">        Duration::from_secs(0)<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+64</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+65</span><span class="line-content">    const NAME: &amp;&#x27;static str = &quot;hourly_sync&quot;;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+66</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">67</span><span class="line-content">diff --git a/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs b/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">68</span><span class="line-content">index 725a212ef4..d5f69ddacb 100644<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/src/timer_tasks.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs</div>
<div class="hunk-header">@@ -90,10 +90,7 @@ async fn get_node_providers_rewards_calculation_is_only_callable_in_nonreplicate</div>
<div class="line context"><span class="line-number">90</span><span class="line-content">     .unwrap()<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">91</span><span class="line-content">     .0<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">92</span><span class="line-content">     .unwrap_err();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-93</span><span class="line-content">    assert_eq!(<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-94</span><span class="line-content">        err,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L94" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-95</span><span class="line-content">        &quot;Could not calculate rewards: \&quot;No metrics found for day 2021-05-06\&quot;&quot;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-96</span><span class="line-content">    );<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L96" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+93</span><span class="line-content">    assert_eq!(err, &quot;Metrics and registry are not synced up&quot;);<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">94</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L94" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">95</span><span class="line-content">     // Replicated update call is not allowed.<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">96</span><span class="line-content">     let err = update_candid::&lt;_, (GetNodeProvidersRewardsCalculationResponse,)&gt;(<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L96" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">97</span><span class="line-content">diff --git a/rs/node_rewards/canister/tests/regisry_sync_test.rs b/rs/node_rewards/canister/tests/regisry_sync_test.rs<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">98</span><span class="line-content">index 659ed17abd..9eb1b2265c 100644<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L98" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/tests/regisry_sync_test.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/tests/regisry_sync_test.rs</div>
<div class="hunk-header">@@ -6,7 +6,6 @@ use ic_protobuf::registry::subnet::v1::{SubnetRecord, SubnetType};</div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use ic_registry_keys::make_subnet_record_key;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/regisry_sync_test.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> use ic_types::{PrincipalId, SubnetId};<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/regisry_sync_test.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> use pocket_ic::PocketIcBuilder;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/regisry_sync_test.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-9</span><span class="line-content">use std::time::Duration;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/tests/regisry_sync_test.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/regisry_sync_test.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> #[tokio::test]<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/regisry_sync_test.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> async fn test_registry_value_syncing() {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/regisry_sync_test.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -30,8 +29,6 @@ async fn test_registry_value_syncing() {</div>
<div class="line context"><span class="line-number">29</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/regisry_sync_test.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">30</span><span class="line-content">     // This is the value from invariant_compliant_mutation<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/regisry_sync_test.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">31</span><span class="line-content">     let test_subnet_id = SubnetId::from(PrincipalId::new_subnet_test_id(999));<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/regisry_sync_test.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-33</span><span class="line-content">    // We don&#x27;t use agents here because this method is test-only, so we won&#x27;t<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/tests/regisry_sync_test.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-34</span><span class="line-content">    // support it beyond this one test.<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/tests/regisry_sync_test.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">32</span><span class="line-content">     let response = pocket_ic<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/regisry_sync_test.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">33</span><span class="line-content">         .query_call(<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/regisry_sync_test.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">34</span><span class="line-content">             canister_id,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/regisry_sync_test.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -42,26 +39,7 @@ async fn test_registry_value_syncing() {</div>
<div class="line context"><span class="line-number">39</span><span class="line-content">         .await<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/regisry_sync_test.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">40</span><span class="line-content">         .unwrap();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/regisry_sync_test.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">41</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/regisry_sync_test.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-45</span><span class="line-content">    let decoded = Decode!(&amp;response, Result&lt;Option&lt;Vec&lt;u8&gt;&gt;, String&gt;).unwrap();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/tests/regisry_sync_test.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-46</span><span class="line-content">    assert_eq!(decoded, Ok(None));<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/tests/regisry_sync_test.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-47</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/tests/regisry_sync_test.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-48</span><span class="line-content">    // Advance time and tick so the sync will run<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/tests/regisry_sync_test.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-49</span><span class="line-content">    for _ in 0..10 {<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/tests/regisry_sync_test.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-50</span><span class="line-content">        pocket_ic.advance_time(Duration::from_secs(60 * 60)).await;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/tests/regisry_sync_test.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-51</span><span class="line-content">        pocket_ic.tick().await;<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/tests/regisry_sync_test.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-52</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/tests/regisry_sync_test.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-53</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/tests/regisry_sync_test.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-54</span><span class="line-content">    let response = pocket_ic<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/tests/regisry_sync_test.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-55</span><span class="line-content">        .query_call(<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/tests/regisry_sync_test.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-56</span><span class="line-content">            canister_id,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/tests/regisry_sync_test.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-57</span><span class="line-content">            PrincipalId::new_anonymous().0,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/tests/regisry_sync_test.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-58</span><span class="line-content">            &quot;get_registry_value&quot;,<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/tests/regisry_sync_test.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-59</span><span class="line-content">            Encode!(&amp;make_subnet_record_key(test_subnet_id)).unwrap(),<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/tests/regisry_sync_test.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-60</span><span class="line-content">        )<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/tests/regisry_sync_test.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-61</span><span class="line-content">        .await<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/tests/regisry_sync_test.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-62</span><span class="line-content">        .unwrap();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/tests/regisry_sync_test.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-63</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/tests/regisry_sync_test.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-64</span><span class="line-content">    // Now we are asserting that there is something in this recod<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385~1/rs/node_rewards/canister/tests/regisry_sync_test.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+42</span><span class="line-content">    // Now we are asserting that there is something in this record<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/regisry_sync_test.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">43</span><span class="line-content">     let decoded = Decode!(&amp;response, Result&lt;Option&lt;Vec&lt;u8&gt;&gt;, String&gt;).unwrap();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/regisry_sync_test.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">44</span><span class="line-content">     let unwrapped = decoded.unwrap().unwrap();<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/regisry_sync_test.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">45</span><span class="line-content">     // Assert that this Registry value is actually a valid sequence of bits<a href="https://github.com/dfinity/ic/blob/46e8847699a9d2eba30bb47872b977e083f9d385/rs/node_rewards/canister/tests/regisry_sync_test.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="commit-detail">
                    <div class="commit-header">
                        <div class="commit-title">
                            <a href="https://github.com/dfinity/ic/commit/0987d0ef4394c7934186a042046d297ee7b6242d" class="commit-hash-large" target="_blank">0987d0ef4394c7934186a042046d297ee7b6242d</a>
                            <span class="badge chore">chore</span>
                        </div>
                        <div class="commit-meta">
                            <span>👤 pietrodimarco-dfinity &lt;124565147+pietrodimarco-dfinity@users.noreply.github.com&gt;</span>
                            <span>📅 2025-10-14</span>
                            <span>📁 9 files</span>
                        </div>
                        <div style="margin-top: 8px; color: #e6edf3; font-size: 0.9em;">
                            chore(node-rewards-canister): Address pending TODOs (#7222)
                        </div>
                        <div class="commit-actions">
                            <button class="toggle-button secondary" onclick="toggleFiles('files-1')">📁 Files (9)</button>
                            <button class="toggle-button" onclick="toggleDiff('diff-1')">🔍 Code Changes</button>
                        </div>
                        <div id="files-1" class="collapsible">
                            <div class="files-list">
                                <ul><li>rs/node_rewards/canister/api/src/api_native_conversion.rs</li><li>rs/node_rewards/canister/api/src/provider_rewards_calculation.rs</li><li>rs/node_rewards/canister/node-rewards-canister.did</li><li>rs/node_rewards/canister/src/canister/mod.rs</li><li>rs/node_rewards/canister/src/main.rs</li><li>rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs</li><li>rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs</li><li>rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs</li><li>rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs</li></ul></div></div>
                        <div id="diff-1" class="collapsible">
                            <div class="diff-container">
                                <div class="line context"><span class="line-number">1</span><span class="line-content">commit 0987d0ef4394c7934186a042046d297ee7b6242d</span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content">Author: pietrodimarco-dfinity &lt;124565147+pietrodimarco-dfinity@users.noreply.github.com&gt;</span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content">Date:   Tue Oct 14 17:30:35 2025 +0200</span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content">    chore(node-rewards-canister): Address pending TODOs (#7222)</span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content">    Changes:</span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content">    - Refactored API types to use f64 and u64 instead of Decimals</span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content">    - Removed layer of indirection introduced with types XDRPermyriad and</span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content">    Percent. Using instead Decimals directly</span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">    - Added units in performance based node rewards types</span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content">    - Removed unused API -&gt; native_type conversion</span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content">    This PR introduce breaking changes to the API which is fine because not</span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content">    used</span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content">diff --git a/rs/node_rewards/canister/api/src/api_native_conversion.rs b/rs/node_rewards/canister/api/src/api_native_conversion.rs</span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content">index 9815939e56..11f9382f17 100644</span></div>
<div class="file-header">--- a/rs/node_rewards/canister/api/src/api_native_conversion.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/api/src/api_native_conversion.rs</div>
<div class="hunk-header">@@ -1,318 +1,200 @@</div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> use crate::provider_rewards_calculation::{<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content">    BaseRewardsSpec, DailyNodeProviderRewards, DailyNodeRewards, DailyResults, NodeMetricsDaily,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-3</span><span class="line-content">    NodeStatus, Type3BaseRewardsSpec,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+2</span><span class="line-content">    DailyNodeFailureRate, DailyNodeProviderRewards, DailyNodeRewards, DailyResults,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+3</span><span class="line-content">    NodeMetricsDaily, NodeTypeRegionBaseRewards, Type3RegionBaseRewards,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-5</span><span class="line-content">use ic_base_types::{NodeId, SubnetId};<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-6</span><span class="line-content">use ic_nervous_system_proto::pb::v1::Decimal as DecimalProto;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content">use ic_protobuf::registry::node::v1::NodeRewardType;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use rewards_calculation::performance_based_algorithm::results as native_types;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-9</span><span class="line-content">use rust_decimal::Decimal;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+6</span><span class="line-content">use rust_decimal::prelude::ToPrimitive;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+7</span><span class="line-content">use std::convert::TryFrom;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> // ================================================================================================<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> // Conversion implementations for API types &lt;-&gt; Internal types<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> // ================================================================================================<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> // NodeMetricsDaily conversions<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-16</span><span class="line-content">impl From&lt;native_types::NodeMetricsDaily&gt; for NodeMetricsDaily {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-17</span><span class="line-content">    fn from(src: native_types::NodeMetricsDaily) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-18</span><span class="line-content">        Self {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-19</span><span class="line-content">            subnet_assigned: Some(src.subnet_assigned.get()),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-20</span><span class="line-content">            subnet_assigned_fr_percent: Some(DecimalProto::from(src.subnet_assigned_fr)),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-21</span><span class="line-content">            num_blocks_proposed: Some(src.num_blocks_proposed),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-22</span><span class="line-content">            num_blocks_failed: Some(src.num_blocks_failed),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-23</span><span class="line-content">            original_fr_percent: Some(DecimalProto::from(src.original_fr)),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-24</span><span class="line-content">            relative_fr_percent: Some(DecimalProto::from(src.relative_fr)),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-25</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-26</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-27</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-28</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-29</span><span class="line-content">impl TryFrom&lt;NodeMetricsDaily&gt; for native_types::NodeMetricsDaily {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+14</span><span class="line-content">impl TryFrom&lt;native_types::NodeMetricsDaily&gt; for NodeMetricsDaily {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content">     type Error = String;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-32</span><span class="line-content">    fn try_from(src: NodeMetricsDaily) -&gt; Result&lt;Self, Self::Error&gt; {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+17</span><span class="line-content">    fn try_from(src: native_types::NodeMetricsDaily) -&gt; Result&lt;Self, Self::Error&gt; {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content">         Ok(Self {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-34</span><span class="line-content">            subnet_assigned: SubnetId::from(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-35</span><span class="line-content">                src.subnet_assigned<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-36</span><span class="line-content">                    .ok_or(&quot;subnet_assigned is missing (from NodeMetricsDaily).&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-37</span><span class="line-content">            ),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-38</span><span class="line-content">            subnet_assigned_fr: Decimal::try_from(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+19</span><span class="line-content">            subnet_assigned: Some(src.subnet_assigned.get()),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+20</span><span class="line-content">            subnet_assigned_fr_percent: Some(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">21</span><span class="line-content">                 src.subnet_assigned_fr_percent<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-40</span><span class="line-content">                    .ok_or(&quot;subnet_assigned_fr_percent is missing (from NodeMetricsDaily).&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-41</span><span class="line-content">            )?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-42</span><span class="line-content">            num_blocks_proposed: src<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-43</span><span class="line-content">                .num_blocks_proposed<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-44</span><span class="line-content">                .ok_or(&quot;num_blocks_proposed is missing (from NodeMetricsDaily).&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-45</span><span class="line-content">            num_blocks_failed: src<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-46</span><span class="line-content">                .num_blocks_failed<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-47</span><span class="line-content">                .ok_or(&quot;num_blocks_failed is missing (from NodeMetricsDaily).&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-48</span><span class="line-content">            original_fr: Decimal::try_from(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+22</span><span class="line-content">                    .to_f64()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+23</span><span class="line-content">                    .ok_or(&quot;Conversion to f64 failed (subnet_assigned_fr_percent)&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+24</span><span class="line-content">            ),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+25</span><span class="line-content">            num_blocks_proposed: Some(src.num_blocks_proposed),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+26</span><span class="line-content">            num_blocks_failed: Some(src.num_blocks_failed),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+27</span><span class="line-content">            original_fr_percent: Some(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">28</span><span class="line-content">                 src.original_fr_percent<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-50</span><span class="line-content">                    .ok_or(&quot;original_fr_percent is missing (from NodeMetricsDaily).&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-51</span><span class="line-content">            )?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-52</span><span class="line-content">            relative_fr: Decimal::try_from(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+29</span><span class="line-content">                    .to_f64()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+30</span><span class="line-content">                    .ok_or(&quot;Conversion to f64 failed (original_fr_percent)&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+31</span><span class="line-content">            ),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+32</span><span class="line-content">            relative_fr_percent: Some(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">33</span><span class="line-content">                 src.relative_fr_percent<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-54</span><span class="line-content">                    .ok_or(&quot;relative_fr_percent is missing (from NodeMetricsDaily).&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-55</span><span class="line-content">            )?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+34</span><span class="line-content">                    .to_f64()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+35</span><span class="line-content">                    .ok_or(&quot;Conversion to f64 failed (relative_fr_percent)&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+36</span><span class="line-content">            ),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">37</span><span class="line-content">         })<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">38</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">39</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">40</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-60</span><span class="line-content">// NodeStatus conversions<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-61</span><span class="line-content">impl From&lt;native_types::NodeStatus&gt; for NodeStatus {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-62</span><span class="line-content">    fn from(src: native_types::NodeStatus) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-63</span><span class="line-content">        match src {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-64</span><span class="line-content">            native_types::NodeStatus::Assigned { node_metrics } =&gt; Self::Assigned {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-65</span><span class="line-content">                node_metrics: Some(NodeMetricsDaily::from(node_metrics)),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-66</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-67</span><span class="line-content">            native_types::NodeStatus::Unassigned { extrapolated_fr } =&gt; Self::Unassigned {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-68</span><span class="line-content">                extrapolated_fr_percent: Some(DecimalProto::from(extrapolated_fr)),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-69</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-70</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-71</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-72</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-73</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-74</span><span class="line-content">impl TryFrom&lt;NodeStatus&gt; for native_types::NodeStatus {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+41</span><span class="line-content">// DailyNodeFailureRate conversions<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+42</span><span class="line-content">impl TryFrom&lt;native_types::DailyNodeFailureRate&gt; for DailyNodeFailureRate {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">43</span><span class="line-content">     type Error = String;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">44</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-77</span><span class="line-content">    fn try_from(src: NodeStatus) -&gt; Result&lt;Self, Self::Error&gt; {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+45</span><span class="line-content">    fn try_from(src: native_types::DailyNodeFailureRate) -&gt; Result&lt;Self, Self::Error&gt; {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">46</span><span class="line-content">         match src {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-79</span><span class="line-content">            NodeStatus::Assigned { node_metrics } =&gt; Ok(Self::Assigned {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-80</span><span class="line-content">                node_metrics: native_types::NodeMetricsDaily::try_from(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-81</span><span class="line-content">                    node_metrics.ok_or(&quot;node_metrics is missing (from NodeStatus).&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-82</span><span class="line-content">                )?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-83</span><span class="line-content">            }),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-84</span><span class="line-content">            NodeStatus::Unassigned {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-85</span><span class="line-content">                extrapolated_fr_percent,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-86</span><span class="line-content">            } =&gt; Ok(Self::Unassigned {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-87</span><span class="line-content">                extrapolated_fr: Decimal::try_from(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-88</span><span class="line-content">                    extrapolated_fr_percent<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-89</span><span class="line-content">                        .ok_or(&quot;extrapolated_fr_percent is missing (from NodeStatus).&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-90</span><span class="line-content">                )?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-91</span><span class="line-content">            }),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+47</span><span class="line-content">            native_types::DailyNodeFailureRate::SubnetMember { node_metrics } =&gt; {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+48</span><span class="line-content">                Ok(DailyNodeFailureRate::SubnetMember {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+49</span><span class="line-content">                    node_metrics: Some(NodeMetricsDaily::try_from(node_metrics)?),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+50</span><span class="line-content">                })<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+51</span><span class="line-content">            }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+52</span><span class="line-content">            native_types::DailyNodeFailureRate::NonSubnetMember { extrapolated_fr } =&gt; {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+53</span><span class="line-content">                Ok(DailyNodeFailureRate::NonSubnetMember {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+54</span><span class="line-content">                    extrapolated_fr_percent: Some(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+55</span><span class="line-content">                        extrapolated_fr<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+56</span><span class="line-content">                            .to_f64()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+57</span><span class="line-content">                            .ok_or(&quot;Conversion to f64 failed (extrapolated_fr)&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+58</span><span class="line-content">                    ),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+59</span><span class="line-content">                })<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+60</span><span class="line-content">            }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">61</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">62</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">63</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">64</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">65</span><span class="line-content"> // DailyNodeRewards conversions<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-97</span><span class="line-content">impl From&lt;native_types::DailyNodeRewards&gt; for DailyNodeRewards {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-98</span><span class="line-content">    fn from(src: native_types::DailyNodeRewards) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L98" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-99</span><span class="line-content">        Self {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+66</span><span class="line-content">impl TryFrom&lt;native_types::DailyNodeRewards&gt; for DailyNodeRewards {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+67</span><span class="line-content">    type Error = String;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+68</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+69</span><span class="line-content">    fn try_from(src: native_types::DailyNodeRewards) -&gt; Result&lt;Self, Self::Error&gt; {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+70</span><span class="line-content">        Ok(Self {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">71</span><span class="line-content">             node_id: Some(src.node_id.get()),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">72</span><span class="line-content">             node_reward_type: Some(src.node_reward_type.to_string()),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">73</span><span class="line-content">             region: Some(src.region),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">74</span><span class="line-content">             dc_id: Some(src.dc_id),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-104</span><span class="line-content">            node_status: Some(NodeStatus::from(src.node_status)),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L104" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-105</span><span class="line-content">            performance_multiplier_percent: Some(DecimalProto::from(src.performance_multiplier)),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L105" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-106</span><span class="line-content">            rewards_reduction_percent: Some(DecimalProto::from(src.rewards_reduction)),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L106" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-107</span><span class="line-content">            base_rewards_xdr_permyriad: Some(DecimalProto::from(src.base_rewards)),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L107" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-108</span><span class="line-content">            adjusted_rewards_xdr_permyriad: Some(DecimalProto::from(src.adjusted_rewards)),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L108" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-109</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L109" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-110</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L110" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-111</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L111" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-112</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L112" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-113</span><span class="line-content">impl TryFrom&lt;DailyNodeRewards&gt; for native_types::DailyNodeRewards {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L113" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-114</span><span class="line-content">    type Error = String;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L114" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-115</span><span class="line-content">    fn try_from(src: DailyNodeRewards) -&gt; Result&lt;Self, Self::Error&gt; {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L115" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-116</span><span class="line-content">        Ok(Self {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L116" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-117</span><span class="line-content">            node_id: NodeId::from(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L117" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-118</span><span class="line-content">                src.node_id<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L118" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-119</span><span class="line-content">                    .ok_or(&quot;node_id is missing (from DailyNodeRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L119" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-120</span><span class="line-content">            ),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L120" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-121</span><span class="line-content">            node_reward_type: NodeRewardType::from(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L121" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-122</span><span class="line-content">                src.node_reward_type<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L122" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-123</span><span class="line-content">                    .ok_or(&quot;node_reward_type is missing (from DailyNodeRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L123" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-124</span><span class="line-content">            ),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L124" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-125</span><span class="line-content">            region: src<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L125" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-126</span><span class="line-content">                .region<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L126" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-127</span><span class="line-content">                .ok_or(&quot;region is missing (from DailyNodeRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L127" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-128</span><span class="line-content">            dc_id: src<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L128" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-129</span><span class="line-content">                .dc_id<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L129" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-130</span><span class="line-content">                .ok_or(&quot;dc_id is missing (from DailyNodeRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L130" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-131</span><span class="line-content">            node_status: native_types::NodeStatus::try_from(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L131" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-132</span><span class="line-content">                src.node_status<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L132" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-133</span><span class="line-content">                    .ok_or(&quot;node_status is missing (from DailyNodeRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L133" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-134</span><span class="line-content">            )?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L134" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-135</span><span class="line-content">            performance_multiplier: Decimal::try_from(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L135" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+75</span><span class="line-content">            daily_node_fr: Some(DailyNodeFailureRate::try_from(src.daily_node_fr)?),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+76</span><span class="line-content">            performance_multiplier_percent: Some(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">77</span><span class="line-content">                 src.performance_multiplier_percent<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-137</span><span class="line-content">                    .ok_or(&quot;performance_multiplier_percent is missing (from DailyNodeRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L137" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-138</span><span class="line-content">            )?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L138" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-139</span><span class="line-content">            rewards_reduction: Decimal::try_from(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L139" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+78</span><span class="line-content">                    .to_f64()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+79</span><span class="line-content">                    .ok_or(&quot;Conversion to f64 failed (performance_multiplier_percent)&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+80</span><span class="line-content">            ),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+81</span><span class="line-content">            rewards_reduction_percent: Some(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">82</span><span class="line-content">                 src.rewards_reduction_percent<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-141</span><span class="line-content">                    .ok_or(&quot;rewards_reduction_percent is missing (from DailyNodeRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L141" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-142</span><span class="line-content">            )?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L142" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-143</span><span class="line-content">            base_rewards: Decimal::try_from(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L143" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+83</span><span class="line-content">                    .to_f64()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+84</span><span class="line-content">                    .ok_or(&quot;Conversion to f64 failed (rewards_reduction_percent)&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+85</span><span class="line-content">            ),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+86</span><span class="line-content">            base_rewards_xdr_permyriad: Some(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">87</span><span class="line-content">                 src.base_rewards_xdr_permyriad<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-145</span><span class="line-content">                    .ok_or(&quot;base_rewards_xdr_permyriad is missing (from DailyNodeRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L145" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-146</span><span class="line-content">            )?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-147</span><span class="line-content">            adjusted_rewards: Decimal::try_from(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L147" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+88</span><span class="line-content">                    .to_u64()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+89</span><span class="line-content">                    .ok_or(&quot;Conversion to u64 failed (base_rewards_xdr_permyriad)&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+90</span><span class="line-content">            ),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+91</span><span class="line-content">            adjusted_rewards_xdr_permyriad: Some(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">92</span><span class="line-content">                 src.adjusted_rewards_xdr_permyriad<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-149</span><span class="line-content">                    .ok_or(&quot;adjusted_rewards_xdr_permyriad is missing (from DailyNodeRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-150</span><span class="line-content">            )?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L150" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+93</span><span class="line-content">                    .to_u64()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+94</span><span class="line-content">                    .ok_or(&quot;Conversion to u64 failed (adjusted_rewards_xdr_permyriad)&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L94" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+95</span><span class="line-content">            ),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">96</span><span class="line-content">         })<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L96" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">97</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">98</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L98" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">99</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-155</span><span class="line-content">// BaseRewards conversions<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L155" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-156</span><span class="line-content">impl From&lt;native_types::BaseRewardsSpec&gt; for BaseRewardsSpec {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L156" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-157</span><span class="line-content">    fn from(src: native_types::BaseRewardsSpec) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L157" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-158</span><span class="line-content">        Self {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L158" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-159</span><span class="line-content">            monthly_xdr_permyriad: Some(DecimalProto::from(src.monthly)),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L159" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-160</span><span class="line-content">            daily_xdr_permyriad: Some(DecimalProto::from(src.daily)),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L160" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-161</span><span class="line-content">            node_reward_type: Some(src.node_reward_type.to_string()),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L161" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-162</span><span class="line-content">            region: Some(src.region),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L162" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-163</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L163" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-164</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L164" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-165</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L165" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-166</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L166" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-167</span><span class="line-content">impl TryFrom&lt;BaseRewardsSpec&gt; for native_types::BaseRewardsSpec {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L167" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+100</span><span class="line-content">// NodeTypeRegionBaseRewards conversions<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L100" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+101</span><span class="line-content">impl TryFrom&lt;native_types::NodeTypeRegionBaseRewards&gt; for NodeTypeRegionBaseRewards {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L101" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">102</span><span class="line-content">     type Error = String;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">103</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-170</span><span class="line-content">    fn try_from(src: BaseRewardsSpec) -&gt; Result&lt;Self, Self::Error&gt; {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L170" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+104</span><span class="line-content">    fn try_from(src: native_types::NodeTypeRegionBaseRewards) -&gt; Result&lt;Self, Self::Error&gt; {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L104" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">105</span><span class="line-content">         Ok(Self {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L105" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-172</span><span class="line-content">            node_reward_type: NodeRewardType::from(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L172" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-173</span><span class="line-content">                src.node_reward_type<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L173" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-174</span><span class="line-content">                    .ok_or(&quot;node_reward_type is missing (from BaseRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L174" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-175</span><span class="line-content">            ),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L175" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-176</span><span class="line-content">            region: src.region.ok_or(&quot;region is missing (from BaseRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L176" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-177</span><span class="line-content">            monthly: Decimal::try_from(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L177" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+106</span><span class="line-content">            monthly_xdr_permyriad: Some(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L106" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">107</span><span class="line-content">                 src.monthly_xdr_permyriad<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L107" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-179</span><span class="line-content">                    .ok_or(&quot;monthly_xdr_permyriad is missing (from BaseRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L179" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-180</span><span class="line-content">            )?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L180" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-181</span><span class="line-content">            daily: Decimal::try_from(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L181" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+108</span><span class="line-content">                    .to_u64()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L108" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+109</span><span class="line-content">                    .ok_or(&quot;Conversion to f64 failed (monthly_xdr_permyriad)&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L109" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+110</span><span class="line-content">            ),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L110" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+111</span><span class="line-content">            daily_xdr_permyriad: Some(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L111" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">112</span><span class="line-content">                 src.daily_xdr_permyriad<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L112" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-183</span><span class="line-content">                    .ok_or(&quot;daily_xdr_permyriad is missing (from BaseRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L183" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-184</span><span class="line-content">            )?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L184" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-185</span><span class="line-content">        })<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L185" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-186</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L186" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-187</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L187" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-188</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L188" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-189</span><span class="line-content">// Type3BaseRewards conversions<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L189" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-190</span><span class="line-content">impl From&lt;native_types::Type3BaseRewards&gt; for Type3BaseRewardsSpec {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L190" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-191</span><span class="line-content">    fn from(src: native_types::Type3BaseRewards) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L191" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-192</span><span class="line-content">        Self {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L192" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+113</span><span class="line-content">                    .to_u64()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L113" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+114</span><span class="line-content">                    .ok_or(&quot;Conversion to f64 failed (daily_xdr_permyriad)&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L114" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+115</span><span class="line-content">            ),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L115" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+116</span><span class="line-content">            node_reward_type: Some(src.node_reward_type.to_string()),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L116" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">117</span><span class="line-content">             region: Some(src.region),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L117" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-194</span><span class="line-content">            nodes_count: Some(src.nodes_count as u64),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L194" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-195</span><span class="line-content">            avg_rewards_xdr_permyriad: Some(DecimalProto::from(src.avg_rewards)),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L195" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-196</span><span class="line-content">            avg_coefficient_percent: Some(DecimalProto::from(src.avg_coefficient)),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L196" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-197</span><span class="line-content">            value_xdr_permyriad: Some(DecimalProto::from(src.value)),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L197" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-198</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L198" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+118</span><span class="line-content">        })<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L118" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">119</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L119" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">120</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L120" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">121</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L121" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-202</span><span class="line-content">impl TryFrom&lt;Type3BaseRewardsSpec&gt; for native_types::Type3BaseRewards {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L202" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+122</span><span class="line-content">// Type3RegionBaseRewards conversions<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L122" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+123</span><span class="line-content">impl TryFrom&lt;native_types::Type3RegionBaseRewards&gt; for Type3RegionBaseRewards {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L123" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">124</span><span class="line-content">     type Error = String;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L124" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">125</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L125" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-205</span><span class="line-content">    fn try_from(value: Type3BaseRewardsSpec) -&gt; Result&lt;Self, Self::Error&gt; {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L205" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+126</span><span class="line-content">    fn try_from(src: native_types::Type3RegionBaseRewards) -&gt; Result&lt;Self, Self::Error&gt; {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L126" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">127</span><span class="line-content">         Ok(Self {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L127" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-207</span><span class="line-content">            region: value<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L207" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-208</span><span class="line-content">                .region<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L208" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-209</span><span class="line-content">                .ok_or(&quot;region is missing (from Type3BaseRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L209" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-210</span><span class="line-content">            nodes_count: value<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L210" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-211</span><span class="line-content">                .nodes_count<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L211" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-212</span><span class="line-content">                .ok_or(&quot;nodes_count is missing (from Type3BaseRewards).&quot;)?<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L212" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-213</span><span class="line-content">                as usize,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L213" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-214</span><span class="line-content">            avg_rewards: Decimal::try_from(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L214" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-215</span><span class="line-content">                value<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L215" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-216</span><span class="line-content">                    .avg_rewards_xdr_permyriad<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L216" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-217</span><span class="line-content">                    .ok_or(&quot;avg_rewards_xdr_permyriad is missing (from Type3BaseRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L217" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-218</span><span class="line-content">            )?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L218" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-219</span><span class="line-content">            avg_coefficient: Decimal::try_from(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L219" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-220</span><span class="line-content">                value<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L220" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-221</span><span class="line-content">                    .avg_coefficient_percent<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L221" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-222</span><span class="line-content">                    .ok_or(&quot;avg_coefficient_percent is missing (from Type3BaseRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L222" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-223</span><span class="line-content">            )?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L223" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-224</span><span class="line-content">            value: Decimal::try_from(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L224" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-225</span><span class="line-content">                value<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L225" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-226</span><span class="line-content">                    .value_xdr_permyriad<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L226" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-227</span><span class="line-content">                    .ok_or(&quot;value_xdr_permyriad is missing (from Type3BaseRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L227" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-228</span><span class="line-content">            )?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L228" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+128</span><span class="line-content">            region: Some(src.region),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L128" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+129</span><span class="line-content">            nodes_count: Some(src.nodes_count as u64),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L129" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+130</span><span class="line-content">            avg_rewards_xdr_permyriad: Some(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L130" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+131</span><span class="line-content">                src.avg_rewards_xdr_permyriad<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L131" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+132</span><span class="line-content">                    .to_u64()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L132" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+133</span><span class="line-content">                    .ok_or(&quot;Conversion to u64 failed (avg_rewards_xdr_permyriad)&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L133" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+134</span><span class="line-content">            ),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L134" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+135</span><span class="line-content">            avg_coefficient_percent: Some(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L135" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+136</span><span class="line-content">                src.avg_coefficient_percent<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L136" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+137</span><span class="line-content">                    .to_f64()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L137" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+138</span><span class="line-content">                    .ok_or(&quot;Conversion to f64 failed (avg_coefficient_percent)&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L138" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+139</span><span class="line-content">            ),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L139" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+140</span><span class="line-content">            daily_xdr_permyriad: Some(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L140" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+141</span><span class="line-content">                src.daily_xdr_permyriad<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L141" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+142</span><span class="line-content">                    .to_u64()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L142" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+143</span><span class="line-content">                    .ok_or(&quot;Conversion to u64 failed (daily_xdr_permyriad)&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L143" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+144</span><span class="line-content">            ),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L144" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">145</span><span class="line-content">         })<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L145" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">146</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">147</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L147" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">148</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L148" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">149</span><span class="line-content"> // DailyNodeProviderRewards conversions<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-234</span><span class="line-content">impl From&lt;native_types::DailyNodeProviderRewards&gt; for DailyNodeProviderRewards {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L234" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-235</span><span class="line-content">    fn from(src: native_types::DailyNodeProviderRewards) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L235" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-236</span><span class="line-content">        Self {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L236" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-237</span><span class="line-content">            rewards_total_xdr_permyriad: Some(DecimalProto::from(src.rewards_total)),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L237" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-238</span><span class="line-content">            base_rewards: src<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L238" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-239</span><span class="line-content">                .base_rewards<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L239" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-240</span><span class="line-content">                .into_iter()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L240" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-241</span><span class="line-content">                .map(BaseRewardsSpec::from)<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L241" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-242</span><span class="line-content">                .collect(),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L242" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-243</span><span class="line-content">            base_rewards_type3: src<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L243" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-244</span><span class="line-content">                .type3_base_rewards<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L244" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-245</span><span class="line-content">                .into_iter()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L245" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-246</span><span class="line-content">                .map(Type3BaseRewardsSpec::from)<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L246" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-247</span><span class="line-content">                .collect(),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L247" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-248</span><span class="line-content">            daily_nodes_rewards: src<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L248" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-249</span><span class="line-content">                .daily_nodes_rewards<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L249" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-250</span><span class="line-content">                .into_iter()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L250" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-251</span><span class="line-content">                .map(DailyNodeRewards::from)<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L251" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-252</span><span class="line-content">                .collect(),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L252" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-253</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L253" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-254</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L254" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-255</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L255" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-256</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L256" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-257</span><span class="line-content">impl TryFrom&lt;DailyNodeProviderRewards&gt; for native_types::DailyNodeProviderRewards {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L257" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+150</span><span class="line-content">impl TryFrom&lt;native_types::DailyNodeProviderRewards&gt; for DailyNodeProviderRewards {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L150" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">151</span><span class="line-content">     type Error = String;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L151" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">152</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L152" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-260</span><span class="line-content">    fn try_from(src: DailyNodeProviderRewards) -&gt; Result&lt;Self, Self::Error&gt; {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L260" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+153</span><span class="line-content">    fn try_from(src: native_types::DailyNodeProviderRewards) -&gt; Result&lt;Self, Self::Error&gt; {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L153" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">154</span><span class="line-content">         Ok(Self {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L154" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-262</span><span class="line-content">            rewards_total: Decimal::try_from(src.rewards_total_xdr_permyriad.ok_or(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L262" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-263</span><span class="line-content">                &quot;rewards_total_xdr_permyriad is missing (from DailyNodeProviderRewards).&quot;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L263" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-264</span><span class="line-content">            )?)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L264" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+155</span><span class="line-content">            rewards_total_xdr_permyriad: Some(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L155" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+156</span><span class="line-content">                src.rewards_total_xdr_permyriad<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L156" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+157</span><span class="line-content">                    .to_u64()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L157" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+158</span><span class="line-content">                    .ok_or(&quot;Conversion to u64 failed (rewards_total_xdr_permyriad)&quot;)?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L158" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+159</span><span class="line-content">            ),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L159" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">160</span><span class="line-content">             base_rewards: src<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L160" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">161</span><span class="line-content">                 .base_rewards<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L161" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">162</span><span class="line-content">                 .into_iter()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L162" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-268</span><span class="line-content">                .map(native_types::BaseRewardsSpec::try_from)<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L268" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+163</span><span class="line-content">                .map(NodeTypeRegionBaseRewards::try_from)<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L163" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">164</span><span class="line-content">                 .collect::&lt;Result&lt;_, _&gt;&gt;()?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L164" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-270</span><span class="line-content">            type3_base_rewards: src<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L270" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-271</span><span class="line-content">                .base_rewards_type3<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L271" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+165</span><span class="line-content">            base_rewards_type3: src<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L165" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+166</span><span class="line-content">                .type3_base_rewards<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L166" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">167</span><span class="line-content">                 .into_iter()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L167" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-273</span><span class="line-content">                .map(native_types::Type3BaseRewards::try_from)<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L273" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+168</span><span class="line-content">                .map(Type3RegionBaseRewards::try_from)<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L168" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">169</span><span class="line-content">                 .collect::&lt;Result&lt;_, _&gt;&gt;()?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L169" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">170</span><span class="line-content">             daily_nodes_rewards: src<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L170" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">171</span><span class="line-content">                 .daily_nodes_rewards<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L171" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">172</span><span class="line-content">                 .into_iter()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L172" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-278</span><span class="line-content">                .map(native_types::DailyNodeRewards::try_from)<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L278" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+173</span><span class="line-content">                .map(DailyNodeRewards::try_from)<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L173" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">174</span><span class="line-content">                 .collect::&lt;Result&lt;_, _&gt;&gt;()?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L174" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">175</span><span class="line-content">         })<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L175" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">176</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L176" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">177</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L177" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">178</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L178" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">179</span><span class="line-content"> // DailyResults conversions<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L179" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-285</span><span class="line-content">impl From&lt;native_types::DailyResults&gt; for DailyResults {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L285" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-286</span><span class="line-content">    fn from(src: native_types::DailyResults) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L286" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-287</span><span class="line-content">        Self {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L287" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-288</span><span class="line-content">            subnets_fr: src<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L288" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-289</span><span class="line-content">                .subnets_fr<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L289" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-290</span><span class="line-content">                .into_iter()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L290" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-291</span><span class="line-content">                .map(|(k, v)| (k, DecimalProto::from(v)))<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L291" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-292</span><span class="line-content">                .collect(),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L292" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-293</span><span class="line-content">            provider_results: src<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L293" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-294</span><span class="line-content">                .provider_results<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L294" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-295</span><span class="line-content">                .into_iter()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L295" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-296</span><span class="line-content">                .map(|(k, v)| (k, DailyNodeProviderRewards::from(v)))<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L296" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-297</span><span class="line-content">                .collect(),<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L297" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-298</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L298" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-299</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L299" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-300</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L300" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-301</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L301" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-302</span><span class="line-content">impl TryFrom&lt;DailyResults&gt; for native_types::DailyResults {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L302" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+180</span><span class="line-content">impl TryFrom&lt;native_types::DailyResults&gt; for DailyResults {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L180" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">181</span><span class="line-content">     type Error = String;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L181" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">182</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L182" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-305</span><span class="line-content">    fn try_from(src: DailyResults) -&gt; Result&lt;Self, Self::Error&gt; {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L305" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+183</span><span class="line-content">    fn try_from(src: native_types::DailyResults) -&gt; Result&lt;Self, Self::Error&gt; {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L183" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">184</span><span class="line-content">         Ok(Self {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L184" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">185</span><span class="line-content">             subnets_fr: src<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L185" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-308</span><span class="line-content">                .subnets_fr<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L308" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+186</span><span class="line-content">                .subnets_fr_percent<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L186" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">187</span><span class="line-content">                 .into_iter()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L187" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-310</span><span class="line-content">                .map(|(k, v)| Decimal::try_from(v).map(|dec| (k, dec)))<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L310" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+188</span><span class="line-content">                .map(|(k, v)| {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L188" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+189</span><span class="line-content">                    v.to_f64()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L189" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+190</span><span class="line-content">                        .map(|v| (k, v))<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L190" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+191</span><span class="line-content">                        .ok_or(&quot;Conversion to f64 failed (subnets_fr_percent)&quot;)<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L191" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+192</span><span class="line-content">                })<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L192" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">193</span><span class="line-content">                 .collect::&lt;Result&lt;_, _&gt;&gt;()?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L193" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">194</span><span class="line-content">             provider_results: src<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L194" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">195</span><span class="line-content">                 .provider_results<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L195" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">196</span><span class="line-content">                 .into_iter()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L196" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-315</span><span class="line-content">                .map(|(k, v)| native_types::DailyNodeProviderRewards::try_from(v).map(|v| (k, v)))<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/api_native_conversion.rs#L315" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+197</span><span class="line-content">                .map(|(k, v)| DailyNodeProviderRewards::try_from(v).map(|v| (k, v)))<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L197" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">198</span><span class="line-content">                 .collect::&lt;Result&lt;_, _&gt;&gt;()?,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L198" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">199</span><span class="line-content">         })<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L199" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">200</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L200" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">201</span><span class="line-content">diff --git a/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs b/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L201" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">202</span><span class="line-content">index 1e41f9f506..00dd628a0f 100644<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/api_native_conversion.rs#L202" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs</div>
<div class="hunk-header">@@ -1,7 +1,6 @@</div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> pub use crate::DateUtc;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use candid::{CandidType, Deserialize};<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use ic_base_types::{PrincipalId, SubnetId};<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-4</span><span class="line-content">use ic_nervous_system_proto::pb::v1::Decimal;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use std::collections::BTreeMap;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> #[derive(CandidType, Clone, Deserialize)]<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -10,7 +9,7 @@ pub struct GetNodeProvidersRewardsCalculationRequest {</div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> // TODO: Remove useless level of indirection: https://github.com/dfinity/ic/pull/7071/files#r2406450031<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-13</span><span class="line-content">pub type GetNodeProviderRewardsCalculationResponse = Result&lt;DailyResults, String&gt;;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+12</span><span class="line-content">pub type GetNodeProvidersRewardsCalculationResponse = Result&lt;DailyResults, String&gt;;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> // These are API-facing types with all fields wrapped in `Option`<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> // to ensure forward compatibility. This way, new fields can be added<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -20,19 +19,19 @@ pub type GetNodeProviderRewardsCalculationResponse = Result&lt;DailyResults, String</div>
<div class="line context"><span class="line-number">19</span><span class="line-content"> #[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">20</span><span class="line-content"> pub struct NodeMetricsDaily {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">21</span><span class="line-content">     pub subnet_assigned: Option&lt;PrincipalId&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-23</span><span class="line-content">    pub subnet_assigned_fr_percent: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+22</span><span class="line-content">    pub subnet_assigned_fr_percent: Option&lt;f64&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">23</span><span class="line-content">     pub num_blocks_proposed: Option&lt;u64&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">24</span><span class="line-content">     pub num_blocks_failed: Option&lt;u64&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-26</span><span class="line-content">    pub original_fr_percent: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-27</span><span class="line-content">    pub relative_fr_percent: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+25</span><span class="line-content">    pub original_fr_percent: Option&lt;f64&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+26</span><span class="line-content">    pub relative_fr_percent: Option&lt;f64&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">27</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">28</span><span class="line-content"> #[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-30</span><span class="line-content">pub enum NodeStatus {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-31</span><span class="line-content">    Assigned {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+29</span><span class="line-content">pub enum DailyNodeFailureRate {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+30</span><span class="line-content">    SubnetMember {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">31</span><span class="line-content">         node_metrics: Option&lt;NodeMetricsDaily&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">32</span><span class="line-content">     },<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-34</span><span class="line-content">    Unassigned {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-35</span><span class="line-content">        extrapolated_fr_percent: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+33</span><span class="line-content">    NonSubnetMember {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+34</span><span class="line-content">        extrapolated_fr_percent: Option&lt;f64&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">35</span><span class="line-content">     },<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">36</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">37</span><span class="line-content"> #[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -41,36 +40,36 @@ pub struct DailyNodeRewards {</div>
<div class="line context"><span class="line-number">40</span><span class="line-content">     pub node_reward_type: Option&lt;String&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">41</span><span class="line-content">     pub region: Option&lt;String&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">42</span><span class="line-content">     pub dc_id: Option&lt;String&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-44</span><span class="line-content">    pub node_status: Option&lt;NodeStatus&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-45</span><span class="line-content">    pub performance_multiplier_percent: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-46</span><span class="line-content">    pub rewards_reduction_percent: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-47</span><span class="line-content">    pub base_rewards_xdr_permyriad: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-48</span><span class="line-content">    pub adjusted_rewards_xdr_permyriad: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+43</span><span class="line-content">    pub daily_node_fr: Option&lt;DailyNodeFailureRate&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+44</span><span class="line-content">    pub performance_multiplier_percent: Option&lt;f64&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+45</span><span class="line-content">    pub rewards_reduction_percent: Option&lt;f64&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+46</span><span class="line-content">    pub base_rewards_xdr_permyriad: Option&lt;u64&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+47</span><span class="line-content">    pub adjusted_rewards_xdr_permyriad: Option&lt;u64&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">48</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">49</span><span class="line-content"> #[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-51</span><span class="line-content">pub struct BaseRewardsSpec {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-52</span><span class="line-content">    pub monthly_xdr_permyriad: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-53</span><span class="line-content">    pub daily_xdr_permyriad: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+50</span><span class="line-content">pub struct NodeTypeRegionBaseRewards {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+51</span><span class="line-content">    pub monthly_xdr_permyriad: Option&lt;u64&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+52</span><span class="line-content">    pub daily_xdr_permyriad: Option&lt;u64&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">53</span><span class="line-content">     pub node_reward_type: Option&lt;String&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">54</span><span class="line-content">     pub region: Option&lt;String&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">55</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">56</span><span class="line-content"> #[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-58</span><span class="line-content">pub struct Type3BaseRewardsSpec {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+57</span><span class="line-content">pub struct Type3RegionBaseRewards {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">58</span><span class="line-content">     pub region: Option&lt;String&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">59</span><span class="line-content">     pub nodes_count: Option&lt;u64&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-61</span><span class="line-content">    pub avg_rewards_xdr_permyriad: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-62</span><span class="line-content">    pub avg_coefficient_percent: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-63</span><span class="line-content">    pub value_xdr_permyriad: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+60</span><span class="line-content">    pub avg_rewards_xdr_permyriad: Option&lt;u64&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+61</span><span class="line-content">    pub avg_coefficient_percent: Option&lt;f64&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+62</span><span class="line-content">    pub daily_xdr_permyriad: Option&lt;u64&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">63</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">64</span><span class="line-content"> #[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">65</span><span class="line-content"> pub struct DailyNodeProviderRewards {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-67</span><span class="line-content">    pub rewards_total_xdr_permyriad: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-68</span><span class="line-content">    pub base_rewards: Vec&lt;BaseRewardsSpec&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-69</span><span class="line-content">    pub base_rewards_type3: Vec&lt;Type3BaseRewardsSpec&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+66</span><span class="line-content">    pub rewards_total_xdr_permyriad: Option&lt;u64&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+67</span><span class="line-content">    pub base_rewards: Vec&lt;NodeTypeRegionBaseRewards&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+68</span><span class="line-content">    pub base_rewards_type3: Vec&lt;Type3RegionBaseRewards&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">69</span><span class="line-content">     pub daily_nodes_rewards: Vec&lt;DailyNodeRewards&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">70</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">71</span><span class="line-content"> #[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">72</span><span class="line-content"> pub struct DailyResults {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-74</span><span class="line-content">    pub subnets_fr: BTreeMap&lt;SubnetId, Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+73</span><span class="line-content">    pub subnets_fr: BTreeMap&lt;SubnetId, f64&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">74</span><span class="line-content">     pub provider_results: BTreeMap&lt;PrincipalId, DailyNodeProviderRewards&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">75</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">76</span><span class="line-content">diff --git a/rs/node_rewards/canister/node-rewards-canister.did b/rs/node_rewards/canister/node-rewards-canister.did<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">77</span><span class="line-content">index 85fd0c27a9..c934ddf5d8 100644<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/node-rewards-canister.did</div>
<div class="file-header">+++ b/rs/node_rewards/canister/node-rewards-canister.did</div>
<div class="hunk-header">@@ -1,9 +1,5 @@</div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> // get_node_providers_rewards_calculation<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-3</span><span class="line-content">type Decimal = record {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-4</span><span class="line-content">  human_readable: opt text;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-5</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-6</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> type DateUtc = record {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content">   day: opt nat32;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content">   month: opt nat32;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -12,16 +8,16 @@ type DateUtc = record {</div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> type NodeMetricsDaily = record {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content">   subnet_assigned: opt principal;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-15</span><span class="line-content">  subnet_assigned_fr_percent: opt Decimal;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+11</span><span class="line-content">  subnet_assigned_fr_percent: opt float64;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">   num_blocks_proposed: opt nat64;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content">   num_blocks_failed: opt nat64;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-18</span><span class="line-content">  original_fr_percent: opt Decimal;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-19</span><span class="line-content">  relative_fr_percent: opt Decimal;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+14</span><span class="line-content">  original_fr_percent: opt float64;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+15</span><span class="line-content">  relative_fr_percent: opt float64;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-22</span><span class="line-content">type NodeStatus = variant {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-23</span><span class="line-content">  Assigned: record { node_metrics: opt NodeMetricsDaily };<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-24</span><span class="line-content">  Unassigned: record { extrapolated_fr_percent: opt Decimal };<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+18</span><span class="line-content">type DailyNodeFailureRate = variant {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+19</span><span class="line-content">  SubnetMember: record { node_metrics: opt NodeMetricsDaily };<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+20</span><span class="line-content">  NonSubnetMember: record { extrapolated_fr_percent: opt float64 };<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">21</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">22</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">23</span><span class="line-content"> type DailyNodeRewards = record {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -29,41 +25,41 @@ type DailyNodeRewards = record {</div>
<div class="line context"><span class="line-number">25</span><span class="line-content">   node_reward_type: opt text;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">26</span><span class="line-content">   region: opt text;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">27</span><span class="line-content">   dc_id: opt text;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-32</span><span class="line-content">  node_status: opt NodeStatus;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-33</span><span class="line-content">  performance_multiplier_percent: opt Decimal;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-34</span><span class="line-content">  rewards_reduction_percent: opt Decimal;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-35</span><span class="line-content">  base_rewards_xdr_permyriad: opt Decimal;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-36</span><span class="line-content">  adjusted_rewards_xdr_permyriad: opt Decimal;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+28</span><span class="line-content">  daily_node_fr: opt DailyNodeFailureRate;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+29</span><span class="line-content">  performance_multiplier_percent: opt float64;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+30</span><span class="line-content">  rewards_reduction_percent: opt float64;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+31</span><span class="line-content">  base_rewards_xdr_permyriad: opt nat64;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+32</span><span class="line-content">  adjusted_rewards_xdr_permyriad: opt nat64;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">33</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">34</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-39</span><span class="line-content">type BaseRewardsSpec = record {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-40</span><span class="line-content">  monthly_xdr_permyriad: opt Decimal;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-41</span><span class="line-content">  daily_xdr_permyriad: opt Decimal;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+35</span><span class="line-content">type NodeTypeRegionBaseRewards = record {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+36</span><span class="line-content">  monthly_xdr_permyriad: opt nat64;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+37</span><span class="line-content">  daily_xdr_permyriad: opt nat64;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">38</span><span class="line-content">   node_reward_type: opt text;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">39</span><span class="line-content">   region: opt text;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">40</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">41</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-46</span><span class="line-content">type Type3BaseRewardsSpec = record {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+42</span><span class="line-content">type Type3BaseRewards = record {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">43</span><span class="line-content">   region: opt text;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">44</span><span class="line-content">   nodes_count: opt nat64;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-49</span><span class="line-content">  avg_rewards_xdr_permyriad: opt Decimal;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-50</span><span class="line-content">  avg_coefficient_percent: opt Decimal;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-51</span><span class="line-content">  value_xdr_permyriad: opt Decimal;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+45</span><span class="line-content">  avg_rewards_xdr_permyriad: opt nat64;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+46</span><span class="line-content">  avg_coefficient_percent: opt float64;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+47</span><span class="line-content">  daily_xdr_permyriad: opt nat64;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">48</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">49</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">50</span><span class="line-content"> type DailyNodeProviderRewards = record {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-55</span><span class="line-content">  rewards_total_xdr_permyriad: opt Decimal;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-56</span><span class="line-content">  base_rewards: vec BaseRewardsSpec;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-57</span><span class="line-content">  base_rewards_type3: vec Type3BaseRewardsSpec;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+51</span><span class="line-content">  rewards_total_xdr_permyriad: opt nat64;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+52</span><span class="line-content">  base_rewards: vec NodeTypeRegionBaseRewards;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+53</span><span class="line-content">  base_rewards_type3: vec Type3BaseRewards;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">54</span><span class="line-content">   daily_nodes_rewards: vec DailyNodeRewards;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">55</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">56</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">57</span><span class="line-content"> type DailyResults = record {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-62</span><span class="line-content">    subnets_fr: vec record { principal; Decimal };<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+58</span><span class="line-content">    subnets_fr: vec record { principal; float64 };<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">59</span><span class="line-content">     provider_results: vec record { principal; DailyNodeProviderRewards };<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">60</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">61</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-66</span><span class="line-content">type GetNodeProviderRewardsCalculationResponse = variant { Ok: DailyResults; Err: text };<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+62</span><span class="line-content">type GetNodeProvidersRewardsCalculationResponse = variant { Ok: DailyResults; Err: text };<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">63</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">64</span><span class="line-content"> type GetNodeProvidersRewardsCalculationRequest = record {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">65</span><span class="line-content">   day: DateUtc;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -107,5 +103,5 @@ service: () -&gt; {</div>
<div class="line context"><span class="line-number">103</span><span class="line-content">         GetNodeProvidersMonthlyXdrRewardsResponse<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">104</span><span class="line-content">     );<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L104" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">105</span><span class="line-content">     get_node_providers_rewards: (GetNodeProvidersRewardsRequest) -&gt; (GetNodeProvidersRewardsResponse);<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L105" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-110</span><span class="line-content">    get_node_providers_rewards_calculation: (GetNodeProvidersRewardsCalculationRequest) -&gt; (GetNodeProviderRewardsCalculationResponse) query;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/node-rewards-canister.did#L110" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+106</span><span class="line-content">    get_node_providers_rewards_calculation: (GetNodeProvidersRewardsCalculationRequest) -&gt; (GetNodeProvidersRewardsCalculationResponse) query;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L106" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">107</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L107" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">108</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/canister/mod.rs b/rs/node_rewards/canister/src/canister/mod.rs<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L108" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">109</span><span class="line-content">index 7d37f3f77a..f8f23e02d2 100644<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/node-rewards-canister.did#L109" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/canister/mod.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/canister/mod.rs</div>
<div class="hunk-header">@@ -10,8 +10,8 @@ use ic_node_rewards_canister_api::monthly_rewards::{</div>
<div class="line context"><span class="line-number">10</span><span class="line-content">     NodeProvidersMonthlyXdrRewards,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/canister/mod.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/canister/mod.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> use ic_node_rewards_canister_api::provider_rewards_calculation::{<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/canister/mod.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-13</span><span class="line-content">    DailyResults, GetNodeProviderRewardsCalculationResponse,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/src/canister/mod.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-14</span><span class="line-content">    GetNodeProvidersRewardsCalculationRequest,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/src/canister/mod.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+13</span><span class="line-content">    DailyResults, GetNodeProvidersRewardsCalculationRequest,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/canister/mod.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+14</span><span class="line-content">    GetNodeProvidersRewardsCalculationResponse,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/canister/mod.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/canister/mod.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> use ic_node_rewards_canister_api::providers_rewards::{<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/canister/mod.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content">     GetNodeProvidersRewardsRequest, GetNodeProvidersRewardsResponse, NodeProvidersRewards,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/canister/mod.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -292,7 +292,7 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">292</span><span class="line-content">     pub fn get_node_providers_rewards_calculation(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/canister/mod.rs#L292" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">293</span><span class="line-content">         canister: &amp;&#x27;static LocalKey&lt;RefCell&lt;NodeRewardsCanister&gt;&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/canister/mod.rs#L293" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">294</span><span class="line-content">         request: GetNodeProvidersRewardsCalculationRequest,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/canister/mod.rs#L294" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-295</span><span class="line-content">    ) -&gt; GetNodeProviderRewardsCalculationResponse {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/src/canister/mod.rs#L295" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+295</span><span class="line-content">    ) -&gt; GetNodeProvidersRewardsCalculationResponse {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/canister/mod.rs#L295" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">296</span><span class="line-content">         let request_inner = GetNodeProvidersRewardsRequest {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/canister/mod.rs#L296" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">297</span><span class="line-content">             from_day: request.day,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/canister/mod.rs#L297" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">298</span><span class="line-content">             to_day: request.day,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/canister/mod.rs#L298" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -305,7 +305,7 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">305</span><span class="line-content">             .daily_results<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/canister/mod.rs#L305" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">306</span><span class="line-content">             .remove(&amp;day)<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/canister/mod.rs#L306" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">307</span><span class="line-content">             .ok_or(&quot;Could not find daily results for the requested day&quot;)?;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/canister/mod.rs#L307" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-308</span><span class="line-content">        Ok(DailyResults::from(daily_results))<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/src/canister/mod.rs#L308" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+308</span><span class="line-content">        DailyResults::try_from(daily_results)<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/canister/mod.rs#L308" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">309</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/canister/mod.rs#L309" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">310</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/canister/mod.rs#L310" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">311</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/canister/mod.rs#L311" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">312</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/main.rs b/rs/node_rewards/canister/src/main.rs<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/canister/mod.rs#L312" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">313</span><span class="line-content">index 9a9a59d0a6..7b9de699a8 100644<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/canister/mod.rs#L313" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/main.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/main.rs</div>
<div class="hunk-header">@@ -9,7 +9,7 @@ use ic_node_rewards_canister_api::monthly_rewards::{</div>
<div class="line context"><span class="line-number">9</span><span class="line-content">     GetNodeProvidersMonthlyXdrRewardsRequest, GetNodeProvidersMonthlyXdrRewardsResponse,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/main.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/main.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> use ic_node_rewards_canister_api::provider_rewards_calculation::{<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/main.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-12</span><span class="line-content">    GetNodeProviderRewardsCalculationResponse, GetNodeProvidersRewardsCalculationRequest,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/src/main.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+12</span><span class="line-content">    GetNodeProvidersRewardsCalculationRequest, GetNodeProvidersRewardsCalculationResponse,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/main.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/main.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> use ic_node_rewards_canister_api::providers_rewards::{<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/main.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content">     GetNodeProvidersRewardsRequest, GetNodeProvidersRewardsResponse,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/main.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -119,7 +119,7 @@ async fn get_node_providers_rewards(</div>
<div class="line context"><span class="line-number">119</span><span class="line-content"> #[query]<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/main.rs#L119" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">120</span><span class="line-content"> fn get_node_providers_rewards_calculation(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/main.rs#L120" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">121</span><span class="line-content">     request: GetNodeProvidersRewardsCalculationRequest,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/main.rs#L121" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-122</span><span class="line-content">) -&gt; GetNodeProviderRewardsCalculationResponse {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/src/main.rs#L122" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+122</span><span class="line-content">) -&gt; GetNodeProvidersRewardsCalculationResponse {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/main.rs#L122" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">123</span><span class="line-content">     if in_replicated_execution() {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/main.rs#L123" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">124</span><span class="line-content">         return Err(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/main.rs#L124" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">125</span><span class="line-content">             &quot;Replicated execution of this method is not allowed. Use a non-replicated query call.&quot;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/main.rs#L125" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">126</span><span class="line-content">diff --git a/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs b/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/main.rs#L126" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">127</span><span class="line-content">index 897bb5042f..725a212ef4 100644<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/src/main.rs#L127" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs</div>
<div class="hunk-header">@@ -6,7 +6,7 @@ use ic_nns_test_utils::common::build_node_rewards_test_wasm;</div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use ic_node_rewards_canister_api::DateUtc;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> use ic_node_rewards_canister_api::monthly_rewards::GetNodeProvidersMonthlyXdrRewardsRequest;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> use ic_node_rewards_canister_api::provider_rewards_calculation::{<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-9</span><span class="line-content">    GetNodeProviderRewardsCalculationResponse, GetNodeProvidersRewardsCalculationRequest,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+9</span><span class="line-content">    GetNodeProvidersRewardsCalculationRequest, GetNodeProvidersRewardsCalculationResponse,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> use ic_types::PrincipalId;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> use pocket_ic::PocketIcBuilder;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -80,7 +80,7 @@ async fn get_node_providers_rewards_calculation_is_only_callable_in_nonreplicate</div>
<div class="line context"><span class="line-number">80</span><span class="line-content">     let request = GetNodeProvidersRewardsCalculationRequest { day };<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">81</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">82</span><span class="line-content">     // Non-replicated query call is allowed.<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-83</span><span class="line-content">    let err = query_candid::&lt;_, (GetNodeProviderRewardsCalculationResponse,)&gt;(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+83</span><span class="line-content">    let err = query_candid::&lt;_, (GetNodeProvidersRewardsCalculationResponse,)&gt;(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">84</span><span class="line-content">         &amp;pocket_ic,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">85</span><span class="line-content">         node_rewards_id,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">86</span><span class="line-content">         &quot;get_node_providers_rewards_calculation&quot;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -96,7 +96,7 @@ async fn get_node_providers_rewards_calculation_is_only_callable_in_nonreplicate</div>
<div class="line context"><span class="line-number">96</span><span class="line-content">     );<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L96" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">97</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">98</span><span class="line-content">     // Replicated update call is not allowed.<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L98" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-99</span><span class="line-content">    let err = update_candid::&lt;_, (GetNodeProviderRewardsCalculationResponse,)&gt;(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+99</span><span class="line-content">    let err = update_candid::&lt;_, (GetNodeProvidersRewardsCalculationResponse,)&gt;(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">100</span><span class="line-content">         &amp;pocket_ic,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L100" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">101</span><span class="line-content">         node_rewards_id,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L101" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">102</span><span class="line-content">         &quot;get_node_providers_rewards_calculation&quot;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">103</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">104</span><span class="line-content">index 7ca9d317f6..0b7d232026 100644<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L104" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs</div>
<div class="hunk-header">@@ -1,6 +1,6 @@</div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> use crate::performance_based_algorithm::results::{<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content">    BaseRewardsSpec, DailyNodeProviderRewards, DailyNodeRewards, DailyResults, NodeMetricsDaily,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-3</span><span class="line-content">    NodeStatus, Percent, RewardsCalculatorResults, Type3BaseRewards, XDRPermyriad,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+2</span><span class="line-content">    DailyNodeFailureRate, DailyNodeProviderRewards, DailyNodeRewards, DailyResults,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+3</span><span class="line-content">    NodeMetricsDaily, NodeTypeRegionBaseRewards, RewardsCalculatorResults, Type3RegionBaseRewards,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use crate::types::{NodeMetricsDailyRaw, Region, RewardableNode};<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use chrono::NaiveDate;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -46,28 +46,28 @@ pub mod v1;</div>
<div class="line context"><span class="line-number">46</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">47</span><span class="line-content"> #[derive(Default)]<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">48</span><span class="line-content"> struct FailureRateResults {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-49</span><span class="line-content">    subnets_fr: BTreeMap&lt;SubnetId, Percent&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+49</span><span class="line-content">    subnets_fr: BTreeMap&lt;SubnetId, Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">50</span><span class="line-content">     nodes_metrics_daily: BTreeMap&lt;NodeId, NodeMetricsDaily&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">51</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">52</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">53</span><span class="line-content"> #[derive(Default)]<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">54</span><span class="line-content"> struct PerformanceMultiplierResults {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-55</span><span class="line-content">    reward_reduction: BTreeMap&lt;NodeId, Percent&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-56</span><span class="line-content">    performance_multiplier: BTreeMap&lt;NodeId, Percent&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+55</span><span class="line-content">    reward_reduction: BTreeMap&lt;NodeId, Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+56</span><span class="line-content">    performance_multiplier: BTreeMap&lt;NodeId, Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">57</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">58</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">59</span><span class="line-content"> #[derive(Default)]<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">60</span><span class="line-content"> struct BaseRewardsResults {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-61</span><span class="line-content">    base_rewards: Vec&lt;BaseRewardsSpec&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-62</span><span class="line-content">    base_rewards_type3: Vec&lt;Type3BaseRewards&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-63</span><span class="line-content">    base_rewards_per_node: BTreeMap&lt;NodeId, XDRPermyriad&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+61</span><span class="line-content">    base_rewards: Vec&lt;NodeTypeRegionBaseRewards&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+62</span><span class="line-content">    base_rewards_type3: Vec&lt;Type3RegionBaseRewards&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+63</span><span class="line-content">    base_rewards_per_node: BTreeMap&lt;NodeId, Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">64</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">65</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">66</span><span class="line-content"> type RewardsCoefficientPercent = Decimal;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">67</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">68</span><span class="line-content"> #[derive(Default)]<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">69</span><span class="line-content"> struct AdjustedRewardsResults {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-70</span><span class="line-content">    adjusted_rewards: BTreeMap&lt;NodeId, XDRPermyriad&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+70</span><span class="line-content">    adjusted_rewards: BTreeMap&lt;NodeId, Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">71</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">72</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">73</span><span class="line-content"> pub trait DataProvider {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -129,8 +129,8 @@ trait PerformanceBasedAlgorithm {</div>
<div class="line context"><span class="line-number">129</span><span class="line-content">             for (provider_id, provider_rewards) in &amp;result_for_day.provider_results {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L129" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">130</span><span class="line-content">                 total_rewards_per_provider<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L130" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">131</span><span class="line-content">                     .entry(*provider_id)<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L131" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-132</span><span class="line-content">                    .and_modify(|total| *total += provider_rewards.rewards_total)<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L132" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-133</span><span class="line-content">                    .or_insert(provider_rewards.rewards_total);<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L133" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+132</span><span class="line-content">                    .and_modify(|total| *total += provider_rewards.rewards_total_xdr_permyriad)<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L132" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+133</span><span class="line-content">                    .or_insert(provider_rewards.rewards_total_xdr_permyriad);<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L133" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">134</span><span class="line-content">             }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L134" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">135</span><span class="line-content">             daily_results.insert(day, result_for_day);<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L135" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">136</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L136" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -172,7 +172,7 @@ trait PerformanceBasedAlgorithm {</div>
<div class="line context"><span class="line-number">172</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L172" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">173</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L173" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">174</span><span class="line-content">         Ok(DailyResults {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L174" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-175</span><span class="line-content">            subnets_fr,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L175" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+175</span><span class="line-content">            subnets_fr_percent: subnets_fr,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L175" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">176</span><span class="line-content">             provider_results: results_per_provider,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L176" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">177</span><span class="line-content">         })<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L177" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">178</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L178" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -191,7 +191,7 @@ trait PerformanceBasedAlgorithm {</div>
<div class="line context"><span class="line-number">191</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L191" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">192</span><span class="line-content">         let relative_nodes_fr: BTreeMap&lt;NodeId, Decimal&gt; = provider_nodes_metrics_daily<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L192" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">193</span><span class="line-content">             .iter()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L193" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-194</span><span class="line-content">            .map(|(node_id, metrics)| (*node_id, metrics.relative_fr))<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L194" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+194</span><span class="line-content">            .map(|(node_id, metrics)| (*node_id, metrics.relative_fr_percent))<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L194" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">195</span><span class="line-content">             .collect();<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L195" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">196</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L196" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">197</span><span class="line-content">         // Calculate extrapolated failure rate for unassigned nodes<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L197" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -297,11 +297,11 @@ trait PerformanceBasedAlgorithm {</div>
<div class="line context"><span class="line-number">297</span><span class="line-content">                     node_id,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L297" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">298</span><span class="line-content">                     NodeMetricsDaily {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L298" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">299</span><span class="line-content">                         subnet_assigned: subnet_id,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L299" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-300</span><span class="line-content">                        subnet_assigned_fr: subnet_fr,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L300" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+300</span><span class="line-content">                        subnet_assigned_fr_percent: subnet_fr,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L300" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">301</span><span class="line-content">                         num_blocks_proposed,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L301" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">302</span><span class="line-content">                         num_blocks_failed,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L302" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-303</span><span class="line-content">                        original_fr,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L303" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-304</span><span class="line-content">                        relative_fr,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L304" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+303</span><span class="line-content">                        original_fr_percent: original_fr,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L303" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+304</span><span class="line-content">                        relative_fr_percent: relative_fr,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L304" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">305</span><span class="line-content">                     },<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L305" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">306</span><span class="line-content">                 );<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L306" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">307</span><span class="line-content">             }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L307" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -467,12 +467,12 @@ trait PerformanceBasedAlgorithm {</div>
<div class="line context"><span class="line-number">467</span><span class="line-content">             .into_iter()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L467" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">468</span><span class="line-content">             .map(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L468" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">469</span><span class="line-content">                 |(region, (daily_rewards, nodes_count, avg_rewards, avg_coefficient))| {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L469" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-470</span><span class="line-content">                    Type3BaseRewards {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L470" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+470</span><span class="line-content">                    Type3RegionBaseRewards {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L470" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">471</span><span class="line-content">                         region,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L471" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">472</span><span class="line-content">                         nodes_count,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L472" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-473</span><span class="line-content">                        avg_rewards,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L473" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-474</span><span class="line-content">                        avg_coefficient,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L474" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-475</span><span class="line-content">                        value: daily_rewards,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L475" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+473</span><span class="line-content">                        avg_rewards_xdr_permyriad: avg_rewards,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L473" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+474</span><span class="line-content">                        avg_coefficient_percent: avg_coefficient,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L474" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+475</span><span class="line-content">                        daily_xdr_permyriad: daily_rewards,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L475" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">476</span><span class="line-content">                     }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L476" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">477</span><span class="line-content">                 },<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L477" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">478</span><span class="line-content">             )<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L478" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -481,11 +481,13 @@ trait PerformanceBasedAlgorithm {</div>
<div class="line context"><span class="line-number">481</span><span class="line-content">         let base_rewards = base_rewards<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L481" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">482</span><span class="line-content">             .into_iter()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L482" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">483</span><span class="line-content">             .map(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L483" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-484</span><span class="line-content">                |((node_reward_type, region), (daily_rewards, monthly_rewards))| BaseRewardsSpec {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L484" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-485</span><span class="line-content">                    node_reward_type,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L485" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-486</span><span class="line-content">                    region,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L486" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-487</span><span class="line-content">                    monthly: monthly_rewards,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L487" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-488</span><span class="line-content">                    daily: daily_rewards,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L488" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+484</span><span class="line-content">                |((node_reward_type, region), (daily_rewards, monthly_rewards))| {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L484" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+485</span><span class="line-content">                    NodeTypeRegionBaseRewards {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L485" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+486</span><span class="line-content">                        node_reward_type,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L486" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+487</span><span class="line-content">                        region,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L487" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+488</span><span class="line-content">                        monthly_xdr_permyriad: monthly_rewards,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L488" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+489</span><span class="line-content">                        daily_xdr_permyriad: daily_rewards,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L489" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+490</span><span class="line-content">                    }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L490" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">491</span><span class="line-content">                 },<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L491" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">492</span><span class="line-content">             )<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L492" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">493</span><span class="line-content">             .collect();<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L493" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -524,23 +526,23 @@ trait PerformanceBasedAlgorithm {</div>
<div class="line context"><span class="line-number">526</span><span class="line-content">     fn build_provider_rewards_summary(<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L526" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">527</span><span class="line-content">         rewardable_nodes: Vec&lt;RewardableNode&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L527" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">528</span><span class="line-content">         mut provider_nodes_metrics_daily: BTreeMap&lt;NodeId, NodeMetricsDaily&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L528" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-527</span><span class="line-content">        extrapolated_fr: Percent,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L527" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-528</span><span class="line-content">        mut reward_reduction: BTreeMap&lt;NodeId, Percent&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L528" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-529</span><span class="line-content">        mut performance_multiplier: BTreeMap&lt;NodeId, Percent&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L529" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-530</span><span class="line-content">        mut base_rewards_per_node: BTreeMap&lt;NodeId, XDRPermyriad&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L530" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-531</span><span class="line-content">        mut adjusted_rewards: BTreeMap&lt;NodeId, XDRPermyriad&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L531" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-532</span><span class="line-content">        base_rewards: Vec&lt;BaseRewardsSpec&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L532" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-533</span><span class="line-content">        base_rewards_type3: Vec&lt;Type3BaseRewards&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L533" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+529</span><span class="line-content">        extrapolated_fr: Decimal,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L529" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+530</span><span class="line-content">        mut reward_reduction: BTreeMap&lt;NodeId, Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L530" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+531</span><span class="line-content">        mut performance_multiplier: BTreeMap&lt;NodeId, Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L531" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+532</span><span class="line-content">        mut base_rewards_per_node: BTreeMap&lt;NodeId, Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L532" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+533</span><span class="line-content">        mut adjusted_rewards: BTreeMap&lt;NodeId, Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L533" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+534</span><span class="line-content">        base_rewards: Vec&lt;NodeTypeRegionBaseRewards&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L534" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+535</span><span class="line-content">        base_rewards_type3: Vec&lt;Type3RegionBaseRewards&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L535" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">536</span><span class="line-content">     ) -&gt; DailyNodeProviderRewards {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L536" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">537</span><span class="line-content">         let mut results_by_node = Vec::new();<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L537" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-536</span><span class="line-content">        let mut rewards_total = Decimal::ZERO;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L536" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+538</span><span class="line-content">        let mut rewards_total_xdr_permyriad = Decimal::ZERO;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L538" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">539</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L539" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">540</span><span class="line-content">         for node in rewardable_nodes {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L540" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">541</span><span class="line-content">             let node_status =<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L541" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">542</span><span class="line-content">                 if let Some(node_metrics) = provider_nodes_metrics_daily.remove(&amp;node.node_id) {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L542" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-541</span><span class="line-content">                    NodeStatus::Assigned { node_metrics }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L541" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+543</span><span class="line-content">                    DailyNodeFailureRate::SubnetMember { node_metrics }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L543" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">544</span><span class="line-content">                 } else {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L544" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-543</span><span class="line-content">                    NodeStatus::Unassigned { extrapolated_fr }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L543" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+545</span><span class="line-content">                    DailyNodeFailureRate::NonSubnetMember { extrapolated_fr }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L545" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">546</span><span class="line-content">                 };<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L546" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">547</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L547" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">548</span><span class="line-content">             let rewards_reduction_percent = reward_reduction<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L548" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -559,23 +561,23 @@ trait PerformanceBasedAlgorithm {</div>
<div class="line context"><span class="line-number">561</span><span class="line-content">                 .remove(&amp;node.node_id)<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L561" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">562</span><span class="line-content">                 .expect(&quot;Adjusted rewards should be present in rewards&quot;);<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L562" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">563</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L563" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-562</span><span class="line-content">            rewards_total += adjusted_rewards_xdr_permyriad;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L562" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+564</span><span class="line-content">            rewards_total_xdr_permyriad += adjusted_rewards_xdr_permyriad;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L564" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">565</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L565" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">566</span><span class="line-content">             results_by_node.push(DailyNodeRewards {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L566" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">567</span><span class="line-content">                 node_id: node.node_id,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L567" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">568</span><span class="line-content">                 node_reward_type: node.node_reward_type,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L568" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">569</span><span class="line-content">                 region: node.region,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L569" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">570</span><span class="line-content">                 dc_id: node.dc_id,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L570" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-569</span><span class="line-content">                node_status,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L569" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-570</span><span class="line-content">                performance_multiplier: performance_multiplier_percent,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L570" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-571</span><span class="line-content">                rewards_reduction: rewards_reduction_percent,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L571" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-572</span><span class="line-content">                base_rewards: base_rewards_xdr_permyriad,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L572" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-573</span><span class="line-content">                adjusted_rewards: adjusted_rewards_xdr_permyriad,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L573" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+571</span><span class="line-content">                daily_node_fr: node_status,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L571" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+572</span><span class="line-content">                performance_multiplier_percent,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L572" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+573</span><span class="line-content">                rewards_reduction_percent,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L573" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+574</span><span class="line-content">                base_rewards_xdr_permyriad,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L574" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+575</span><span class="line-content">                adjusted_rewards_xdr_permyriad,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L575" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">576</span><span class="line-content">             });<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L576" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">577</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L577" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">578</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L578" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">579</span><span class="line-content">         DailyNodeProviderRewards {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L579" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-578</span><span class="line-content">            rewards_total,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L578" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+580</span><span class="line-content">            rewards_total_xdr_permyriad,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L580" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">581</span><span class="line-content">             base_rewards,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L581" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">582</span><span class="line-content">             type3_base_rewards: base_rewards_type3,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L582" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">583</span><span class="line-content">             daily_nodes_rewards: results_by_node,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L583" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">584</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L584" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">585</span><span class="line-content">index e384825ae3..6b368e68b7 100644<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L585" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs</div>
<div class="hunk-header">@@ -5,10 +5,6 @@ use rust_decimal::Decimal;</div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use serde::{Deserialize, Serialize};<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use std::collections::BTreeMap;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-8</span><span class="line-content">// TODO: Remove these types in favor of Decimal. Also fields renaming to include units<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-9</span><span class="line-content">// https://github.com/dfinity/ic/pull/7071/files#r2406492271<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-10</span><span class="line-content">pub type XDRPermyriad = Decimal; // Rewards unit in XDR scaled by 1/10,000 (permyriad)<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-11</span><span class="line-content">pub type Percent = Decimal;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> pub type Region = String;<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> #[derive(Serialize, Deserialize, Clone, Debug, PartialEq)]<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -23,7 +19,7 @@ pub struct NodeMetricsDaily {</div>
<div class="line context"><span class="line-number">19</span><span class="line-content">     /// This is the SUBNET_FAILURE_RATE_PERCENTILE of the original_fr all nodes in the subnet.<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">20</span><span class="line-content">     /// It is used to adjust individual node failure rates to account for systematic issues<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">21</span><span class="line-content">     /// affecting the whole subnet.<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-26</span><span class="line-content">    pub subnet_assigned_fr: Percent,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+22</span><span class="line-content">    pub subnet_assigned_fr_percent: Decimal,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">23</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">24</span><span class="line-content">     /// Number of blocks successfully proposed by this node on this day<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">25</span><span class="line-content">     pub num_blocks_proposed: u64,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -35,27 +31,27 @@ pub struct NodeMetricsDaily {</div>
<div class="line context"><span class="line-number">31</span><span class="line-content">     ///<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">32</span><span class="line-content">     /// Calculated as `num_blocks_failed / (num_blocks_proposed + num_blocks_failed)`.<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">33</span><span class="line-content">     /// Represents the failure rate of the node before any subnet-level adjustments.<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-38</span><span class="line-content">    pub original_fr: Percent,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+34</span><span class="line-content">    pub original_fr_percent: Decimal,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">35</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">36</span><span class="line-content">     /// Relative Failure Rate<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">37</span><span class="line-content">     ///<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">38</span><span class="line-content">     /// Failure rate adjusted for subnet performance.<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-43</span><span class="line-content">    /// Calculated as `max(0, original_fr - subnet_assigned_fr)`.<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+39</span><span class="line-content">    /// Calculated as `max(0, original_fr - subnet_assigned_fr_percent)`.<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">40</span><span class="line-content">     /// TODO: Link documentation about performance based rewards algorithm<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-45</span><span class="line-content">    pub relative_fr: Percent,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+41</span><span class="line-content">    pub relative_fr_percent: Decimal,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">42</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">43</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-48</span><span class="line-content">// TODO: Renaming to NodeProductivity: https://github.com/dfinity/ic/pull/7071/files#r2406794563<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+44</span><span class="line-content">// TODO: Link documentation about performance based rewards algorithm<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">45</span><span class="line-content"> #[derive(Serialize, Deserialize, Debug, PartialEq, Clone)]<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-50</span><span class="line-content">pub enum NodeStatus {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+46</span><span class="line-content">pub enum DailyNodeFailureRate {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">47</span><span class="line-content">     /// Node is assigned to a subnet with recorded metrics<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-52</span><span class="line-content">    Assigned { node_metrics: NodeMetricsDaily },<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+48</span><span class="line-content">    SubnetMember { node_metrics: NodeMetricsDaily },<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">49</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">50</span><span class="line-content">     /// Node is unassigned; only extrapolated failure rate is available<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-55</span><span class="line-content">    Unassigned {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+51</span><span class="line-content">    NonSubnetMember {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">52</span><span class="line-content">         /// Extrapolated Failure Rate (EFR)<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">53</span><span class="line-content">         /// Used to estimate the node&#x27;s performance when unassigned<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-58</span><span class="line-content">        extrapolated_fr: Percent,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+54</span><span class="line-content">        extrapolated_fr: Decimal,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">55</span><span class="line-content">     },<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">56</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">57</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -73,28 +69,28 @@ pub struct DailyNodeRewards {</div>
<div class="line context"><span class="line-number">69</span><span class="line-content">     /// TODO: Link to documentation about performance based rewards<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">70</span><span class="line-content">     pub dc_id: String,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">71</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-76</span><span class="line-content">    /// Node status, assigned or unassigned, with associated metrics<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-77</span><span class="line-content">    pub node_status: NodeStatus,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+72</span><span class="line-content">    /// Daily node failure rate<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+73</span><span class="line-content">    pub daily_node_fr: DailyNodeFailureRate,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">74</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">75</span><span class="line-content">     /// Performance multiplier (1 - rewards_reduction)<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">76</span><span class="line-content">     ///<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">77</span><span class="line-content">     /// Represents how rewards are adjusted based on node performance<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-82</span><span class="line-content">    pub performance_multiplier: Percent,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+78</span><span class="line-content">    pub performance_multiplier_percent: Decimal,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">79</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">80</span><span class="line-content">     /// Rewards reduction applied due to failure rates<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">81</span><span class="line-content">     // TODO: Link to documentation about performance based rewards<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-86</span><span class="line-content">    pub rewards_reduction: Percent,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+82</span><span class="line-content">    pub rewards_reduction_percent: Decimal,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">83</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">84</span><span class="line-content">     /// Base rewards before applying performance multipliers<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-89</span><span class="line-content">    pub base_rewards: XDRPermyriad,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+85</span><span class="line-content">    pub base_rewards_xdr_permyriad: Decimal,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">86</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">87</span><span class="line-content">     /// Rewards adjusted by the performance multiplier<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-92</span><span class="line-content">    pub adjusted_rewards: XDRPermyriad,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+88</span><span class="line-content">    pub adjusted_rewards_xdr_permyriad: Decimal,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">89</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">90</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">91</span><span class="line-content"> /// Base rewards for NON type 3 nodes.<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">92</span><span class="line-content"> #[derive(Serialize, Deserialize, Debug, PartialEq, Clone)]<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-97</span><span class="line-content">pub struct BaseRewardsSpec {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+93</span><span class="line-content">pub struct NodeTypeRegionBaseRewards {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">94</span><span class="line-content">     /// NodeRewardType<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L94" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">95</span><span class="line-content">     pub node_reward_type: NodeRewardType,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">96</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L96" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -102,10 +98,10 @@ pub struct BaseRewardsSpec {</div>
<div class="line context"><span class="line-number">98</span><span class="line-content">     pub region: Region,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L98" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">99</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">100</span><span class="line-content">     /// Monthly base rewards in XDR permyriad<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L100" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-105</span><span class="line-content">    pub monthly: XDRPermyriad,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L105" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+101</span><span class="line-content">    pub monthly_xdr_permyriad: Decimal,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L101" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">102</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">103</span><span class="line-content">     /// Daily base rewards in XDR permyriad<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-108</span><span class="line-content">    pub daily: XDRPermyriad,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L108" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+104</span><span class="line-content">    pub daily_xdr_permyriad: Decimal,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L104" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">105</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L105" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">106</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L106" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">107</span><span class="line-content"> /// Base rewards for a Type 3 node.<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L107" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -114,7 +110,7 @@ pub struct BaseRewardsSpec {</div>
<div class="line context"><span class="line-number">110</span><span class="line-content"> /// For nodes which are type3 special logic is applied to compute base rewards.<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L110" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">111</span><span class="line-content"> /// Check the documentation of the performance-based rewards algorithm for details.<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L111" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">112</span><span class="line-content"> #[derive(Serialize, Deserialize, Debug, PartialEq, Clone)]<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L112" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-117</span><span class="line-content">pub struct Type3BaseRewards {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L117" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+113</span><span class="line-content">pub struct Type3RegionBaseRewards {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L113" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">114</span><span class="line-content">     /// Region for which the rewards are calculated<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L114" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">115</span><span class="line-content">     pub region: Region,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L115" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">116</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L116" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -122,25 +118,25 @@ pub struct Type3BaseRewards {</div>
<div class="line context"><span class="line-number">118</span><span class="line-content">     pub nodes_count: usize,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L118" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">119</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L119" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">120</span><span class="line-content">     /// Average rewards for nodes in this region<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L120" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-125</span><span class="line-content">    pub avg_rewards: XDRPermyriad,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L125" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+121</span><span class="line-content">    pub avg_rewards_xdr_permyriad: Decimal,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L121" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">122</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L122" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">123</span><span class="line-content">     /// Average performance coefficient applied to nodes<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L123" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-128</span><span class="line-content">    pub avg_coefficient: Percent,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L128" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+124</span><span class="line-content">    pub avg_coefficient_percent: Decimal,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L124" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">125</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L125" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">126</span><span class="line-content">     /// Base rewards value for Type 3 nodes<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L126" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-131</span><span class="line-content">    pub value: XDRPermyriad,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L131" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+127</span><span class="line-content">    pub daily_xdr_permyriad: Decimal,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L127" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">128</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L128" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">129</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L129" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">130</span><span class="line-content"> #[derive(Serialize, Deserialize, Debug, PartialEq, Clone)]<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L130" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">131</span><span class="line-content"> pub struct DailyNodeProviderRewards {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L131" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">132</span><span class="line-content">     /// Total rewards across all nodes for this provider in XDR permyriad<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L132" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-137</span><span class="line-content">    pub rewards_total: XDRPermyriad,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L137" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+133</span><span class="line-content">    pub rewards_total_xdr_permyriad: Decimal,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L133" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">134</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L134" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">135</span><span class="line-content">     /// Base rewards broken down by node type and region<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L135" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-140</span><span class="line-content">    pub base_rewards: Vec&lt;BaseRewardsSpec&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L140" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+136</span><span class="line-content">    pub base_rewards: Vec&lt;NodeTypeRegionBaseRewards&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L136" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">137</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L137" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">138</span><span class="line-content">     /// Base rewards broken down by &quot;type 3&quot; grouping (region aggregates)<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L138" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-143</span><span class="line-content">    pub type3_base_rewards: Vec&lt;Type3BaseRewards&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L143" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+139</span><span class="line-content">    pub type3_base_rewards: Vec&lt;Type3RegionBaseRewards&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L139" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">140</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L140" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">141</span><span class="line-content">     /// Daily rewards for each node managed by this provider<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L141" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">142</span><span class="line-content">     pub daily_nodes_rewards: Vec&lt;DailyNodeRewards&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L142" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -149,7 +145,7 @@ pub struct DailyNodeProviderRewards {</div>
<div class="line context"><span class="line-number">145</span><span class="line-content"> #[derive(Serialize, Deserialize)]<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L145" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">146</span><span class="line-content"> pub struct DailyResults {<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">147</span><span class="line-content">     /// Failure rates for all subnets on this day<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L147" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-152</span><span class="line-content">    pub subnets_fr: BTreeMap&lt;SubnetId, Percent&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L152" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+148</span><span class="line-content">    pub subnets_fr_percent: BTreeMap&lt;SubnetId, Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L148" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">149</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">150</span><span class="line-content">     /// Rewards for all node providers on this day<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L150" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">151</span><span class="line-content">     pub provider_results: BTreeMap&lt;PrincipalId, DailyNodeProviderRewards&gt;,<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L151" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">152</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L152" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">153</span><span class="line-content">index dc260d44d7..0e2bfef9ee 100644<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L153" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs</div>
<div class="hunk-header">@@ -107,12 +107,12 @@ mod tests {</div>
<div class="line context"><span class="line-number">107</span><span class="line-content">         let original_nodes_fr: BTreeMap&lt;_, _&gt; = result<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L107" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">108</span><span class="line-content">             .nodes_metrics_daily<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L108" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">109</span><span class="line-content">             .iter()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L109" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-110</span><span class="line-content">            .map(|(k, v)| (*k, v.original_fr))<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L110" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+110</span><span class="line-content">            .map(|(k, v)| (*k, v.original_fr_percent))<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L110" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">111</span><span class="line-content">             .collect();<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L111" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">112</span><span class="line-content">         let relative_nodes_fr: BTreeMap&lt;_, _&gt; = result<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L112" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">113</span><span class="line-content">             .nodes_metrics_daily<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L113" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">114</span><span class="line-content">             .iter()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L114" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-115</span><span class="line-content">            .map(|(k, v)| (*k, v.relative_fr))<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L115" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+115</span><span class="line-content">            .map(|(k, v)| (*k, v.relative_fr_percent))<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L115" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">116</span><span class="line-content">             .collect();<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L116" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">117</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L117" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">118</span><span class="line-content">         // --- Assertions for Day 1, Subnet 1 ---<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L118" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -148,12 +148,12 @@ mod tests {</div>
<div class="line context"><span class="line-number">148</span><span class="line-content">         let original_nodes_fr: BTreeMap&lt;_, _&gt; = result<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L148" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">149</span><span class="line-content">             .nodes_metrics_daily<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">150</span><span class="line-content">             .iter()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L150" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-151</span><span class="line-content">            .map(|(k, v)| (*k, v.original_fr))<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L151" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+151</span><span class="line-content">            .map(|(k, v)| (*k, v.original_fr_percent))<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L151" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">152</span><span class="line-content">             .collect();<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L152" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">153</span><span class="line-content">         let relative_nodes_fr: BTreeMap&lt;_, _&gt; = result<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L153" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">154</span><span class="line-content">             .nodes_metrics_daily<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L154" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">155</span><span class="line-content">             .iter()<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L155" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-156</span><span class="line-content">            .map(|(k, v)| (*k, v.relative_fr))<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L156" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+156</span><span class="line-content">            .map(|(k, v)| (*k, v.relative_fr_percent))<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L156" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">157</span><span class="line-content">             .collect();<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L157" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">158</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L158" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">159</span><span class="line-content">         // --- Assertions for Day 2, Subnet 1 ---<a href="https://github.com/dfinity/ic/blob/0987d0ef4394c7934186a042046d297ee7b6242d/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L159" class="github-link" target="_blank">🔗</a></span></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="commit-detail">
                    <div class="commit-header">
                        <div class="commit-title">
                            <a href="https://github.com/dfinity/ic/commit/55d5612325bfea80a32845c0eec023ed58c4d173" class="commit-hash-large" target="_blank">55d5612325bfea80a32845c0eec023ed58c4d173</a>
                            <span class="badge feat">feat</span>
                        </div>
                        <div class="commit-meta">
                            <span>👤 pietrodimarco-dfinity &lt;124565147+pietrodimarco-dfinity@users.noreply.github.com&gt;</span>
                            <span>📅 2025-10-13</span>
                            <span>📁 15 files</span>
                        </div>
                        <div style="margin-top: 8px; color: #e6edf3; font-size: 0.9em;">
                            feat(node-rewards-canister): Compute rewards over single day for all node providers (#7071)
                        </div>
                        <div class="commit-actions">
                            <button class="toggle-button secondary" onclick="toggleFiles('files-2')">📁 Files (15)</button>
                            <button class="toggle-button" onclick="toggleDiff('diff-2')">🔍 Code Changes</button>
                        </div>
                        <div id="files-2" class="collapsible">
                            <div class="files-list">
                                <ul><li>rs/node_rewards/canister/CHANGELOG.md</li><li>rs/node_rewards/canister/api/BUILD.bazel</li><li>rs/node_rewards/canister/api/Cargo.toml</li><li>rs/node_rewards/canister/api/src/api_native_conversion.rs</li><li>rs/node_rewards/canister/api/src/lib.rs</li><li>rs/node_rewards/canister/api/src/provider_rewards_calculation.rs</li><li>rs/node_rewards/canister/node-rewards-canister.did</li><li>rs/node_rewards/canister/src/api_conversion.rs</li><li>rs/node_rewards/canister/src/canister/mod.rs</li><li>rs/node_rewards/canister/src/lib.rs</li><li>rs/node_rewards/canister/src/main.rs</li><li>rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs</li><li>rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs</li><li>rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs</li><li>rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs</li></ul></div></div>
                        <div id="diff-2" class="collapsible">
                            <div class="diff-container">
                                <div class="line context"><span class="line-number">1</span><span class="line-content">commit 55d5612325bfea80a32845c0eec023ed58c4d173</span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content">Author: pietrodimarco-dfinity &lt;124565147+pietrodimarco-dfinity@users.noreply.github.com&gt;</span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content">Date:   Mon Oct 13 15:35:54 2025 +0200</span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content">    feat(node-rewards-canister): Compute rewards over single day for all node providers (#7071)</span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content">    Modified the `get_rewards_calculation` API.</span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content">    No external changes, as the API is not yet in use.</span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content">    Changes include:</span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content">    - Compute rewards for all node providers over a single day, instead of</span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">    calculating the full reward period for a single provider.</span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content">    - Add detailed comments explaining the attributes in the rewards</span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content">    calculation results.</span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content">    - Move API type conversions to the appropriate module for better</span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content">    organization.</span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content">diff --git a/rs/node_rewards/canister/CHANGELOG.md b/rs/node_rewards/canister/CHANGELOG.md</span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content">index fb9ef5a1ea..944c5341ef 100644</span></div>
<div class="file-header">--- a/rs/node_rewards/canister/CHANGELOG.md</div>
<div class="file-header">+++ b/rs/node_rewards/canister/CHANGELOG.md</div>
<div class="hunk-header">@@ -2,7 +2,6 @@</div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/CHANGELOG.md#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> INSERT NEW RELEASES HERE<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/CHANGELOG.md#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/CHANGELOG.md#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-5</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/CHANGELOG.md#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> # 2025-09-06: Proposal 138378<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/CHANGELOG.md#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/CHANGELOG.md#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> https://dashboard.internetcomputer.org/proposal/138378<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/CHANGELOG.md#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -26,10 +25,10 @@ http://dashboard.internetcomputer.org/proposal/138288</div>
<div class="line context"><span class="line-number">25</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/CHANGELOG.md#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">26</span><span class="line-content"> * Fix rewards calculation algorithm to extrapolate with 0% failure rate node&#x27;s performance for node providers with no<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/CHANGELOG.md#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">27</span><span class="line-content">   assigned nodes on a given day.<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/CHANGELOG.md#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-29</span><span class="line-content">* Replicated execution of the query endpoints `get_node_provider_rewards_calculation` and `get_historical_reward_periods`<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/CHANGELOG.md#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+28</span><span class="line-content">* Replicated execution of the query endpoints `get_node_providers_rewards_calculation` and<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/CHANGELOG.md#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+29</span><span class="line-content">  `get_historical_reward_periods`<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/CHANGELOG.md#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">30</span><span class="line-content">   is disabled.<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/CHANGELOG.md#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">31</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/CHANGELOG.md#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-32</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/CHANGELOG.md#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">32</span><span class="line-content"> # 2025-08-15: Proposal 137910<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/CHANGELOG.md#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">33</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/CHANGELOG.md#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">34</span><span class="line-content"> http://dashboard.internetcomputer.org/proposal/137910<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/CHANGELOG.md#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">35</span><span class="line-content">diff --git a/rs/node_rewards/canister/api/BUILD.bazel b/rs/node_rewards/canister/api/BUILD.bazel<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/CHANGELOG.md#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">36</span><span class="line-content">index d178c2ea23..381e0b7789 100644<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/CHANGELOG.md#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/api/BUILD.bazel</div>
<div class="file-header">+++ b/rs/node_rewards/canister/api/BUILD.bazel</div>
<div class="hunk-header">@@ -6,10 +6,12 @@ DEPENDENCIES = [</div>
<div class="line context"><span class="line-number">6</span><span class="line-content">     # Keep sorted.<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/BUILD.bazel#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content">     &quot;//rs/nervous_system/proto&quot;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/BUILD.bazel#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content">     &quot;//rs/node_rewards/rewards_calculation&quot;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/BUILD.bazel#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+9</span><span class="line-content">    &quot;//rs/protobuf&quot;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/BUILD.bazel#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content">     &quot;//rs/types/base_types&quot;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/BUILD.bazel#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content">     &quot;@crate_index//:candid&quot;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/BUILD.bazel#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">     &quot;@crate_index//:chrono_canisters&quot;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/BUILD.bazel#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content">     &quot;@crate_index//:ic-cdk&quot;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/BUILD.bazel#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+14</span><span class="line-content">    &quot;@crate_index//:rust_decimal&quot;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/BUILD.bazel#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content">     &quot;@crate_index//:serde&quot;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/BUILD.bazel#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> ]<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/BUILD.bazel#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/BUILD.bazel#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content">diff --git a/rs/node_rewards/canister/api/Cargo.toml b/rs/node_rewards/canister/api/Cargo.toml<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/BUILD.bazel#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content">index 804ca0cc8f..f60e0508a4 100644<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/BUILD.bazel#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/api/Cargo.toml</div>
<div class="file-header">+++ b/rs/node_rewards/canister/api/Cargo.toml</div>
<div class="hunk-header">@@ -14,5 +14,7 @@ candid = { workspace = true }</div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> ic-base-types = { path = &quot;../../../types/base_types&quot; }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/Cargo.toml#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> rewards-calculation = { path = &quot;../../rewards_calculation&quot; }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/Cargo.toml#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> ic-nervous-system-proto = { path = &quot;../../../nervous_system/proto&quot; }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/Cargo.toml#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+17</span><span class="line-content">ic-protobuf = { path = &quot;../../../protobuf&quot; }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/Cargo.toml#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content"> serde = { workspace = true }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/Cargo.toml#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content"> chrono = { workspace = true }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/Cargo.toml#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+20</span><span class="line-content">rust_decimal = &quot;1.37.1&quot;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/Cargo.toml#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">21</span><span class="line-content">diff --git a/rs/node_rewards/canister/api/src/api_native_conversion.rs b/rs/node_rewards/canister/api/src/api_native_conversion.rs<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/Cargo.toml#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">22</span><span class="line-content">new file mode 100644<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/Cargo.toml#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">23</span><span class="line-content">index 0000000000..9815939e56<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/Cargo.toml#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- /dev/null</div>
<div class="file-header">+++ b/rs/node_rewards/canister/api/src/api_native_conversion.rs</div>
<div class="hunk-header">@@ -0,0 +1,319 @@</div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">use crate::provider_rewards_calculation::{<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+2</span><span class="line-content">    BaseRewardsSpec, DailyNodeProviderRewards, DailyNodeRewards, DailyResults, NodeMetricsDaily,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+3</span><span class="line-content">    NodeStatus, Type3BaseRewardsSpec,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+4</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+5</span><span class="line-content">use ic_base_types::{NodeId, SubnetId};<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+6</span><span class="line-content">use ic_nervous_system_proto::pb::v1::Decimal as DecimalProto;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+7</span><span class="line-content">use ic_protobuf::registry::node::v1::NodeRewardType;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content">use rewards_calculation::performance_based_algorithm::results as native_types;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+9</span><span class="line-content">use rust_decimal::Decimal;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+10</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+11</span><span class="line-content">// ================================================================================================<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+12</span><span class="line-content">// Conversion implementations for API types &lt;-&gt; Internal types<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+13</span><span class="line-content">// ================================================================================================<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+14</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+15</span><span class="line-content">// NodeMetricsDaily conversions<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+16</span><span class="line-content">impl From&lt;native_types::NodeMetricsDaily&gt; for NodeMetricsDaily {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+17</span><span class="line-content">    fn from(src: native_types::NodeMetricsDaily) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+18</span><span class="line-content">        Self {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+19</span><span class="line-content">            subnet_assigned: Some(src.subnet_assigned.get()),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+20</span><span class="line-content">            subnet_assigned_fr_percent: Some(DecimalProto::from(src.subnet_assigned_fr)),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+21</span><span class="line-content">            num_blocks_proposed: Some(src.num_blocks_proposed),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+22</span><span class="line-content">            num_blocks_failed: Some(src.num_blocks_failed),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+23</span><span class="line-content">            original_fr_percent: Some(DecimalProto::from(src.original_fr)),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+24</span><span class="line-content">            relative_fr_percent: Some(DecimalProto::from(src.relative_fr)),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+25</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+26</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+27</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+28</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+29</span><span class="line-content">impl TryFrom&lt;NodeMetricsDaily&gt; for native_types::NodeMetricsDaily {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+30</span><span class="line-content">    type Error = String;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+31</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+32</span><span class="line-content">    fn try_from(src: NodeMetricsDaily) -&gt; Result&lt;Self, Self::Error&gt; {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+33</span><span class="line-content">        Ok(Self {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+34</span><span class="line-content">            subnet_assigned: SubnetId::from(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+35</span><span class="line-content">                src.subnet_assigned<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+36</span><span class="line-content">                    .ok_or(&quot;subnet_assigned is missing (from NodeMetricsDaily).&quot;)?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+37</span><span class="line-content">            ),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+38</span><span class="line-content">            subnet_assigned_fr: Decimal::try_from(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+39</span><span class="line-content">                src.subnet_assigned_fr_percent<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+40</span><span class="line-content">                    .ok_or(&quot;subnet_assigned_fr_percent is missing (from NodeMetricsDaily).&quot;)?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+41</span><span class="line-content">            )?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+42</span><span class="line-content">            num_blocks_proposed: src<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+43</span><span class="line-content">                .num_blocks_proposed<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+44</span><span class="line-content">                .ok_or(&quot;num_blocks_proposed is missing (from NodeMetricsDaily).&quot;)?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+45</span><span class="line-content">            num_blocks_failed: src<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+46</span><span class="line-content">                .num_blocks_failed<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+47</span><span class="line-content">                .ok_or(&quot;num_blocks_failed is missing (from NodeMetricsDaily).&quot;)?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+48</span><span class="line-content">            original_fr: Decimal::try_from(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+49</span><span class="line-content">                src.original_fr_percent<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+50</span><span class="line-content">                    .ok_or(&quot;original_fr_percent is missing (from NodeMetricsDaily).&quot;)?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+51</span><span class="line-content">            )?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+52</span><span class="line-content">            relative_fr: Decimal::try_from(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+53</span><span class="line-content">                src.relative_fr_percent<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+54</span><span class="line-content">                    .ok_or(&quot;relative_fr_percent is missing (from NodeMetricsDaily).&quot;)?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+55</span><span class="line-content">            )?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+56</span><span class="line-content">        })<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+57</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+58</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+59</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+60</span><span class="line-content">// NodeStatus conversions<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+61</span><span class="line-content">impl From&lt;native_types::NodeStatus&gt; for NodeStatus {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+62</span><span class="line-content">    fn from(src: native_types::NodeStatus) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+63</span><span class="line-content">        match src {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+64</span><span class="line-content">            native_types::NodeStatus::Assigned { node_metrics } =&gt; Self::Assigned {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+65</span><span class="line-content">                node_metrics: Some(NodeMetricsDaily::from(node_metrics)),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+66</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+67</span><span class="line-content">            native_types::NodeStatus::Unassigned { extrapolated_fr } =&gt; Self::Unassigned {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+68</span><span class="line-content">                extrapolated_fr_percent: Some(DecimalProto::from(extrapolated_fr)),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+69</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+70</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+71</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+72</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+73</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+74</span><span class="line-content">impl TryFrom&lt;NodeStatus&gt; for native_types::NodeStatus {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+75</span><span class="line-content">    type Error = String;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+76</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+77</span><span class="line-content">    fn try_from(src: NodeStatus) -&gt; Result&lt;Self, Self::Error&gt; {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+78</span><span class="line-content">        match src {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+79</span><span class="line-content">            NodeStatus::Assigned { node_metrics } =&gt; Ok(Self::Assigned {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+80</span><span class="line-content">                node_metrics: native_types::NodeMetricsDaily::try_from(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+81</span><span class="line-content">                    node_metrics.ok_or(&quot;node_metrics is missing (from NodeStatus).&quot;)?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+82</span><span class="line-content">                )?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+83</span><span class="line-content">            }),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+84</span><span class="line-content">            NodeStatus::Unassigned {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+85</span><span class="line-content">                extrapolated_fr_percent,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+86</span><span class="line-content">            } =&gt; Ok(Self::Unassigned {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+87</span><span class="line-content">                extrapolated_fr: Decimal::try_from(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+88</span><span class="line-content">                    extrapolated_fr_percent<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+89</span><span class="line-content">                        .ok_or(&quot;extrapolated_fr_percent is missing (from NodeStatus).&quot;)?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+90</span><span class="line-content">                )?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+91</span><span class="line-content">            }),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+92</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+93</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+94</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L94" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+95</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+96</span><span class="line-content">// DailyNodeRewards conversions<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L96" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+97</span><span class="line-content">impl From&lt;native_types::DailyNodeRewards&gt; for DailyNodeRewards {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+98</span><span class="line-content">    fn from(src: native_types::DailyNodeRewards) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L98" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+99</span><span class="line-content">        Self {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+100</span><span class="line-content">            node_id: Some(src.node_id.get()),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L100" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+101</span><span class="line-content">            node_reward_type: Some(src.node_reward_type.to_string()),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L101" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+102</span><span class="line-content">            region: Some(src.region),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+103</span><span class="line-content">            dc_id: Some(src.dc_id),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+104</span><span class="line-content">            node_status: Some(NodeStatus::from(src.node_status)),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L104" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+105</span><span class="line-content">            performance_multiplier_percent: Some(DecimalProto::from(src.performance_multiplier)),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L105" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+106</span><span class="line-content">            rewards_reduction_percent: Some(DecimalProto::from(src.rewards_reduction)),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L106" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+107</span><span class="line-content">            base_rewards_xdr_permyriad: Some(DecimalProto::from(src.base_rewards)),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L107" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+108</span><span class="line-content">            adjusted_rewards_xdr_permyriad: Some(DecimalProto::from(src.adjusted_rewards)),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L108" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+109</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L109" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+110</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L110" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+111</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L111" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+112</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L112" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+113</span><span class="line-content">impl TryFrom&lt;DailyNodeRewards&gt; for native_types::DailyNodeRewards {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L113" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+114</span><span class="line-content">    type Error = String;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L114" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+115</span><span class="line-content">    fn try_from(src: DailyNodeRewards) -&gt; Result&lt;Self, Self::Error&gt; {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L115" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+116</span><span class="line-content">        Ok(Self {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L116" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+117</span><span class="line-content">            node_id: NodeId::from(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L117" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+118</span><span class="line-content">                src.node_id<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L118" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+119</span><span class="line-content">                    .ok_or(&quot;node_id is missing (from DailyNodeRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L119" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+120</span><span class="line-content">            ),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L120" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+121</span><span class="line-content">            node_reward_type: NodeRewardType::from(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L121" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+122</span><span class="line-content">                src.node_reward_type<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L122" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+123</span><span class="line-content">                    .ok_or(&quot;node_reward_type is missing (from DailyNodeRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L123" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+124</span><span class="line-content">            ),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L124" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+125</span><span class="line-content">            region: src<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L125" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+126</span><span class="line-content">                .region<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L126" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+127</span><span class="line-content">                .ok_or(&quot;region is missing (from DailyNodeRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L127" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+128</span><span class="line-content">            dc_id: src<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L128" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+129</span><span class="line-content">                .dc_id<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L129" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+130</span><span class="line-content">                .ok_or(&quot;dc_id is missing (from DailyNodeRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L130" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+131</span><span class="line-content">            node_status: native_types::NodeStatus::try_from(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L131" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+132</span><span class="line-content">                src.node_status<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L132" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+133</span><span class="line-content">                    .ok_or(&quot;node_status is missing (from DailyNodeRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L133" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+134</span><span class="line-content">            )?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L134" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+135</span><span class="line-content">            performance_multiplier: Decimal::try_from(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L135" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+136</span><span class="line-content">                src.performance_multiplier_percent<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L136" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+137</span><span class="line-content">                    .ok_or(&quot;performance_multiplier_percent is missing (from DailyNodeRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L137" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+138</span><span class="line-content">            )?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L138" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+139</span><span class="line-content">            rewards_reduction: Decimal::try_from(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L139" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+140</span><span class="line-content">                src.rewards_reduction_percent<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L140" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+141</span><span class="line-content">                    .ok_or(&quot;rewards_reduction_percent is missing (from DailyNodeRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L141" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+142</span><span class="line-content">            )?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L142" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+143</span><span class="line-content">            base_rewards: Decimal::try_from(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L143" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+144</span><span class="line-content">                src.base_rewards_xdr_permyriad<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L144" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+145</span><span class="line-content">                    .ok_or(&quot;base_rewards_xdr_permyriad is missing (from DailyNodeRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L145" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+146</span><span class="line-content">            )?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+147</span><span class="line-content">            adjusted_rewards: Decimal::try_from(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L147" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+148</span><span class="line-content">                src.adjusted_rewards_xdr_permyriad<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L148" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+149</span><span class="line-content">                    .ok_or(&quot;adjusted_rewards_xdr_permyriad is missing (from DailyNodeRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+150</span><span class="line-content">            )?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L150" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+151</span><span class="line-content">        })<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L151" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+152</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L152" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+153</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L153" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+154</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L154" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+155</span><span class="line-content">// BaseRewards conversions<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L155" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+156</span><span class="line-content">impl From&lt;native_types::BaseRewardsSpec&gt; for BaseRewardsSpec {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L156" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+157</span><span class="line-content">    fn from(src: native_types::BaseRewardsSpec) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L157" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+158</span><span class="line-content">        Self {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L158" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+159</span><span class="line-content">            monthly_xdr_permyriad: Some(DecimalProto::from(src.monthly)),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L159" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+160</span><span class="line-content">            daily_xdr_permyriad: Some(DecimalProto::from(src.daily)),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L160" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+161</span><span class="line-content">            node_reward_type: Some(src.node_reward_type.to_string()),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L161" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+162</span><span class="line-content">            region: Some(src.region),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L162" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+163</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L163" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+164</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L164" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+165</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L165" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+166</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L166" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+167</span><span class="line-content">impl TryFrom&lt;BaseRewardsSpec&gt; for native_types::BaseRewardsSpec {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L167" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+168</span><span class="line-content">    type Error = String;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L168" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+169</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L169" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+170</span><span class="line-content">    fn try_from(src: BaseRewardsSpec) -&gt; Result&lt;Self, Self::Error&gt; {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L170" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+171</span><span class="line-content">        Ok(Self {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L171" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+172</span><span class="line-content">            node_reward_type: NodeRewardType::from(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L172" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+173</span><span class="line-content">                src.node_reward_type<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L173" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+174</span><span class="line-content">                    .ok_or(&quot;node_reward_type is missing (from BaseRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L174" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+175</span><span class="line-content">            ),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L175" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+176</span><span class="line-content">            region: src.region.ok_or(&quot;region is missing (from BaseRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L176" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+177</span><span class="line-content">            monthly: Decimal::try_from(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L177" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+178</span><span class="line-content">                src.monthly_xdr_permyriad<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L178" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+179</span><span class="line-content">                    .ok_or(&quot;monthly_xdr_permyriad is missing (from BaseRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L179" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+180</span><span class="line-content">            )?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L180" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+181</span><span class="line-content">            daily: Decimal::try_from(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L181" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+182</span><span class="line-content">                src.daily_xdr_permyriad<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L182" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+183</span><span class="line-content">                    .ok_or(&quot;daily_xdr_permyriad is missing (from BaseRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L183" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+184</span><span class="line-content">            )?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L184" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+185</span><span class="line-content">        })<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L185" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+186</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L186" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+187</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L187" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+188</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L188" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+189</span><span class="line-content">// Type3BaseRewards conversions<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L189" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+190</span><span class="line-content">impl From&lt;native_types::Type3BaseRewards&gt; for Type3BaseRewardsSpec {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L190" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+191</span><span class="line-content">    fn from(src: native_types::Type3BaseRewards) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L191" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+192</span><span class="line-content">        Self {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L192" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+193</span><span class="line-content">            region: Some(src.region),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L193" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+194</span><span class="line-content">            nodes_count: Some(src.nodes_count as u64),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L194" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+195</span><span class="line-content">            avg_rewards_xdr_permyriad: Some(DecimalProto::from(src.avg_rewards)),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L195" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+196</span><span class="line-content">            avg_coefficient_percent: Some(DecimalProto::from(src.avg_coefficient)),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L196" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+197</span><span class="line-content">            value_xdr_permyriad: Some(DecimalProto::from(src.value)),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L197" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+198</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L198" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+199</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L199" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+200</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L200" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+201</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L201" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+202</span><span class="line-content">impl TryFrom&lt;Type3BaseRewardsSpec&gt; for native_types::Type3BaseRewards {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L202" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+203</span><span class="line-content">    type Error = String;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L203" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+204</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L204" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+205</span><span class="line-content">    fn try_from(value: Type3BaseRewardsSpec) -&gt; Result&lt;Self, Self::Error&gt; {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L205" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+206</span><span class="line-content">        Ok(Self {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L206" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+207</span><span class="line-content">            region: value<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L207" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+208</span><span class="line-content">                .region<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L208" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+209</span><span class="line-content">                .ok_or(&quot;region is missing (from Type3BaseRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L209" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+210</span><span class="line-content">            nodes_count: value<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L210" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+211</span><span class="line-content">                .nodes_count<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L211" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+212</span><span class="line-content">                .ok_or(&quot;nodes_count is missing (from Type3BaseRewards).&quot;)?<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L212" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+213</span><span class="line-content">                as usize,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L213" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+214</span><span class="line-content">            avg_rewards: Decimal::try_from(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L214" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+215</span><span class="line-content">                value<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L215" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+216</span><span class="line-content">                    .avg_rewards_xdr_permyriad<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L216" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+217</span><span class="line-content">                    .ok_or(&quot;avg_rewards_xdr_permyriad is missing (from Type3BaseRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L217" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+218</span><span class="line-content">            )?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L218" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+219</span><span class="line-content">            avg_coefficient: Decimal::try_from(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L219" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+220</span><span class="line-content">                value<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L220" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+221</span><span class="line-content">                    .avg_coefficient_percent<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L221" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+222</span><span class="line-content">                    .ok_or(&quot;avg_coefficient_percent is missing (from Type3BaseRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L222" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+223</span><span class="line-content">            )?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L223" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+224</span><span class="line-content">            value: Decimal::try_from(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L224" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+225</span><span class="line-content">                value<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L225" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+226</span><span class="line-content">                    .value_xdr_permyriad<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L226" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+227</span><span class="line-content">                    .ok_or(&quot;value_xdr_permyriad is missing (from Type3BaseRewards).&quot;)?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L227" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+228</span><span class="line-content">            )?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L228" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+229</span><span class="line-content">        })<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L229" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+230</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L230" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+231</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L231" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+232</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L232" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+233</span><span class="line-content">// DailyNodeProviderRewards conversions<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L233" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+234</span><span class="line-content">impl From&lt;native_types::DailyNodeProviderRewards&gt; for DailyNodeProviderRewards {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L234" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+235</span><span class="line-content">    fn from(src: native_types::DailyNodeProviderRewards) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L235" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+236</span><span class="line-content">        Self {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L236" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+237</span><span class="line-content">            rewards_total_xdr_permyriad: Some(DecimalProto::from(src.rewards_total)),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L237" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+238</span><span class="line-content">            base_rewards: src<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L238" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+239</span><span class="line-content">                .base_rewards<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L239" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+240</span><span class="line-content">                .into_iter()<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L240" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+241</span><span class="line-content">                .map(BaseRewardsSpec::from)<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L241" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+242</span><span class="line-content">                .collect(),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L242" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+243</span><span class="line-content">            base_rewards_type3: src<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L243" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+244</span><span class="line-content">                .type3_base_rewards<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L244" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+245</span><span class="line-content">                .into_iter()<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L245" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+246</span><span class="line-content">                .map(Type3BaseRewardsSpec::from)<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L246" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+247</span><span class="line-content">                .collect(),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L247" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+248</span><span class="line-content">            daily_nodes_rewards: src<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L248" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+249</span><span class="line-content">                .daily_nodes_rewards<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L249" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+250</span><span class="line-content">                .into_iter()<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L250" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+251</span><span class="line-content">                .map(DailyNodeRewards::from)<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L251" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+252</span><span class="line-content">                .collect(),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L252" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+253</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L253" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+254</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L254" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+255</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L255" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+256</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L256" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+257</span><span class="line-content">impl TryFrom&lt;DailyNodeProviderRewards&gt; for native_types::DailyNodeProviderRewards {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L257" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+258</span><span class="line-content">    type Error = String;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L258" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+259</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L259" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+260</span><span class="line-content">    fn try_from(src: DailyNodeProviderRewards) -&gt; Result&lt;Self, Self::Error&gt; {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L260" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+261</span><span class="line-content">        Ok(Self {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L261" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+262</span><span class="line-content">            rewards_total: Decimal::try_from(src.rewards_total_xdr_permyriad.ok_or(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L262" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+263</span><span class="line-content">                &quot;rewards_total_xdr_permyriad is missing (from DailyNodeProviderRewards).&quot;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L263" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+264</span><span class="line-content">            )?)?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L264" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+265</span><span class="line-content">            base_rewards: src<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L265" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+266</span><span class="line-content">                .base_rewards<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L266" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+267</span><span class="line-content">                .into_iter()<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L267" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+268</span><span class="line-content">                .map(native_types::BaseRewardsSpec::try_from)<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L268" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+269</span><span class="line-content">                .collect::&lt;Result&lt;_, _&gt;&gt;()?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L269" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+270</span><span class="line-content">            type3_base_rewards: src<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L270" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+271</span><span class="line-content">                .base_rewards_type3<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L271" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+272</span><span class="line-content">                .into_iter()<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L272" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+273</span><span class="line-content">                .map(native_types::Type3BaseRewards::try_from)<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L273" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+274</span><span class="line-content">                .collect::&lt;Result&lt;_, _&gt;&gt;()?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L274" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+275</span><span class="line-content">            daily_nodes_rewards: src<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L275" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+276</span><span class="line-content">                .daily_nodes_rewards<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L276" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+277</span><span class="line-content">                .into_iter()<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L277" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+278</span><span class="line-content">                .map(native_types::DailyNodeRewards::try_from)<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L278" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+279</span><span class="line-content">                .collect::&lt;Result&lt;_, _&gt;&gt;()?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L279" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+280</span><span class="line-content">        })<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L280" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+281</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L281" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+282</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L282" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+283</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L283" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+284</span><span class="line-content">// DailyResults conversions<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L284" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+285</span><span class="line-content">impl From&lt;native_types::DailyResults&gt; for DailyResults {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L285" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+286</span><span class="line-content">    fn from(src: native_types::DailyResults) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L286" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+287</span><span class="line-content">        Self {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L287" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+288</span><span class="line-content">            subnets_fr: src<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L288" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+289</span><span class="line-content">                .subnets_fr<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L289" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+290</span><span class="line-content">                .into_iter()<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L290" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+291</span><span class="line-content">                .map(|(k, v)| (k, DecimalProto::from(v)))<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L291" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+292</span><span class="line-content">                .collect(),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L292" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+293</span><span class="line-content">            provider_results: src<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L293" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+294</span><span class="line-content">                .provider_results<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L294" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+295</span><span class="line-content">                .into_iter()<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L295" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+296</span><span class="line-content">                .map(|(k, v)| (k, DailyNodeProviderRewards::from(v)))<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L296" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+297</span><span class="line-content">                .collect(),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L297" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+298</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L298" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+299</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L299" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+300</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L300" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+301</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L301" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+302</span><span class="line-content">impl TryFrom&lt;DailyResults&gt; for native_types::DailyResults {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L302" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+303</span><span class="line-content">    type Error = String;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L303" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+304</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L304" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+305</span><span class="line-content">    fn try_from(src: DailyResults) -&gt; Result&lt;Self, Self::Error&gt; {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L305" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+306</span><span class="line-content">        Ok(Self {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L306" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+307</span><span class="line-content">            subnets_fr: src<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L307" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+308</span><span class="line-content">                .subnets_fr<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L308" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+309</span><span class="line-content">                .into_iter()<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L309" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+310</span><span class="line-content">                .map(|(k, v)| Decimal::try_from(v).map(|dec| (k, dec)))<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L310" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+311</span><span class="line-content">                .collect::&lt;Result&lt;_, _&gt;&gt;()?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L311" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+312</span><span class="line-content">            provider_results: src<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L312" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+313</span><span class="line-content">                .provider_results<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L313" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+314</span><span class="line-content">                .into_iter()<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L314" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+315</span><span class="line-content">                .map(|(k, v)| native_types::DailyNodeProviderRewards::try_from(v).map(|v| (k, v)))<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L315" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+316</span><span class="line-content">                .collect::&lt;Result&lt;_, _&gt;&gt;()?,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L316" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+317</span><span class="line-content">        })<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L317" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+318</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L318" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+319</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L319" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">320</span><span class="line-content">diff --git a/rs/node_rewards/canister/api/src/lib.rs b/rs/node_rewards/canister/api/src/lib.rs<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L320" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">321</span><span class="line-content">index 291111bd85..906fae078b 100644<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/api_native_conversion.rs#L321" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/api/src/lib.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/api/src/lib.rs</div>
<div class="hunk-header">@@ -2,6 +2,8 @@ pub mod monthly_rewards;</div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> pub mod provider_rewards_calculation;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/lib.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> pub mod providers_rewards;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/lib.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/lib.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+5</span><span class="line-content">mod api_native_conversion;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/lib.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+6</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/lib.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> use chrono::{DateTime, Datelike, NaiveDate};<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/lib.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> use std::fmt::Display;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/lib.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/lib.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content">diff --git a/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs b/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/lib.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content">index d14dbb47ea..1e41f9f506 100644<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/lib.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs</div>
<div class="hunk-header">@@ -1,20 +1,22 @@</div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> pub use crate::DateUtc;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content">use candid::{CandidType, Deserialize, Principal};<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-3</span><span class="line-content">use ic_base_types::PrincipalId;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+2</span><span class="line-content">use candid::{CandidType, Deserialize};<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+3</span><span class="line-content">use ic_base_types::{PrincipalId, SubnetId};<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use ic_nervous_system_proto::pb::v1::Decimal;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+5</span><span class="line-content">use std::collections::BTreeMap;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> #[derive(CandidType, Clone, Deserialize)]<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content">pub struct GetNodeProviderRewardsCalculationRequest {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-8</span><span class="line-content">    pub from_day: DateUtc,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-9</span><span class="line-content">    pub to_day: DateUtc,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-10</span><span class="line-content">    pub provider_id: Principal,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content">pub struct GetNodeProvidersRewardsCalculationRequest {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+9</span><span class="line-content">    pub day: DateUtc,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-13</span><span class="line-content">pub type GetNodeProviderRewardsCalculationResponse = Result&lt;Vec&lt;NodeProviderRewardsDaily&gt;, String&gt;;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+12</span><span class="line-content">// TODO: Remove useless level of indirection: https://github.com/dfinity/ic/pull/7071/files#r2406450031<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+13</span><span class="line-content">pub type GetNodeProviderRewardsCalculationResponse = Result&lt;DailyResults, String&gt;;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> // These are API-facing types with all fields wrapped in `Option`<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> // to ensure forward compatibility. This way, new fields can be added<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content"> // in the future without breaking clients that consume the API.<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+18</span><span class="line-content">//<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+19</span><span class="line-content">// Check rewards_calculation/performance_based_algorithm/results.rs for the explanations of the fields.<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">20</span><span class="line-content"> #[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">21</span><span class="line-content"> pub struct NodeMetricsDaily {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">22</span><span class="line-content">     pub subnet_assigned: Option&lt;PrincipalId&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -34,7 +36,7 @@ pub enum NodeStatus {</div>
<div class="line context"><span class="line-number">36</span><span class="line-content">     },<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">37</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">38</span><span class="line-content"> #[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-37</span><span class="line-content">pub struct NodeResults {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+39</span><span class="line-content">pub struct DailyNodeRewards {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">40</span><span class="line-content">     pub node_id: Option&lt;PrincipalId&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">41</span><span class="line-content">     pub node_reward_type: Option&lt;String&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">42</span><span class="line-content">     pub region: Option&lt;String&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -46,14 +48,14 @@ pub struct NodeResults {</div>
<div class="line context"><span class="line-number">48</span><span class="line-content">     pub adjusted_rewards_xdr_permyriad: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">49</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">50</span><span class="line-content"> #[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-49</span><span class="line-content">pub struct BaseRewards {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+51</span><span class="line-content">pub struct BaseRewardsSpec {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">52</span><span class="line-content">     pub monthly_xdr_permyriad: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">53</span><span class="line-content">     pub daily_xdr_permyriad: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">54</span><span class="line-content">     pub node_reward_type: Option&lt;String&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">55</span><span class="line-content">     pub region: Option&lt;String&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">56</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">57</span><span class="line-content"> #[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-56</span><span class="line-content">pub struct BaseRewardsType3 {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+58</span><span class="line-content">pub struct Type3BaseRewardsSpec {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">59</span><span class="line-content">     pub region: Option&lt;String&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">60</span><span class="line-content">     pub nodes_count: Option&lt;u64&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">61</span><span class="line-content">     pub avg_rewards_xdr_permyriad: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -61,15 +63,14 @@ pub struct BaseRewardsType3 {</div>
<div class="line context"><span class="line-number">63</span><span class="line-content">     pub value_xdr_permyriad: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">64</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">65</span><span class="line-content"> #[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-64</span><span class="line-content">pub struct NodeProviderRewards {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+66</span><span class="line-content">pub struct DailyNodeProviderRewards {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">67</span><span class="line-content">     pub rewards_total_xdr_permyriad: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-66</span><span class="line-content">    pub base_rewards: Vec&lt;BaseRewards&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-67</span><span class="line-content">    pub base_rewards_type3: Vec&lt;BaseRewardsType3&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-68</span><span class="line-content">    pub nodes_results: Vec&lt;NodeResults&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+68</span><span class="line-content">    pub base_rewards: Vec&lt;BaseRewardsSpec&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+69</span><span class="line-content">    pub base_rewards_type3: Vec&lt;Type3BaseRewardsSpec&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+70</span><span class="line-content">    pub daily_nodes_rewards: Vec&lt;DailyNodeRewards&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">71</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-70</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-71</span><span class="line-content">#[derive(CandidType, candid::Deserialize, Clone, Debug)]<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-72</span><span class="line-content">pub struct NodeProviderRewardsDaily {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-73</span><span class="line-content">    pub day_utc: Option&lt;DateUtc&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-74</span><span class="line-content">    pub node_provider_rewards: Option&lt;NodeProviderRewards&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+72</span><span class="line-content">#[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+73</span><span class="line-content">pub struct DailyResults {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+74</span><span class="line-content">    pub subnets_fr: BTreeMap&lt;SubnetId, Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+75</span><span class="line-content">    pub provider_results: BTreeMap&lt;PrincipalId, DailyNodeProviderRewards&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">76</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">77</span><span class="line-content">diff --git a/rs/node_rewards/canister/node-rewards-canister.did b/rs/node_rewards/canister/node-rewards-canister.did<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">78</span><span class="line-content">index f3dfb75a78..85fd0c27a9 100644<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/node-rewards-canister.did</div>
<div class="file-header">+++ b/rs/node_rewards/canister/node-rewards-canister.did</div>
<div class="hunk-header">@@ -1,4 +1,4 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">// get_node_provider_rewards_calculation<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/node-rewards-canister.did#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">// get_node_providers_rewards_calculation<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> type Decimal = record {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content">   human_readable: opt text;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -24,7 +24,7 @@ type NodeStatus = variant {</div>
<div class="line context"><span class="line-number">24</span><span class="line-content">   Unassigned: record { extrapolated_fr_percent: opt Decimal };<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">25</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">26</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-27</span><span class="line-content">type NodeResults = record {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/node-rewards-canister.did#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+27</span><span class="line-content">type DailyNodeRewards = record {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">28</span><span class="line-content">   node_id: opt principal;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">29</span><span class="line-content">   node_reward_type: opt text;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">30</span><span class="line-content">   region: opt text;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -36,14 +36,14 @@ type NodeResults = record {</div>
<div class="line context"><span class="line-number">36</span><span class="line-content">   adjusted_rewards_xdr_permyriad: opt Decimal;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">37</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">38</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-39</span><span class="line-content">type BaseRewards = record {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/node-rewards-canister.did#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+39</span><span class="line-content">type BaseRewardsSpec = record {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">40</span><span class="line-content">   monthly_xdr_permyriad: opt Decimal;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">41</span><span class="line-content">   daily_xdr_permyriad: opt Decimal;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">42</span><span class="line-content">   node_reward_type: opt text;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">43</span><span class="line-content">   region: opt text;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">44</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">45</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-46</span><span class="line-content">type BaseRewardsType3 = record {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/node-rewards-canister.did#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+46</span><span class="line-content">type Type3BaseRewardsSpec = record {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">47</span><span class="line-content">   region: opt text;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">48</span><span class="line-content">   nodes_count: opt nat64;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">49</span><span class="line-content">   avg_rewards_xdr_permyriad: opt Decimal;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -51,24 +51,22 @@ type BaseRewardsType3 = record {</div>
<div class="line context"><span class="line-number">51</span><span class="line-content">   value_xdr_permyriad: opt Decimal;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">52</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">53</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-54</span><span class="line-content">type NodeProviderRewards = record {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/node-rewards-canister.did#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+54</span><span class="line-content">type DailyNodeProviderRewards = record {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">55</span><span class="line-content">   rewards_total_xdr_permyriad: opt Decimal;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-56</span><span class="line-content">  base_rewards: vec BaseRewards;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/node-rewards-canister.did#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-57</span><span class="line-content">  base_rewards_type3: vec BaseRewardsType3;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/node-rewards-canister.did#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-58</span><span class="line-content">  nodes_results: vec NodeResults;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/node-rewards-canister.did#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+56</span><span class="line-content">  base_rewards: vec BaseRewardsSpec;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+57</span><span class="line-content">  base_rewards_type3: vec Type3BaseRewardsSpec;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+58</span><span class="line-content">  daily_nodes_rewards: vec DailyNodeRewards;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">59</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">60</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-61</span><span class="line-content">type NodeProviderRewardsDaily = record {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/node-rewards-canister.did#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-62</span><span class="line-content">    day_utc: opt DateUtc;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/node-rewards-canister.did#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-63</span><span class="line-content">    node_provider_rewards: opt NodeProviderRewards;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/node-rewards-canister.did#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+61</span><span class="line-content">type DailyResults = record {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+62</span><span class="line-content">    subnets_fr: vec record { principal; Decimal };<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+63</span><span class="line-content">    provider_results: vec record { principal; DailyNodeProviderRewards };<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">64</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">65</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-66</span><span class="line-content">type GetNodeProviderRewardsCalculationResponse = variant { Ok: vec NodeProviderRewardsDaily; Err: text };<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/node-rewards-canister.did#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+66</span><span class="line-content">type GetNodeProviderRewardsCalculationResponse = variant { Ok: DailyResults; Err: text };<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">67</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-68</span><span class="line-content">type GetNodeProviderRewardsCalculationRequest = record {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/node-rewards-canister.did#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-69</span><span class="line-content">  from_day: DateUtc;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/node-rewards-canister.did#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-70</span><span class="line-content">  to_day: DateUtc;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/node-rewards-canister.did#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-71</span><span class="line-content">  provider_id: principal;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/node-rewards-canister.did#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+68</span><span class="line-content">type GetNodeProvidersRewardsCalculationRequest = record {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+69</span><span class="line-content">  day: DateUtc;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">70</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">71</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">72</span><span class="line-content"> // get_node_providers_rewards<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -109,5 +107,5 @@ service: () -&gt; {</div>
<div class="line context"><span class="line-number">107</span><span class="line-content">         GetNodeProvidersMonthlyXdrRewardsResponse<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L107" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">108</span><span class="line-content">     );<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L108" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">109</span><span class="line-content">     get_node_providers_rewards: (GetNodeProvidersRewardsRequest) -&gt; (GetNodeProvidersRewardsResponse);<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L109" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-112</span><span class="line-content">    get_node_provider_rewards_calculation: (GetNodeProviderRewardsCalculationRequest) -&gt; (GetNodeProviderRewardsCalculationResponse) query;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/node-rewards-canister.did#L112" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+110</span><span class="line-content">    get_node_providers_rewards_calculation: (GetNodeProvidersRewardsCalculationRequest) -&gt; (GetNodeProviderRewardsCalculationResponse) query;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L110" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">111</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L111" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">112</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/api_conversion.rs b/rs/node_rewards/canister/src/api_conversion.rs<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L112" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">113</span><span class="line-content">deleted file mode 100644<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L113" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">114</span><span class="line-content">index 02079e373f..0000000000<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/node-rewards-canister.did#L114" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/api_conversion.rs</div>
<div class="file-header">+++ /dev/null</div>
<div class="hunk-header">@@ -1,96 +0,0 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">use ic_base_types::PrincipalId;</span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content">use ic_node_rewards_canister_api::provider_rewards_calculation::{</span></div>
<div class="line removed"><span class="line-number">-3</span><span class="line-content">    BaseRewards as BaseRewardsCandid, BaseRewardsType3 as BaseRewardsType3Candid,</span></div>
<div class="line removed"><span class="line-number">-4</span><span class="line-content">    GetNodeProviderRewardsCalculationResponse, NodeMetricsDaily as NodeMetricsDailyCandid,</span></div>
<div class="line removed"><span class="line-number">-5</span><span class="line-content">    NodeProviderRewards as NodeProviderRewardsCandid, NodeProviderRewardsDaily,</span></div>
<div class="line removed"><span class="line-number">-6</span><span class="line-content">    NodeResults as NodeResultsCandid, NodeStatus as NodeStatusCandid,</span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content">};</span></div>
<div class="line removed"><span class="line-number">-8</span><span class="line-content">use rewards_calculation::performance_based_algorithm::results::{</span></div>
<div class="line removed"><span class="line-number">-9</span><span class="line-content">    NodeStatus, RewardsCalculatorResults,</span></div>
<div class="line removed"><span class="line-number">-10</span><span class="line-content">};</span></div>
<div class="line removed"><span class="line-number">-11</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-12</span><span class="line-content">pub fn into_rewards_calculation_results(</span></div>
<div class="line removed"><span class="line-number">-13</span><span class="line-content">    results: RewardsCalculatorResults,</span></div>
<div class="line removed"><span class="line-number">-14</span><span class="line-content">    provider_id: PrincipalId,</span></div>
<div class="line removed"><span class="line-number">-15</span><span class="line-content">) -&gt; GetNodeProviderRewardsCalculationResponse {</span></div>
<div class="line removed"><span class="line-number">-16</span><span class="line-content">    let mut daily_rewards: Vec&lt;NodeProviderRewardsDaily&gt; = Vec::new();</span></div>
<div class="line removed"><span class="line-number">-17</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-18</span><span class="line-content">    for (day, mut daily_results) in results.daily_results {</span></div>
<div class="line removed"><span class="line-number">-19</span><span class="line-content">        let daily_provider_results = daily_results</span></div>
<div class="line removed"><span class="line-number">-20</span><span class="line-content">            .provider_results</span></div>
<div class="line removed"><span class="line-number">-21</span><span class="line-content">            .remove(&amp;provider_id)</span></div>
<div class="line removed"><span class="line-number">-22</span><span class="line-content">            .ok_or(format!(&quot;No results found for provider_id: {}&quot;, provider_id))?;</span></div>
<div class="line removed"><span class="line-number">-23</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-24</span><span class="line-content">        let nodes_results = daily_provider_results</span></div>
<div class="line removed"><span class="line-number">-25</span><span class="line-content">            .nodes_results</span></div>
<div class="line removed"><span class="line-number">-26</span><span class="line-content">            .iter()</span></div>
<div class="line removed"><span class="line-number">-27</span><span class="line-content">            .map(|nr| NodeResultsCandid {</span></div>
<div class="line removed"><span class="line-number">-28</span><span class="line-content">                node_id: Some(nr.node_id.get()),</span></div>
<div class="line removed"><span class="line-number">-29</span><span class="line-content">                node_reward_type: Some(nr.node_reward_type.to_string()),</span></div>
<div class="line removed"><span class="line-number">-30</span><span class="line-content">                region: Some(nr.region.clone()),</span></div>
<div class="line removed"><span class="line-number">-31</span><span class="line-content">                dc_id: Some(nr.dc_id.clone()),</span></div>
<div class="line removed"><span class="line-number">-32</span><span class="line-content">                node_status: match &amp;nr.node_status {</span></div>
<div class="line removed"><span class="line-number">-33</span><span class="line-content">                    NodeStatus::Assigned { node_metrics } =&gt; Some(NodeStatusCandid::Assigned {</span></div>
<div class="line removed"><span class="line-number">-34</span><span class="line-content">                        node_metrics: Some(NodeMetricsDailyCandid {</span></div>
<div class="line removed"><span class="line-number">-35</span><span class="line-content">                            subnet_assigned: Some(node_metrics.subnet_assigned.get()),</span></div>
<div class="line removed"><span class="line-number">-36</span><span class="line-content">                            subnet_assigned_fr_percent: Some(</span></div>
<div class="line removed"><span class="line-number">-37</span><span class="line-content">                                node_metrics.subnet_assigned_fr.into(),</span></div>
<div class="line removed"><span class="line-number">-38</span><span class="line-content">                            ),</span></div>
<div class="line removed"><span class="line-number">-39</span><span class="line-content">                            num_blocks_proposed: Some(node_metrics.num_blocks_proposed),</span></div>
<div class="line removed"><span class="line-number">-40</span><span class="line-content">                            num_blocks_failed: Some(node_metrics.num_blocks_failed),</span></div>
<div class="line removed"><span class="line-number">-41</span><span class="line-content">                            original_fr_percent: Some(node_metrics.original_fr.into()),</span></div>
<div class="line removed"><span class="line-number">-42</span><span class="line-content">                            relative_fr_percent: Some(node_metrics.relative_fr.into()),</span></div>
<div class="line removed"><span class="line-number">-43</span><span class="line-content">                        }),</span></div>
<div class="line removed"><span class="line-number">-44</span><span class="line-content">                    }),</span></div>
<div class="line removed"><span class="line-number">-45</span><span class="line-content">                    NodeStatus::Unassigned { extrapolated_fr } =&gt; {</span></div>
<div class="line removed"><span class="line-number">-46</span><span class="line-content">                        Some(NodeStatusCandid::Unassigned {</span></div>
<div class="line removed"><span class="line-number">-47</span><span class="line-content">                            extrapolated_fr_percent: Some((*extrapolated_fr).into()),</span></div>
<div class="line removed"><span class="line-number">-48</span><span class="line-content">                        })</span></div>
<div class="line removed"><span class="line-number">-49</span><span class="line-content">                    }</span></div>
<div class="line removed"><span class="line-number">-50</span><span class="line-content">                },</span></div>
<div class="line removed"><span class="line-number">-51</span><span class="line-content">                performance_multiplier_percent: Some(nr.performance_multiplier.into()),</span></div>
<div class="line removed"><span class="line-number">-52</span><span class="line-content">                rewards_reduction_percent: Some(nr.rewards_reduction.into()),</span></div>
<div class="line removed"><span class="line-number">-53</span><span class="line-content">                base_rewards_xdr_permyriad: Some(nr.base_rewards.into()),</span></div>
<div class="line removed"><span class="line-number">-54</span><span class="line-content">                adjusted_rewards_xdr_permyriad: Some(nr.adjusted_rewards.into()),</span></div>
<div class="line removed"><span class="line-number">-55</span><span class="line-content">            })</span></div>
<div class="line removed"><span class="line-number">-56</span><span class="line-content">            .collect();</span></div>
<div class="line removed"><span class="line-number">-57</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-58</span><span class="line-content">        // Map BaseRewards</span></div>
<div class="line removed"><span class="line-number">-59</span><span class="line-content">        let base_rewards = daily_provider_results</span></div>
<div class="line removed"><span class="line-number">-60</span><span class="line-content">            .base_rewards</span></div>
<div class="line removed"><span class="line-number">-61</span><span class="line-content">            .iter()</span></div>
<div class="line removed"><span class="line-number">-62</span><span class="line-content">            .map(|br| BaseRewardsCandid {</span></div>
<div class="line removed"><span class="line-number">-63</span><span class="line-content">                monthly_xdr_permyriad: Some(br.monthly.into()),</span></div>
<div class="line removed"><span class="line-number">-64</span><span class="line-content">                daily_xdr_permyriad: Some(br.daily.into()),</span></div>
<div class="line removed"><span class="line-number">-65</span><span class="line-content">                node_reward_type: Some(br.node_reward_type.to_string()),</span></div>
<div class="line removed"><span class="line-number">-66</span><span class="line-content">                region: Some(br.region.clone()),</span></div>
<div class="line removed"><span class="line-number">-67</span><span class="line-content">            })</span></div>
<div class="line removed"><span class="line-number">-68</span><span class="line-content">            .collect();</span></div>
<div class="line removed"><span class="line-number">-69</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-70</span><span class="line-content">        // Map BaseRewardsType3</span></div>
<div class="line removed"><span class="line-number">-71</span><span class="line-content">        let base_rewards_type3 = daily_provider_results</span></div>
<div class="line removed"><span class="line-number">-72</span><span class="line-content">            .base_rewards_type3</span></div>
<div class="line removed"><span class="line-number">-73</span><span class="line-content">            .iter()</span></div>
<div class="line removed"><span class="line-number">-74</span><span class="line-content">            .map(|br3| BaseRewardsType3Candid {</span></div>
<div class="line removed"><span class="line-number">-75</span><span class="line-content">                region: Some(br3.region.clone()),</span></div>
<div class="line removed"><span class="line-number">-76</span><span class="line-content">                nodes_count: Some(br3.nodes_count as u64),</span></div>
<div class="line removed"><span class="line-number">-77</span><span class="line-content">                avg_rewards_xdr_permyriad: Some(br3.avg_rewards.into()),</span></div>
<div class="line removed"><span class="line-number">-78</span><span class="line-content">                avg_coefficient_percent: Some(br3.avg_coefficient.into()),</span></div>
<div class="line removed"><span class="line-number">-79</span><span class="line-content">                value_xdr_permyriad: Some(br3.value.into()),</span></div>
<div class="line removed"><span class="line-number">-80</span><span class="line-content">            })</span></div>
<div class="line removed"><span class="line-number">-81</span><span class="line-content">            .collect();</span></div>
<div class="line removed"><span class="line-number">-82</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-83</span><span class="line-content">        let node_provider_rewards = NodeProviderRewardsCandid {</span></div>
<div class="line removed"><span class="line-number">-84</span><span class="line-content">            rewards_total_xdr_permyriad: Some(daily_provider_results.rewards_total.into()),</span></div>
<div class="line removed"><span class="line-number">-85</span><span class="line-content">            base_rewards,</span></div>
<div class="line removed"><span class="line-number">-86</span><span class="line-content">            base_rewards_type3,</span></div>
<div class="line removed"><span class="line-number">-87</span><span class="line-content">            nodes_results,</span></div>
<div class="line removed"><span class="line-number">-88</span><span class="line-content">        };</span></div>
<div class="line removed"><span class="line-number">-89</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-90</span><span class="line-content">        daily_rewards.push(NodeProviderRewardsDaily {</span></div>
<div class="line removed"><span class="line-number">-91</span><span class="line-content">            day_utc: Some(day.into()),</span></div>
<div class="line removed"><span class="line-number">-92</span><span class="line-content">            node_provider_rewards: Some(node_provider_rewards),</span></div>
<div class="line removed"><span class="line-number">-93</span><span class="line-content">        });</span></div>
<div class="line removed"><span class="line-number">-94</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-95</span><span class="line-content">    Ok(daily_rewards)</span></div>
<div class="line removed"><span class="line-number">-96</span><span class="line-content">}</span></div>
<div class="line context"><span class="line-number">0</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/canister/mod.rs b/rs/node_rewards/canister/src/canister/mod.rs</span></div>
<div class="line context"><span class="line-number">1</span><span class="line-content">index 5ab8ca38fb..7d37f3f77a 100644</span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/canister/mod.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/canister/mod.rs</div>
<div class="hunk-header">@@ -1,4 +1,3 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">use crate::api_conversion::into_rewards_calculation_results;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> use crate::chrono_utils::last_unix_timestamp_nanoseconds;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use crate::metrics::MetricsManager;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use crate::registry_querier::RegistryQuerier;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -11,7 +10,8 @@ use ic_node_rewards_canister_api::monthly_rewards::{</div>
<div class="line context"><span class="line-number">10</span><span class="line-content">     NodeProvidersMonthlyXdrRewards,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> use ic_node_rewards_canister_api::provider_rewards_calculation::{<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-14</span><span class="line-content">    GetNodeProviderRewardsCalculationRequest, GetNodeProviderRewardsCalculationResponse,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+13</span><span class="line-content">    DailyResults, GetNodeProviderRewardsCalculationResponse,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+14</span><span class="line-content">    GetNodeProvidersRewardsCalculationRequest,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> use ic_node_rewards_canister_api::providers_rewards::{<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content">     GetNodeProvidersRewardsRequest, GetNodeProvidersRewardsResponse, NodeProvidersRewards,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -145,13 +145,12 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">145</span><span class="line-content">     fn calculate_rewards(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L145" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">146</span><span class="line-content">         &amp;self,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">147</span><span class="line-content">         request: GetNodeProvidersRewardsRequest,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L147" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-148</span><span class="line-content">        provider_filter: Option&lt;PrincipalId&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L148" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">148</span><span class="line-content">     ) -&gt; Result&lt;RewardsCalculatorResults, String&gt; {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L148" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">149</span><span class="line-content">         let start_day = NaiveDate::try_from(request.from_day)?;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">150</span><span class="line-content">         let end_day = NaiveDate::try_from(request.to_day)?;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L150" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">151</span><span class="line-content">         Self::validate_reward_period(&amp;start_day, &amp;end_day)?;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L151" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">152</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L152" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-154</span><span class="line-content">        RewardsCalculationV1::calculate_rewards(&amp;start_day, &amp;end_day, provider_filter, self)<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L154" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+153</span><span class="line-content">        RewardsCalculationV1::calculate_rewards(&amp;start_day, &amp;end_day, self)<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L153" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">154</span><span class="line-content">             .map_err(|e| format!(&quot;Could not calculate rewards: {e:?}&quot;))<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L154" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">155</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L155" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">156</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L156" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -190,22 +189,6 @@ impl rewards_calculation::performance_based_algorithm::DataProvider for &amp;NodeRew</div>
<div class="line context"><span class="line-number">189</span><span class="line-content">             .get_rewardable_nodes_per_provider(date, None)<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L189" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">190</span><span class="line-content">             .map_err(|e| format!(&quot;Could not get rewardable nodes: {e:?}&quot;))<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L190" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">191</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L191" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-193</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L193" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-194</span><span class="line-content">    fn get_provider_rewardable_nodes(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L194" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-195</span><span class="line-content">        &amp;self,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L195" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-196</span><span class="line-content">        date: &amp;NaiveDate,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L196" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-197</span><span class="line-content">        provider_id: &amp;PrincipalId,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L197" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-198</span><span class="line-content">    ) -&gt; Result&lt;Vec&lt;RewardableNode&gt;, String&gt; {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L198" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-199</span><span class="line-content">        let mut all_rewardable_nodes = self.get_rewardable_nodes(date)?;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L199" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-200</span><span class="line-content">        let rewardable_nodes = all_rewardable_nodes.remove(provider_id).ok_or_else(|| {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L200" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-201</span><span class="line-content">            format!(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L201" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-202</span><span class="line-content">                &quot;No rewardable nodes found for provider {} for day {}&quot;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L202" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-203</span><span class="line-content">                provider_id,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L203" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-204</span><span class="line-content">                date.format(&quot;%Y-%m-%d&quot;)<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L204" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-205</span><span class="line-content">            )<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L205" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-206</span><span class="line-content">        })?;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L206" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-207</span><span class="line-content">        Ok(rewardable_nodes)<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L207" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-208</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L208" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">192</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L192" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">193</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L193" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">194</span><span class="line-content"> // Exposed API Methods<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L194" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -293,7 +276,7 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">276</span><span class="line-content">                 )<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L276" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">277</span><span class="line-content">             })?;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L277" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">278</span><span class="line-content">         NodeRewardsCanister::schedule_metrics_sync(canister).await;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L278" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-296</span><span class="line-content">        let result = canister.with_borrow(|canister| canister.calculate_rewards(request, None))?;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L296" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+279</span><span class="line-content">        let result = canister.with_borrow(|canister| canister.calculate_rewards(request))?;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L279" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">280</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L280" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">281</span><span class="line-content">         let rewards_xdr_permyriad = result<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L281" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">282</span><span class="line-content">             .total_rewards_xdr_permyriad<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L282" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -306,18 +289,23 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">289</span><span class="line-content">         })<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L289" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">290</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L290" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">291</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L291" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-309</span><span class="line-content">    pub fn get_node_provider_rewards_calculation(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L309" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+292</span><span class="line-content">    pub fn get_node_providers_rewards_calculation(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L292" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">293</span><span class="line-content">         canister: &amp;&#x27;static LocalKey&lt;RefCell&lt;NodeRewardsCanister&gt;&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L293" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-311</span><span class="line-content">        request: GetNodeProviderRewardsCalculationRequest,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L311" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+294</span><span class="line-content">        request: GetNodeProvidersRewardsCalculationRequest,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L294" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">295</span><span class="line-content">     ) -&gt; GetNodeProviderRewardsCalculationResponse {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L295" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-313</span><span class="line-content">        let provider_id = PrincipalId::from(request.provider_id);<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L313" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">296</span><span class="line-content">         let request_inner = GetNodeProvidersRewardsRequest {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L296" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-315</span><span class="line-content">            from_day: request.from_day,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L315" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-316</span><span class="line-content">            to_day: request.to_day,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L316" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+297</span><span class="line-content">            from_day: request.day,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L297" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+298</span><span class="line-content">            to_day: request.day,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L298" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">299</span><span class="line-content">         };<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L299" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-318</span><span class="line-content">        let result = canister<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L318" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-319</span><span class="line-content">            .with_borrow(|canister| canister.calculate_rewards(request_inner, Some(provider_id)))?;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L319" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-320</span><span class="line-content">        into_rewards_calculation_results(result, provider_id)<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/canister/mod.rs#L320" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+300</span><span class="line-content">        let mut result =<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L300" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+301</span><span class="line-content">            canister.with_borrow(|canister| canister.calculate_rewards(request_inner))?;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L301" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+302</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L302" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+303</span><span class="line-content">        let day = NaiveDate::try_from(request.day)?;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L303" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+304</span><span class="line-content">        let daily_results = result<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L304" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+305</span><span class="line-content">            .daily_results<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L305" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+306</span><span class="line-content">            .remove(&amp;day)<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L306" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+307</span><span class="line-content">            .ok_or(&quot;Could not find daily results for the requested day&quot;)?;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L307" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+308</span><span class="line-content">        Ok(DailyResults::from(daily_results))<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L308" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">309</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L309" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">310</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L310" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">311</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L311" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">312</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/lib.rs b/rs/node_rewards/canister/src/lib.rs<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L312" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">313</span><span class="line-content">index b86c3d9dcc..a1161a5093 100644<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/canister/mod.rs#L313" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/lib.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/lib.rs</div>
<div class="hunk-header">@@ -13,7 +13,6 @@ use ic_stable_structures::storable::Bound;</div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> use prost::Message;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/lib.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> use std::borrow::Cow;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/lib.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/lib.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-16</span><span class="line-content">pub mod api_conversion;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/lib.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> pub mod canister;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/lib.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content"> mod chrono_utils;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/lib.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content"> pub mod metrics;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/lib.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/main.rs b/rs/node_rewards/canister/src/main.rs<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/lib.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">20</span><span class="line-content">index e05229c245..9a9a59d0a6 100644<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/lib.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/main.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/main.rs</div>
<div class="hunk-header">@@ -9,7 +9,7 @@ use ic_node_rewards_canister_api::monthly_rewards::{</div>
<div class="line context"><span class="line-number">9</span><span class="line-content">     GetNodeProvidersMonthlyXdrRewardsRequest, GetNodeProvidersMonthlyXdrRewardsResponse,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/main.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/main.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> use ic_node_rewards_canister_api::provider_rewards_calculation::{<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/main.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-12</span><span class="line-content">    GetNodeProviderRewardsCalculationRequest, GetNodeProviderRewardsCalculationResponse,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/main.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+12</span><span class="line-content">    GetNodeProviderRewardsCalculationResponse, GetNodeProvidersRewardsCalculationRequest,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/main.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/main.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> use ic_node_rewards_canister_api::providers_rewards::{<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/main.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content">     GetNodeProvidersRewardsRequest, GetNodeProvidersRewardsResponse,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/main.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -117,8 +117,8 @@ async fn get_node_providers_rewards(</div>
<div class="line context"><span class="line-number">117</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/main.rs#L117" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">118</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/main.rs#L118" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">119</span><span class="line-content"> #[query]<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/main.rs#L119" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-120</span><span class="line-content">fn get_node_provider_rewards_calculation(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/main.rs#L120" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-121</span><span class="line-content">    request: GetNodeProviderRewardsCalculationRequest,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/main.rs#L121" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+120</span><span class="line-content">fn get_node_providers_rewards_calculation(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/main.rs#L120" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+121</span><span class="line-content">    request: GetNodeProvidersRewardsCalculationRequest,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/main.rs#L121" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">122</span><span class="line-content"> ) -&gt; GetNodeProviderRewardsCalculationResponse {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/main.rs#L122" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">123</span><span class="line-content">     if in_replicated_execution() {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/main.rs#L123" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">124</span><span class="line-content">         return Err(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/main.rs#L124" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -127,7 +127,7 @@ fn get_node_provider_rewards_calculation(</div>
<div class="line context"><span class="line-number">127</span><span class="line-content">         );<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/main.rs#L127" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">128</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/main.rs#L128" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">129</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/main.rs#L129" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-130</span><span class="line-content">    NodeRewardsCanister::get_node_provider_rewards_calculation(&amp;CANISTER, request)<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/src/main.rs#L130" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+130</span><span class="line-content">    NodeRewardsCanister::get_node_providers_rewards_calculation(&amp;CANISTER, request)<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/main.rs#L130" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">131</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/main.rs#L131" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">132</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/main.rs#L132" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">133</span><span class="line-content"> #[cfg(test)]<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/main.rs#L133" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">134</span><span class="line-content">diff --git a/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs b/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/main.rs#L134" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">135</span><span class="line-content">index 6370987988..897bb5042f 100644<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/src/main.rs#L135" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs</div>
<div class="hunk-header">@@ -1,4 +1,4 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">use candid::{Encode, Principal};<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">use candid::Encode;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use ic_nervous_system_agent::AgentFor;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use ic_nervous_system_agent::nns::node_rewards::get_node_providers_monthly_xdr_rewards;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use ic_nns_constants::NODE_REWARDS_CANISTER_ID;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -6,7 +6,7 @@ use ic_nns_test_utils::common::build_node_rewards_test_wasm;</div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use ic_node_rewards_canister_api::DateUtc;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> use ic_node_rewards_canister_api::monthly_rewards::GetNodeProvidersMonthlyXdrRewardsRequest;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> use ic_node_rewards_canister_api::provider_rewards_calculation::{<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-9</span><span class="line-content">    GetNodeProviderRewardsCalculationRequest, GetNodeProviderRewardsCalculationResponse,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+9</span><span class="line-content">    GetNodeProviderRewardsCalculationResponse, GetNodeProvidersRewardsCalculationRequest,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> use ic_types::PrincipalId;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> use pocket_ic::PocketIcBuilder;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -68,7 +68,7 @@ async fn get_node_providers_monthly_xdr_rewards_is_only_callable_by_governance()</div>
<div class="line context"><span class="line-number">68</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">69</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">70</span><span class="line-content"> #[tokio::test]<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-71</span><span class="line-content">async fn get_node_provider_rewards_calculation_is_only_callable_in_nonreplicated_mode() {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+71</span><span class="line-content">async fn get_node_providers_rewards_calculation_is_only_callable_in_nonreplicated_mode() {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">72</span><span class="line-content">     let pocket_ic = setup_env().await;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">73</span><span class="line-content">     let node_rewards_id = NODE_REWARDS_CANISTER_ID.get().0;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">74</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -77,17 +77,13 @@ async fn get_node_provider_rewards_calculation_is_only_callable_in_nonreplicated</div>
<div class="line context"><span class="line-number">77</span><span class="line-content">     pocket_ic.tick().await;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">78</span><span class="line-content">     let day = DateUtc::from_unix_timestamp_nanoseconds(past_time_nanos);<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">79</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-80</span><span class="line-content">    let request = GetNodeProviderRewardsCalculationRequest {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-81</span><span class="line-content">        from_day: day,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-82</span><span class="line-content">        to_day: day,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-83</span><span class="line-content">        provider_id: Principal::anonymous(),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-84</span><span class="line-content">    };<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+80</span><span class="line-content">    let request = GetNodeProvidersRewardsCalculationRequest { day };<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">81</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">82</span><span class="line-content">     // Non-replicated query call is allowed.<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">83</span><span class="line-content">     let err = query_candid::&lt;_, (GetNodeProviderRewardsCalculationResponse,)&gt;(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">84</span><span class="line-content">         &amp;pocket_ic,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">85</span><span class="line-content">         node_rewards_id,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-90</span><span class="line-content">        &quot;get_node_provider_rewards_calculation&quot;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+86</span><span class="line-content">        &quot;get_node_providers_rewards_calculation&quot;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">87</span><span class="line-content">         (request.clone(),),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">88</span><span class="line-content">     )<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">89</span><span class="line-content">     .await<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -103,7 +99,7 @@ async fn get_node_provider_rewards_calculation_is_only_callable_in_nonreplicated</div>
<div class="line context"><span class="line-number">99</span><span class="line-content">     let err = update_candid::&lt;_, (GetNodeProviderRewardsCalculationResponse,)&gt;(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">100</span><span class="line-content">         &amp;pocket_ic,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L100" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">101</span><span class="line-content">         node_rewards_id,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L101" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-106</span><span class="line-content">        &quot;get_node_provider_rewards_calculation&quot;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L106" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+102</span><span class="line-content">        &quot;get_node_providers_rewards_calculation&quot;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">103</span><span class="line-content">         (request,),<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">104</span><span class="line-content">     )<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L104" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">105</span><span class="line-content">     .await<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L105" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">106</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L106" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">107</span><span class="line-content">index c84eb6ea8d..7ca9d317f6 100644<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L107" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs</div>
<div class="hunk-header">@@ -1,6 +1,6 @@</div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> use crate::performance_based_algorithm::results::{<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content">    BaseRewards, BaseRewardsType3, DailyResults, NodeMetricsDaily, NodeProviderRewards,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-3</span><span class="line-content">    NodeResults, NodeStatus, Percent, RewardsCalculatorResults, XDRPermyriad,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+2</span><span class="line-content">    BaseRewardsSpec, DailyNodeProviderRewards, DailyNodeRewards, DailyResults, NodeMetricsDaily,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+3</span><span class="line-content">    NodeStatus, Percent, RewardsCalculatorResults, Type3BaseRewards, XDRPermyriad,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use crate::types::{NodeMetricsDailyRaw, Region, RewardableNode};<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use chrono::NaiveDate;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -8,7 +8,6 @@ use ic_base_types::{NodeId, PrincipalId, SubnetId};</div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> use ic_protobuf::registry::node::v1::NodeRewardType;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> use ic_protobuf::registry::node_rewards::v2::NodeRewardsTable;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> use itertools::Itertools;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-11</span><span class="line-content">use maplit::btreemap;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> use rust_decimal::Decimal;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> use rust_decimal::prelude::ToPrimitive;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> use rust_decimal_macros::dec;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -59,8 +58,8 @@ struct PerformanceMultiplierResults {</div>
<div class="line context"><span class="line-number">58</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">59</span><span class="line-content"> #[derive(Default)]<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">60</span><span class="line-content"> struct BaseRewardsResults {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-62</span><span class="line-content">    base_rewards: Vec&lt;BaseRewards&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-63</span><span class="line-content">    base_rewards_type3: Vec&lt;BaseRewardsType3&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+61</span><span class="line-content">    base_rewards: Vec&lt;BaseRewardsSpec&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+62</span><span class="line-content">    base_rewards_type3: Vec&lt;Type3BaseRewards&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">63</span><span class="line-content">     base_rewards_per_node: BTreeMap&lt;NodeId, XDRPermyriad&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">64</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">65</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -83,12 +82,6 @@ pub trait DataProvider {</div>
<div class="line context"><span class="line-number">82</span><span class="line-content">         &amp;self,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">83</span><span class="line-content">         date: &amp;NaiveDate,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">84</span><span class="line-content">     ) -&gt; Result&lt;BTreeMap&lt;PrincipalId, Vec&lt;RewardableNode&gt;&gt;, String&gt;;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-86</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-87</span><span class="line-content">    fn get_provider_rewardable_nodes(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-88</span><span class="line-content">        &amp;self,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-89</span><span class="line-content">        date: &amp;NaiveDate,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-90</span><span class="line-content">        provider_id: &amp;PrincipalId,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-91</span><span class="line-content">    ) -&gt; Result&lt;Vec&lt;RewardableNode&gt;, String&gt;;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">85</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">86</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">87</span><span class="line-content"> trait PerformanceBasedAlgorithm {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -118,7 +111,6 @@ trait PerformanceBasedAlgorithm {</div>
<div class="line context"><span class="line-number">111</span><span class="line-content">     fn calculate_rewards(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L111" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">112</span><span class="line-content">         from_date: &amp;NaiveDate,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L112" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">113</span><span class="line-content">         to_date: &amp;NaiveDate,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L113" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-121</span><span class="line-content">        node_provider_filter: Option&lt;PrincipalId&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L121" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">114</span><span class="line-content">         data_provider: impl DataProvider,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L114" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">115</span><span class="line-content">     ) -&gt; Result&lt;RewardsCalculatorResults, String&gt; {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L115" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">116</span><span class="line-content">         if from_date &gt; to_date {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L116" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -131,8 +123,7 @@ trait PerformanceBasedAlgorithm {</div>
<div class="line context"><span class="line-number">123</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L123" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">124</span><span class="line-content">         // Process each day in the reward period<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L124" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">125</span><span class="line-content">         for day in reward_period {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L125" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-134</span><span class="line-content">            let result_for_day =<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L134" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-135</span><span class="line-content">                Self::calculate_daily_rewards(&amp;data_provider, &amp;day, &amp;node_provider_filter)?;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L135" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+126</span><span class="line-content">            let result_for_day = Self::calculate_daily_rewards(&amp;data_provider, &amp;day)?;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L126" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">127</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L127" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">128</span><span class="line-content">             // Accumulate total rewards per provider across all days<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L128" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">129</span><span class="line-content">             for (provider_id, provider_rewards) in &amp;result_for_day.provider_results {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L129" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -158,17 +149,10 @@ trait PerformanceBasedAlgorithm {</div>
<div class="line context"><span class="line-number">149</span><span class="line-content">     fn calculate_daily_rewards(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">150</span><span class="line-content">         data_provider: &amp;impl DataProvider,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L150" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">151</span><span class="line-content">         date: &amp;NaiveDate,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L151" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-161</span><span class="line-content">        node_provider_filter: &amp;Option&lt;PrincipalId&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L161" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">152</span><span class="line-content">     ) -&gt; Result&lt;DailyResults, String&gt; {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L152" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">153</span><span class="line-content">         let rewards_table = data_provider.get_rewards_table(date)?;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L153" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">154</span><span class="line-content">         let metrics_by_subnet = data_provider.get_daily_metrics_by_subnet(date)?;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L154" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-165</span><span class="line-content">        let providers_rewardable_nodes = if let Some(provider_id) = node_provider_filter {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L165" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-166</span><span class="line-content">            let rewardable_nodes =<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L166" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-167</span><span class="line-content">                data_provider.get_provider_rewardable_nodes(date, provider_id)?;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L167" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-168</span><span class="line-content">            btreemap! { *provider_id =&gt; rewardable_nodes }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L168" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-169</span><span class="line-content">        } else {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L169" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-170</span><span class="line-content">            data_provider.get_rewardable_nodes(date)?<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L170" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-171</span><span class="line-content">        };<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L171" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+155</span><span class="line-content">        let providers_rewardable_nodes = data_provider.get_rewardable_nodes(date)?;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L155" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">156</span><span class="line-content">         let mut results_per_provider = BTreeMap::new();<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L156" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">157</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L157" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">158</span><span class="line-content">         // Calculate failure rates for subnets and individual nodes<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L158" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -197,7 +181,7 @@ trait PerformanceBasedAlgorithm {</div>
<div class="line context"><span class="line-number">181</span><span class="line-content">         rewards_table: &amp;NodeRewardsTable,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L181" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">182</span><span class="line-content">         nodes_metrics_daily: &amp;mut BTreeMap&lt;NodeId, NodeMetricsDaily&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L182" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">183</span><span class="line-content">         rewardable_nodes: Vec&lt;RewardableNode&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L183" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-200</span><span class="line-content">    ) -&gt; NodeProviderRewards {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L200" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+184</span><span class="line-content">    ) -&gt; DailyNodeProviderRewards {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L184" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">185</span><span class="line-content">         let mut provider_nodes_metrics_daily = BTreeMap::new();<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L185" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">186</span><span class="line-content">         for node in &amp;rewardable_nodes {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L186" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">187</span><span class="line-content">             if let Some(metrics) = nodes_metrics_daily.remove(&amp;node.node_id) {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L187" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -483,7 +467,7 @@ trait PerformanceBasedAlgorithm {</div>
<div class="line context"><span class="line-number">467</span><span class="line-content">             .into_iter()<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L467" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">468</span><span class="line-content">             .map(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L468" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">469</span><span class="line-content">                 |(region, (daily_rewards, nodes_count, avg_rewards, avg_coefficient))| {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L469" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-486</span><span class="line-content">                    BaseRewardsType3 {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L486" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+470</span><span class="line-content">                    Type3BaseRewards {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L470" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">471</span><span class="line-content">                         region,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L471" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">472</span><span class="line-content">                         nodes_count,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L472" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">473</span><span class="line-content">                         avg_rewards,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L473" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -497,7 +481,7 @@ trait PerformanceBasedAlgorithm {</div>
<div class="line context"><span class="line-number">481</span><span class="line-content">         let base_rewards = base_rewards<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L481" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">482</span><span class="line-content">             .into_iter()<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L482" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">483</span><span class="line-content">             .map(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L483" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-500</span><span class="line-content">                |((node_reward_type, region), (daily_rewards, monthly_rewards))| BaseRewards {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L500" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+484</span><span class="line-content">                |((node_reward_type, region), (daily_rewards, monthly_rewards))| BaseRewardsSpec {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L484" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">485</span><span class="line-content">                     node_reward_type,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L485" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">486</span><span class="line-content">                     region,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L486" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">487</span><span class="line-content">                     monthly: monthly_rewards,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L487" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -545,9 +529,9 @@ trait PerformanceBasedAlgorithm {</div>
<div class="line context"><span class="line-number">529</span><span class="line-content">         mut performance_multiplier: BTreeMap&lt;NodeId, Percent&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L529" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">530</span><span class="line-content">         mut base_rewards_per_node: BTreeMap&lt;NodeId, XDRPermyriad&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L530" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">531</span><span class="line-content">         mut adjusted_rewards: BTreeMap&lt;NodeId, XDRPermyriad&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L531" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-548</span><span class="line-content">        base_rewards: Vec&lt;BaseRewards&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L548" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-549</span><span class="line-content">        base_rewards_type3: Vec&lt;BaseRewardsType3&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L549" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-550</span><span class="line-content">    ) -&gt; NodeProviderRewards {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L550" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+532</span><span class="line-content">        base_rewards: Vec&lt;BaseRewardsSpec&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L532" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+533</span><span class="line-content">        base_rewards_type3: Vec&lt;Type3BaseRewards&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L533" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+534</span><span class="line-content">    ) -&gt; DailyNodeProviderRewards {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L534" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">535</span><span class="line-content">         let mut results_by_node = Vec::new();<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L535" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">536</span><span class="line-content">         let mut rewards_total = Decimal::ZERO;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L536" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">537</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L537" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -577,7 +561,7 @@ trait PerformanceBasedAlgorithm {</div>
<div class="line context"><span class="line-number">561</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L561" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">562</span><span class="line-content">             rewards_total += adjusted_rewards_xdr_permyriad;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L562" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">563</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L563" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-580</span><span class="line-content">            results_by_node.push(NodeResults {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L580" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+564</span><span class="line-content">            results_by_node.push(DailyNodeRewards {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L564" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">565</span><span class="line-content">                 node_id: node.node_id,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L565" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">566</span><span class="line-content">                 node_reward_type: node.node_reward_type,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L566" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">567</span><span class="line-content">                 region: node.region,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L567" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -590,11 +574,11 @@ trait PerformanceBasedAlgorithm {</div>
<div class="line context"><span class="line-number">574</span><span class="line-content">             });<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L574" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">575</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L575" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">576</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L576" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-593</span><span class="line-content">        NodeProviderRewards {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L593" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+577</span><span class="line-content">        DailyNodeProviderRewards {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L577" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">578</span><span class="line-content">             rewards_total,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L578" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">579</span><span class="line-content">             base_rewards,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L579" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-596</span><span class="line-content">            base_rewards_type3,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L596" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-597</span><span class="line-content">            nodes_results: results_by_node,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L597" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+580</span><span class="line-content">            type3_base_rewards: base_rewards_type3,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L580" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+581</span><span class="line-content">            daily_nodes_rewards: results_by_node,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L581" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">582</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L582" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">583</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L583" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">584</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L584" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">585</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L585" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">586</span><span class="line-content">index 45eb704041..e384825ae3 100644<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L586" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs</div>
<div class="hunk-header">@@ -5,71 +5,160 @@ use rust_decimal::Decimal;</div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use serde::{Deserialize, Serialize};<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use std::collections::BTreeMap;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-8</span><span class="line-content">pub type XDRPermyriad = Decimal;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content">// TODO: Remove these types in favor of Decimal. Also fields renaming to include units<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+9</span><span class="line-content">// https://github.com/dfinity/ic/pull/7071/files#r2406492271<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+10</span><span class="line-content">pub type XDRPermyriad = Decimal; // Rewards unit in XDR scaled by 1/10,000 (permyriad)<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> pub type Percent = Decimal;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> pub type Region = String;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> #[derive(Serialize, Deserialize, Clone, Debug, PartialEq)]<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> pub struct NodeMetricsDaily {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+16</span><span class="line-content">    /// The subnet this node was assigned to on the given day.<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+17</span><span class="line-content">    /// This is determined by the subnet assigned to the node in the last registry version<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+18</span><span class="line-content">    /// before the next day&#x27;s registry version was generated.<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content">     pub subnet_assigned: SubnetId,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+20</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+21</span><span class="line-content">    /// Subnet Assigned Failure Rate<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+22</span><span class="line-content">    ///<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+23</span><span class="line-content">    /// This is the SUBNET_FAILURE_RATE_PERCENTILE of the original_fr all nodes in the subnet.<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+24</span><span class="line-content">    /// It is used to adjust individual node failure rates to account for systematic issues<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+25</span><span class="line-content">    /// affecting the whole subnet.<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">26</span><span class="line-content">     pub subnet_assigned_fr: Percent,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+27</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+28</span><span class="line-content">    /// Number of blocks successfully proposed by this node on this day<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">29</span><span class="line-content">     pub num_blocks_proposed: u64,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+30</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+31</span><span class="line-content">    /// Number of blocks that failed to be included on this day<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">32</span><span class="line-content">     pub num_blocks_failed: u64,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+33</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+34</span><span class="line-content">    /// Original Failure Rate<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+35</span><span class="line-content">    ///<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+36</span><span class="line-content">    /// Calculated as `num_blocks_failed / (num_blocks_proposed + num_blocks_failed)`.<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+37</span><span class="line-content">    /// Represents the failure rate of the node before any subnet-level adjustments.<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">38</span><span class="line-content">     pub original_fr: Percent,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+39</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+40</span><span class="line-content">    /// Relative Failure Rate<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+41</span><span class="line-content">    ///<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+42</span><span class="line-content">    /// Failure rate adjusted for subnet performance.<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+43</span><span class="line-content">    /// Calculated as `max(0, original_fr - subnet_assigned_fr)`.<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+44</span><span class="line-content">    /// TODO: Link documentation about performance based rewards algorithm<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">45</span><span class="line-content">     pub relative_fr: Percent,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">46</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">47</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+48</span><span class="line-content">// TODO: Renaming to NodeProductivity: https://github.com/dfinity/ic/pull/7071/files#r2406794563<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">49</span><span class="line-content"> #[derive(Serialize, Deserialize, Debug, PartialEq, Clone)]<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">50</span><span class="line-content"> pub enum NodeStatus {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+51</span><span class="line-content">    /// Node is assigned to a subnet with recorded metrics<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">52</span><span class="line-content">     Assigned { node_metrics: NodeMetricsDaily },<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-25</span><span class="line-content">    Unassigned { extrapolated_fr: Percent },<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+53</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+54</span><span class="line-content">    /// Node is unassigned; only extrapolated failure rate is available<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+55</span><span class="line-content">    Unassigned {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+56</span><span class="line-content">        /// Extrapolated Failure Rate (EFR)<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+57</span><span class="line-content">        /// Used to estimate the node&#x27;s performance when unassigned<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+58</span><span class="line-content">        extrapolated_fr: Percent,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+59</span><span class="line-content">    },<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">60</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">61</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">62</span><span class="line-content"> #[derive(Serialize, Deserialize, Debug, PartialEq, Clone)]<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-29</span><span class="line-content">pub struct NodeResults {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+63</span><span class="line-content">pub struct DailyNodeRewards {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">64</span><span class="line-content">     pub node_id: NodeId,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+65</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">66</span><span class="line-content">     pub node_reward_type: NodeRewardType,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+67</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+68</span><span class="line-content">    /// Geographical region of the node<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+69</span><span class="line-content">    /// TODO: Link to documentation about performance based rewards<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">70</span><span class="line-content">     pub region: String,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+71</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+72</span><span class="line-content">    /// Data center identifier<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+73</span><span class="line-content">    /// TODO: Link to documentation about performance based rewards<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">74</span><span class="line-content">     pub dc_id: String,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+75</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+76</span><span class="line-content">    /// Node status, assigned or unassigned, with associated metrics<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">77</span><span class="line-content">     pub node_status: NodeStatus,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+78</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+79</span><span class="line-content">    /// Performance multiplier (1 - rewards_reduction)<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+80</span><span class="line-content">    ///<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+81</span><span class="line-content">    /// Represents how rewards are adjusted based on node performance<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">82</span><span class="line-content">     pub performance_multiplier: Percent,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+83</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+84</span><span class="line-content">    /// Rewards reduction applied due to failure rates<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+85</span><span class="line-content">    // TODO: Link to documentation about performance based rewards<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">86</span><span class="line-content">     pub rewards_reduction: Percent,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+87</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+88</span><span class="line-content">    /// Base rewards before applying performance multipliers<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">89</span><span class="line-content">     pub base_rewards: XDRPermyriad,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+90</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+91</span><span class="line-content">    /// Rewards adjusted by the performance multiplier<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">92</span><span class="line-content">     pub adjusted_rewards: XDRPermyriad,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">93</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">94</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L94" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+95</span><span class="line-content">/// Base rewards for NON type 3 nodes.<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">96</span><span class="line-content"> #[derive(Serialize, Deserialize, Debug, PartialEq, Clone)]<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L96" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-42</span><span class="line-content">pub struct BaseRewards {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+97</span><span class="line-content">pub struct BaseRewardsSpec {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+98</span><span class="line-content">    /// NodeRewardType<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L98" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">99</span><span class="line-content">     pub node_reward_type: NodeRewardType,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+100</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L100" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+101</span><span class="line-content">    /// Region for which base rewards are calculated<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L101" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">102</span><span class="line-content">     pub region: Region,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+103</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+104</span><span class="line-content">    /// Monthly base rewards in XDR permyriad<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L104" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">105</span><span class="line-content">     pub monthly: XDRPermyriad,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L105" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+106</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L106" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+107</span><span class="line-content">    /// Daily base rewards in XDR permyriad<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L107" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">108</span><span class="line-content">     pub daily: XDRPermyriad,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L108" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">109</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L109" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">110</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L110" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+111</span><span class="line-content">/// Base rewards for a Type 3 node.<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L111" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+112</span><span class="line-content">///<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L112" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+113</span><span class="line-content">/// Type3 nodes are defined [rs/protobuf/src/gen/registry/registry.node.v1.rs]<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L113" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+114</span><span class="line-content">/// For nodes which are type3 special logic is applied to compute base rewards.<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L114" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+115</span><span class="line-content">/// Check the documentation of the performance-based rewards algorithm for details.<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L115" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">116</span><span class="line-content"> #[derive(Serialize, Deserialize, Debug, PartialEq, Clone)]<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L116" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-50</span><span class="line-content">pub struct BaseRewardsType3 {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+117</span><span class="line-content">pub struct Type3BaseRewards {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L117" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+118</span><span class="line-content">    /// Region for which the rewards are calculated<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L118" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">119</span><span class="line-content">     pub region: Region,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L119" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+120</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L120" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+121</span><span class="line-content">    /// Number of nodes in the region<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L121" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">122</span><span class="line-content">     pub nodes_count: usize,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L122" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+123</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L123" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+124</span><span class="line-content">    /// Average rewards for nodes in this region<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L124" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">125</span><span class="line-content">     pub avg_rewards: XDRPermyriad,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L125" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+126</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L126" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+127</span><span class="line-content">    /// Average performance coefficient applied to nodes<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L127" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">128</span><span class="line-content">     pub avg_coefficient: Percent,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L128" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+129</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L129" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+130</span><span class="line-content">    /// Base rewards value for Type 3 nodes<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L130" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">131</span><span class="line-content">     pub value: XDRPermyriad,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L131" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">132</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L132" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">133</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L133" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">134</span><span class="line-content"> #[derive(Serialize, Deserialize, Debug, PartialEq, Clone)]<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L134" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-59</span><span class="line-content">pub struct NodeProviderRewards {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+135</span><span class="line-content">pub struct DailyNodeProviderRewards {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L135" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+136</span><span class="line-content">    /// Total rewards across all nodes for this provider in XDR permyriad<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L136" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">137</span><span class="line-content">     pub rewards_total: XDRPermyriad,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L137" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-61</span><span class="line-content">    pub base_rewards: Vec&lt;BaseRewards&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-62</span><span class="line-content">    pub base_rewards_type3: Vec&lt;BaseRewardsType3&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-63</span><span class="line-content">    pub nodes_results: Vec&lt;NodeResults&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+138</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L138" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+139</span><span class="line-content">    /// Base rewards broken down by node type and region<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L139" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+140</span><span class="line-content">    pub base_rewards: Vec&lt;BaseRewardsSpec&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L140" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+141</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L141" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+142</span><span class="line-content">    /// Base rewards broken down by &quot;type 3&quot; grouping (region aggregates)<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L142" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+143</span><span class="line-content">    pub type3_base_rewards: Vec&lt;Type3BaseRewards&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L143" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+144</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L144" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+145</span><span class="line-content">    /// Daily rewards for each node managed by this provider<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L145" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+146</span><span class="line-content">    pub daily_nodes_rewards: Vec&lt;DailyNodeRewards&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">147</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L147" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">148</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L148" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">149</span><span class="line-content"> #[derive(Serialize, Deserialize)]<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">150</span><span class="line-content"> pub struct DailyResults {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L150" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+151</span><span class="line-content">    /// Failure rates for all subnets on this day<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L151" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">152</span><span class="line-content">     pub subnets_fr: BTreeMap&lt;SubnetId, Percent&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L152" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-69</span><span class="line-content">    pub provider_results: BTreeMap&lt;PrincipalId, NodeProviderRewards&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+153</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L153" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+154</span><span class="line-content">    /// Rewards for all node providers on this day<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L154" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+155</span><span class="line-content">    pub provider_results: BTreeMap&lt;PrincipalId, DailyNodeProviderRewards&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L155" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">156</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L156" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">157</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L157" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">158</span><span class="line-content"> pub struct RewardsCalculatorResults {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L158" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+159</span><span class="line-content">    /// Total rewards for each provider across the entire reward period<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L159" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">160</span><span class="line-content">     pub total_rewards_xdr_permyriad: BTreeMap&lt;PrincipalId, u64&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L160" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+161</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L161" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+162</span><span class="line-content">    /// Daily breakdown of results<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L162" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">163</span><span class="line-content">     pub daily_results: BTreeMap&lt;NaiveDate, DailyResults&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L163" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">164</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L164" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">165</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L165" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">166</span><span class="line-content">index 6fb37bc87e..dc260d44d7 100644<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L166" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs</div>
<div class="hunk-header">@@ -1,7 +1,6 @@</div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> use crate::performance_based_algorithm::results::RewardsCalculatorResults;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use crate::performance_based_algorithm::{DataProvider, PerformanceBasedAlgorithm};<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use chrono::NaiveDate;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-4</span><span class="line-content">use ic_base_types::PrincipalId;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use rust_decimal::Decimal;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use rust_decimal_macros::dec;<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -38,13 +37,11 @@ impl RewardsCalculationV1 {</div>
<div class="line context"><span class="line-number">37</span><span class="line-content">     pub fn calculate_rewards(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">38</span><span class="line-content">         from_date: &amp;NaiveDate,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">39</span><span class="line-content">         to_date: &amp;NaiveDate,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-41</span><span class="line-content">        node_provider_filter: Option&lt;PrincipalId&gt;,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">40</span><span class="line-content">         data_provider: impl DataProvider,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">41</span><span class="line-content">     ) -&gt; Result&lt;RewardsCalculatorResults, String&gt; {<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">42</span><span class="line-content">         &lt;RewardsCalculationV1 as PerformanceBasedAlgorithm&gt;::calculate_rewards(<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">43</span><span class="line-content">             from_date,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">44</span><span class="line-content">             to_date,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-47</span><span class="line-content">            node_provider_filter,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">45</span><span class="line-content">             data_provider,<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">46</span><span class="line-content">         )<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">47</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/55d5612325bfea80a32845c0eec023ed58c4d173/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="commit-detail">
                    <div class="commit-header">
                        <div class="commit-title">
                            <a href="https://github.com/dfinity/ic/commit/2851d16acbe87159f58348a9c9f4e10f34f488b9" class="commit-hash-large" target="_blank">2851d16acbe87159f58348a9c9f4e10f34f488b9</a>
                            <span class="badge fix">fix</span>
                        </div>
                        <div class="commit-meta">
                            <span>👤 pietrodimarco-dfinity &lt;124565147+pietrodimarco-dfinity@users.noreply.github.com&gt;</span>
                            <span>📅 2025-09-30</span>
                            <span>📁 22 files</span>
                        </div>
                        <div style="margin-top: 8px; color: #e6edf3; font-size: 0.9em;">
                            fix(node-rewards-canister): Discard DayUtc type in favor of NaiveDate (#6981)
                        </div>
                        <div class="commit-actions">
                            <button class="toggle-button secondary" onclick="toggleFiles('files-3')">📁 Files (22)</button>
                            <button class="toggle-button" onclick="toggleDiff('diff-3')">🔍 Code Changes</button>
                        </div>
                        <div id="files-3" class="collapsible">
                            <div class="files-list">
                                <ul><li>rs/node_rewards/canister/BUILD.bazel</li><li>rs/node_rewards/canister/Cargo.toml</li><li>rs/node_rewards/canister/api/BUILD.bazel</li><li>rs/node_rewards/canister/api/Cargo.toml</li><li>rs/node_rewards/canister/api/src/lib.rs</li><li>rs/node_rewards/canister/api/src/provider_rewards_calculation.rs</li><li>rs/node_rewards/canister/api/src/providers_rewards.rs</li><li>rs/node_rewards/canister/node-rewards-canister.did</li><li>rs/node_rewards/canister/src/canister/mod.rs</li><li>rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs</li><li>rs/node_rewards/canister/src/chrono_utils.rs</li><li>rs/node_rewards/canister/src/lib.rs</li><li>rs/node_rewards/canister/src/metrics.rs</li><li>rs/node_rewards/canister/src/metrics/tests.rs</li><li>rs/node_rewards/canister/src/registry_querier.rs</li><li>rs/node_rewards/canister/src/registry_querier/tests.rs</li><li>rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs</li><li>rs/node_rewards/rewards_calculation/Cargo.toml</li><li>rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs</li><li>rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs</li><li>rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs</li><li>rs/node_rewards/rewards_calculation/src/types.rs</li></ul></div></div>
                        <div id="diff-3" class="collapsible">
                            <div class="diff-container">
                                <div class="line context"><span class="line-number">1</span><span class="line-content">commit 2851d16acbe87159f58348a9c9f4e10f34f488b9</span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content">Author: pietrodimarco-dfinity &lt;124565147+pietrodimarco-dfinity@users.noreply.github.com&gt;</span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content">Date:   Tue Sep 30 18:12:47 2025 +0200</span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content">    fix(node-rewards-canister): Discard DayUtc type in favor of NaiveDate (#6981)</span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content">    This introduces some breaking changes to the Node Rewards canister API,</span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content">    however that&#x27;s considered acceptable since nobody is calling it yet.</span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content">    Changes:</span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">    - Removed completely `DayUtc` base custom type in favour of</span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content">    `chrono::NaiveDate`</span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content">    - Adapted DayUtc in API types to work with `chrono::NaiveDate`</span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content">    - Adapted tests</span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content">diff --git a/rs/node_rewards/canister/BUILD.bazel b/rs/node_rewards/canister/BUILD.bazel</span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content">index 5a7f643961..0e5213753b 100644</span></div>
<div class="file-header">--- a/rs/node_rewards/canister/BUILD.bazel</div>
<div class="file-header">+++ b/rs/node_rewards/canister/BUILD.bazel</div>
<div class="hunk-header">@@ -19,6 +19,7 @@ DEPENDENCIES = [</div>
<div class="line context"><span class="line-number">19</span><span class="line-content">     &quot;//rs/types/base_types&quot;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/BUILD.bazel#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">20</span><span class="line-content">     &quot;//rs/types/types&quot;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/BUILD.bazel#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">21</span><span class="line-content">     &quot;@crate_index//:candid&quot;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/BUILD.bazel#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+22</span><span class="line-content">    &quot;@crate_index//:chrono_canisters&quot;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/BUILD.bazel#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">23</span><span class="line-content">     &quot;@crate_index//:futures&quot;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/BUILD.bazel#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">24</span><span class="line-content">     &quot;@crate_index//:ic-cdk&quot;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/BUILD.bazel#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">25</span><span class="line-content">     &quot;@crate_index//:ic-cdk-timers&quot;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/BUILD.bazel#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -39,7 +40,6 @@ DEV_DEPENDENCIES = [</div>
<div class="line context"><span class="line-number">40</span><span class="line-content">     &quot;//rs/registry/transport&quot;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/BUILD.bazel#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">41</span><span class="line-content">     &quot;//rs/state_machine_tests&quot;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/BUILD.bazel#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">42</span><span class="line-content">     &quot;@crate_index//:candid_parser&quot;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/BUILD.bazel#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-42</span><span class="line-content">    &quot;@crate_index//:chrono_canisters&quot;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/BUILD.bazel#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">43</span><span class="line-content">     &quot;@crate_index//:futures-util&quot;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/BUILD.bazel#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">44</span><span class="line-content">     &quot;@crate_index//:maplit&quot;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/BUILD.bazel#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">45</span><span class="line-content">     &quot;@crate_index//:mockall&quot;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/BUILD.bazel#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">46</span><span class="line-content">diff --git a/rs/node_rewards/canister/Cargo.toml b/rs/node_rewards/canister/Cargo.toml<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/BUILD.bazel#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">47</span><span class="line-content">index c1df86922c..68435759ce 100644<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/BUILD.bazel#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/Cargo.toml</div>
<div class="file-header">+++ b/rs/node_rewards/canister/Cargo.toml</div>
<div class="hunk-header">@@ -37,6 +37,7 @@ mockall = { workspace = true }</div>
<div class="line context"><span class="line-number">37</span><span class="line-content"> prost = { workspace = true }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/Cargo.toml#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">38</span><span class="line-content"> rewards-calculation = { path = &quot;../rewards_calculation&quot; }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/Cargo.toml#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">39</span><span class="line-content"> itertools = { workspace = true }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/Cargo.toml#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+40</span><span class="line-content">chrono = { workspace = true }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/Cargo.toml#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">41</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/Cargo.toml#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">42</span><span class="line-content"> [dev-dependencies]<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/Cargo.toml#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">43</span><span class="line-content"> candid_parser = { workspace = true }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/Cargo.toml#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">44</span><span class="line-content">diff --git a/rs/node_rewards/canister/api/BUILD.bazel b/rs/node_rewards/canister/api/BUILD.bazel<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/Cargo.toml#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">45</span><span class="line-content">index a577bcc4cc..d178c2ea23 100644<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/Cargo.toml#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/api/BUILD.bazel</div>
<div class="file-header">+++ b/rs/node_rewards/canister/api/BUILD.bazel</div>
<div class="hunk-header">@@ -8,6 +8,7 @@ DEPENDENCIES = [</div>
<div class="line context"><span class="line-number">8</span><span class="line-content">     &quot;//rs/node_rewards/rewards_calculation&quot;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/BUILD.bazel#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content">     &quot;//rs/types/base_types&quot;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/BUILD.bazel#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content">     &quot;@crate_index//:candid&quot;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/BUILD.bazel#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+11</span><span class="line-content">    &quot;@crate_index//:chrono_canisters&quot;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/BUILD.bazel#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">     &quot;@crate_index//:ic-cdk&quot;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/BUILD.bazel#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content">     &quot;@crate_index//:serde&quot;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/BUILD.bazel#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> ]<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/BUILD.bazel#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content">diff --git a/rs/node_rewards/canister/api/Cargo.toml b/rs/node_rewards/canister/api/Cargo.toml<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/BUILD.bazel#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content">index decff706f9..804ca0cc8f 100644<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/BUILD.bazel#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/api/Cargo.toml</div>
<div class="file-header">+++ b/rs/node_rewards/canister/api/Cargo.toml</div>
<div class="hunk-header">@@ -15,3 +15,4 @@ ic-base-types = { path = &quot;../../../types/base_types&quot; }</div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> rewards-calculation = { path = &quot;../../rewards_calculation&quot; }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/Cargo.toml#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> ic-nervous-system-proto = { path = &quot;../../../nervous_system/proto&quot; }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/Cargo.toml#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content"> serde = { workspace = true }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/Cargo.toml#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+18</span><span class="line-content">chrono = { workspace = true }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/Cargo.toml#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content">diff --git a/rs/node_rewards/canister/api/src/lib.rs b/rs/node_rewards/canister/api/src/lib.rs<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/Cargo.toml#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">20</span><span class="line-content">index 15ce9c70ea..291111bd85 100644<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/Cargo.toml#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/api/src/lib.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/api/src/lib.rs</div>
<div class="hunk-header">@@ -2,7 +2,8 @@ pub mod monthly_rewards;</div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> pub mod provider_rewards_calculation;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> pub mod providers_rewards;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-5</span><span class="line-content">use rewards_calculation::types as native_types;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/api/src/lib.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+5</span><span class="line-content">use chrono::{DateTime, Datelike, NaiveDate};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+6</span><span class="line-content">use std::fmt::Display;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> // These are API-facing types with all fields wrapped in `Option`<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> // to ensure deserialization always works<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -10,34 +11,56 @@ use rewards_calculation::types as native_types;</div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> #[derive(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">     PartialOrd, Ord, Eq, candid::CandidType, candid::Deserialize, Clone, Copy, PartialEq, Debug,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> )]<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-13</span><span class="line-content">pub struct DayUtc {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/api/src/lib.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-14</span><span class="line-content">    last_ts_nanoseconds: Option&lt;u64&gt;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/api/src/lib.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+14</span><span class="line-content">pub struct DateUtc {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+15</span><span class="line-content">    pub day: Option&lt;u32&gt;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+16</span><span class="line-content">    pub month: Option&lt;u32&gt;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+17</span><span class="line-content">    pub year: Option&lt;u32&gt;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-17</span><span class="line-content">impl DayUtc {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/api/src/lib.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-18</span><span class="line-content">    pub fn from_nanos(nanos_since_unix_epoch: u64) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/api/src/lib.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-19</span><span class="line-content">        Self::from(native_types::DayUtc::from_nanos(nanos_since_unix_epoch))<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/api/src/lib.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-20</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/api/src/lib.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-21</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/api/src/lib.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-22</span><span class="line-content">    pub fn from_secs(secs_since_unix_epoch: u64) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/api/src/lib.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-23</span><span class="line-content">        Self::from(native_types::DayUtc::from_secs(secs_since_unix_epoch))<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/api/src/lib.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+20</span><span class="line-content">impl Display for DateUtc {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+21</span><span class="line-content">    fn fmt(&amp;self, f: &amp;mut std::fmt::Formatter&lt;&#x27;_&gt;) -&gt; std::fmt::Result {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+22</span><span class="line-content">        write!(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+23</span><span class="line-content">            f,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+24</span><span class="line-content">            &quot;{}-{}-{} UTC&quot;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+25</span><span class="line-content">            self.year.expect(&quot;Year is missing&quot;),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+26</span><span class="line-content">            self.month.expect(&quot;Month is missing&quot;),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+27</span><span class="line-content">            self.day.expect(&quot;Day is missing&quot;)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+28</span><span class="line-content">        )<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">29</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">30</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">31</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-27</span><span class="line-content">impl From&lt;native_types::DayUtc&gt; for DayUtc {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/api/src/lib.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-28</span><span class="line-content">    fn from(day_utc: native_types::DayUtc) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/api/src/lib.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+32</span><span class="line-content">impl From&lt;NaiveDate&gt; for DateUtc {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+33</span><span class="line-content">    fn from(value: NaiveDate) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">34</span><span class="line-content">         Self {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-30</span><span class="line-content">            last_ts_nanoseconds: Some(day_utc.unix_timestamp_at_day_end_nanoseconds()),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/api/src/lib.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+35</span><span class="line-content">            day: Some(value.day()),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+36</span><span class="line-content">            month: Some(value.month()),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+37</span><span class="line-content">            year: Some(value.year() as u32),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">38</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">39</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">40</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">41</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-35</span><span class="line-content">impl From&lt;DayUtc&gt; for native_types::DayUtc {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/api/src/lib.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-36</span><span class="line-content">    fn from(day_utc: DayUtc) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/api/src/lib.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-37</span><span class="line-content">        native_types::DayUtc::from_nanos(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/api/src/lib.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-38</span><span class="line-content">            day_utc<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/api/src/lib.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-39</span><span class="line-content">                .last_ts_nanoseconds<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/api/src/lib.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-40</span><span class="line-content">                .expect(&quot;last_ts_nanoseconds is None&quot;),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/api/src/lib.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+42</span><span class="line-content">impl TryFrom&lt;DateUtc&gt; for NaiveDate {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+43</span><span class="line-content">    type Error = String;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+44</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+45</span><span class="line-content">    fn try_from(value: DateUtc) -&gt; Result&lt;Self, Self::Error&gt; {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+46</span><span class="line-content">        NaiveDate::from_ymd_opt(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+47</span><span class="line-content">            value.year.expect(&quot;Year is missing&quot;) as i32,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+48</span><span class="line-content">            value.month.expect(&quot;Month is missing&quot;),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+49</span><span class="line-content">            value.day.expect(&quot;Day is missing&quot;),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">50</span><span class="line-content">         )<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+51</span><span class="line-content">        .ok_or(format!(&quot;Invalid date: {:?}&quot;, value))<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+52</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+53</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+54</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+55</span><span class="line-content">impl DateUtc {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+56</span><span class="line-content">    pub fn from_unix_timestamp_nanoseconds(value: u64) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+57</span><span class="line-content">        let naive_date = DateTime::from_timestamp_nanos(value as i64).date_naive();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+58</span><span class="line-content">        Self::from(naive_date)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+59</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+60</span><span class="line-content">    pub fn from_unix_timestamp_seconds(value: u64) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+61</span><span class="line-content">        let naive_date = DateTime::from_timestamp(value as i64, 0)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+62</span><span class="line-content">            .unwrap()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+63</span><span class="line-content">            .date_naive();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+64</span><span class="line-content">        Self::from(naive_date)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">65</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">66</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">67</span><span class="line-content">diff --git a/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs b/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">68</span><span class="line-content">index 984536628c..d14dbb47ea 100644<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/lib.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs</div>
<div class="hunk-header">@@ -1,12 +1,12 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">pub use crate::DayUtc;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">pub use crate::DateUtc;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use candid::{CandidType, Deserialize, Principal};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use ic_base_types::PrincipalId;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use ic_nervous_system_proto::pb::v1::Decimal;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> #[derive(CandidType, Clone, Deserialize)]<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> pub struct GetNodeProviderRewardsCalculationRequest {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-8</span><span class="line-content">    pub from_day: DayUtc,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-9</span><span class="line-content">    pub to_day: DayUtc,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content">    pub from_day: DateUtc,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+9</span><span class="line-content">    pub to_day: DateUtc,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content">     pub provider_id: Principal,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -70,6 +70,6 @@ pub struct NodeProviderRewards {</div>
<div class="line context"><span class="line-number">70</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">71</span><span class="line-content"> #[derive(CandidType, candid::Deserialize, Clone, Debug)]<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">72</span><span class="line-content"> pub struct NodeProviderRewardsDaily {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-73</span><span class="line-content">    pub day_utc: Option&lt;DayUtc&gt;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+73</span><span class="line-content">    pub day_utc: Option&lt;DateUtc&gt;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">74</span><span class="line-content">     pub node_provider_rewards: Option&lt;NodeProviderRewards&gt;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">75</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">76</span><span class="line-content">diff --git a/rs/node_rewards/canister/api/src/providers_rewards.rs b/rs/node_rewards/canister/api/src/providers_rewards.rs<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">77</span><span class="line-content">index dc4fb8cafc..6f89da3802 100644<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/api/src/providers_rewards.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/api/src/providers_rewards.rs</div>
<div class="hunk-header">@@ -1,11 +1,11 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">use crate::DayUtc;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/api/src/providers_rewards.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">use crate::DateUtc;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/providers_rewards.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use candid::{CandidType, Deserialize, Principal};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/providers_rewards.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use std::collections::BTreeMap;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/providers_rewards.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/providers_rewards.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> #[derive(CandidType, Clone, Deserialize)]<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/providers_rewards.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> pub struct GetNodeProvidersRewardsRequest {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/providers_rewards.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content">    pub from_day: DayUtc,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/api/src/providers_rewards.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-8</span><span class="line-content">    pub to_day: DayUtc,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/api/src/providers_rewards.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+7</span><span class="line-content">    pub from_day: DateUtc,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/providers_rewards.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content">    pub to_day: DateUtc,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/providers_rewards.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/providers_rewards.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> pub type GetNodeProvidersRewardsResponse = Result&lt;NodeProvidersRewards, String&gt;;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/providers_rewards.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/providers_rewards.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">diff --git a/rs/node_rewards/canister/node-rewards-canister.did b/rs/node_rewards/canister/node-rewards-canister.did<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/providers_rewards.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content">index ddd78881cd..f3dfb75a78 100644<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/api/src/providers_rewards.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/node-rewards-canister.did</div>
<div class="file-header">+++ b/rs/node_rewards/canister/node-rewards-canister.did</div>
<div class="hunk-header">@@ -4,8 +4,10 @@ type Decimal = record {</div>
<div class="line context"><span class="line-number">4</span><span class="line-content">   human_readable: opt text;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content">type DayUtc = record {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/node-rewards-canister.did#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-8</span><span class="line-content">  last_ts_nanoseconds: opt nat64;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/node-rewards-canister.did#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+7</span><span class="line-content">type DateUtc = record {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content">  day: opt nat32;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+9</span><span class="line-content">  month: opt nat32;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+10</span><span class="line-content">  year: opt nat32;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> type NodeMetricsDaily = record {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -57,15 +59,15 @@ type NodeProviderRewards = record {</div>
<div class="line context"><span class="line-number">59</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">60</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">61</span><span class="line-content"> type NodeProviderRewardsDaily = record {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-60</span><span class="line-content">    day_utc: opt DayUtc;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/node-rewards-canister.did#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+62</span><span class="line-content">    day_utc: opt DateUtc;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">63</span><span class="line-content">     node_provider_rewards: opt NodeProviderRewards;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">64</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">65</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">66</span><span class="line-content"> type GetNodeProviderRewardsCalculationResponse = variant { Ok: vec NodeProviderRewardsDaily; Err: text };<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">67</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">68</span><span class="line-content"> type GetNodeProviderRewardsCalculationRequest = record {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-67</span><span class="line-content">  from_day: DayUtc;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/node-rewards-canister.did#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-68</span><span class="line-content">  to_day: DayUtc;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/node-rewards-canister.did#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+69</span><span class="line-content">  from_day: DateUtc;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+70</span><span class="line-content">  to_day: DateUtc;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">71</span><span class="line-content">   provider_id: principal;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">72</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">73</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -79,8 +81,8 @@ type NodeProvidersRewards = record {</div>
<div class="line context"><span class="line-number">81</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">82</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">83</span><span class="line-content"> type GetNodeProvidersRewardsRequest = record {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-82</span><span class="line-content">  from_day: DayUtc;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/node-rewards-canister.did#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-83</span><span class="line-content">  to_day: DayUtc;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/node-rewards-canister.did#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+84</span><span class="line-content">  from_day: DateUtc;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+85</span><span class="line-content">  to_day: DateUtc;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">86</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">87</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">88</span><span class="line-content"> type GetNodeProvidersRewardsResponse = variant { Ok: NodeProvidersRewards; Err: text };<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">89</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/canister/mod.rs b/rs/node_rewards/canister/src/canister/mod.rs<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">90</span><span class="line-content">index e613b42873..5ab8ca38fb 100644<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/node-rewards-canister.did#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/canister/mod.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/canister/mod.rs</div>
<div class="hunk-header">@@ -1,7 +1,9 @@</div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> use crate::api_conversion::into_rewards_calculation_results;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+2</span><span class="line-content">use crate::chrono_utils::last_unix_timestamp_nanoseconds;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use crate::metrics::MetricsManager;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use crate::registry_querier::RegistryQuerier;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use crate::storage::VM;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+6</span><span class="line-content">use chrono::{DateTime, NaiveDate};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> use ic_base_types::{PrincipalId, SubnetId};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> use ic_interfaces_registry::ZERO_REGISTRY_VERSION;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> use ic_node_rewards_canister_api::monthly_rewards::{<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -25,7 +27,7 @@ use ic_registry_node_provider_rewards::{RewardsPerNodeProvider, calculate_reward</div>
<div class="line context"><span class="line-number">27</span><span class="line-content"> use ic_types::{RegistryVersion, Time};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">28</span><span class="line-content"> use rewards_calculation::performance_based_algorithm::results::RewardsCalculatorResults;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">29</span><span class="line-content"> use rewards_calculation::performance_based_algorithm::v1::RewardsCalculationV1;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-28</span><span class="line-content">use rewards_calculation::types::{DayUtc, NodeMetricsDailyRaw, RewardableNode};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/mod.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+30</span><span class="line-content">use rewards_calculation::types::{NodeMetricsDailyRaw, RewardableNode};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">31</span><span class="line-content"> use std::cell::RefCell;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">32</span><span class="line-content"> use std::collections::{BTreeMap, HashSet};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">33</span><span class="line-content"> use std::rc::Rc;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -127,13 +129,15 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">129</span><span class="line-content">         });<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L129" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">130</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L130" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">131</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L131" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-130</span><span class="line-content">    fn validate_reward_period(from_day: &amp;DayUtc, to_day: &amp;DayUtc) -&gt; Result&lt;(), String&gt; {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/mod.rs#L130" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-131</span><span class="line-content">        let today: DayUtc = current_time().into();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/mod.rs#L131" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-132</span><span class="line-content">        if from_day &gt; to_day {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/mod.rs#L132" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-133</span><span class="line-content">            return Err(&quot;from_day must be before to_day&quot;.to_string());<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/mod.rs#L133" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+132</span><span class="line-content">    fn validate_reward_period(from_date: &amp;NaiveDate, to_date: &amp;NaiveDate) -&gt; Result&lt;(), String&gt; {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L132" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+133</span><span class="line-content">        let today =<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L133" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+134</span><span class="line-content">            DateTime::from_timestamp_nanos(current_time().as_nanos_since_unix_epoch() as i64)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L134" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+135</span><span class="line-content">                .date_naive();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L135" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+136</span><span class="line-content">        if from_date &gt; to_date {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L136" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+137</span><span class="line-content">            return Err(&quot;from_date must be before to_date&quot;.to_string());<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L137" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">138</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L138" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-135</span><span class="line-content">        if to_day &gt;= &amp;today {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/mod.rs#L135" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-136</span><span class="line-content">            return Err(&quot;to_day_timestamp_nanos must be earlier than today&quot;.to_string());<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/mod.rs#L136" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+139</span><span class="line-content">        if to_date &gt;= &amp;today {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L139" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+140</span><span class="line-content">            return Err(&quot;to_date must be earlier than today&quot;.to_string());<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L140" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">141</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L141" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">142</span><span class="line-content">         Ok(())<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L142" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">143</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L143" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -143,8 +147,8 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">147</span><span class="line-content">         request: GetNodeProvidersRewardsRequest,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L147" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">148</span><span class="line-content">         provider_filter: Option&lt;PrincipalId&gt;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L148" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">149</span><span class="line-content">     ) -&gt; Result&lt;RewardsCalculatorResults, String&gt; {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-146</span><span class="line-content">        let start_day = request.from_day.into();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/mod.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-147</span><span class="line-content">        let end_day = request.to_day.into();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/mod.rs#L147" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+150</span><span class="line-content">        let start_day = NaiveDate::try_from(request.from_day)?;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L150" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+151</span><span class="line-content">        let end_day = NaiveDate::try_from(request.to_day)?;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L151" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">152</span><span class="line-content">         Self::validate_reward_period(&amp;start_day, &amp;end_day)?;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L152" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">153</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L153" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">154</span><span class="line-content">         RewardsCalculationV1::calculate_rewards(&amp;start_day, &amp;end_day, provider_filter, self)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L154" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -153,24 +157,24 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">157</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L157" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">158</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L158" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">159</span><span class="line-content"> impl rewards_calculation::performance_based_algorithm::DataProvider for &amp;NodeRewardsCanister {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L159" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-156</span><span class="line-content">    fn get_rewards_table(&amp;self, day: &amp;DayUtc) -&gt; Result&lt;NodeRewardsTable, String&gt; {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/mod.rs#L156" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+160</span><span class="line-content">    fn get_rewards_table(&amp;self, date: &amp;NaiveDate) -&gt; Result&lt;NodeRewardsTable, String&gt; {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L160" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">161</span><span class="line-content">         let registry_querier = RegistryQuerier::new(self.registry_client.clone());<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L161" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">162</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L162" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">163</span><span class="line-content">         let version = registry_querier<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L163" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-160</span><span class="line-content">            .version_for_timestamp(day.unix_timestamp_at_day_end_nanoseconds())<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/mod.rs#L160" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+164</span><span class="line-content">            .version_for_timestamp_nanoseconds(last_unix_timestamp_nanoseconds(date))<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L164" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">165</span><span class="line-content">             .ok_or_else(|| &quot;Could not find registry version for timestamp&quot;.to_string())?;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L165" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">166</span><span class="line-content">         Ok(registry_querier.get_rewards_table(version))<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L166" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">167</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L167" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">168</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L168" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">169</span><span class="line-content">     fn get_daily_metrics_by_subnet(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L169" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">170</span><span class="line-content">         &amp;self,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L170" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-167</span><span class="line-content">        day: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/mod.rs#L167" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+171</span><span class="line-content">        date: &amp;NaiveDate,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L171" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">172</span><span class="line-content">     ) -&gt; Result&lt;BTreeMap&lt;SubnetId, Vec&lt;NodeMetricsDailyRaw&gt;&gt;, String&gt; {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L172" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-169</span><span class="line-content">        let metrics = self.metrics_manager.metrics_by_subnet(day);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/mod.rs#L169" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+173</span><span class="line-content">        let metrics = self.metrics_manager.metrics_by_subnet(date);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L173" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">174</span><span class="line-content">         if metrics.is_empty() {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L174" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">175</span><span class="line-content">             return Err(format!(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L175" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">176</span><span class="line-content">                 &quot;No metrics found for day {}&quot;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L176" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-173</span><span class="line-content">                day.unix_timestamp_at_day_end_nanoseconds()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/mod.rs#L173" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+177</span><span class="line-content">                date.format(&quot;%Y-%m-%d&quot;)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L177" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">178</span><span class="line-content">             ));<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L178" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">179</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L179" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">180</span><span class="line-content">         Ok(metrics)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L180" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -178,25 +182,26 @@ impl rewards_calculation::performance_based_algorithm::DataProvider for &amp;NodeRew</div>
<div class="line context"><span class="line-number">182</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L182" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">183</span><span class="line-content">     fn get_rewardable_nodes(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L183" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">184</span><span class="line-content">         &amp;self,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L184" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-181</span><span class="line-content">        day: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/mod.rs#L181" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+185</span><span class="line-content">        date: &amp;NaiveDate,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L185" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">186</span><span class="line-content">     ) -&gt; Result&lt;BTreeMap&lt;PrincipalId, Vec&lt;RewardableNode&gt;&gt;, String&gt; {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L186" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">187</span><span class="line-content">         let registry_client = self.get_registry_client();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L187" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">188</span><span class="line-content">         let registry_querier = RegistryQuerier::new(registry_client.clone());<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L188" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">189</span><span class="line-content">         registry_querier<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L189" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-186</span><span class="line-content">            .get_rewardable_nodes_per_provider(day, None)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/mod.rs#L186" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+190</span><span class="line-content">            .get_rewardable_nodes_per_provider(date, None)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L190" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">191</span><span class="line-content">             .map_err(|e| format!(&quot;Could not get rewardable nodes: {e:?}&quot;))<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L191" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">192</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L192" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">193</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L193" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">194</span><span class="line-content">     fn get_provider_rewardable_nodes(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L194" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">195</span><span class="line-content">         &amp;self,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L195" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-192</span><span class="line-content">        day: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/mod.rs#L192" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+196</span><span class="line-content">        date: &amp;NaiveDate,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L196" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">197</span><span class="line-content">         provider_id: &amp;PrincipalId,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L197" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">198</span><span class="line-content">     ) -&gt; Result&lt;Vec&lt;RewardableNode&gt;, String&gt; {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L198" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-195</span><span class="line-content">        let mut all_rewardable_nodes = self.get_rewardable_nodes(day)?;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/mod.rs#L195" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+199</span><span class="line-content">        let mut all_rewardable_nodes = self.get_rewardable_nodes(date)?;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L199" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">200</span><span class="line-content">         let rewardable_nodes = all_rewardable_nodes.remove(provider_id).ok_or_else(|| {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L200" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">201</span><span class="line-content">             format!(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L201" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">202</span><span class="line-content">                 &quot;No rewardable nodes found for provider {} for day {}&quot;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L202" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-199</span><span class="line-content">                provider_id, day<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/mod.rs#L199" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+203</span><span class="line-content">                provider_id,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L203" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+204</span><span class="line-content">                date.format(&quot;%Y-%m-%d&quot;)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L204" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">205</span><span class="line-content">             )<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L205" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">206</span><span class="line-content">         })?;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L206" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">207</span><span class="line-content">         Ok(rewardable_nodes)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L207" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">208</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs b/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L208" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">209</span><span class="line-content">index a23ea75201..d24a62132c 100644<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/mod.rs#L209" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs</div>
<div class="hunk-header">@@ -1,5 +1,6 @@</div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> use crate::canister::NodeRewardsCanister;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use crate::canister::test::test_utils::{CANISTER_TEST, VM, setup_thread_local_canister_for_test};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+3</span><span class="line-content">use crate::chrono_utils::{last_unix_timestamp_nanoseconds, to_native_date};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use crate::metrics::MetricsManager;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use crate::pb::v1::{NodeMetrics, SubnetMetricsKey, SubnetMetricsValue};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use futures_util::FutureExt;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -19,7 +20,6 @@ use maplit::btreemap;</div>
<div class="line context"><span class="line-number">20</span><span class="line-content"> use rewards_calculation::performance_based_algorithm::test_utils::{<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">21</span><span class="line-content">     create_rewards_table_for_region_test, test_node_id, test_provider_id, test_subnet_id,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">22</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-22</span><span class="line-content">use rewards_calculation::types::DayUtc;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">23</span><span class="line-content"> use std::rc::Rc;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">24</span><span class="line-content"> use std::str::FromStr;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">25</span><span class="line-content"> use std::sync::Arc;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -28,8 +28,8 @@ fn setup_data_for_test_rewards_calculation(</div>
<div class="line context"><span class="line-number">28</span><span class="line-content">     fake_registry: Arc&lt;FakeRegistry&gt;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">29</span><span class="line-content">     metrics_manager: Rc&lt;MetricsManager&lt;VM&gt;&gt;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">30</span><span class="line-content"> ) {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-31</span><span class="line-content">    let day1: DayUtc = DayUtc::try_from(&quot;2024-01-01&quot;).unwrap();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-32</span><span class="line-content">    let day2: DayUtc = DayUtc::try_from(&quot;2024-01-02&quot;).unwrap();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+31</span><span class="line-content">    let day1 = to_native_date(&quot;2024-01-01&quot;);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+32</span><span class="line-content">    let day2 = to_native_date(&quot;2024-01-02&quot;);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">33</span><span class="line-content">     let subnet1 = test_subnet_id(1);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">34</span><span class="line-content">     let subnet2 = test_subnet_id(2);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">35</span><span class="line-content">     let p1 = test_provider_id(1);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -188,7 +188,7 @@ fn setup_data_for_test_rewards_calculation(</div>
<div class="line context"><span class="line-number">188</span><span class="line-content">     fake_registry.set_value_at_version_with_timestamp(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L188" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">189</span><span class="line-content">         make_node_record_key(p1_node3_t31),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L189" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">190</span><span class="line-content">         6,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L190" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-191</span><span class="line-content">        day2.unix_timestamp_at_day_end_nanoseconds(),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L191" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+191</span><span class="line-content">        last_unix_timestamp_nanoseconds(&amp;day2),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L191" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">192</span><span class="line-content">         None,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L192" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">193</span><span class="line-content">     );<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L193" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">194</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L194" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -214,7 +214,7 @@ fn setup_data_for_test_rewards_calculation(</div>
<div class="line context"><span class="line-number">214</span><span class="line-content">     fake_registry.set_value_at_version_with_timestamp(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L214" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">215</span><span class="line-content">         make_node_record_key(p1_node5_perf),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L215" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">216</span><span class="line-content">         6,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L216" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-217</span><span class="line-content">        day2.unix_timestamp_at_day_end_nanoseconds(),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L217" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+217</span><span class="line-content">        last_unix_timestamp_nanoseconds(&amp;day2),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L217" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">218</span><span class="line-content">         None,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L218" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">219</span><span class="line-content">     );<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L219" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">220</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L220" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -231,7 +231,7 @@ fn setup_data_for_test_rewards_calculation(</div>
<div class="line context"><span class="line-number">231</span><span class="line-content">     fake_registry.set_value_at_version_with_timestamp(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L231" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">232</span><span class="line-content">         make_node_record_key(p2_node1),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L232" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">233</span><span class="line-content">         6,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L233" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-234</span><span class="line-content">        day2.unix_timestamp_at_day_end_nanoseconds(),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L234" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+234</span><span class="line-content">        last_unix_timestamp_nanoseconds(&amp;day2),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L234" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">235</span><span class="line-content">         None,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L235" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">236</span><span class="line-content">     );<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L236" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">237</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L237" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -241,7 +241,7 @@ fn setup_data_for_test_rewards_calculation(</div>
<div class="line context"><span class="line-number">241</span><span class="line-content">     // Day 1 subnet 1<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L241" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">242</span><span class="line-content">     subnets_metrics.insert(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L242" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">243</span><span class="line-content">         SubnetMetricsKey {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L243" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-244</span><span class="line-content">            timestamp_nanos: day1.unix_timestamp_at_day_end_nanoseconds(),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L244" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+244</span><span class="line-content">            timestamp_nanos: last_unix_timestamp_nanoseconds(&amp;day1),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L244" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">245</span><span class="line-content">             subnet_id: Some(subnet1.get()),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L245" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">246</span><span class="line-content">         },<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L246" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">247</span><span class="line-content">         SubnetMetricsValue {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L247" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -273,7 +273,7 @@ fn setup_data_for_test_rewards_calculation(</div>
<div class="line context"><span class="line-number">273</span><span class="line-content">     // Day 1 subnet 2<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L273" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">274</span><span class="line-content">     subnets_metrics.insert(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L274" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">275</span><span class="line-content">         SubnetMetricsKey {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L275" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-276</span><span class="line-content">            timestamp_nanos: day1.unix_timestamp_at_day_end_nanoseconds(),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L276" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+276</span><span class="line-content">            timestamp_nanos: last_unix_timestamp_nanoseconds(&amp;day1),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L276" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">277</span><span class="line-content">             subnet_id: Some(subnet2.get()),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L277" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">278</span><span class="line-content">         },<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L278" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">279</span><span class="line-content">         SubnetMetricsValue {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L279" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -288,7 +288,7 @@ fn setup_data_for_test_rewards_calculation(</div>
<div class="line context"><span class="line-number">288</span><span class="line-content">     // Day 2 subnet 1<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L288" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">289</span><span class="line-content">     subnets_metrics.insert(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L289" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">290</span><span class="line-content">         SubnetMetricsKey {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L290" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-291</span><span class="line-content">            timestamp_nanos: day2.unix_timestamp_at_day_end_nanoseconds(),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L291" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+291</span><span class="line-content">            timestamp_nanos: last_unix_timestamp_nanoseconds(&amp;day2),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L291" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">292</span><span class="line-content">             subnet_id: Some(subnet1.get()),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L292" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">293</span><span class="line-content">         },<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L293" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">294</span><span class="line-content">         SubnetMetricsValue {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L294" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -309,8 +309,8 @@ fn test_get_node_providers_rewards() {</div>
<div class="line context"><span class="line-number">309</span><span class="line-content">     setup_data_for_test_rewards_calculation(fake_registry, metrics_manager);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L309" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">310</span><span class="line-content">     NodeRewardsCanister::schedule_registry_sync(&amp;CANISTER_TEST).now_or_never();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L310" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">311</span><span class="line-content">     NodeRewardsCanister::schedule_metrics_sync(&amp;CANISTER_TEST).now_or_never();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L311" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-312</span><span class="line-content">    let from = DayUtc::try_from(&quot;2024-01-01&quot;).unwrap();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L312" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-313</span><span class="line-content">    let to = DayUtc::try_from(&quot;2024-01-02&quot;).unwrap();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L313" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+312</span><span class="line-content">    let from = to_native_date(&quot;2024-01-01&quot;);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L312" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+313</span><span class="line-content">    let to = to_native_date(&quot;2024-01-02&quot;);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L313" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">314</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L314" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">315</span><span class="line-content">     let request = GetNodeProvidersRewardsRequest {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L315" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">316</span><span class="line-content">         from_day: from.into(),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L316" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">317</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/chrono_utils.rs b/rs/node_rewards/canister/src/chrono_utils.rs<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L317" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">318</span><span class="line-content">new file mode 100644<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L318" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">319</span><span class="line-content">index 0000000000..7724d65d53<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L319" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- /dev/null</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/chrono_utils.rs</div>
<div class="hunk-header">@@ -0,0 +1,24 @@</div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">use chrono::NaiveDate;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/chrono_utils.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+2</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/chrono_utils.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+3</span><span class="line-content">pub fn first_unix_timestamp_nanoseconds(naive_date: &amp;NaiveDate) -&gt; u64 {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/chrono_utils.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+4</span><span class="line-content">    naive_date<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/chrono_utils.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+5</span><span class="line-content">        .and_hms_nano_opt(0, 0, 0, 1)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/chrono_utils.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+6</span><span class="line-content">        .unwrap()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/chrono_utils.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+7</span><span class="line-content">        .and_utc()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/chrono_utils.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content">        .timestamp_nanos_opt()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/chrono_utils.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+9</span><span class="line-content">        .unwrap() as u64<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/chrono_utils.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+10</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/chrono_utils.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+11</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/chrono_utils.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+12</span><span class="line-content">pub fn last_unix_timestamp_nanoseconds(naive_date: &amp;NaiveDate) -&gt; u64 {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/chrono_utils.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+13</span><span class="line-content">    naive_date<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/chrono_utils.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+14</span><span class="line-content">        .and_hms_nano_opt(23, 59, 59, 999_999_999)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/chrono_utils.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+15</span><span class="line-content">        .unwrap()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/chrono_utils.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+16</span><span class="line-content">        .and_utc()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/chrono_utils.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+17</span><span class="line-content">        .timestamp_nanos_opt()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/chrono_utils.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+18</span><span class="line-content">        .unwrap() as u64<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/chrono_utils.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+19</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/chrono_utils.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+20</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/chrono_utils.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+21</span><span class="line-content">#[cfg(test)]<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/chrono_utils.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+22</span><span class="line-content">pub fn to_native_date(date: &amp;str) -&gt; NaiveDate {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/chrono_utils.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+23</span><span class="line-content">    NaiveDate::parse_from_str(date, &quot;%Y-%m-%d&quot;).unwrap()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/chrono_utils.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+24</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/chrono_utils.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">25</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/lib.rs b/rs/node_rewards/canister/src/lib.rs<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/chrono_utils.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">26</span><span class="line-content">index 504f62d8f6..b86c3d9dcc 100644<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/chrono_utils.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/lib.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/lib.rs</div>
<div class="hunk-header">@@ -15,6 +15,7 @@ use std::borrow::Cow;</div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/lib.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> pub mod api_conversion;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/lib.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content"> pub mod canister;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/lib.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+18</span><span class="line-content">mod chrono_utils;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/lib.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content"> pub mod metrics;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/lib.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">20</span><span class="line-content"> pub mod pb;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/lib.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">21</span><span class="line-content"> pub mod registry_querier;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/lib.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">22</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/metrics.rs b/rs/node_rewards/canister/src/metrics.rs<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/lib.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">23</span><span class="line-content">index 80a5cc55cc..28b03e43ca 100644<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/lib.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/metrics.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/metrics.rs</div>
<div class="hunk-header">@@ -1,14 +1,16 @@</div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> #![allow(deprecated)]<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use crate::KeyRange;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+3</span><span class="line-content">use crate::chrono_utils::{first_unix_timestamp_nanoseconds, last_unix_timestamp_nanoseconds};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use crate::pb::v1::{SubnetIdKey, SubnetMetricsKey, SubnetMetricsValue};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use async_trait::async_trait;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use candid::Principal;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+7</span><span class="line-content">use chrono::{DateTime, NaiveDate};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> use ic_base_types::{NodeId, SubnetId};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> use ic_cdk::api::call::CallResult;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> use ic_management_canister_types::{NodeMetricsHistoryArgs, NodeMetricsHistoryRecord};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> use ic_stable_structures::StableBTreeMap;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> use itertools::Itertools;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-11</span><span class="line-content">use rewards_calculation::types::{DayUtc, NodeMetricsDailyRaw, UnixTsNanos};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+13</span><span class="line-content">use rewards_calculation::types::{NodeMetricsDailyRaw, UnixTsNanos};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> use std::cell::RefCell;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> use std::collections::{BTreeMap, HashMap};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -178,40 +180,39 @@ where</div>
<div class="line context"><span class="line-number">180</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L180" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">181</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L181" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">182</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L182" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-181</span><span class="line-content">    /// Computes daily node metrics for a specific day.<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics.rs#L181" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+183</span><span class="line-content">    /// Computes daily node metrics for a specific date.<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L183" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">184</span><span class="line-content">     ///<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L184" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">185</span><span class="line-content">     /// This is done by subtracting the total metrics of the<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L185" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-184</span><span class="line-content">    /// previous day from those of the current day.<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics.rs#L184" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+186</span><span class="line-content">    /// previous date from those of the current date.<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L186" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">187</span><span class="line-content">     pub fn metrics_by_subnet(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L187" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">188</span><span class="line-content">         &amp;self,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L188" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-187</span><span class="line-content">        day_utc: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics.rs#L187" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+189</span><span class="line-content">        date: &amp;NaiveDate,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L189" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">190</span><span class="line-content">     ) -&gt; BTreeMap&lt;SubnetId, Vec&lt;NodeMetricsDailyRaw&gt;&gt; {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L190" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">191</span><span class="line-content">         let mut metrics_by_subnet = BTreeMap::new();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L191" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-190</span><span class="line-content">        let previous_day_ts = day_utc<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics.rs#L190" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-191</span><span class="line-content">            .previous_day()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics.rs#L191" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-192</span><span class="line-content">            .unix_timestamp_at_day_start_nanoseconds();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics.rs#L192" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">192</span><span class="line-content">         let first_key = SubnetMetricsKey {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L192" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-194</span><span class="line-content">            timestamp_nanos: previous_day_ts,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics.rs#L194" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+193</span><span class="line-content">            timestamp_nanos: first_unix_timestamp_nanoseconds(&amp;date.pred()),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L193" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">194</span><span class="line-content">             ..SubnetMetricsKey::min_key()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L194" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">195</span><span class="line-content">         };<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L195" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">196</span><span class="line-content">         let last_key = SubnetMetricsKey {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L196" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-198</span><span class="line-content">            timestamp_nanos: day_utc.unix_timestamp_at_day_end_nanoseconds(),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics.rs#L198" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+197</span><span class="line-content">            timestamp_nanos: last_unix_timestamp_nanoseconds(date),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L197" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">198</span><span class="line-content">             ..SubnetMetricsKey::max_key()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L198" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">199</span><span class="line-content">         };<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L199" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">200</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L200" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-202</span><span class="line-content">        let mut subnets_metrics_by_day: BTreeMap&lt;DayUtc, _&gt; = self<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics.rs#L202" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+201</span><span class="line-content">        let mut subnets_metrics_by_date: BTreeMap&lt;NaiveDate, _&gt; = self<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L201" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">202</span><span class="line-content">             .subnets_metrics<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L202" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">203</span><span class="line-content">             .borrow()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L203" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">204</span><span class="line-content">             .range(first_key..=last_key)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L204" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-206</span><span class="line-content">            .into_group_map_by(|(k, _)| DayUtc::from_nanos(k.timestamp_nanos))<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics.rs#L206" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+205</span><span class="line-content">            .into_group_map_by(|(k, _)| {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L205" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+206</span><span class="line-content">                DateTime::from_timestamp_nanos(k.timestamp_nanos as i64).date_naive()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L206" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+207</span><span class="line-content">            })<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L207" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">208</span><span class="line-content">             .into_iter()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L208" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">209</span><span class="line-content">             .collect();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L209" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">210</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L210" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">211</span><span class="line-content">         let mut initial_total_metrics: HashMap&lt;_, _&gt; = HashMap::new();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L211" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-211</span><span class="line-content">        if let Some((timestamp_nanos, _)) = subnets_metrics_by_day.first_key_value()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics.rs#L211" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-212</span><span class="line-content">            &amp;&amp; timestamp_nanos &lt; day_utc<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics.rs#L212" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+212</span><span class="line-content">        if let Some((stored_date, _)) = subnets_metrics_by_date.first_key_value()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L212" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+213</span><span class="line-content">            &amp;&amp; stored_date &lt; date<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L213" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">214</span><span class="line-content">         {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L214" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-214</span><span class="line-content">            initial_total_metrics = subnets_metrics_by_day<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics.rs#L214" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+215</span><span class="line-content">            initial_total_metrics = subnets_metrics_by_date<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L215" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">216</span><span class="line-content">                 .pop_first()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L216" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">217</span><span class="line-content">                 .unwrap()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L217" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">218</span><span class="line-content">                 .1<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L218" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -230,7 +231,7 @@ where</div>
<div class="line context"><span class="line-number">231</span><span class="line-content">                 .collect();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L231" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">232</span><span class="line-content">         };<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L232" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">233</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L233" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-233</span><span class="line-content">        for (_, subnets_metrics) in subnets_metrics_by_day {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics.rs#L233" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+234</span><span class="line-content">        for (_, subnets_metrics) in subnets_metrics_by_date {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L234" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">235</span><span class="line-content">             for (k, v) in subnets_metrics {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L235" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">236</span><span class="line-content">                 let subnet_id = SubnetId::from(k.subnet_id.unwrap());<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L236" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">237</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L237" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">238</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/metrics/tests.rs b/rs/node_rewards/canister/src/metrics/tests.rs<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L238" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">239</span><span class="line-content">index 378cbd5c77..ff67195b52 100644<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics.rs#L239" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/metrics/tests.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/metrics/tests.rs</div>
<div class="hunk-header">@@ -1,11 +1,13 @@</div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">use crate::chrono_utils::last_unix_timestamp_nanoseconds;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use crate::metrics::{MetricsManager, UnixTsNanos};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use crate::pb::v1::SubnetMetricsKey;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+4</span><span class="line-content">use chrono::{Days, NaiveDate};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use ic_base_types::{NodeId, PrincipalId, SubnetId};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use ic_cdk::api::call::{CallResult, RejectionCode};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> use ic_management_canister_types::{NodeMetrics, NodeMetricsHistoryArgs, NodeMetricsHistoryRecord};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> use ic_stable_structures::DefaultMemoryImpl;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> use ic_stable_structures::memory_manager::{MemoryId, VirtualMemory};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-8</span><span class="line-content">use rewards_calculation::types::{DayUtc, NodeMetricsDailyRaw};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+10</span><span class="line-content">use rewards_calculation::types::NodeMetricsDailyRaw;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> use std::cell::RefCell;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> use std::collections::{BTreeMap, HashMap};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -47,6 +49,10 @@ impl MetricsManager&lt;VM&gt; {</div>
<div class="line context"><span class="line-number">49</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">50</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">51</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+52</span><span class="line-content">fn add_days(date: &amp;NaiveDate, days: u64) -&gt; NaiveDate {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+53</span><span class="line-content">    date.checked_add_days(Days::new(days)).unwrap()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+54</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+55</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">56</span><span class="line-content"> fn node_metrics_history_gen(days: u64) -&gt; Vec&lt;NodeMetricsHistoryRecord&gt; {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">57</span><span class="line-content">     let mut result = Vec::new();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">58</span><span class="line-content">     for i in 0..days {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -245,14 +251,13 @@ impl NodeMetricsHistoryResponseTracker {</div>
<div class="line context"><span class="line-number">251</span><span class="line-content">     fn add_node_metrics(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L251" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">252</span><span class="line-content">         mut self,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L252" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">253</span><span class="line-content">         node_id: NodeId,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L253" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-248</span><span class="line-content">        metrics: Vec&lt;(DayUtc, Vec&lt;(Proposed, Failed)&gt;)&gt;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L248" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+254</span><span class="line-content">        metrics: Vec&lt;(NaiveDate, Vec&lt;(Proposed, Failed)&gt;)&gt;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L254" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">255</span><span class="line-content">     ) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L255" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-250</span><span class="line-content">        for (from, proposed_failed) in metrics {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L250" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-251</span><span class="line-content">            let mut metrics_day = from;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L251" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+256</span><span class="line-content">        for (mut from, proposed_failed) in metrics {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L256" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">257</span><span class="line-content">             for (proposed, failed) in proposed_failed {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L257" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">258</span><span class="line-content">                 let entry = self<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L258" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">259</span><span class="line-content">                     .subnets_responses<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L259" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-255</span><span class="line-content">                    .entry(metrics_day.unix_timestamp_at_day_end_nanoseconds())<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L255" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+260</span><span class="line-content">                    .entry(last_unix_timestamp_nanoseconds(&amp;from))<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L260" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">261</span><span class="line-content">                     .or_default();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L261" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">262</span><span class="line-content">                 let entry_sub = entry.entry(self.current_subnet).or_default();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L262" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">263</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L263" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -261,7 +266,7 @@ impl NodeMetricsHistoryResponseTracker {</div>
<div class="line context"><span class="line-number">266</span><span class="line-content">                     num_block_failures_total: failed,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L266" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">267</span><span class="line-content">                     node_id: node_id.get().0,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L267" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">268</span><span class="line-content">                 });<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L268" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-264</span><span class="line-content">                metrics_day = metrics_day.next_day();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L264" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+269</span><span class="line-content">                from = from.succ_opt().unwrap();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L269" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">270</span><span class="line-content">             }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L270" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">271</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L271" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">272</span><span class="line-content">         self<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L272" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -276,10 +281,8 @@ impl NodeMetricsHistoryResponseTracker {</div>
<div class="line context"><span class="line-number">281</span><span class="line-content">         let subnet_id = SubnetId::from(PrincipalId::from(args.subnet_id));<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L281" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">282</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L282" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">283</span><span class="line-content">         self.subnets_responses<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L283" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-279</span><span class="line-content">            .range(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L279" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-280</span><span class="line-content">                args.start_at_timestamp_nanos<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L280" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-281</span><span class="line-content">                    ..(args.start_at_timestamp_nanos + (response_step as u64) * ONE_DAY_NANOS),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L281" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-282</span><span class="line-content">            )<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L282" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+284</span><span class="line-content">            .range(args.start_at_timestamp_nanos..)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L284" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+285</span><span class="line-content">            .take(response_step)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L285" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">286</span><span class="line-content">             .filter(|(_, metrics)| metrics.contains_key(&amp;subnet_id))<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L286" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">287</span><span class="line-content">             .for_each(|(ts, metrics)| {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L287" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">288</span><span class="line-content">                 let node_metrics = metrics.get(&amp;subnet_id).unwrap().clone();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L288" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -298,7 +301,7 @@ impl NodeMetricsHistoryResponseTracker {</div>
<div class="line context"><span class="line-number">301</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L301" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">302</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L302" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">303</span><span class="line-content"> async fn _daily_metrics_correct_different_update_size(size: usize) {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L303" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-301</span><span class="line-content">    let day_start = DayUtc::from_nanos(0);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L301" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+304</span><span class="line-content">    let day_start = NaiveDate::from_ymd(2025, 1, 1);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L304" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">305</span><span class="line-content">     let tracker = NodeMetricsHistoryResponseTracker::new()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L305" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">306</span><span class="line-content">         .with_subnet(subnet_id(1))<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L306" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">307</span><span class="line-content">         .add_node_metrics(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L307" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -307,10 +310,9 @@ async fn _daily_metrics_correct_different_update_size(size: usize) {</div>
<div class="line context"><span class="line-number">310</span><span class="line-content">         )<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L310" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">311</span><span class="line-content">         .add_node_metrics(node_id(2), vec![(day_start, vec![(19, 21), (32, 22)])])<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L311" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">312</span><span class="line-content">         // Node 2 is redeployed to subnet 1 on day 2<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L312" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-310</span><span class="line-content">        .add_node_metrics(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L310" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-311</span><span class="line-content">            node_id(2),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L311" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-312</span><span class="line-content">            vec![(day_start.next_day().next_day().next_day(), vec![(10, 10)])],<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L312" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-313</span><span class="line-content">        );<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L313" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+313</span><span class="line-content">        .add_node_metrics(node_id(2), vec![(add_days(&amp;day_start, 3), vec![(10, 10)])]);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L313" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+314</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L314" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+315</span><span class="line-content">    println!(&quot;metrics stored {:?}&quot;, tracker.subnets_responses);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L315" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">316</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L316" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">317</span><span class="line-content">     let mut mock = mock::MockCanisterClient::new();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L317" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">318</span><span class="line-content">     mock.expect_node_metrics_history()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L318" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -333,7 +335,7 @@ async fn _daily_metrics_correct_different_update_size(size: usize) {</div>
<div class="line context"><span class="line-number">335</span><span class="line-content">     assert_eq!(daily_metrics[0][1].num_blocks_failed, 21);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L335" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">336</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L336" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">337</span><span class="line-content">     let daily_metrics: Vec&lt;Vec&lt;NodeMetricsDailyRaw&gt;&gt; = mm<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L337" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-336</span><span class="line-content">        .metrics_by_subnet(&amp;day_start.next_day())<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L336" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+338</span><span class="line-content">        .metrics_by_subnet(&amp;day_start.succ_opt().unwrap())<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L338" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">339</span><span class="line-content">         .into_values()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L339" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">340</span><span class="line-content">         .collect();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L340" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">341</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L341" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -346,7 +348,7 @@ async fn _daily_metrics_correct_different_update_size(size: usize) {</div>
<div class="line context"><span class="line-number">348</span><span class="line-content">     assert_eq!(daily_metrics[0][1].num_blocks_failed, 1);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L348" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">349</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L349" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">350</span><span class="line-content">     let daily_metrics: Vec&lt;Vec&lt;NodeMetricsDailyRaw&gt;&gt; = mm<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L350" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-349</span><span class="line-content">        .metrics_by_subnet(&amp;day_start.next_day().next_day())<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L349" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+351</span><span class="line-content">        .metrics_by_subnet(&amp;add_days(&amp;day_start, 2))<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L351" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">352</span><span class="line-content">         .into_values()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L352" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">353</span><span class="line-content">         .collect();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L353" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">354</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L354" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -355,7 +357,7 @@ async fn _daily_metrics_correct_different_update_size(size: usize) {</div>
<div class="line context"><span class="line-number">357</span><span class="line-content">     assert_eq!(daily_metrics[0][0].num_blocks_failed, 0);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L357" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">358</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L358" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">359</span><span class="line-content">     let daily_metrics: Vec&lt;Vec&lt;NodeMetricsDailyRaw&gt;&gt; = mm<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L359" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-358</span><span class="line-content">        .metrics_by_subnet(&amp;day_start.next_day().next_day().next_day())<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L358" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+360</span><span class="line-content">        .metrics_by_subnet(&amp;add_days(&amp;day_start, 3))<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L360" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">361</span><span class="line-content">         .into_values()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L361" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">362</span><span class="line-content">         .collect();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L362" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">363</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L363" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -381,7 +383,7 @@ async fn daily_metrics_correct_2_subs() {</div>
<div class="line context"><span class="line-number">383</span><span class="line-content">     let subnet_2 = subnet_id(2);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L383" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">384</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L384" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">385</span><span class="line-content">     let node_1 = node_id(1);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L385" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-384</span><span class="line-content">    let day_start = DayUtc::from_nanos(0);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L384" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+386</span><span class="line-content">    let day_start = NaiveDate::from_ymd(2025, 1, 1);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L386" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">387</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L387" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">388</span><span class="line-content">     let tracker = NodeMetricsHistoryResponseTracker::new()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L388" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">389</span><span class="line-content">         .with_subnet(subnet_1)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L389" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -389,10 +391,7 @@ async fn daily_metrics_correct_2_subs() {</div>
<div class="line context"><span class="line-number">391</span><span class="line-content">         .with_subnet(subnet_2)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L391" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">392</span><span class="line-content">         .add_node_metrics(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L392" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">393</span><span class="line-content">             node_1,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L393" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-392</span><span class="line-content">            vec![(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L392" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-393</span><span class="line-content">                day_start.next_day().next_day().next_day(),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L393" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-394</span><span class="line-content">                vec![(4, 4), (6, 6), (8, 8)],<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L394" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-395</span><span class="line-content">            )],<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L395" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+394</span><span class="line-content">            vec![(add_days(&amp;day_start, 3), vec![(4, 4), (6, 6), (8, 8)])],<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L394" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">395</span><span class="line-content">         );<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L395" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">396</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L396" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">397</span><span class="line-content">     let mut mock = mock::MockCanisterClient::new();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L397" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -407,7 +406,7 @@ async fn daily_metrics_correct_2_subs() {</div>
<div class="line context"><span class="line-number">406</span><span class="line-content">     let mut node_1_daily_metrics = Vec::new();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L406" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">407</span><span class="line-content">     for day in 0..8 {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L407" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">408</span><span class="line-content">         let daily_metrics = mm<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L408" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-410</span><span class="line-content">            .metrics_by_subnet(&amp;DayUtc::from_nanos(day * ONE_DAY_NANOS))<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L410" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+409</span><span class="line-content">            .metrics_by_subnet(&amp;add_days(&amp;day_start, day))<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L409" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">410</span><span class="line-content">             .into_iter()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L410" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">411</span><span class="line-content">             .collect::&lt;BTreeMap&lt;_, _&gt;&gt;()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L411" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">412</span><span class="line-content">             .into_iter()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L412" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -475,8 +474,8 @@ async fn daily_metrics_correct_overlapping_days() {</div>
<div class="line context"><span class="line-number">474</span><span class="line-content">     let subnet_2 = subnet_id(2);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L474" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">475</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L475" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">476</span><span class="line-content">     let node_1 = node_id(1);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L476" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-478</span><span class="line-content">    let node_2 = node_id(1);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L478" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-479</span><span class="line-content">    let day_start = DayUtc::from_nanos(0);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L479" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+477</span><span class="line-content">    let node_2 = node_id(2);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L477" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+478</span><span class="line-content">    let day_start = NaiveDate::from_ymd(2025, 1, 1);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L478" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">479</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L479" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">480</span><span class="line-content">     let tracker = NodeMetricsHistoryResponseTracker::new()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L480" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">481</span><span class="line-content">         .with_subnet(subnet_1)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L481" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -485,17 +484,11 @@ async fn daily_metrics_correct_overlapping_days() {</div>
<div class="line context"><span class="line-number">484</span><span class="line-content">         // Node 1 redeployed to subnet 2 on day 2<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L484" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">485</span><span class="line-content">         .add_node_metrics(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L485" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">486</span><span class="line-content">             node_1,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L486" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-488</span><span class="line-content">            vec![(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L488" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-489</span><span class="line-content">                day_start.next_day().next_day(),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L489" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-490</span><span class="line-content">                vec![(4, 4), (6, 6), (8, 8)],<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L490" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-491</span><span class="line-content">            )],<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L491" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+487</span><span class="line-content">            vec![(add_days(&amp;day_start, 2), vec![(4, 4), (6, 6), (8, 8)])],<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L487" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">488</span><span class="line-content">         )<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L488" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">489</span><span class="line-content">         .add_node_metrics(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L489" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">490</span><span class="line-content">             node_2,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L490" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-495</span><span class="line-content">            vec![(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L495" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-496</span><span class="line-content">                day_start.next_day().next_day(),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L496" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-497</span><span class="line-content">                vec![(1, 1), (3, 3), (6, 6)],<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L497" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-498</span><span class="line-content">            )],<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L498" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+491</span><span class="line-content">            vec![(add_days(&amp;day_start, 2), vec![(1, 1), (3, 3), (6, 6)])],<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L491" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">492</span><span class="line-content">         );<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L492" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">493</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L493" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">494</span><span class="line-content">     let mut mock = mock::MockCanisterClient::new();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L494" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -510,7 +503,7 @@ async fn daily_metrics_correct_overlapping_days() {</div>
<div class="line context"><span class="line-number">503</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L503" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">504</span><span class="line-content">     let mut daily_metrics = Vec::new();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L504" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">505</span><span class="line-content">     for idx in 0..4 {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L505" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-513</span><span class="line-content">        let day = DayUtc::from_nanos(idx * ONE_DAY_NANOS);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L513" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+506</span><span class="line-content">        let day = add_days(&amp;day_start, idx);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L506" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">507</span><span class="line-content">         let metrics = mm<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L507" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">508</span><span class="line-content">             .metrics_by_subnet(&amp;day)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L508" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">509</span><span class="line-content">             .into_iter()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L509" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -528,7 +521,7 @@ async fn daily_metrics_correct_overlapping_days() {</div>
<div class="line context"><span class="line-number">521</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L521" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">522</span><span class="line-content">     let overlapping_sub_1 = daily_metrics<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L522" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">523</span><span class="line-content">         .iter()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L523" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-531</span><span class="line-content">        .find(|(sub, day, _)| sub == &amp;subnet_1 &amp;&amp; *day == day_start.next_day().next_day())<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L531" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+524</span><span class="line-content">        .find(|(sub, day, _)| sub == &amp;subnet_1 &amp;&amp; *day == add_days(&amp;day_start, 2))<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L524" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">525</span><span class="line-content">         .map(|(_, _, node_metrics)| node_metrics)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L525" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">526</span><span class="line-content">         .unwrap();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L526" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">527</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L527" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -537,7 +530,7 @@ async fn daily_metrics_correct_overlapping_days() {</div>
<div class="line context"><span class="line-number">530</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L530" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">531</span><span class="line-content">     let overlapping_sub_2 = daily_metrics<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L531" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">532</span><span class="line-content">         .iter()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L532" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-540</span><span class="line-content">        .find(|(sub, day, _)| sub == &amp;subnet_2 &amp;&amp; *day == day_start.next_day().next_day())<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/metrics/tests.rs#L540" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+533</span><span class="line-content">        .find(|(sub, day, _)| sub == &amp;subnet_2 &amp;&amp; *day == add_days(&amp;day_start, 2))<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L533" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">534</span><span class="line-content">         .map(|(_, _, node_metrics)| node_metrics)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L534" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">535</span><span class="line-content">         .unwrap();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L535" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">536</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L536" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">537</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/registry_querier.rs b/rs/node_rewards/canister/src/registry_querier.rs<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L537" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">538</span><span class="line-content">index 2c80205763..16f2050f82 100644<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/metrics/tests.rs#L538" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/registry_querier.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/registry_querier.rs</div>
<div class="hunk-header">@@ -1,3 +1,5 @@</div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">use crate::chrono_utils::last_unix_timestamp_nanoseconds;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+2</span><span class="line-content">use chrono::NaiveDate;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use ic_base_types::{NodeId, PrincipalId, RegistryVersion, SubnetId};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use ic_interfaces_registry::RegistryValue;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use ic_protobuf::registry::dc::v1::DataCenterRecord;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -11,7 +13,7 @@ use ic_registry_keys::{</div>
<div class="line context"><span class="line-number">13</span><span class="line-content">     make_node_operator_record_key, make_subnet_list_record_key,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> use ic_types::registry::RegistryClientError;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-14</span><span class="line-content">use rewards_calculation::types::{DayUtc, Region, RewardableNode, UnixTsNanos};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+16</span><span class="line-content">use rewards_calculation::types::{Region, RewardableNode, UnixTsNanos};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content"> use std::collections::BTreeMap;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content"> use std::str::FromStr;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content"> use std::sync::Arc;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -32,7 +34,7 @@ impl RegistryQuerier {</div>
<div class="line context"><span class="line-number">34</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">35</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">36</span><span class="line-content">     ///  Returns the latest registry version corresponding to the given timestamp.<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-35</span><span class="line-content">    pub fn version_for_timestamp(&amp;self, ts: UnixTsNanos) -&gt; Option&lt;RegistryVersion&gt; {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+37</span><span class="line-content">    pub fn version_for_timestamp_nanoseconds(&amp;self, ts: UnixTsNanos) -&gt; Option&lt;RegistryVersion&gt; {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">38</span><span class="line-content">         self.registry_client<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">39</span><span class="line-content">             .timestamp_to_versions_map()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">40</span><span class="line-content">             .range(..=ts)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -82,12 +84,12 @@ impl RegistryQuerier {</div>
<div class="line context"><span class="line-number">84</span><span class="line-content">     /// version of that day.<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">85</span><span class="line-content">     pub fn get_rewardable_nodes_per_provider(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">86</span><span class="line-content">         &amp;self,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-85</span><span class="line-content">        day_utc: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+87</span><span class="line-content">        date: &amp;NaiveDate,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">88</span><span class="line-content">         provider_filter: Option&lt;&amp;PrincipalId&gt;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">89</span><span class="line-content">     ) -&gt; Result&lt;BTreeMap&lt;PrincipalId, Vec&lt;RewardableNode&gt;&gt;, RegistryClientError&gt; {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">90</span><span class="line-content">         let mut rewardable_nodes_per_provider: BTreeMap&lt;_, Vec&lt;RewardableNode&gt;&gt; = BTreeMap::new();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">91</span><span class="line-content">         let registry_version = self<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-90</span><span class="line-content">            .version_for_timestamp(day_utc.unix_timestamp_at_day_end_nanoseconds())<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+92</span><span class="line-content">            .version_for_timestamp_nanoseconds(last_unix_timestamp_nanoseconds(date))<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">93</span><span class="line-content">             .unwrap();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">94</span><span class="line-content">         let nodes = self.nodes_in_version(registry_version)?;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L94" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">95</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">96</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/registry_querier/tests.rs b/rs/node_rewards/canister/src/registry_querier/tests.rs<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L96" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">97</span><span class="line-content">index 674eb405ba..f722bff0d5 100644<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/registry_querier/tests.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/registry_querier/tests.rs</div>
<div class="hunk-header">@@ -1,3 +1,4 @@</div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">use crate::chrono_utils::{last_unix_timestamp_nanoseconds, to_native_date};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use crate::registry_querier::RegistryQuerier;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use ic_base_types::{NodeId, PrincipalId, SubnetId};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use ic_nervous_system_canisters::registry::RegistryCanister;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -17,7 +18,7 @@ use ic_registry_keys::{</div>
<div class="line context"><span class="line-number">18</span><span class="line-content"> use ic_stable_structures::memory_manager::{MemoryId, MemoryManager, VirtualMemory};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content"> use ic_stable_structures::{DefaultMemoryImpl, StableBTreeMap};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">20</span><span class="line-content"> use maplit::btreemap;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-20</span><span class="line-content">use rewards_calculation::types::{DayUtc, RewardableNode};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+21</span><span class="line-content">use rewards_calculation::types::RewardableNode;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">22</span><span class="line-content"> use std::cell::RefCell;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">23</span><span class="line-content"> use std::sync::Arc;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">24</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -44,19 +45,14 @@ fn add_record_helper(</div>
<div class="line context"><span class="line-number">45</span><span class="line-content">     value: Option&lt;impl ::prost::Message&gt;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">46</span><span class="line-content">     datetime_str: &amp;str,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">47</span><span class="line-content"> ) {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-47</span><span class="line-content">    let ts = DayUtc::try_from(datetime_str).unwrap();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-48</span><span class="line-content">    add_record_helper_ts(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-49</span><span class="line-content">        key,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-50</span><span class="line-content">        version,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-51</span><span class="line-content">        value,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-52</span><span class="line-content">        ts.unix_timestamp_at_day_end_nanoseconds(),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-53</span><span class="line-content">    );<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-54</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-55</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-56</span><span class="line-content">fn add_record_helper_ts(key: &amp;str, version: u64, value: Option&lt;impl ::prost::Message&gt;, ts: u64) {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+48</span><span class="line-content">    let naive_date = to_native_date(datetime_str);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">49</span><span class="line-content">     STATE.with_borrow_mut(|map| {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">50</span><span class="line-content">         map.insert(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-59</span><span class="line-content">            StorableRegistryKey::new(key.to_string(), version, ts),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+51</span><span class="line-content">            StorableRegistryKey::new(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+52</span><span class="line-content">                key.to_string(),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+53</span><span class="line-content">                version,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+54</span><span class="line-content">                last_unix_timestamp_nanoseconds(&amp;naive_date),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+55</span><span class="line-content">            ),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">56</span><span class="line-content">             StorableRegistryValue(value.map(|v| v.encode_to_vec())),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">57</span><span class="line-content">         );<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">58</span><span class="line-content">     });<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -144,15 +140,8 @@ fn add_dummy_data() {</div>
<div class="line context"><span class="line-number">140</span><span class="line-content">     add_record_helper(&amp;node_3_k, 39670, None::&lt;NodeRecord&gt;, &quot;2025-07-13&quot;);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L140" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">141</span><span class="line-content">     add_record_helper(&amp;node_3_k, 39675, Some(node_3_v.clone()), &quot;2025-07-15&quot;);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L141" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">142</span><span class="line-content">     add_record_helper(&amp;node_4_k, 39676, Some(node_4_v.clone()), &quot;2025-07-16&quot;);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L142" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-147</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L147" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-148</span><span class="line-content">    // Removed and re-added node_3 same day<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L148" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-149</span><span class="line-content">    let ts_removed = DayUtc::try_from(&quot;2025-07-16&quot;)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-150</span><span class="line-content">        .unwrap()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L150" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-151</span><span class="line-content">        .unix_timestamp_at_day_start_nanoseconds()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L151" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-152</span><span class="line-content">        + 1;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L152" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-153</span><span class="line-content">    add_record_helper_ts(&amp;node_3_k, 39676, None::&lt;NodeRecord&gt;, ts_removed);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L153" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-154</span><span class="line-content">    let ts_readded = ts_removed + 1;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L154" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-155</span><span class="line-content">    add_record_helper_ts(&amp;node_3_k, 39677, Some(node_3_v), ts_readded);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L155" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+143</span><span class="line-content">    add_record_helper(&amp;node_3_k, 39676, None::&lt;NodeRecord&gt;, &quot;2025-07-16&quot;);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L143" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+144</span><span class="line-content">    add_record_helper(&amp;node_3_k, 39677, Some(node_3_v), &quot;2025-07-16&quot;);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L144" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">145</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L145" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">146</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">147</span><span class="line-content"> fn client_for_tests() -&gt; RegistryQuerier {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L147" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -234,8 +223,8 @@ fn contains_node(nodes: &amp;[RewardableNode], node_num: u64) -&gt; bool {</div>
<div class="line context"><span class="line-number">223</span><span class="line-content"> #[test]<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L223" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">224</span><span class="line-content"> fn test_rewardable_nodes_deleted_nodes() {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L224" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">225</span><span class="line-content">     let client = client_for_tests();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L225" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-237</span><span class="line-content">    let day1 = DayUtc::try_from(&quot;2025-07-12&quot;).unwrap();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L237" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-238</span><span class="line-content">    let day2 = DayUtc::try_from(&quot;2025-07-13&quot;).unwrap();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L238" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+226</span><span class="line-content">    let day1 = to_native_date(&quot;2025-07-12&quot;);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L226" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+227</span><span class="line-content">    let day2 = to_native_date(&quot;2025-07-13&quot;);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L227" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">228</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L228" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">229</span><span class="line-content">     let mut rewardable_nodes_day1 = client<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L229" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">230</span><span class="line-content">         .get_rewardable_nodes_per_provider(&amp;day1, None)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L230" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -290,23 +279,22 @@ fn test_node_re_registered_after_deletion() {</div>
<div class="line context"><span class="line-number">279</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L279" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">280</span><span class="line-content">     let client = client_for_tests();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L280" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">281</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L281" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-293</span><span class="line-content">    let from = DayUtc::try_from(&quot;2025-07-07&quot;).unwrap();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L293" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-294</span><span class="line-content">    let to = DayUtc::try_from(&quot;2025-07-12&quot;).unwrap();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L294" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-295</span><span class="line-content">    let mut current_day = from;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L295" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+282</span><span class="line-content">    let from = to_native_date(&quot;2025-07-07&quot;);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L282" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+283</span><span class="line-content">    let to = to_native_date(&quot;2025-07-12&quot;);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L283" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">284</span><span class="line-content">     let expected_absent = [<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L284" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-297</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-08&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L297" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-298</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-09&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L298" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-299</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-10&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L299" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+285</span><span class="line-content">        to_native_date(&quot;2025-07-08&quot;),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L285" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+286</span><span class="line-content">        to_native_date(&quot;2025-07-09&quot;),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L286" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+287</span><span class="line-content">        to_native_date(&quot;2025-07-10&quot;),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L287" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">288</span><span class="line-content">     ];<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L288" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">289</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L289" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-302</span><span class="line-content">    while current_day &lt;= to {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L302" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+290</span><span class="line-content">    for day in from.iter_days().take_while(|d| *d &lt;= to) {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L290" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">291</span><span class="line-content">         let rewardables = client<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L291" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-304</span><span class="line-content">            .get_rewardable_nodes_per_provider(&amp;current_day, None)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L304" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+292</span><span class="line-content">            .get_rewardable_nodes_per_provider(&amp;day, None)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L292" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">293</span><span class="line-content">             .unwrap()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L293" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">294</span><span class="line-content">             .remove(&amp;PrincipalId::new_user_test_id(20))<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L294" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">295</span><span class="line-content">             .unwrap();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L295" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">296</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L296" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-309</span><span class="line-content">        if expected_absent.contains(&amp;current_day) {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L309" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+297</span><span class="line-content">        if expected_absent.contains(&amp;day) {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L297" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">298</span><span class="line-content">             assert!(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L298" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">299</span><span class="line-content">                 !contains_node(&amp;rewardables, 1),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L299" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">300</span><span class="line-content">                 &quot;Node 1 should not be rewardable after deletion&quot;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L300" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -317,8 +305,6 @@ fn test_node_re_registered_after_deletion() {</div>
<div class="line context"><span class="line-number">305</span><span class="line-content">                 &quot;Node 1 should be rewardable on day 1&quot;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L305" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">306</span><span class="line-content">             );<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L306" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">307</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L307" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-320</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L320" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-321</span><span class="line-content">        current_day = current_day.next_day();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L321" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">308</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L308" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">309</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L309" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">310</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L310" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">311</span><span class="line-content">diff --git a/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs b/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L311" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">312</span><span class="line-content">index f0e79c9254..6370987988 100644<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/src/registry_querier/tests.rs#L312" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs</div>
<div class="hunk-header">@@ -3,7 +3,7 @@ use ic_nervous_system_agent::AgentFor;</div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use ic_nervous_system_agent::nns::node_rewards::get_node_providers_monthly_xdr_rewards;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use ic_nns_constants::NODE_REWARDS_CANISTER_ID;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use ic_nns_test_utils::common::build_node_rewards_test_wasm;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-6</span><span class="line-content">use ic_node_rewards_canister_api::DayUtc;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+6</span><span class="line-content">use ic_node_rewards_canister_api::DateUtc;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> use ic_node_rewards_canister_api::monthly_rewards::GetNodeProvidersMonthlyXdrRewardsRequest;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> use ic_node_rewards_canister_api::provider_rewards_calculation::{<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content">     GetNodeProviderRewardsCalculationRequest, GetNodeProviderRewardsCalculationResponse,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -75,7 +75,7 @@ async fn get_node_provider_rewards_calculation_is_only_callable_in_nonreplicated</div>
<div class="line context"><span class="line-number">75</span><span class="line-content">     let past_time_nanos = pocket_ic.get_time().await.as_nanos_since_unix_epoch();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">76</span><span class="line-content">     pocket_ic.advance_time(Duration::from_secs(86_400)).await;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">77</span><span class="line-content">     pocket_ic.tick().await;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-78</span><span class="line-content">    let day = DayUtc::from_nanos(past_time_nanos);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+78</span><span class="line-content">    let day = DateUtc::from_unix_timestamp_nanoseconds(past_time_nanos);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">79</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">80</span><span class="line-content">     let request = GetNodeProviderRewardsCalculationRequest {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">81</span><span class="line-content">         from_day: day,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -96,7 +96,7 @@ async fn get_node_provider_rewards_calculation_is_only_callable_in_nonreplicated</div>
<div class="line context"><span class="line-number">96</span><span class="line-content">     .unwrap_err();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L96" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">97</span><span class="line-content">     assert_eq!(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">98</span><span class="line-content">         err,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L98" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-99</span><span class="line-content">        &quot;Could not calculate rewards: \&quot;No metrics found for day 1620345599999999999\&quot;&quot;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+99</span><span class="line-content">        &quot;Could not calculate rewards: \&quot;No metrics found for day 2021-05-06\&quot;&quot;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">100</span><span class="line-content">     );<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L100" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">101</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L101" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">102</span><span class="line-content">     // Replicated update call is not allowed.<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">103</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/Cargo.toml b/rs/node_rewards/rewards_calculation/Cargo.toml<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">104</span><span class="line-content">index 1fa3a2dc52..82558012bf 100644<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L104" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/Cargo.toml</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/Cargo.toml</div>
<div class="hunk-header">@@ -13,12 +13,8 @@ path = &quot;src/lib.rs&quot;</div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> ic-base-types = { path = &quot;../../types/base_types&quot; }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/Cargo.toml#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> itertools = { workspace = true }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/Cargo.toml#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> ic-protobuf = { path = &quot;../../protobuf&quot; }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/Cargo.toml#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-16</span><span class="line-content">ic-types = { path = &quot;../../types/types&quot; }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/Cargo.toml#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> maplit = &quot;1.0&quot;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/Cargo.toml#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content"> rust_decimal = &quot;1.37.1&quot;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/Cargo.toml#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content"> rust_decimal_macros = &quot;1.37.1&quot;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/Cargo.toml#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-20</span><span class="line-content">chrono = { version = &quot;0.4.41&quot;, default-features = false, features = [<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/Cargo.toml#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-21</span><span class="line-content">    &quot;alloc&quot;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/Cargo.toml#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-22</span><span class="line-content">    &quot;serde&quot;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/Cargo.toml#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-23</span><span class="line-content">] }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/Cargo.toml#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+19</span><span class="line-content">chrono = { workspace = true }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/Cargo.toml#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">20</span><span class="line-content"> serde = { workspace = true }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/Cargo.toml#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">21</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/Cargo.toml#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">22</span><span class="line-content">index 3634cdcafb..c84eb6ea8d 100644<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/Cargo.toml#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs</div>
<div class="hunk-header">@@ -2,7 +2,8 @@ use crate::performance_based_algorithm::results::{</div>
<div class="line context"><span class="line-number">2</span><span class="line-content">     BaseRewards, BaseRewardsType3, DailyResults, NodeMetricsDaily, NodeProviderRewards,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content">     NodeResults, NodeStatus, Percent, RewardsCalculatorResults, XDRPermyriad,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-5</span><span class="line-content">use crate::types::{DayUtc, NodeMetricsDailyRaw, Region, RewardableNode};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+5</span><span class="line-content">use crate::types::{NodeMetricsDailyRaw, Region, RewardableNode};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+6</span><span class="line-content">use chrono::NaiveDate;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> use ic_base_types::{NodeId, PrincipalId, SubnetId};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> use ic_protobuf::registry::node::v1::NodeRewardType;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> use ic_protobuf::registry::node_rewards::v2::NodeRewardsTable;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -71,21 +72,21 @@ struct AdjustedRewardsResults {</div>
<div class="line context"><span class="line-number">72</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">73</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">74</span><span class="line-content"> pub trait DataProvider {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-74</span><span class="line-content">    fn get_rewards_table(&amp;self, day: &amp;DayUtc) -&gt; Result&lt;NodeRewardsTable, String&gt;;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+75</span><span class="line-content">    fn get_rewards_table(&amp;self, date: &amp;NaiveDate) -&gt; Result&lt;NodeRewardsTable, String&gt;;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">76</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">77</span><span class="line-content">     fn get_daily_metrics_by_subnet(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">78</span><span class="line-content">         &amp;self,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-78</span><span class="line-content">        day: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+79</span><span class="line-content">        date: &amp;NaiveDate,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">80</span><span class="line-content">     ) -&gt; Result&lt;BTreeMap&lt;SubnetId, Vec&lt;NodeMetricsDailyRaw&gt;&gt;, String&gt;;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">81</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">82</span><span class="line-content">     fn get_rewardable_nodes(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">83</span><span class="line-content">         &amp;self,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-83</span><span class="line-content">        day: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+84</span><span class="line-content">        date: &amp;NaiveDate,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">85</span><span class="line-content">     ) -&gt; Result&lt;BTreeMap&lt;PrincipalId, Vec&lt;RewardableNode&gt;&gt;, String&gt;;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">86</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">87</span><span class="line-content">     fn get_provider_rewardable_nodes(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">88</span><span class="line-content">         &amp;self,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-88</span><span class="line-content">        day: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+89</span><span class="line-content">        date: &amp;NaiveDate,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">90</span><span class="line-content">         provider_id: &amp;PrincipalId,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">91</span><span class="line-content">     ) -&gt; Result&lt;Vec&lt;RewardableNode&gt;, String&gt;;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">92</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -115,16 +116,16 @@ trait PerformanceBasedAlgorithm {</div>
<div class="line context"><span class="line-number">116</span><span class="line-content">     const REWARDS_TABLE_DAYS: Decimal = dec!(30.4375);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L116" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">117</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L117" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">118</span><span class="line-content">     fn calculate_rewards(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L118" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-118</span><span class="line-content">        from_day: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L118" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-119</span><span class="line-content">        to_day: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L119" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+119</span><span class="line-content">        from_date: &amp;NaiveDate,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L119" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+120</span><span class="line-content">        to_date: &amp;NaiveDate,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L120" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">121</span><span class="line-content">         node_provider_filter: Option&lt;PrincipalId&gt;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L121" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">122</span><span class="line-content">         data_provider: impl DataProvider,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L122" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">123</span><span class="line-content">     ) -&gt; Result&lt;RewardsCalculatorResults, String&gt; {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L123" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-123</span><span class="line-content">        if from_day &gt; to_day {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L123" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+124</span><span class="line-content">        if from_date &gt; to_date {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L124" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">125</span><span class="line-content">             return Err(&quot;from_day must be before to_day&quot;.to_string());<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L125" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">126</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L126" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">127</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L127" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-127</span><span class="line-content">        let reward_period = from_day.days_until(to_day)?;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L127" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+128</span><span class="line-content">        let reward_period = from_date.iter_days().take_while(|d| d &lt;= to_date);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L128" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">129</span><span class="line-content">         let mut total_rewards_per_provider = BTreeMap::new();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L129" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">130</span><span class="line-content">         let mut daily_results = BTreeMap::new();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L130" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">131</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L131" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -156,16 +157,17 @@ trait PerformanceBasedAlgorithm {</div>
<div class="line context"><span class="line-number">157</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L157" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">158</span><span class="line-content">     fn calculate_daily_rewards(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L158" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">159</span><span class="line-content">         data_provider: &amp;impl DataProvider,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L159" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-159</span><span class="line-content">        day: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L159" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+160</span><span class="line-content">        date: &amp;NaiveDate,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L160" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">161</span><span class="line-content">         node_provider_filter: &amp;Option&lt;PrincipalId&gt;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L161" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">162</span><span class="line-content">     ) -&gt; Result&lt;DailyResults, String&gt; {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L162" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-162</span><span class="line-content">        let rewards_table = data_provider.get_rewards_table(day)?;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L162" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-163</span><span class="line-content">        let metrics_by_subnet = data_provider.get_daily_metrics_by_subnet(day)?;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L163" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+163</span><span class="line-content">        let rewards_table = data_provider.get_rewards_table(date)?;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L163" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+164</span><span class="line-content">        let metrics_by_subnet = data_provider.get_daily_metrics_by_subnet(date)?;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L164" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">165</span><span class="line-content">         let providers_rewardable_nodes = if let Some(provider_id) = node_provider_filter {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L165" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-165</span><span class="line-content">            let rewardable_nodes = data_provider.get_provider_rewardable_nodes(day, provider_id)?;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L165" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+166</span><span class="line-content">            let rewardable_nodes =<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L166" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+167</span><span class="line-content">                data_provider.get_provider_rewardable_nodes(date, provider_id)?;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L167" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">168</span><span class="line-content">             btreemap! { *provider_id =&gt; rewardable_nodes }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L168" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">169</span><span class="line-content">         } else {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L169" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-168</span><span class="line-content">            data_provider.get_rewardable_nodes(day)?<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L168" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+170</span><span class="line-content">            data_provider.get_rewardable_nodes(date)?<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L170" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">171</span><span class="line-content">         };<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L171" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">172</span><span class="line-content">         let mut results_per_provider = BTreeMap::new();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L172" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">173</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L173" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">174</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L174" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">175</span><span class="line-content">index 2d066a435b..45eb704041 100644<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L175" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs</div>
<div class="hunk-header">@@ -1,4 +1,4 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">use crate::types::DayUtc;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">use chrono::NaiveDate;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use ic_base_types::{NodeId, PrincipalId, SubnetId};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use ic_protobuf::registry::node::v1::NodeRewardType;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use rust_decimal::Decimal;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -69,8 +69,7 @@ pub struct DailyResults {</div>
<div class="line context"><span class="line-number">69</span><span class="line-content">     pub provider_results: BTreeMap&lt;PrincipalId, NodeProviderRewards&gt;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">70</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">71</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-72</span><span class="line-content">#[derive(Serialize, Deserialize)]<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">72</span><span class="line-content"> pub struct RewardsCalculatorResults {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">73</span><span class="line-content">     pub total_rewards_xdr_permyriad: BTreeMap&lt;PrincipalId, u64&gt;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-75</span><span class="line-content">    pub daily_results: BTreeMap&lt;DayUtc, DailyResults&gt;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+74</span><span class="line-content">    pub daily_results: BTreeMap&lt;NaiveDate, DailyResults&gt;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">75</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">76</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">77</span><span class="line-content">index 83deedbb20..6fb37bc87e 100644<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs</div>
<div class="hunk-header">@@ -1,6 +1,6 @@</div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> use crate::performance_based_algorithm::results::RewardsCalculatorResults;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use crate::performance_based_algorithm::{DataProvider, PerformanceBasedAlgorithm};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-3</span><span class="line-content">use crate::types::DayUtc;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+3</span><span class="line-content">use chrono::NaiveDate;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use ic_base_types::PrincipalId;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use rust_decimal::Decimal;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use rust_decimal_macros::dec;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -36,14 +36,14 @@ impl PerformanceBasedAlgorithm for RewardsCalculationV1 {</div>
<div class="line context"><span class="line-number">36</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">37</span><span class="line-content"> impl RewardsCalculationV1 {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">38</span><span class="line-content">     pub fn calculate_rewards(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-39</span><span class="line-content">        from_day: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-40</span><span class="line-content">        to_day: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+39</span><span class="line-content">        from_date: &amp;NaiveDate,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+40</span><span class="line-content">        to_date: &amp;NaiveDate,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">41</span><span class="line-content">         node_provider_filter: Option&lt;PrincipalId&gt;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">42</span><span class="line-content">         data_provider: impl DataProvider,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">43</span><span class="line-content">     ) -&gt; Result&lt;RewardsCalculatorResults, String&gt; {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">44</span><span class="line-content">         &lt;RewardsCalculationV1 as PerformanceBasedAlgorithm&gt;::calculate_rewards(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-45</span><span class="line-content">            from_day,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-46</span><span class="line-content">            to_day,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+45</span><span class="line-content">            from_date,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+46</span><span class="line-content">            to_date,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">47</span><span class="line-content">             node_provider_filter,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">48</span><span class="line-content">             data_provider,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">49</span><span class="line-content">         )<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">50</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/types.rs b/rs/node_rewards/rewards_calculation/src/types.rs<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">51</span><span class="line-content">index ec99adce94..22fc702296 100644<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/types.rs</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/types.rs</div>
<div class="hunk-header">@@ -1,139 +1,10 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">use chrono::{DateTime, NaiveDateTime, ParseError, Utc};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> use ic_base_types::NodeId;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/types.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use ic_protobuf::registry::node::v1::NodeRewardType;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/types.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-4</span><span class="line-content">use ic_types::Time;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-5</span><span class="line-content">use serde::{Deserialize, Serialize};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-6</span><span class="line-content">use std::fmt;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content">use std::fmt::Display;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/types.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> pub type UnixTsNanos = u64;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/types.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> pub type NodesCount = u64;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/types.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> pub type Region = String;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/types.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/types.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-13</span><span class="line-content">const NANOS_PER_DAY: UnixTsNanos = 24 * 60 * 60 * 1_000_000_000;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-14</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-15</span><span class="line-content">#[derive(Clone, Debug, PartialEq, Hash, PartialOrd, Ord, Eq, Copy, Deserialize, Serialize)]<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-16</span><span class="line-content">pub struct DayUtc {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-17</span><span class="line-content">    last_ts_nanoseconds: u64,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-18</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-19</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-20</span><span class="line-content">impl DayUtc {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-21</span><span class="line-content">    pub fn from_nanos(value: u64) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-22</span><span class="line-content">        let last_ts_nanoseconds = value<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-23</span><span class="line-content">            .checked_div(NANOS_PER_DAY)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-24</span><span class="line-content">            .and_then(|v| v.checked_add(1))<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-25</span><span class="line-content">            .and_then(|v| v.checked_mul(NANOS_PER_DAY))<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-26</span><span class="line-content">            .and_then(|v| v.checked_sub(1))<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-27</span><span class="line-content">            .unwrap();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-28</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-29</span><span class="line-content">        Self {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-30</span><span class="line-content">            last_ts_nanoseconds,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-31</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-32</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-33</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-34</span><span class="line-content">    pub fn from_secs(value: u64) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-35</span><span class="line-content">        let nanos = value * 1_000_000_000;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-36</span><span class="line-content">        Self::from_nanos(nanos)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-37</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-38</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-39</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-40</span><span class="line-content">impl From&lt;Time&gt; for DayUtc {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-41</span><span class="line-content">    fn from(value: Time) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-42</span><span class="line-content">        Self::from_nanos(value.as_nanos_since_unix_epoch())<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-43</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-44</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-45</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-46</span><span class="line-content">impl Display for DayUtc {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-47</span><span class="line-content">    fn fmt(&amp;self, f: &amp;mut fmt::Formatter&lt;&#x27;_&gt;) -&gt; fmt::Result {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-48</span><span class="line-content">        let dd_mm_yyyy =<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-49</span><span class="line-content">            DateTime::from_timestamp_nanos(self.unix_timestamp_at_day_end_nanoseconds() as i64)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-50</span><span class="line-content">                .naive_utc()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-51</span><span class="line-content">                .format(&quot;%d-%m-%Y&quot;)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-52</span><span class="line-content">                .to_string();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-53</span><span class="line-content">        write!(f, &quot;{}&quot;, dd_mm_yyyy)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-54</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-55</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-56</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-57</span><span class="line-content">impl TryFrom&lt;&amp;str&gt; for DayUtc {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-58</span><span class="line-content">    type Error = ParseError;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-59</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-60</span><span class="line-content">    fn try_from(value: &amp;str) -&gt; Result&lt;Self, Self::Error&gt; {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-61</span><span class="line-content">        let dt = format!(&quot;{} 00:00:00&quot;, value);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-62</span><span class="line-content">        let naive = NaiveDateTime::parse_from_str(&amp;dt, &quot;%Y-%m-%d %H:%M:%S&quot;)?;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-63</span><span class="line-content">        let datetime: DateTime&lt;Utc&gt; = DateTime::from_naive_utc_and_offset(naive, Utc);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-64</span><span class="line-content">        let ts = datetime.timestamp_nanos_opt().unwrap() as u64;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-65</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-66</span><span class="line-content">        Ok(DayUtc::from_nanos(ts))<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-67</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-68</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-69</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-70</span><span class="line-content">impl Default for DayUtc {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-71</span><span class="line-content">    fn default() -&gt; Self {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-72</span><span class="line-content">        DayUtc::from_nanos(0)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-73</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-74</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-75</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-76</span><span class="line-content">impl DayUtc {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-77</span><span class="line-content">    pub fn unix_timestamp_at_day_end_nanoseconds(&amp;self) -&gt; u64 {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-78</span><span class="line-content">        self.last_ts_nanoseconds<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-79</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-80</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-81</span><span class="line-content">    pub fn unix_timestamp_at_day_start_nanoseconds(&amp;self) -&gt; u64 {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-82</span><span class="line-content">        let extra = self.last_ts_nanoseconds.checked_rem(NANOS_PER_DAY).unwrap();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-83</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-84</span><span class="line-content">        self.last_ts_nanoseconds.saturating_sub(extra)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-85</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-86</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-87</span><span class="line-content">    pub fn unix_timestamp_at_day_end_seconds(&amp;self) -&gt; u64 {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-88</span><span class="line-content">        self.unix_timestamp_at_day_end_nanoseconds()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-89</span><span class="line-content">            .checked_div(1_000_000_000)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-90</span><span class="line-content">            .unwrap()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-91</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-92</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-93</span><span class="line-content">    pub fn unix_timestamp_at_day_start_seconds(&amp;self) -&gt; u64 {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-94</span><span class="line-content">        self.unix_timestamp_at_day_start_nanoseconds()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L94" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-95</span><span class="line-content">            .checked_div(1_000_000_000)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-96</span><span class="line-content">            .expect(&quot;underflow detected in first_ts_secs&quot;)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L96" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-97</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-98</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L98" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-99</span><span class="line-content">    pub fn next_day(&amp;self) -&gt; DayUtc {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-100</span><span class="line-content">        DayUtc {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L100" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-101</span><span class="line-content">            last_ts_nanoseconds: self<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L101" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-102</span><span class="line-content">                .last_ts_nanoseconds<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-103</span><span class="line-content">                .checked_add(NANOS_PER_DAY)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-104</span><span class="line-content">                .expect(&quot;overflow detected in next_day&quot;),<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L104" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-105</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L105" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-106</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L106" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-107</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L107" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-108</span><span class="line-content">    pub fn previous_day(&amp;self) -&gt; DayUtc {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L108" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-109</span><span class="line-content">        let ts_previous_day = self<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L109" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-110</span><span class="line-content">            .last_ts_nanoseconds<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L110" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-111</span><span class="line-content">            .checked_sub(NANOS_PER_DAY)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L111" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-112</span><span class="line-content">            .unwrap_or_default();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L112" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-113</span><span class="line-content">        DayUtc {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L113" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-114</span><span class="line-content">            last_ts_nanoseconds: ts_previous_day,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L114" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-115</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L115" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-116</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L116" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-117</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L117" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-118</span><span class="line-content">    pub fn days_until(&amp;self, other: &amp;DayUtc) -&gt; Result&lt;Vec&lt;DayUtc&gt;, String&gt; {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L118" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-119</span><span class="line-content">        if self &gt; other {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L119" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-120</span><span class="line-content">            return Err(format!(<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L120" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-121</span><span class="line-content">                &quot;Cannot compute days_until: {} &gt; {}&quot;,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L121" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-122</span><span class="line-content">                self.last_ts_nanoseconds, other.last_ts_nanoseconds<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L122" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-123</span><span class="line-content">            ));<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L123" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-124</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L124" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-125</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L125" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-126</span><span class="line-content">        let num_days = (other.last_ts_nanoseconds - self.last_ts_nanoseconds) / NANOS_PER_DAY;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L126" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-127</span><span class="line-content">        let days_until = (0..=num_days)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L127" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-128</span><span class="line-content">            .map(|i| DayUtc {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L128" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-129</span><span class="line-content">                last_ts_nanoseconds: self.last_ts_nanoseconds + i * NANOS_PER_DAY,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L129" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-130</span><span class="line-content">            })<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L130" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-131</span><span class="line-content">            .collect();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L131" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-132</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L132" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-133</span><span class="line-content">        Ok(days_until)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L133" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-134</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L134" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-135</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L135" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-136</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L136" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> #[derive(Clone, Debug, PartialEq, Eq, PartialOrd, Ord)]<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/types.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> pub struct NodeMetricsDailyRaw {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/types.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content">     pub node_id: NodeId,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/types.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -148,32 +19,3 @@ pub struct RewardableNode {</div>
<div class="line context"><span class="line-number">19</span><span class="line-content">     pub node_reward_type: NodeRewardType,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/types.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">20</span><span class="line-content">     pub dc_id: String,<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/types.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">21</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9/rs/node_rewards/rewards_calculation/src/types.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-151</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L151" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-152</span><span class="line-content">#[cfg(test)]<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L152" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-153</span><span class="line-content">mod tests {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L153" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-154</span><span class="line-content">    use super::*;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L154" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-155</span><span class="line-content">    use crate::types::UnixTsNanos;<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L155" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-156</span><span class="line-content">    use chrono::{TimeZone, Utc};<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L156" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-157</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L157" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-158</span><span class="line-content">    fn ymdh_to_ts(year: i32, month: u32, day: u32, hour: u32) -&gt; UnixTsNanos {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L158" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-159</span><span class="line-content">        Utc.with_ymd_and_hms(year, month, day, hour, 0, 0)<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L159" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-160</span><span class="line-content">            .unwrap()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L160" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-161</span><span class="line-content">            .timestamp_nanos_opt()<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L161" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-162</span><span class="line-content">            .unwrap() as UnixTsNanos<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L162" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-163</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L163" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-164</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L164" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-165</span><span class="line-content">    #[test]<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L165" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-166</span><span class="line-content">    fn test_valid_rewarding_period() {<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L166" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-167</span><span class="line-content">        let from_day: DayUtc = DayUtc::from_nanos(ymdh_to_ts(2020, 1, 12, 0));<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L167" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-168</span><span class="line-content">        let to_day: DayUtc = DayUtc::from_nanos(ymdh_to_ts(2020, 1, 15, 0));<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L168" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-169</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L169" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-170</span><span class="line-content">        let days = from_day.days_until(&amp;to_day).unwrap().len();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L170" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-171</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L171" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-172</span><span class="line-content">        assert_eq!(days, 4);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L172" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-173</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L173" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-174</span><span class="line-content">        let to_day = DayUtc::from_nanos(ymdh_to_ts(2020, 1, 12, 13));<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L174" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-175</span><span class="line-content">        let days = from_day.days_until(&amp;to_day).unwrap().len();<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L175" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-176</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L176" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-177</span><span class="line-content">        assert_eq!(days, 1);<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L177" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-178</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L178" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-179</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/2851d16acbe87159f58348a9c9f4e10f34f488b9~1/rs/node_rewards/rewards_calculation/src/types.rs#L179" class="github-link" target="_blank">🔗</a></span></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="commit-detail">
                    <div class="commit-header">
                        <div class="commit-title">
                            <a href="https://github.com/dfinity/ic/commit/d161192b1376423686e5a826b7affb0da7bc868c" class="commit-hash-large" target="_blank">d161192b1376423686e5a826b7affb0da7bc868c</a>
                            <span class="badge chore">chore</span>
                        </div>
                        <div class="commit-meta">
                            <span>👤 Mathias Björkqvist &lt;mathias.bjorkqvist@dfinity.org&gt;</span>
                            <span>📅 2025-09-26</span>
                            <span>📁 1 files</span>
                        </div>
                        <div style="margin-top: 8px; color: #e6edf3; font-size: 0.9em;">
                            chore(ICP_Ledger): FI-1845: Remove ICP ledger notify-method feature (#6717)
                        </div>
                        <div class="commit-actions">
                            <button class="toggle-button secondary" onclick="toggleFiles('files-4')">📁 Files (1)</button>
                            <button class="toggle-button" onclick="toggleDiff('diff-4')">🔍 Code Changes</button>
                        </div>
                        <div id="files-4" class="collapsible">
                            <div class="files-list">
                                <ul><li>rs/node_rewards/canister/BUILD.bazel</li></ul></div></div>
                        <div id="diff-4" class="collapsible">
                            <div class="diff-container">
                                <div class="line context"><span class="line-number">1</span><span class="line-content">commit d161192b1376423686e5a826b7affb0da7bc868c</span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content">Author: Mathias Björkqvist &lt;mathias.bjorkqvist@dfinity.org&gt;</span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content">Date:   Fri Sep 26 12:36:09 2025 +0200</span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content">    chore(ICP_Ledger): FI-1845: Remove ICP ledger notify-method feature (#6717)</span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content">    Remove the `notify-method` feature from the ICP ledger canister. The</span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content">    `notify` endpoint is still exported, but traps when called. Since many</span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content">    consumers still expect the `ledger-canister_notify-method.wasm.gz` file,</span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content">    this is still being built and uploaded to the CDN, but it is identical</span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content">    to the `ledger-canister.wasm.gz` file. Subsequent ICP ledger suite</span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">    releases will include both (identical) files, and at some later point,</span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content">    the `ledger-canister_notify-method.wasm.gz` will be removed.</span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content">diff --git a/rs/node_rewards/canister/BUILD.bazel b/rs/node_rewards/canister/BUILD.bazel</span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content">index f640f6783a..5a7f643961 100644</span></div>
<div class="file-header">--- a/rs/node_rewards/canister/BUILD.bazel</div>
<div class="file-header">+++ b/rs/node_rewards/canister/BUILD.bazel</div>
<div class="hunk-header">@@ -61,7 +61,7 @@ DEV_DATA = [</div>
<div class="line context"><span class="line-number">61</span><span class="line-content">     # Keep sorted.<a href="https://github.com/dfinity/ic/blob/d161192b1376423686e5a826b7affb0da7bc868c/rs/node_rewards/canister/BUILD.bazel#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">62</span><span class="line-content">     &quot;:node-rewards-canister&quot;,<a href="https://github.com/dfinity/ic/blob/d161192b1376423686e5a826b7affb0da7bc868c/rs/node_rewards/canister/BUILD.bazel#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">63</span><span class="line-content">     &quot;:node-rewards-canister-test&quot;,<a href="https://github.com/dfinity/ic/blob/d161192b1376423686e5a826b7affb0da7bc868c/rs/node_rewards/canister/BUILD.bazel#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-64</span><span class="line-content">    &quot;//rs/ledger_suite/icp/ledger:ledger-canister-wasm-notify-method&quot;,<a href="https://github.com/dfinity/ic/blob/d161192b1376423686e5a826b7affb0da7bc868c~1/rs/node_rewards/canister/BUILD.bazel#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+64</span><span class="line-content">    &quot;//rs/ledger_suite/icp/ledger:ledger-canister-wasm&quot;,<a href="https://github.com/dfinity/ic/blob/d161192b1376423686e5a826b7affb0da7bc868c/rs/node_rewards/canister/BUILD.bazel#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">65</span><span class="line-content">     &quot;//rs/nns/cmc:cycles-minting-canister&quot;,<a href="https://github.com/dfinity/ic/blob/d161192b1376423686e5a826b7affb0da7bc868c/rs/node_rewards/canister/BUILD.bazel#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">66</span><span class="line-content">     &quot;//rs/nns/governance:governance-canister&quot;,<a href="https://github.com/dfinity/ic/blob/d161192b1376423686e5a826b7affb0da7bc868c/rs/node_rewards/canister/BUILD.bazel#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">67</span><span class="line-content">     &quot;//rs/nns/governance:governance-canister-test&quot;,<a href="https://github.com/dfinity/ic/blob/d161192b1376423686e5a826b7affb0da7bc868c/rs/node_rewards/canister/BUILD.bazel#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -82,7 +82,7 @@ DEV_ENV = {</div>
<div class="line context"><span class="line-number">82</span><span class="line-content">     &quot;GENESIS_TOKEN_CANISTER_WASM_PATH&quot;: &quot;$(rootpath //rs/nns/gtc:genesis-token-canister)&quot;,<a href="https://github.com/dfinity/ic/blob/d161192b1376423686e5a826b7affb0da7bc868c/rs/node_rewards/canister/BUILD.bazel#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">83</span><span class="line-content">     &quot;GOVERNANCE_CANISTER_WASM_PATH&quot;: &quot;$(rootpath //rs/nns/governance:governance-canister)&quot;,<a href="https://github.com/dfinity/ic/blob/d161192b1376423686e5a826b7affb0da7bc868c/rs/node_rewards/canister/BUILD.bazel#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">84</span><span class="line-content">     &quot;GOVERNANCE_CANISTER_TEST_WASM_PATH&quot;: &quot;$(rootpath //rs/nns/governance:governance-canister-test)&quot;,<a href="https://github.com/dfinity/ic/blob/d161192b1376423686e5a826b7affb0da7bc868c/rs/node_rewards/canister/BUILD.bazel#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-85</span><span class="line-content">    &quot;LEDGER_CANISTER_NOTIFY_METHOD_WASM_PATH&quot;: &quot;$(rootpath //rs/ledger_suite/icp/ledger:ledger-canister-wasm-notify-method)&quot;,<a href="https://github.com/dfinity/ic/blob/d161192b1376423686e5a826b7affb0da7bc868c~1/rs/node_rewards/canister/BUILD.bazel#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+85</span><span class="line-content">    &quot;LEDGER_CANISTER_WASM_PATH&quot;: &quot;$(rootpath //rs/ledger_suite/icp/ledger:ledger-canister-wasm)&quot;,<a href="https://github.com/dfinity/ic/blob/d161192b1376423686e5a826b7affb0da7bc868c/rs/node_rewards/canister/BUILD.bazel#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">86</span><span class="line-content">     &quot;LIFELINE_CANISTER_WASM_PATH&quot;: &quot;$(rootpath //rs/nns/handlers/lifeline/impl:lifeline_canister)&quot;,<a href="https://github.com/dfinity/ic/blob/d161192b1376423686e5a826b7affb0da7bc868c/rs/node_rewards/canister/BUILD.bazel#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">87</span><span class="line-content">     &quot;REGISTRY_CANISTER_WASM_PATH&quot;: &quot;$(rootpath //rs/registry/canister:registry-canister)&quot;,<a href="https://github.com/dfinity/ic/blob/d161192b1376423686e5a826b7affb0da7bc868c/rs/node_rewards/canister/BUILD.bazel#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">88</span><span class="line-content">     &quot;ROOT_CANISTER_WASM_PATH&quot;: &quot;$(rootpath //rs/nns/handlers/root/impl:root-canister)&quot;,<a href="https://github.com/dfinity/ic/blob/d161192b1376423686e5a826b7affb0da7bc868c/rs/node_rewards/canister/BUILD.bazel#L88" class="github-link" target="_blank">🔗</a></span></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="commit-detail">
                    <div class="commit-header">
                        <div class="commit-title">
                            <a href="https://github.com/dfinity/ic/commit/ef7cd8fdf88c3fae338854a378cf284522d8357c" class="commit-hash-large" target="_blank">ef7cd8fdf88c3fae338854a378cf284522d8357c</a>
                            <span class="badge fix">fix</span>
                        </div>
                        <div class="commit-meta">
                            <span>👤 pietrodimarco-dfinity &lt;124565147+pietrodimarco-dfinity@users.noreply.github.com&gt;</span>
                            <span>📅 2025-09-25</span>
                            <span>📁 17 files</span>
                        </div>
                        <div style="margin-top: 8px; color: #e6edf3; font-size: 0.9em;">
                            fix(node-rewards-canister): Consolidate DayUtc type (#6853)
                        </div>
                        <div class="commit-actions">
                            <button class="toggle-button secondary" onclick="toggleFiles('files-5')">📁 Files (17)</button>
                            <button class="toggle-button" onclick="toggleDiff('diff-5')">🔍 Code Changes</button>
                        </div>
                        <div id="files-5" class="collapsible">
                            <div class="files-list">
                                <ul><li>rs/node_rewards/canister/api/BUILD.bazel</li><li>rs/node_rewards/canister/api/Cargo.toml</li><li>rs/node_rewards/canister/api/src/lib.rs</li><li>rs/node_rewards/canister/api/src/provider_rewards_calculation.rs</li><li>rs/node_rewards/canister/api/src/providers_rewards.rs</li><li>rs/node_rewards/canister/node-rewards-canister.did</li><li>rs/node_rewards/canister/src/api_conversion.rs</li><li>rs/node_rewards/canister/src/canister/mod.rs</li><li>rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs</li><li>rs/node_rewards/canister/src/metrics.rs</li><li>rs/node_rewards/canister/src/metrics/tests.rs</li><li>rs/node_rewards/canister/src/registry_querier.rs</li><li>rs/node_rewards/canister/src/registry_querier/tests.rs</li><li>rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs</li><li>rs/node_rewards/rewards_calculation/BUILD.bazel</li><li>rs/node_rewards/rewards_calculation/Cargo.toml</li><li>rs/node_rewards/rewards_calculation/src/types.rs</li></ul></div></div>
                        <div id="diff-5" class="collapsible">
                            <div class="diff-container">
                                <div class="line context"><span class="line-number">1</span><span class="line-content">commit ef7cd8fdf88c3fae338854a378cf284522d8357c</span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content">Author: pietrodimarco-dfinity &lt;124565147+pietrodimarco-dfinity@users.noreply.github.com&gt;</span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content">Date:   Thu Sep 25 19:41:33 2025 +0200</span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content">    fix(node-rewards-canister): Consolidate DayUtc type (#6853)</span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content">    This introduces some breaking changes to the Node Rewards canister API,</span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content">    but that is ok, because nobody is calling it yet.</span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content">    ---------</span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">    Co-authored-by: Daniel Wong &lt;97631336+daniel-wong-dfinity-org@users.noreply.github.com&gt;</span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content">diff --git a/rs/node_rewards/canister/api/BUILD.bazel b/rs/node_rewards/canister/api/BUILD.bazel</span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content">index 5cede2d4c8..a577bcc4cc 100644</span></div>
<div class="file-header">--- a/rs/node_rewards/canister/api/BUILD.bazel</div>
<div class="file-header">+++ b/rs/node_rewards/canister/api/BUILD.bazel</div>
<div class="hunk-header">@@ -5,6 +5,7 @@ package(default_visibility = [&quot;//visibility:public&quot;])</div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> DEPENDENCIES = [<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/BUILD.bazel#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content">     # Keep sorted.<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/BUILD.bazel#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content">     &quot;//rs/nervous_system/proto&quot;,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/BUILD.bazel#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content">    &quot;//rs/node_rewards/rewards_calculation&quot;,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/BUILD.bazel#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content">     &quot;//rs/types/base_types&quot;,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/BUILD.bazel#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content">     &quot;@crate_index//:candid&quot;,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/BUILD.bazel#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content">     &quot;@crate_index//:ic-cdk&quot;,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/BUILD.bazel#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">diff --git a/rs/node_rewards/canister/api/Cargo.toml b/rs/node_rewards/canister/api/Cargo.toml<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/BUILD.bazel#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content">index 4c7ddb9b62..decff706f9 100644<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/BUILD.bazel#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/api/Cargo.toml</div>
<div class="file-header">+++ b/rs/node_rewards/canister/api/Cargo.toml</div>
<div class="hunk-header">@@ -12,5 +12,6 @@ path = &quot;src/lib.rs&quot;</div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> [dependencies]<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/Cargo.toml#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> candid = { workspace = true }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/Cargo.toml#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> ic-base-types = { path = &quot;../../../types/base_types&quot; }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/Cargo.toml#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+15</span><span class="line-content">rewards-calculation = { path = &quot;../../rewards_calculation&quot; }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/Cargo.toml#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> ic-nervous-system-proto = { path = &quot;../../../nervous_system/proto&quot; }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/Cargo.toml#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content"> serde = { workspace = true }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/Cargo.toml#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content">diff --git a/rs/node_rewards/canister/api/src/lib.rs b/rs/node_rewards/canister/api/src/lib.rs<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/Cargo.toml#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content">index 1647c81b1f..15ce9c70ea 100644<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/Cargo.toml#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/api/src/lib.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/api/src/lib.rs</div>
<div class="hunk-header">@@ -1,3 +1,43 @@</div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> pub mod monthly_rewards;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> pub mod provider_rewards_calculation;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> pub mod providers_rewards;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+4</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+5</span><span class="line-content">use rewards_calculation::types as native_types;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+6</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+7</span><span class="line-content">// These are API-facing types with all fields wrapped in `Option`<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content">// to ensure deserialization always works<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+9</span><span class="line-content">// in the future without breaking clients that consume the API.<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+10</span><span class="line-content">#[derive(<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+11</span><span class="line-content">    PartialOrd, Ord, Eq, candid::CandidType, candid::Deserialize, Clone, Copy, PartialEq, Debug,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+12</span><span class="line-content">)]<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+13</span><span class="line-content">pub struct DayUtc {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+14</span><span class="line-content">    last_ts_nanoseconds: Option&lt;u64&gt;,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+15</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+16</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+17</span><span class="line-content">impl DayUtc {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+18</span><span class="line-content">    pub fn from_nanos(nanos_since_unix_epoch: u64) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+19</span><span class="line-content">        Self::from(native_types::DayUtc::from_nanos(nanos_since_unix_epoch))<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+20</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+21</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+22</span><span class="line-content">    pub fn from_secs(secs_since_unix_epoch: u64) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+23</span><span class="line-content">        Self::from(native_types::DayUtc::from_secs(secs_since_unix_epoch))<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+24</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+25</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+26</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+27</span><span class="line-content">impl From&lt;native_types::DayUtc&gt; for DayUtc {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+28</span><span class="line-content">    fn from(day_utc: native_types::DayUtc) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+29</span><span class="line-content">        Self {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+30</span><span class="line-content">            last_ts_nanoseconds: Some(day_utc.unix_timestamp_at_day_end_nanoseconds()),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+31</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+32</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+33</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+34</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+35</span><span class="line-content">impl From&lt;DayUtc&gt; for native_types::DayUtc {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+36</span><span class="line-content">    fn from(day_utc: DayUtc) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+37</span><span class="line-content">        native_types::DayUtc::from_nanos(<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+38</span><span class="line-content">            day_utc<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+39</span><span class="line-content">                .last_ts_nanoseconds<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+40</span><span class="line-content">                .expect(&quot;last_ts_nanoseconds is None&quot;),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+41</span><span class="line-content">        )<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+42</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+43</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">44</span><span class="line-content">diff --git a/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs b/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">45</span><span class="line-content">index 96d677460b..984536628c 100644<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/lib.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs</div>
<div class="hunk-header">@@ -1,23 +1,20 @@</div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">pub use crate::DayUtc;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use candid::{CandidType, Deserialize, Principal};<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use ic_base_types::PrincipalId;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use ic_nervous_system_proto::pb::v1::Decimal;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> #[derive(CandidType, Clone, Deserialize)]<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> pub struct GetNodeProviderRewardsCalculationRequest {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content">    pub from_day_timestamp_nanos: u64,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-8</span><span class="line-content">    pub to_day_timestamp_nanos: u64,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content">    pub from_day: DayUtc,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+9</span><span class="line-content">    pub to_day: DayUtc,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content">     pub provider_id: Principal,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> pub type GetNodeProviderRewardsCalculationResponse = Result&lt;Vec&lt;NodeProviderRewardsDaily&gt;, String&gt;;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-14</span><span class="line-content">#[derive(<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-15</span><span class="line-content">    PartialOrd, Ord, Eq, candid::CandidType, candid::Deserialize, Clone, Copy, PartialEq, Debug,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-16</span><span class="line-content">)]<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-17</span><span class="line-content">pub struct DayUtc {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-18</span><span class="line-content">    pub value: Option&lt;u64&gt;,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-19</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-20</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+15</span><span class="line-content">// These are API-facing types with all fields wrapped in `Option`<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+16</span><span class="line-content">// to ensure forward compatibility. This way, new fields can be added<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+17</span><span class="line-content">// in the future without breaking clients that consume the API.<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content"> #[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content"> pub struct NodeMetricsDaily {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">20</span><span class="line-content">     pub subnet_assigned: Option&lt;PrincipalId&gt;,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">21</span><span class="line-content">diff --git a/rs/node_rewards/canister/api/src/providers_rewards.rs b/rs/node_rewards/canister/api/src/providers_rewards.rs<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">22</span><span class="line-content">index 20f39b035f..dc4fb8cafc 100644<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/api/src/providers_rewards.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/api/src/providers_rewards.rs</div>
<div class="hunk-header">@@ -1,10 +1,11 @@</div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">use crate::DayUtc;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/providers_rewards.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use candid::{CandidType, Deserialize, Principal};<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/providers_rewards.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use std::collections::BTreeMap;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/providers_rewards.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/providers_rewards.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> #[derive(CandidType, Clone, Deserialize)]<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/providers_rewards.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> pub struct GetNodeProvidersRewardsRequest {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/providers_rewards.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-6</span><span class="line-content">    pub from_day_timestamp_nanos: u64,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/api/src/providers_rewards.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content">    pub to_day_timestamp_nanos: u64,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/api/src/providers_rewards.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+7</span><span class="line-content">    pub from_day: DayUtc,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/providers_rewards.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content">    pub to_day: DayUtc,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/providers_rewards.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/providers_rewards.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> pub type GetNodeProvidersRewardsResponse = Result&lt;NodeProvidersRewards, String&gt;;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/providers_rewards.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/providers_rewards.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">diff --git a/rs/node_rewards/canister/node-rewards-canister.did b/rs/node_rewards/canister/node-rewards-canister.did<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/providers_rewards.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content">index c79541bd5c..ddd78881cd 100644<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/api/src/providers_rewards.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/node-rewards-canister.did</div>
<div class="file-header">+++ b/rs/node_rewards/canister/node-rewards-canister.did</div>
<div class="hunk-header">@@ -5,7 +5,7 @@ type Decimal = record {</div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/node-rewards-canister.did#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/node-rewards-canister.did#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> type DayUtc = record {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/node-rewards-canister.did#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-8</span><span class="line-content">  value: opt nat64;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/node-rewards-canister.did#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content">  last_ts_nanoseconds: opt nat64;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/node-rewards-canister.did#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/node-rewards-canister.did#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/node-rewards-canister.did#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> type NodeMetricsDaily = record {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/node-rewards-canister.did#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -64,8 +64,8 @@ type NodeProviderRewardsDaily = record {</div>
<div class="line context"><span class="line-number">64</span><span class="line-content"> type GetNodeProviderRewardsCalculationResponse = variant { Ok: vec NodeProviderRewardsDaily; Err: text };<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/node-rewards-canister.did#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">65</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/node-rewards-canister.did#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">66</span><span class="line-content"> type GetNodeProviderRewardsCalculationRequest = record {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/node-rewards-canister.did#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-67</span><span class="line-content">  from_day_timestamp_nanos: nat64;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/node-rewards-canister.did#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-68</span><span class="line-content">  to_day_timestamp_nanos: nat64;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/node-rewards-canister.did#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+67</span><span class="line-content">  from_day: DayUtc;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/node-rewards-canister.did#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+68</span><span class="line-content">  to_day: DayUtc;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/node-rewards-canister.did#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">69</span><span class="line-content">   provider_id: principal;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/node-rewards-canister.did#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">70</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/node-rewards-canister.did#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">71</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/node-rewards-canister.did#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -79,8 +79,8 @@ type NodeProvidersRewards = record {</div>
<div class="line context"><span class="line-number">79</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/node-rewards-canister.did#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">80</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/node-rewards-canister.did#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">81</span><span class="line-content"> type GetNodeProvidersRewardsRequest = record {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/node-rewards-canister.did#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-82</span><span class="line-content">  from_day_timestamp_nanos: nat64;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/node-rewards-canister.did#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-83</span><span class="line-content">  to_day_timestamp_nanos: nat64;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/node-rewards-canister.did#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+82</span><span class="line-content">  from_day: DayUtc;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/node-rewards-canister.did#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+83</span><span class="line-content">  to_day: DayUtc;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/node-rewards-canister.did#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">84</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/node-rewards-canister.did#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">85</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/node-rewards-canister.did#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">86</span><span class="line-content"> type GetNodeProvidersRewardsResponse = variant { Ok: NodeProvidersRewards; Err: text };<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/node-rewards-canister.did#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">87</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/api_conversion.rs b/rs/node_rewards/canister/src/api_conversion.rs<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/node-rewards-canister.did#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">88</span><span class="line-content">index 98ce409b69..02079e373f 100644<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/node-rewards-canister.did#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/api_conversion.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/api_conversion.rs</div>
<div class="hunk-header">@@ -1,6 +1,6 @@</div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> use ic_base_types::PrincipalId;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/api_conversion.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use ic_node_rewards_canister_api::provider_rewards_calculation::{<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/api_conversion.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-3</span><span class="line-content">    BaseRewards as BaseRewardsCandid, BaseRewardsType3 as BaseRewardsType3Candid, DayUtc,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/api_conversion.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+3</span><span class="line-content">    BaseRewards as BaseRewardsCandid, BaseRewardsType3 as BaseRewardsType3Candid,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/api_conversion.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content">     GetNodeProviderRewardsCalculationResponse, NodeMetricsDaily as NodeMetricsDailyCandid,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/api_conversion.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content">     NodeProviderRewards as NodeProviderRewardsCandid, NodeProviderRewardsDaily,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/api_conversion.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content">     NodeResults as NodeResultsCandid, NodeStatus as NodeStatusCandid,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/api_conversion.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -88,9 +88,7 @@ pub fn into_rewards_calculation_results(</div>
<div class="line context"><span class="line-number">88</span><span class="line-content">         };<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/api_conversion.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">89</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/api_conversion.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">90</span><span class="line-content">         daily_rewards.push(NodeProviderRewardsDaily {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/api_conversion.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-91</span><span class="line-content">            day_utc: Some(DayUtc {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/api_conversion.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-92</span><span class="line-content">                value: Some(day.unix_ts_at_day_end_nanoseconds()),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/api_conversion.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-93</span><span class="line-content">            }),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/api_conversion.rs#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+91</span><span class="line-content">            day_utc: Some(day.into()),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/api_conversion.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">92</span><span class="line-content">             node_provider_rewards: Some(node_provider_rewards),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/api_conversion.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">93</span><span class="line-content">         });<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/api_conversion.rs#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">94</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/api_conversion.rs#L94" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">95</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/canister/mod.rs b/rs/node_rewards/canister/src/canister/mod.rs<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/api_conversion.rs#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">96</span><span class="line-content">index 20eef68823..e613b42873 100644<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/api_conversion.rs#L96" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/canister/mod.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/canister/mod.rs</div>
<div class="hunk-header">@@ -128,7 +128,7 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">128</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L128" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">129</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L129" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">130</span><span class="line-content">     fn validate_reward_period(from_day: &amp;DayUtc, to_day: &amp;DayUtc) -&gt; Result&lt;(), String&gt; {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L130" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-131</span><span class="line-content">        let today: DayUtc = current_time().as_nanos_since_unix_epoch().into();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/canister/mod.rs#L131" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+131</span><span class="line-content">        let today: DayUtc = current_time().into();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L131" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">132</span><span class="line-content">         if from_day &gt; to_day {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L132" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">133</span><span class="line-content">             return Err(&quot;from_day must be before to_day&quot;.to_string());<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L133" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">134</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L134" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -143,8 +143,8 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">143</span><span class="line-content">         request: GetNodeProvidersRewardsRequest,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L143" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">144</span><span class="line-content">         provider_filter: Option&lt;PrincipalId&gt;,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L144" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">145</span><span class="line-content">     ) -&gt; Result&lt;RewardsCalculatorResults, String&gt; {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L145" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-146</span><span class="line-content">        let start_day = DayUtc::from(request.from_day_timestamp_nanos);<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/canister/mod.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-147</span><span class="line-content">        let end_day = DayUtc::from(request.to_day_timestamp_nanos);<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/canister/mod.rs#L147" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+146</span><span class="line-content">        let start_day = request.from_day.into();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+147</span><span class="line-content">        let end_day = request.to_day.into();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L147" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">148</span><span class="line-content">         Self::validate_reward_period(&amp;start_day, &amp;end_day)?;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L148" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">149</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">150</span><span class="line-content">         RewardsCalculationV1::calculate_rewards(&amp;start_day, &amp;end_day, provider_filter, self)<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L150" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -157,7 +157,7 @@ impl rewards_calculation::performance_based_algorithm::DataProvider for &amp;NodeRew</div>
<div class="line context"><span class="line-number">157</span><span class="line-content">         let registry_querier = RegistryQuerier::new(self.registry_client.clone());<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L157" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">158</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L158" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">159</span><span class="line-content">         let version = registry_querier<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L159" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-160</span><span class="line-content">            .version_for_timestamp(day.unix_ts_at_day_end_nanoseconds())<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/canister/mod.rs#L160" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+160</span><span class="line-content">            .version_for_timestamp(day.unix_timestamp_at_day_end_nanoseconds())<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L160" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">161</span><span class="line-content">             .ok_or_else(|| &quot;Could not find registry version for timestamp&quot;.to_string())?;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L161" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">162</span><span class="line-content">         Ok(registry_querier.get_rewards_table(version))<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L162" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">163</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L163" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -168,7 +168,10 @@ impl rewards_calculation::performance_based_algorithm::DataProvider for &amp;NodeRew</div>
<div class="line context"><span class="line-number">168</span><span class="line-content">     ) -&gt; Result&lt;BTreeMap&lt;SubnetId, Vec&lt;NodeMetricsDailyRaw&gt;&gt;, String&gt; {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L168" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">169</span><span class="line-content">         let metrics = self.metrics_manager.metrics_by_subnet(day);<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L169" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">170</span><span class="line-content">         if metrics.is_empty() {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L170" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-171</span><span class="line-content">            return Err(format!(&quot;No metrics found for day {}&quot;, day.get()));<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/canister/mod.rs#L171" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+171</span><span class="line-content">            return Err(format!(<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L171" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+172</span><span class="line-content">                &quot;No metrics found for day {}&quot;,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L172" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+173</span><span class="line-content">                day.unix_timestamp_at_day_end_nanoseconds()<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L173" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+174</span><span class="line-content">            ));<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L174" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">175</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L175" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">176</span><span class="line-content">         Ok(metrics)<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L176" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">177</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L177" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -304,8 +307,8 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">307</span><span class="line-content">     ) -&gt; GetNodeProviderRewardsCalculationResponse {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L307" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">308</span><span class="line-content">         let provider_id = PrincipalId::from(request.provider_id);<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L308" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">309</span><span class="line-content">         let request_inner = GetNodeProvidersRewardsRequest {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L309" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-307</span><span class="line-content">            from_day_timestamp_nanos: request.from_day_timestamp_nanos,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/canister/mod.rs#L307" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-308</span><span class="line-content">            to_day_timestamp_nanos: request.to_day_timestamp_nanos,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/canister/mod.rs#L308" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+310</span><span class="line-content">            from_day: request.from_day,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L310" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+311</span><span class="line-content">            to_day: request.to_day,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L311" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">312</span><span class="line-content">         };<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L312" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">313</span><span class="line-content">         let result = canister<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L313" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">314</span><span class="line-content">             .with_borrow(|canister| canister.calculate_rewards(request_inner, Some(provider_id)))?;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L314" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">315</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs b/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L315" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">316</span><span class="line-content">index 9171eb4ec7..a23ea75201 100644<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/mod.rs#L316" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs</div>
<div class="hunk-header">@@ -188,7 +188,7 @@ fn setup_data_for_test_rewards_calculation(</div>
<div class="line context"><span class="line-number">188</span><span class="line-content">     fake_registry.set_value_at_version_with_timestamp(<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L188" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">189</span><span class="line-content">         make_node_record_key(p1_node3_t31),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L189" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">190</span><span class="line-content">         6,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L190" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-191</span><span class="line-content">        day2.get(),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L191" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+191</span><span class="line-content">        day2.unix_timestamp_at_day_end_nanoseconds(),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L191" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">192</span><span class="line-content">         None,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L192" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">193</span><span class="line-content">     );<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L193" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">194</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L194" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -214,7 +214,7 @@ fn setup_data_for_test_rewards_calculation(</div>
<div class="line context"><span class="line-number">214</span><span class="line-content">     fake_registry.set_value_at_version_with_timestamp(<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L214" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">215</span><span class="line-content">         make_node_record_key(p1_node5_perf),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L215" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">216</span><span class="line-content">         6,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L216" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-217</span><span class="line-content">        day2.get(),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L217" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+217</span><span class="line-content">        day2.unix_timestamp_at_day_end_nanoseconds(),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L217" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">218</span><span class="line-content">         None,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L218" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">219</span><span class="line-content">     );<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L219" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">220</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L220" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -231,7 +231,7 @@ fn setup_data_for_test_rewards_calculation(</div>
<div class="line context"><span class="line-number">231</span><span class="line-content">     fake_registry.set_value_at_version_with_timestamp(<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L231" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">232</span><span class="line-content">         make_node_record_key(p2_node1),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L232" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">233</span><span class="line-content">         6,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L233" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-234</span><span class="line-content">        day2.get(),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L234" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+234</span><span class="line-content">        day2.unix_timestamp_at_day_end_nanoseconds(),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L234" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">235</span><span class="line-content">         None,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L235" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">236</span><span class="line-content">     );<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L236" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">237</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L237" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -241,7 +241,7 @@ fn setup_data_for_test_rewards_calculation(</div>
<div class="line context"><span class="line-number">241</span><span class="line-content">     // Day 1 subnet 1<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L241" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">242</span><span class="line-content">     subnets_metrics.insert(<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L242" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">243</span><span class="line-content">         SubnetMetricsKey {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L243" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-244</span><span class="line-content">            timestamp_nanos: day1.unix_ts_at_day_end_nanoseconds(),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L244" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+244</span><span class="line-content">            timestamp_nanos: day1.unix_timestamp_at_day_end_nanoseconds(),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L244" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">245</span><span class="line-content">             subnet_id: Some(subnet1.get()),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L245" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">246</span><span class="line-content">         },<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L246" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">247</span><span class="line-content">         SubnetMetricsValue {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L247" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -273,7 +273,7 @@ fn setup_data_for_test_rewards_calculation(</div>
<div class="line context"><span class="line-number">273</span><span class="line-content">     // Day 1 subnet 2<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L273" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">274</span><span class="line-content">     subnets_metrics.insert(<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L274" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">275</span><span class="line-content">         SubnetMetricsKey {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L275" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-276</span><span class="line-content">            timestamp_nanos: day1.unix_ts_at_day_end_nanoseconds(),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L276" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+276</span><span class="line-content">            timestamp_nanos: day1.unix_timestamp_at_day_end_nanoseconds(),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L276" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">277</span><span class="line-content">             subnet_id: Some(subnet2.get()),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L277" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">278</span><span class="line-content">         },<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L278" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">279</span><span class="line-content">         SubnetMetricsValue {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L279" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -288,7 +288,7 @@ fn setup_data_for_test_rewards_calculation(</div>
<div class="line context"><span class="line-number">288</span><span class="line-content">     // Day 2 subnet 1<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L288" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">289</span><span class="line-content">     subnets_metrics.insert(<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L289" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">290</span><span class="line-content">         SubnetMetricsKey {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L290" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-291</span><span class="line-content">            timestamp_nanos: day2.unix_ts_at_day_end_nanoseconds(),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L291" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+291</span><span class="line-content">            timestamp_nanos: day2.unix_timestamp_at_day_end_nanoseconds(),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L291" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">292</span><span class="line-content">             subnet_id: Some(subnet1.get()),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L292" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">293</span><span class="line-content">         },<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L293" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">294</span><span class="line-content">         SubnetMetricsValue {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L294" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -313,8 +313,8 @@ fn test_get_node_providers_rewards() {</div>
<div class="line context"><span class="line-number">313</span><span class="line-content">     let to = DayUtc::try_from(&quot;2024-01-02&quot;).unwrap();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L313" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">314</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L314" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">315</span><span class="line-content">     let request = GetNodeProvidersRewardsRequest {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L315" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-316</span><span class="line-content">        from_day_timestamp_nanos: from.unix_ts_at_day_start_nanoseconds(),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L316" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-317</span><span class="line-content">        to_day_timestamp_nanos: to.unix_ts_at_day_end_nanoseconds(),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L317" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+316</span><span class="line-content">        from_day: from.into(),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L316" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+317</span><span class="line-content">        to_day: to.into(),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L317" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">318</span><span class="line-content">     };<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L318" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">319</span><span class="line-content">     let result_endpoint =<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L319" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">320</span><span class="line-content">         NodeRewardsCanister::get_node_providers_rewards(&amp;CANISTER_TEST, request.clone())<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L320" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">321</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/metrics.rs b/rs/node_rewards/canister/src/metrics.rs<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L321" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">322</span><span class="line-content">index 7e7941f079..80a5cc55cc 100644<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L322" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/metrics.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/metrics.rs</div>
<div class="hunk-header">@@ -187,13 +187,15 @@ where</div>
<div class="line context"><span class="line-number">187</span><span class="line-content">         day_utc: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics.rs#L187" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">188</span><span class="line-content">     ) -&gt; BTreeMap&lt;SubnetId, Vec&lt;NodeMetricsDailyRaw&gt;&gt; {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics.rs#L188" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">189</span><span class="line-content">         let mut metrics_by_subnet = BTreeMap::new();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics.rs#L189" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-190</span><span class="line-content">        let previous_day_ts = day_utc.previous_day().unix_ts_at_day_start_nanoseconds();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/metrics.rs#L190" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+190</span><span class="line-content">        let previous_day_ts = day_utc<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics.rs#L190" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+191</span><span class="line-content">            .previous_day()<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics.rs#L191" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+192</span><span class="line-content">            .unix_timestamp_at_day_start_nanoseconds();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics.rs#L192" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">193</span><span class="line-content">         let first_key = SubnetMetricsKey {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics.rs#L193" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">194</span><span class="line-content">             timestamp_nanos: previous_day_ts,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics.rs#L194" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">195</span><span class="line-content">             ..SubnetMetricsKey::min_key()<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics.rs#L195" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">196</span><span class="line-content">         };<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics.rs#L196" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">197</span><span class="line-content">         let last_key = SubnetMetricsKey {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics.rs#L197" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-196</span><span class="line-content">            timestamp_nanos: day_utc.get(),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/metrics.rs#L196" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+198</span><span class="line-content">            timestamp_nanos: day_utc.unix_timestamp_at_day_end_nanoseconds(),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics.rs#L198" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">199</span><span class="line-content">             ..SubnetMetricsKey::max_key()<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics.rs#L199" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">200</span><span class="line-content">         };<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics.rs#L200" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">201</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics.rs#L201" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -201,7 +203,7 @@ where</div>
<div class="line context"><span class="line-number">203</span><span class="line-content">             .subnets_metrics<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics.rs#L203" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">204</span><span class="line-content">             .borrow()<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics.rs#L204" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">205</span><span class="line-content">             .range(first_key..=last_key)<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics.rs#L205" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-204</span><span class="line-content">            .into_group_map_by(|(k, _)| k.timestamp_nanos.into())<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/metrics.rs#L204" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+206</span><span class="line-content">            .into_group_map_by(|(k, _)| DayUtc::from_nanos(k.timestamp_nanos))<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics.rs#L206" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">207</span><span class="line-content">             .into_iter()<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics.rs#L207" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">208</span><span class="line-content">             .collect();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics.rs#L208" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">209</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics.rs#L209" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">210</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/metrics/tests.rs b/rs/node_rewards/canister/src/metrics/tests.rs<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics.rs#L210" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">211</span><span class="line-content">index 8fc016da2f..378cbd5c77 100644<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics.rs#L211" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/metrics/tests.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/metrics/tests.rs</div>
<div class="hunk-header">@@ -250,7 +250,10 @@ impl NodeMetricsHistoryResponseTracker {</div>
<div class="line context"><span class="line-number">250</span><span class="line-content">         for (from, proposed_failed) in metrics {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L250" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">251</span><span class="line-content">             let mut metrics_day = from;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L251" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">252</span><span class="line-content">             for (proposed, failed) in proposed_failed {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L252" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-253</span><span class="line-content">                let entry = self.subnets_responses.entry(metrics_day.get()).or_default();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/metrics/tests.rs#L253" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+253</span><span class="line-content">                let entry = self<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L253" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+254</span><span class="line-content">                    .subnets_responses<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L254" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+255</span><span class="line-content">                    .entry(metrics_day.unix_timestamp_at_day_end_nanoseconds())<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L255" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+256</span><span class="line-content">                    .or_default();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L256" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">257</span><span class="line-content">                 let entry_sub = entry.entry(self.current_subnet).or_default();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L257" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">258</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L258" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">259</span><span class="line-content">                 entry_sub.push(NodeMetrics {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L259" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -295,17 +298,18 @@ impl NodeMetricsHistoryResponseTracker {</div>
<div class="line context"><span class="line-number">298</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L298" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">299</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L299" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">300</span><span class="line-content"> async fn _daily_metrics_correct_different_update_size(size: usize) {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L300" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+301</span><span class="line-content">    let day_start = DayUtc::from_nanos(0);<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L301" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">302</span><span class="line-content">     let tracker = NodeMetricsHistoryResponseTracker::new()<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L302" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">303</span><span class="line-content">         .with_subnet(subnet_id(1))<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L303" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">304</span><span class="line-content">         .add_node_metrics(<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L304" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">305</span><span class="line-content">             node_id(1),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L305" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-302</span><span class="line-content">            vec![(0.into(), vec![(7, 5), (10, 6), (15, 6), (25, 50)])],<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/metrics/tests.rs#L302" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+306</span><span class="line-content">            vec![(day_start, vec![(7, 5), (10, 6), (15, 6), (25, 50)])],<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L306" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">307</span><span class="line-content">         )<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L307" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-304</span><span class="line-content">        .add_node_metrics(node_id(2), vec![(0.into(), vec![(19, 21), (32, 22)])])<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/metrics/tests.rs#L304" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+308</span><span class="line-content">        .add_node_metrics(node_id(2), vec![(day_start, vec![(19, 21), (32, 22)])])<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L308" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">309</span><span class="line-content">         // Node 2 is redeployed to subnet 1 on day 2<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L309" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">310</span><span class="line-content">         .add_node_metrics(<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L310" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">311</span><span class="line-content">             node_id(2),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L311" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-308</span><span class="line-content">            vec![((3 * ONE_DAY_NANOS).into(), vec![(10, 10)])],<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/metrics/tests.rs#L308" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+312</span><span class="line-content">            vec![(day_start.next_day().next_day().next_day(), vec![(10, 10)])],<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L312" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">313</span><span class="line-content">         );<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L313" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">314</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L314" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">315</span><span class="line-content">     let mut mock = mock::MockCanisterClient::new();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L315" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -317,7 +321,7 @@ async fn _daily_metrics_correct_different_update_size(size: usize) {</div>
<div class="line context"><span class="line-number">321</span><span class="line-content">         mm.update_subnets_metrics(vec![subnet_id(1)]).await;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L321" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">322</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L322" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">323</span><span class="line-content">     let daily_metrics: Vec&lt;Vec&lt;NodeMetricsDailyRaw&gt;&gt; =<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L323" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-320</span><span class="line-content">        mm.metrics_by_subnet(&amp;0.into()).into_values().collect();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/metrics/tests.rs#L320" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+324</span><span class="line-content">        mm.metrics_by_subnet(&amp;day_start).into_values().collect();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L324" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">325</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L325" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">326</span><span class="line-content">     println!(&quot;{:?}&quot;, daily_metrics);<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L326" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">327</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L327" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -329,7 +333,7 @@ async fn _daily_metrics_correct_different_update_size(size: usize) {</div>
<div class="line context"><span class="line-number">333</span><span class="line-content">     assert_eq!(daily_metrics[0][1].num_blocks_failed, 21);<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L333" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">334</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L334" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">335</span><span class="line-content">     let daily_metrics: Vec&lt;Vec&lt;NodeMetricsDailyRaw&gt;&gt; = mm<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L335" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-332</span><span class="line-content">        .metrics_by_subnet(&amp;ONE_DAY_NANOS.into())<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/metrics/tests.rs#L332" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+336</span><span class="line-content">        .metrics_by_subnet(&amp;day_start.next_day())<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L336" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">337</span><span class="line-content">         .into_values()<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L337" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">338</span><span class="line-content">         .collect();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L338" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">339</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L339" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -342,7 +346,7 @@ async fn _daily_metrics_correct_different_update_size(size: usize) {</div>
<div class="line context"><span class="line-number">346</span><span class="line-content">     assert_eq!(daily_metrics[0][1].num_blocks_failed, 1);<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L346" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">347</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L347" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">348</span><span class="line-content">     let daily_metrics: Vec&lt;Vec&lt;NodeMetricsDailyRaw&gt;&gt; = mm<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L348" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-345</span><span class="line-content">        .metrics_by_subnet(&amp;(2 * ONE_DAY_NANOS).into())<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/metrics/tests.rs#L345" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+349</span><span class="line-content">        .metrics_by_subnet(&amp;day_start.next_day().next_day())<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L349" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">350</span><span class="line-content">         .into_values()<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L350" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">351</span><span class="line-content">         .collect();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L351" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">352</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L352" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -351,7 +355,7 @@ async fn _daily_metrics_correct_different_update_size(size: usize) {</div>
<div class="line context"><span class="line-number">355</span><span class="line-content">     assert_eq!(daily_metrics[0][0].num_blocks_failed, 0);<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L355" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">356</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L356" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">357</span><span class="line-content">     let daily_metrics: Vec&lt;Vec&lt;NodeMetricsDailyRaw&gt;&gt; = mm<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L357" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-354</span><span class="line-content">        .metrics_by_subnet(&amp;(3 * ONE_DAY_NANOS).into())<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/metrics/tests.rs#L354" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+358</span><span class="line-content">        .metrics_by_subnet(&amp;day_start.next_day().next_day().next_day())<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L358" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">359</span><span class="line-content">         .into_values()<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L359" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">360</span><span class="line-content">         .collect();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L360" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">361</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L361" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -377,14 +381,18 @@ async fn daily_metrics_correct_2_subs() {</div>
<div class="line context"><span class="line-number">381</span><span class="line-content">     let subnet_2 = subnet_id(2);<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L381" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">382</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L382" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">383</span><span class="line-content">     let node_1 = node_id(1);<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L383" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+384</span><span class="line-content">    let day_start = DayUtc::from_nanos(0);<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L384" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">385</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L385" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">386</span><span class="line-content">     let tracker = NodeMetricsHistoryResponseTracker::new()<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L386" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">387</span><span class="line-content">         .with_subnet(subnet_1)<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L387" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-383</span><span class="line-content">        .add_node_metrics(node_1, vec![(0.into(), vec![(1, 1), (2, 2), (3, 3)])])<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/metrics/tests.rs#L383" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+388</span><span class="line-content">        .add_node_metrics(node_1, vec![(day_start, vec![(1, 1), (2, 2), (3, 3)])])<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L388" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">389</span><span class="line-content">         .with_subnet(subnet_2)<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L389" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">390</span><span class="line-content">         .add_node_metrics(<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L390" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">391</span><span class="line-content">             node_1,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L391" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-387</span><span class="line-content">            vec![((3 * ONE_DAY_NANOS).into(), vec![(4, 4), (6, 6), (8, 8)])],<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/metrics/tests.rs#L387" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+392</span><span class="line-content">            vec![(<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L392" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+393</span><span class="line-content">                day_start.next_day().next_day().next_day(),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L393" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+394</span><span class="line-content">                vec![(4, 4), (6, 6), (8, 8)],<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L394" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+395</span><span class="line-content">            )],<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L395" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">396</span><span class="line-content">         );<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L396" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">397</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L397" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">398</span><span class="line-content">     let mut mock = mock::MockCanisterClient::new();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L398" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -399,7 +407,7 @@ async fn daily_metrics_correct_2_subs() {</div>
<div class="line context"><span class="line-number">407</span><span class="line-content">     let mut node_1_daily_metrics = Vec::new();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L407" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">408</span><span class="line-content">     for day in 0..8 {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L408" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">409</span><span class="line-content">         let daily_metrics = mm<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L409" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-402</span><span class="line-content">            .metrics_by_subnet(&amp;(day * ONE_DAY_NANOS).into())<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/metrics/tests.rs#L402" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+410</span><span class="line-content">            .metrics_by_subnet(&amp;DayUtc::from_nanos(day * ONE_DAY_NANOS))<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L410" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">411</span><span class="line-content">             .into_iter()<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L411" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">412</span><span class="line-content">             .collect::&lt;BTreeMap&lt;_, _&gt;&gt;()<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L412" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">413</span><span class="line-content">             .into_iter()<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L413" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -468,19 +476,26 @@ async fn daily_metrics_correct_overlapping_days() {</div>
<div class="line context"><span class="line-number">476</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L476" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">477</span><span class="line-content">     let node_1 = node_id(1);<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L477" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">478</span><span class="line-content">     let node_2 = node_id(1);<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L478" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+479</span><span class="line-content">    let day_start = DayUtc::from_nanos(0);<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L479" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">480</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L480" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">481</span><span class="line-content">     let tracker = NodeMetricsHistoryResponseTracker::new()<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L481" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">482</span><span class="line-content">         .with_subnet(subnet_1)<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L482" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-474</span><span class="line-content">        .add_node_metrics(node_1, vec![(0.into(), vec![(1, 1), (2, 2), (3, 3)])])<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/metrics/tests.rs#L474" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+483</span><span class="line-content">        .add_node_metrics(node_1, vec![(day_start, vec![(1, 1), (2, 2), (3, 3)])])<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L483" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">484</span><span class="line-content">         .with_subnet(subnet_2)<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L484" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">485</span><span class="line-content">         // Node 1 redeployed to subnet 2 on day 2<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L485" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">486</span><span class="line-content">         .add_node_metrics(<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L486" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">487</span><span class="line-content">             node_1,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L487" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-479</span><span class="line-content">            vec![((2 * ONE_DAY_NANOS).into(), vec![(4, 4), (6, 6), (8, 8)])],<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/metrics/tests.rs#L479" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+488</span><span class="line-content">            vec![(<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L488" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+489</span><span class="line-content">                day_start.next_day().next_day(),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L489" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+490</span><span class="line-content">                vec![(4, 4), (6, 6), (8, 8)],<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L490" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+491</span><span class="line-content">            )],<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L491" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">492</span><span class="line-content">         )<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L492" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">493</span><span class="line-content">         .add_node_metrics(<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L493" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">494</span><span class="line-content">             node_2,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L494" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-483</span><span class="line-content">            vec![((2 * ONE_DAY_NANOS).into(), vec![(1, 1), (3, 3), (6, 6)])],<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/metrics/tests.rs#L483" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+495</span><span class="line-content">            vec![(<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L495" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+496</span><span class="line-content">                day_start.next_day().next_day(),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L496" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+497</span><span class="line-content">                vec![(1, 1), (3, 3), (6, 6)],<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L497" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+498</span><span class="line-content">            )],<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L498" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">499</span><span class="line-content">         );<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L499" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">500</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L500" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">501</span><span class="line-content">     let mut mock = mock::MockCanisterClient::new();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L501" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -495,7 +510,7 @@ async fn daily_metrics_correct_overlapping_days() {</div>
<div class="line context"><span class="line-number">510</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L510" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">511</span><span class="line-content">     let mut daily_metrics = Vec::new();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L511" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">512</span><span class="line-content">     for idx in 0..4 {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L512" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-498</span><span class="line-content">        let day = (idx * ONE_DAY_NANOS).into();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/metrics/tests.rs#L498" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+513</span><span class="line-content">        let day = DayUtc::from_nanos(idx * ONE_DAY_NANOS);<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L513" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">514</span><span class="line-content">         let metrics = mm<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L514" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">515</span><span class="line-content">             .metrics_by_subnet(&amp;day)<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L515" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">516</span><span class="line-content">             .into_iter()<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L516" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -513,7 +528,7 @@ async fn daily_metrics_correct_overlapping_days() {</div>
<div class="line context"><span class="line-number">528</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L528" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">529</span><span class="line-content">     let overlapping_sub_1 = daily_metrics<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L529" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">530</span><span class="line-content">         .iter()<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L530" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-516</span><span class="line-content">        .find(|(sub, day, _)| sub == &amp;subnet_1 &amp;&amp; *day == (2 * ONE_DAY_NANOS).into())<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/metrics/tests.rs#L516" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+531</span><span class="line-content">        .find(|(sub, day, _)| sub == &amp;subnet_1 &amp;&amp; *day == day_start.next_day().next_day())<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L531" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">532</span><span class="line-content">         .map(|(_, _, node_metrics)| node_metrics)<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L532" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">533</span><span class="line-content">         .unwrap();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L533" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">534</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L534" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -522,7 +537,7 @@ async fn daily_metrics_correct_overlapping_days() {</div>
<div class="line context"><span class="line-number">537</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L537" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">538</span><span class="line-content">     let overlapping_sub_2 = daily_metrics<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L538" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">539</span><span class="line-content">         .iter()<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L539" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-525</span><span class="line-content">        .find(|(sub, day, _)| sub == &amp;subnet_2 &amp;&amp; *day == (2 * ONE_DAY_NANOS).into())<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/metrics/tests.rs#L525" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+540</span><span class="line-content">        .find(|(sub, day, _)| sub == &amp;subnet_2 &amp;&amp; *day == day_start.next_day().next_day())<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L540" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">541</span><span class="line-content">         .map(|(_, _, node_metrics)| node_metrics)<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L541" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">542</span><span class="line-content">         .unwrap();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L542" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">543</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L543" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">544</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/registry_querier.rs b/rs/node_rewards/canister/src/registry_querier.rs<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L544" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">545</span><span class="line-content">index e983675bb9..2c80205763 100644<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/metrics/tests.rs#L545" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/registry_querier.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/registry_querier.rs</div>
<div class="hunk-header">@@ -87,7 +87,7 @@ impl RegistryQuerier {</div>
<div class="line context"><span class="line-number">87</span><span class="line-content">     ) -&gt; Result&lt;BTreeMap&lt;PrincipalId, Vec&lt;RewardableNode&gt;&gt;, RegistryClientError&gt; {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">88</span><span class="line-content">         let mut rewardable_nodes_per_provider: BTreeMap&lt;_, Vec&lt;RewardableNode&gt;&gt; = BTreeMap::new();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">89</span><span class="line-content">         let registry_version = self<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-90</span><span class="line-content">            .version_for_timestamp(day_utc.unix_ts_at_day_end_nanoseconds())<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/registry_querier.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+90</span><span class="line-content">            .version_for_timestamp(day_utc.unix_timestamp_at_day_end_nanoseconds())<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">91</span><span class="line-content">             .unwrap();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">92</span><span class="line-content">         let nodes = self.nodes_in_version(registry_version)?;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">93</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier.rs#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">94</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/registry_querier/tests.rs b/rs/node_rewards/canister/src/registry_querier/tests.rs<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier.rs#L94" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">95</span><span class="line-content">index 33514945ba..674eb405ba 100644<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier.rs#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/registry_querier/tests.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/registry_querier/tests.rs</div>
<div class="hunk-header">@@ -45,7 +45,12 @@ fn add_record_helper(</div>
<div class="line context"><span class="line-number">45</span><span class="line-content">     datetime_str: &amp;str,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier/tests.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">46</span><span class="line-content"> ) {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier/tests.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">47</span><span class="line-content">     let ts = DayUtc::try_from(datetime_str).unwrap();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier/tests.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-48</span><span class="line-content">    add_record_helper_ts(key, version, value, ts.unix_ts_at_day_end_nanoseconds());<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+48</span><span class="line-content">    add_record_helper_ts(<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier/tests.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+49</span><span class="line-content">        key,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier/tests.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+50</span><span class="line-content">        version,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier/tests.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+51</span><span class="line-content">        value,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier/tests.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+52</span><span class="line-content">        ts.unix_timestamp_at_day_end_nanoseconds(),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier/tests.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+53</span><span class="line-content">    );<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier/tests.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">54</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier/tests.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">55</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier/tests.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">56</span><span class="line-content"> fn add_record_helper_ts(key: &amp;str, version: u64, value: Option&lt;impl ::prost::Message&gt;, ts: u64) {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier/tests.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -143,7 +148,7 @@ fn add_dummy_data() {</div>
<div class="line context"><span class="line-number">148</span><span class="line-content">     // Removed and re-added node_3 same day<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier/tests.rs#L148" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">149</span><span class="line-content">     let ts_removed = DayUtc::try_from(&quot;2025-07-16&quot;)<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier/tests.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">150</span><span class="line-content">         .unwrap()<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier/tests.rs#L150" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-146</span><span class="line-content">        .unix_ts_at_day_start_nanoseconds()<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+151</span><span class="line-content">        .unix_timestamp_at_day_start_nanoseconds()<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier/tests.rs#L151" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">152</span><span class="line-content">         + 1;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier/tests.rs#L152" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">153</span><span class="line-content">     add_record_helper_ts(&amp;node_3_k, 39676, None::&lt;NodeRecord&gt;, ts_removed);<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier/tests.rs#L153" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">154</span><span class="line-content">     let ts_readded = ts_removed + 1;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier/tests.rs#L154" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">155</span><span class="line-content">diff --git a/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs b/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier/tests.rs#L155" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">156</span><span class="line-content">index bd5f326c7a..f0e79c9254 100644<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/src/registry_querier/tests.rs#L156" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs</div>
<div class="hunk-header">@@ -3,6 +3,7 @@ use ic_nervous_system_agent::AgentFor;</div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use ic_nervous_system_agent::nns::node_rewards::get_node_providers_monthly_xdr_rewards;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use ic_nns_constants::NODE_REWARDS_CANISTER_ID;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use ic_nns_test_utils::common::build_node_rewards_test_wasm;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+6</span><span class="line-content">use ic_node_rewards_canister_api::DayUtc;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> use ic_node_rewards_canister_api::monthly_rewards::GetNodeProvidersMonthlyXdrRewardsRequest;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> use ic_node_rewards_canister_api::provider_rewards_calculation::{<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content">     GetNodeProviderRewardsCalculationRequest, GetNodeProviderRewardsCalculationResponse,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -74,10 +75,11 @@ async fn get_node_provider_rewards_calculation_is_only_callable_in_nonreplicated</div>
<div class="line context"><span class="line-number">75</span><span class="line-content">     let past_time_nanos = pocket_ic.get_time().await.as_nanos_since_unix_epoch();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">76</span><span class="line-content">     pocket_ic.advance_time(Duration::from_secs(86_400)).await;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">77</span><span class="line-content">     pocket_ic.tick().await;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+78</span><span class="line-content">    let day = DayUtc::from_nanos(past_time_nanos);<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">79</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">80</span><span class="line-content">     let request = GetNodeProviderRewardsCalculationRequest {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-79</span><span class="line-content">        from_day_timestamp_nanos: past_time_nanos,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-80</span><span class="line-content">        to_day_timestamp_nanos: past_time_nanos,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+81</span><span class="line-content">        from_day: day,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+82</span><span class="line-content">        to_day: day,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">83</span><span class="line-content">         provider_id: Principal::anonymous(),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">84</span><span class="line-content">     };<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">85</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">86</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/BUILD.bazel b/rs/node_rewards/rewards_calculation/BUILD.bazel<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">87</span><span class="line-content">index abe52d044d..93f535602e 100644<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/BUILD.bazel</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/BUILD.bazel</div>
<div class="hunk-header">@@ -6,6 +6,7 @@ DEPENDENCIES = [</div>
<div class="line context"><span class="line-number">6</span><span class="line-content">     # Keep sorted.<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/BUILD.bazel#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content">     &quot;//rs/protobuf&quot;,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/BUILD.bazel#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content">     &quot;//rs/types/base_types&quot;,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/BUILD.bazel#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+9</span><span class="line-content">    &quot;//rs/types/types&quot;,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/BUILD.bazel#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content">     &quot;@crate_index//:candid&quot;,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/BUILD.bazel#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content">     &quot;@crate_index//:chrono_canisters&quot;,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/BUILD.bazel#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">     &quot;@crate_index//:itertools&quot;,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/BUILD.bazel#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/Cargo.toml b/rs/node_rewards/rewards_calculation/Cargo.toml<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/BUILD.bazel#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content">index d3de985e51..1fa3a2dc52 100644<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/BUILD.bazel#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/Cargo.toml</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/Cargo.toml</div>
<div class="hunk-header">@@ -13,6 +13,7 @@ path = &quot;src/lib.rs&quot;</div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> ic-base-types = { path = &quot;../../types/base_types&quot; }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/Cargo.toml#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> itertools = { workspace = true }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/Cargo.toml#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> ic-protobuf = { path = &quot;../../protobuf&quot; }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/Cargo.toml#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+16</span><span class="line-content">ic-types = { path = &quot;../../types/types&quot; }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/Cargo.toml#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content"> maplit = &quot;1.0&quot;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/Cargo.toml#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content"> rust_decimal = &quot;1.37.1&quot;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/Cargo.toml#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content"> rust_decimal_macros = &quot;1.37.1&quot;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/Cargo.toml#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">20</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/types.rs b/rs/node_rewards/rewards_calculation/src/types.rs<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/Cargo.toml#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">21</span><span class="line-content">index 0eec8c16e3..ec99adce94 100644<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/Cargo.toml#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/types.rs</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/types.rs</div>
<div class="hunk-header">@@ -1,6 +1,7 @@</div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> use chrono::{DateTime, NaiveDateTime, ParseError, Utc};<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use ic_base_types::NodeId;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use ic_protobuf::registry::node::v1::NodeRewardType;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+4</span><span class="line-content">use ic_types::Time;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use serde::{Deserialize, Serialize};<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use std::fmt;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> use std::fmt::Display;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -13,13 +14,39 @@ const NANOS_PER_DAY: UnixTsNanos = 24 * 60 * 60 * 1_000_000_000;</div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> #[derive(Clone, Debug, PartialEq, Hash, PartialOrd, Ord, Eq, Copy, Deserialize, Serialize)]<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> pub struct DayUtc {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-16</span><span class="line-content">    value: UnixTsNanos,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+17</span><span class="line-content">    last_ts_nanoseconds: u64,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+18</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+19</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+20</span><span class="line-content">impl DayUtc {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+21</span><span class="line-content">    pub fn from_nanos(value: u64) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+22</span><span class="line-content">        let last_ts_nanoseconds = value<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+23</span><span class="line-content">            .checked_div(NANOS_PER_DAY)<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+24</span><span class="line-content">            .and_then(|v| v.checked_add(1))<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+25</span><span class="line-content">            .and_then(|v| v.checked_mul(NANOS_PER_DAY))<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+26</span><span class="line-content">            .and_then(|v| v.checked_sub(1))<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+27</span><span class="line-content">            .unwrap();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+28</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+29</span><span class="line-content">        Self {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+30</span><span class="line-content">            last_ts_nanoseconds,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+31</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+32</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+33</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+34</span><span class="line-content">    pub fn from_secs(value: u64) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+35</span><span class="line-content">        let nanos = value * 1_000_000_000;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+36</span><span class="line-content">        Self::from_nanos(nanos)<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+37</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+38</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+39</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+40</span><span class="line-content">impl From&lt;Time&gt; for DayUtc {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+41</span><span class="line-content">    fn from(value: Time) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+42</span><span class="line-content">        Self::from_nanos(value.as_nanos_since_unix_epoch())<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+43</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">44</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">45</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">46</span><span class="line-content"> impl Display for DayUtc {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">47</span><span class="line-content">     fn fmt(&amp;self, f: &amp;mut fmt::Formatter&lt;&#x27;_&gt;) -&gt; fmt::Result {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">48</span><span class="line-content">         let dd_mm_yyyy =<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-22</span><span class="line-content">            DateTime::from_timestamp_nanos(self.unix_ts_at_day_end_nanoseconds() as i64)<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+49</span><span class="line-content">            DateTime::from_timestamp_nanos(self.unix_timestamp_at_day_end_nanoseconds() as i64)<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">50</span><span class="line-content">                 .naive_utc()<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">51</span><span class="line-content">                 .format(&quot;%d-%m-%Y&quot;)<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">52</span><span class="line-content">                 .to_string();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -27,13 +54,6 @@ impl Display for DayUtc {</div>
<div class="line context"><span class="line-number">54</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">55</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">56</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-30</span><span class="line-content">impl From&lt;UnixTsNanos&gt; for DayUtc {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-31</span><span class="line-content">    fn from(value: UnixTsNanos) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-32</span><span class="line-content">        let day_end = ((value / NANOS_PER_DAY) + 1) * NANOS_PER_DAY - 1;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-33</span><span class="line-content">        Self { value: day_end }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-34</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-35</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-36</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">57</span><span class="line-content"> impl TryFrom&lt;&amp;str&gt; for DayUtc {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">58</span><span class="line-content">     type Error = ParseError;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">59</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -43,43 +63,55 @@ impl TryFrom&lt;&amp;str&gt; for DayUtc {</div>
<div class="line context"><span class="line-number">63</span><span class="line-content">         let datetime: DateTime&lt;Utc&gt; = DateTime::from_naive_utc_and_offset(naive, Utc);<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">64</span><span class="line-content">         let ts = datetime.timestamp_nanos_opt().unwrap() as u64;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">65</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-46</span><span class="line-content">        Ok(DayUtc::from(ts))<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+66</span><span class="line-content">        Ok(DayUtc::from_nanos(ts))<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">67</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">68</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">69</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">70</span><span class="line-content"> impl Default for DayUtc {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">71</span><span class="line-content">     fn default() -&gt; Self {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-52</span><span class="line-content">        DayUtc::from(0)<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+72</span><span class="line-content">        DayUtc::from_nanos(0)<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">73</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">74</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">75</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">76</span><span class="line-content"> impl DayUtc {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-57</span><span class="line-content">    pub fn unix_ts_at_day_end_nanoseconds(&amp;self) -&gt; UnixTsNanos {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-58</span><span class="line-content">        self.value<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+77</span><span class="line-content">    pub fn unix_timestamp_at_day_end_nanoseconds(&amp;self) -&gt; u64 {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+78</span><span class="line-content">        self.last_ts_nanoseconds<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">79</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">80</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-61</span><span class="line-content">    pub fn get(&amp;self) -&gt; UnixTsNanos {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-62</span><span class="line-content">        self.value<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+81</span><span class="line-content">    pub fn unix_timestamp_at_day_start_nanoseconds(&amp;self) -&gt; u64 {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+82</span><span class="line-content">        let extra = self.last_ts_nanoseconds.checked_rem(NANOS_PER_DAY).unwrap();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+83</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+84</span><span class="line-content">        self.last_ts_nanoseconds.saturating_sub(extra)<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">85</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">86</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-65</span><span class="line-content">    pub fn unix_ts_at_day_start_nanoseconds(&amp;self) -&gt; UnixTsNanos {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-66</span><span class="line-content">        (self.value / NANOS_PER_DAY) * NANOS_PER_DAY<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+87</span><span class="line-content">    pub fn unix_timestamp_at_day_end_seconds(&amp;self) -&gt; u64 {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+88</span><span class="line-content">        self.unix_timestamp_at_day_end_nanoseconds()<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+89</span><span class="line-content">            .checked_div(1_000_000_000)<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+90</span><span class="line-content">            .unwrap()<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">91</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">92</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-69</span><span class="line-content">    pub fn unix_ts_at_day_end_seconds(&amp;self) -&gt; u64 {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-70</span><span class="line-content">        self.unix_ts_at_day_end_nanoseconds() / 1_000_000_000<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+93</span><span class="line-content">    pub fn unix_timestamp_at_day_start_seconds(&amp;self) -&gt; u64 {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+94</span><span class="line-content">        self.unix_timestamp_at_day_start_nanoseconds()<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L94" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+95</span><span class="line-content">            .checked_div(1_000_000_000)<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+96</span><span class="line-content">            .expect(&quot;underflow detected in first_ts_secs&quot;)<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L96" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">97</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">98</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L98" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">99</span><span class="line-content">     pub fn next_day(&amp;self) -&gt; DayUtc {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">100</span><span class="line-content">         DayUtc {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L100" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-75</span><span class="line-content">            value: self.value + NANOS_PER_DAY,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+101</span><span class="line-content">            last_ts_nanoseconds: self<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L101" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+102</span><span class="line-content">                .last_ts_nanoseconds<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+103</span><span class="line-content">                .checked_add(NANOS_PER_DAY)<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+104</span><span class="line-content">                .expect(&quot;overflow detected in next_day&quot;),<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L104" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">105</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L105" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">106</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L106" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">107</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L107" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">108</span><span class="line-content">     pub fn previous_day(&amp;self) -&gt; DayUtc {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L108" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-80</span><span class="line-content">        let ts_previous_day = self.value.checked_sub(NANOS_PER_DAY).unwrap_or_default();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+109</span><span class="line-content">        let ts_previous_day = self<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L109" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+110</span><span class="line-content">            .last_ts_nanoseconds<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L110" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+111</span><span class="line-content">            .checked_sub(NANOS_PER_DAY)<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L111" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+112</span><span class="line-content">            .unwrap_or_default();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L112" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">113</span><span class="line-content">         DayUtc {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L113" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-82</span><span class="line-content">            value: ts_previous_day,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+114</span><span class="line-content">            last_ts_nanoseconds: ts_previous_day,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L114" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">115</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L115" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">116</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L116" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">117</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L117" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -87,14 +119,14 @@ impl DayUtc {</div>
<div class="line context"><span class="line-number">119</span><span class="line-content">         if self &gt; other {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L119" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">120</span><span class="line-content">             return Err(format!(<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L120" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">121</span><span class="line-content">                 &quot;Cannot compute days_until: {} &gt; {}&quot;,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L121" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-90</span><span class="line-content">                self.value, other.value<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+122</span><span class="line-content">                self.last_ts_nanoseconds, other.last_ts_nanoseconds<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L122" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">123</span><span class="line-content">             ));<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L123" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">124</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L124" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">125</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L125" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-94</span><span class="line-content">        let num_days = (other.value - self.value) / NANOS_PER_DAY;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L94" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+126</span><span class="line-content">        let num_days = (other.last_ts_nanoseconds - self.last_ts_nanoseconds) / NANOS_PER_DAY;<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L126" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">127</span><span class="line-content">         let days_until = (0..=num_days)<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L127" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">128</span><span class="line-content">             .map(|i| DayUtc {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L128" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-97</span><span class="line-content">                value: self.value + i * NANOS_PER_DAY,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+129</span><span class="line-content">                last_ts_nanoseconds: self.last_ts_nanoseconds + i * NANOS_PER_DAY,<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L129" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">130</span><span class="line-content">             })<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L130" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">131</span><span class="line-content">             .collect();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L131" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">132</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L132" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -132,13 +164,14 @@ mod tests {</div>
<div class="line context"><span class="line-number">164</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L164" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">165</span><span class="line-content">     #[test]<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L165" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">166</span><span class="line-content">     fn test_valid_rewarding_period() {<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L166" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-135</span><span class="line-content">        let from_day: DayUtc = ymdh_to_ts(2020, 1, 12, 0).into();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L135" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-136</span><span class="line-content">        let to_day = (ymdh_to_ts(2020, 1, 16, 0) - 1).into();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L136" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+167</span><span class="line-content">        let from_day: DayUtc = DayUtc::from_nanos(ymdh_to_ts(2020, 1, 12, 0));<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L167" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+168</span><span class="line-content">        let to_day: DayUtc = DayUtc::from_nanos(ymdh_to_ts(2020, 1, 15, 0));<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L168" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+169</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L169" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">170</span><span class="line-content">         let days = from_day.days_until(&amp;to_day).unwrap().len();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L170" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">171</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L171" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">172</span><span class="line-content">         assert_eq!(days, 4);<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L172" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">173</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L173" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-141</span><span class="line-content">        let to_day = ymdh_to_ts(2020, 1, 12, 13).into();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c~1/rs/node_rewards/rewards_calculation/src/types.rs#L141" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+174</span><span class="line-content">        let to_day = DayUtc::from_nanos(ymdh_to_ts(2020, 1, 12, 13));<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L174" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">175</span><span class="line-content">         let days = from_day.days_until(&amp;to_day).unwrap().len();<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L175" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">176</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L176" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">177</span><span class="line-content">         assert_eq!(days, 1);<a href="https://github.com/dfinity/ic/blob/ef7cd8fdf88c3fae338854a378cf284522d8357c/rs/node_rewards/rewards_calculation/src/types.rs#L177" class="github-link" target="_blank">🔗</a></span></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="commit-detail">
                    <div class="commit-header">
                        <div class="commit-title">
                            <a href="https://github.com/dfinity/ic/commit/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57" class="commit-hash-large" target="_blank">2f56f172a1ea9dfac0c2fc6889454c38bb88ff57</a>
                            <span class="badge chore">chore</span>
                        </div>
                        <div class="commit-meta">
                            <span>👤 Nikola Milosavljevic &lt;73236646+NikolaMilosa@users.noreply.github.com&gt;</span>
                            <span>📅 2025-09-24</span>
                            <span>📁 3 files</span>
                        </div>
                        <div style="margin-top: 8px; color: #e6edf3; font-size: 0.9em;">
                            chore: bump rust to 1.89 (#6758)
                        </div>
                        <div class="commit-actions">
                            <button class="toggle-button secondary" onclick="toggleFiles('files-6')">📁 Files (3)</button>
                            <button class="toggle-button" onclick="toggleDiff('diff-6')">🔍 Code Changes</button>
                        </div>
                        <div id="files-6" class="collapsible">
                            <div class="files-list">
                                <ul><li>rs/node_rewards/canister/src/lib.rs</li><li>rs/node_rewards/canister/src/metrics.rs</li><li>rs/node_rewards/canister/src/registry_querier.rs</li></ul></div></div>
                        <div id="diff-6" class="collapsible">
                            <div class="diff-container">
                                <div class="line context"><span class="line-number">1</span><span class="line-content">commit 2f56f172a1ea9dfac0c2fc6889454c38bb88ff57</span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content">Author: Nikola Milosavljevic &lt;73236646+NikolaMilosa@users.noreply.github.com&gt;</span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content">Date:   Wed Sep 24 09:21:42 2025 +0200</span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content">    chore: bump rust to 1.89 (#6758)</span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content">    This PR bumps rust version to `1.89`. These changes were generated by:</span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content">    * automatic `cargo fix --workspace --all-targets --keep-going ...`</span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content">    * automatic `cargo clippy --fix ...` (It did fix some things that the</span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content">    above command missed)</span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content">    * Manually applied rustc</span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">    [`mismatched_lifetime_syntax`](https://doc.rust-lang.org/beta/nightly-rustc/rustc_lint/lifetime_syntax/static.MISMATCHED_LIFETIME_SYNTAXES.html)</span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content">    fixes</span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content">    * Manually applied clippy</span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content">    [`cloned-ref-to-slice-refs`](https://rust-lang.github.io/rust-clippy/master/index.html#/cloned-ref-to-slice-refs)</span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content">    * Had to add some `#[allow(dead_code)]` because the `const` values used</span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content">    in `lazy_static!` weren&#x27;t viewed as ever used. Left `//TODO:` to ask if</span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content">    some of the parts that aren&#x27;t used are needed</span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content">    * Small manual patching of difference between</span></div>
<div class="line context"><span class="line-number">20</span><span class="line-content">    ```bash</span></div>
<div class="line context"><span class="line-number">21</span><span class="line-content">    bazel query &#x27;kind(&quot;rust_library&quot;, //...) union kind(&quot;rust_binary&quot;, //...) union (&quot;rust_test&quot;, //...)&#x27; &gt; targets</span></div>
<div class="line context"><span class="line-number">22</span><span class="line-content">    bazel build --config=lint --target_pattern_file=targets</span></div>
<div class="line context"><span class="line-number">23</span><span class="line-content">    ```</span></div>
<div class="line context"><span class="line-number">24</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">25</span><span class="line-content">    ---------</span></div>
<div class="line context"><span class="line-number">26</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">27</span><span class="line-content">    Co-authored-by: IDX GitHub Automation &lt;&gt;</span></div>
<div class="line context"><span class="line-number">28</span><span class="line-content">    Co-authored-by: Nicolas Mattia &lt;nicolas.mattia@dfinity.org&gt;</span></div>
<div class="line context"><span class="line-number">29</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">30</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/lib.rs b/rs/node_rewards/canister/src/lib.rs</span></div>
<div class="line context"><span class="line-number">31</span><span class="line-content">index 20af202a31..504f62d8f6 100644</span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/lib.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/lib.rs</div>
<div class="hunk-header">@@ -55,7 +55,7 @@ impl KeyRange for pb::v1::SubnetMetricsKey {</div>
<div class="line context"><span class="line-number">55</span><span class="line-content"> //------------ Storable Implementations ------------//<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">56</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">57</span><span class="line-content"> impl Storable for pb::v1::SubnetIdKey {<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-58</span><span class="line-content">    fn to_bytes(&amp;self) -&gt; std::borrow::Cow&lt;[u8]&gt; {<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57~1/rs/node_rewards/canister/src/lib.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+58</span><span class="line-content">    fn to_bytes(&amp;self) -&gt; std::borrow::Cow&lt;&#x27;_, [u8]&gt; {<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">59</span><span class="line-content">         Cow::Owned(self.encode_to_vec())<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">60</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">61</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -70,7 +70,7 @@ impl Storable for pb::v1::SubnetIdKey {</div>
<div class="line context"><span class="line-number">70</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">71</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">72</span><span class="line-content"> impl Storable for pb::v1::SubnetMetricsKey {<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-73</span><span class="line-content">    fn to_bytes(&amp;self) -&gt; std::borrow::Cow&lt;[u8]&gt; {<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57~1/rs/node_rewards/canister/src/lib.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+73</span><span class="line-content">    fn to_bytes(&amp;self) -&gt; std::borrow::Cow&lt;&#x27;_, [u8]&gt; {<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">74</span><span class="line-content">         Cow::Owned(self.encode_to_vec())<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">75</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">76</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -85,7 +85,7 @@ impl Storable for pb::v1::SubnetMetricsKey {</div>
<div class="line context"><span class="line-number">85</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">86</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">87</span><span class="line-content"> impl Storable for pb::v1::SubnetMetricsValue {<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-88</span><span class="line-content">    fn to_bytes(&amp;self) -&gt; std::borrow::Cow&lt;[u8]&gt; {<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57~1/rs/node_rewards/canister/src/lib.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+88</span><span class="line-content">    fn to_bytes(&amp;self) -&gt; std::borrow::Cow&lt;&#x27;_, [u8]&gt; {<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">89</span><span class="line-content">         Cow::Owned(self.encode_to_vec())<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">90</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">91</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -97,7 +97,7 @@ impl Storable for pb::v1::SubnetMetricsValue {</div>
<div class="line context"><span class="line-number">97</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">98</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L98" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">99</span><span class="line-content"> impl Storable for pb::v1::NodeMetrics {<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-100</span><span class="line-content">    fn to_bytes(&amp;self) -&gt; std::borrow::Cow&lt;[u8]&gt; {<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57~1/rs/node_rewards/canister/src/lib.rs#L100" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+100</span><span class="line-content">    fn to_bytes(&amp;self) -&gt; std::borrow::Cow&lt;&#x27;_, [u8]&gt; {<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L100" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">101</span><span class="line-content">         Cow::Owned(self.encode_to_vec())<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L101" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">102</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">103</span><span class="line-content">     fn from_bytes(bytes: std::borrow::Cow&lt;[u8]&gt;) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">104</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/metrics.rs b/rs/node_rewards/canister/src/metrics.rs<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L104" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">105</span><span class="line-content">index 9df82f44dc..7e7941f079 100644<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/lib.rs#L105" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/metrics.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/metrics.rs</div>
<div class="hunk-header">@@ -206,26 +206,26 @@ where</div>
<div class="line context"><span class="line-number">206</span><span class="line-content">             .collect();<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L206" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">207</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L207" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">208</span><span class="line-content">         let mut initial_total_metrics: HashMap&lt;_, _&gt; = HashMap::new();<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L208" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-209</span><span class="line-content">        if let Some((timestamp_nanos, _)) = subnets_metrics_by_day.first_key_value() {<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57~1/rs/node_rewards/canister/src/metrics.rs#L209" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-210</span><span class="line-content">            if timestamp_nanos &lt; day_utc {<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57~1/rs/node_rewards/canister/src/metrics.rs#L210" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-211</span><span class="line-content">                initial_total_metrics = subnets_metrics_by_day<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57~1/rs/node_rewards/canister/src/metrics.rs#L211" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-212</span><span class="line-content">                    .pop_first()<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57~1/rs/node_rewards/canister/src/metrics.rs#L212" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-213</span><span class="line-content">                    .unwrap()<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57~1/rs/node_rewards/canister/src/metrics.rs#L213" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-214</span><span class="line-content">                    .1<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57~1/rs/node_rewards/canister/src/metrics.rs#L214" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-215</span><span class="line-content">                    .into_iter()<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57~1/rs/node_rewards/canister/src/metrics.rs#L215" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-216</span><span class="line-content">                    .flat_map(|(k, v)| {<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57~1/rs/node_rewards/canister/src/metrics.rs#L216" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-217</span><span class="line-content">                        v.nodes_metrics.into_iter().map(move |node_metrics| {<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57~1/rs/node_rewards/canister/src/metrics.rs#L217" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+209</span><span class="line-content">        if let Some((timestamp_nanos, _)) = subnets_metrics_by_day.first_key_value()<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L209" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+210</span><span class="line-content">            &amp;&amp; timestamp_nanos &lt; day_utc<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L210" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+211</span><span class="line-content">        {<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L211" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+212</span><span class="line-content">            initial_total_metrics = subnets_metrics_by_day<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L212" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+213</span><span class="line-content">                .pop_first()<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L213" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+214</span><span class="line-content">                .unwrap()<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L214" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+215</span><span class="line-content">                .1<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L215" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+216</span><span class="line-content">                .into_iter()<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L216" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+217</span><span class="line-content">                .flat_map(|(k, v)| {<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L217" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+218</span><span class="line-content">                    v.nodes_metrics.into_iter().map(move |node_metrics| {<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L218" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+219</span><span class="line-content">                        (<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L219" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+220</span><span class="line-content">                            (k.subnet_id, node_metrics.node_id),<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L220" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">221</span><span class="line-content">                             (<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L221" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-219</span><span class="line-content">                                (k.subnet_id, node_metrics.node_id),<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57~1/rs/node_rewards/canister/src/metrics.rs#L219" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-220</span><span class="line-content">                                (<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57~1/rs/node_rewards/canister/src/metrics.rs#L220" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-221</span><span class="line-content">                                    node_metrics.num_blocks_proposed_total,<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57~1/rs/node_rewards/canister/src/metrics.rs#L221" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-222</span><span class="line-content">                                    node_metrics.num_blocks_failed_total,<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57~1/rs/node_rewards/canister/src/metrics.rs#L222" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-223</span><span class="line-content">                                ),<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57~1/rs/node_rewards/canister/src/metrics.rs#L223" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-224</span><span class="line-content">                            )<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57~1/rs/node_rewards/canister/src/metrics.rs#L224" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-225</span><span class="line-content">                        })<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57~1/rs/node_rewards/canister/src/metrics.rs#L225" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+222</span><span class="line-content">                                node_metrics.num_blocks_proposed_total,<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L222" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+223</span><span class="line-content">                                node_metrics.num_blocks_failed_total,<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L223" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+224</span><span class="line-content">                            ),<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L224" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+225</span><span class="line-content">                        )<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L225" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">226</span><span class="line-content">                     })<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L226" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-227</span><span class="line-content">                    .collect();<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57~1/rs/node_rewards/canister/src/metrics.rs#L227" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-228</span><span class="line-content">            }<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57~1/rs/node_rewards/canister/src/metrics.rs#L228" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+227</span><span class="line-content">                })<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L227" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+228</span><span class="line-content">                .collect();<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L228" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">229</span><span class="line-content">         };<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L229" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">230</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L230" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">231</span><span class="line-content">         for (_, subnets_metrics) in subnets_metrics_by_day {<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L231" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">232</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/registry_querier.rs b/rs/node_rewards/canister/src/registry_querier.rs<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L232" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">233</span><span class="line-content">index cfaf3eb621..e983675bb9 100644<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/metrics.rs#L233" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/registry_querier.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/registry_querier.rs</div>
<div class="hunk-header">@@ -107,10 +107,10 @@ impl RegistryQuerier {</div>
<div class="line context"><span class="line-number">107</span><span class="line-content">                 ic_cdk::println!(&quot;Node {} has no NodeOperatorData: skipping&quot;, node_id);<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/registry_querier.rs#L107" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">108</span><span class="line-content">                 continue;<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/registry_querier.rs#L108" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">109</span><span class="line-content">             };<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/registry_querier.rs#L109" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-110</span><span class="line-content">            if let Some(provider_filter) = provider_filter {<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57~1/rs/node_rewards/canister/src/registry_querier.rs#L110" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-111</span><span class="line-content">                if &amp;node_provider_id != provider_filter {<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57~1/rs/node_rewards/canister/src/registry_querier.rs#L111" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-112</span><span class="line-content">                    continue;<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57~1/rs/node_rewards/canister/src/registry_querier.rs#L112" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-113</span><span class="line-content">                }<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57~1/rs/node_rewards/canister/src/registry_querier.rs#L113" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+110</span><span class="line-content">            if let Some(provider_filter) = provider_filter<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/registry_querier.rs#L110" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+111</span><span class="line-content">                &amp;&amp; &amp;node_provider_id != provider_filter<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/registry_querier.rs#L111" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+112</span><span class="line-content">            {<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/registry_querier.rs#L112" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+113</span><span class="line-content">                continue;<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/registry_querier.rs#L113" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">114</span><span class="line-content">             }<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/registry_querier.rs#L114" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">115</span><span class="line-content">             let Some(some_reward_type) = node_record.node_reward_type else {<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/registry_querier.rs#L115" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">116</span><span class="line-content">                 // If the node does not have a node_reward_type, we skip it.<a href="https://github.com/dfinity/ic/blob/2f56f172a1ea9dfac0c2fc6889454c38bb88ff57/rs/node_rewards/canister/src/registry_querier.rs#L116" class="github-link" target="_blank">🔗</a></span></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="commit-detail">
                    <div class="commit-header">
                        <div class="commit-title">
                            <a href="https://github.com/dfinity/ic/commit/626ccf507254cc6b72ae126ae4d7f7ba22b52406" class="commit-hash-large" target="_blank">626ccf507254cc6b72ae126ae4d7f7ba22b52406</a>
                            <span class="badge chore">chore</span>
                        </div>
                        <div class="commit-meta">
                            <span>👤 pietrodimarco-dfinity &lt;124565147+pietrodimarco-dfinity@users.noreply.github.com&gt;</span>
                            <span>📅 2025-09-16</span>
                            <span>📁 1 files</span>
                        </div>
                        <div style="margin-top: 8px; color: #e6edf3; font-size: 0.9em;">
                            chore(nns): Release notes (#6641)
                        </div>
                        <div class="commit-actions">
                            <button class="toggle-button secondary" onclick="toggleFiles('files-7')">📁 Files (1)</button>
                            <button class="toggle-button" onclick="toggleDiff('diff-7')">🔍 Code Changes</button>
                        </div>
                        <div id="files-7" class="collapsible">
                            <div class="files-list">
                                <ul><li>rs/node_rewards/canister/CHANGELOG.md</li></ul></div></div>
                        <div id="diff-7" class="collapsible">
                            <div class="diff-container">
                                <div class="line context"><span class="line-number">1</span><span class="line-content">commit 626ccf507254cc6b72ae126ae4d7f7ba22b52406</span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content">Author: pietrodimarco-dfinity &lt;124565147+pietrodimarco-dfinity@users.noreply.github.com&gt;</span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content">Date:   Tue Sep 16 19:14:26 2025 +0200</span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content">    chore(nns): Release notes (#6641)</span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content">    Release notes for submitted proposals:</span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content">    https://dashboard.internetcomputer.org/proposal/138378</span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content">    Co-authored-by: max-dfinity &lt;100170574+max-dfinity@users.noreply.github.com&gt;</span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content">diff --git a/rs/node_rewards/canister/CHANGELOG.md b/rs/node_rewards/canister/CHANGELOG.md</span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content">index 0ec4c84f0d..fb9ef5a1ea 100644</span></div>
<div class="file-header">--- a/rs/node_rewards/canister/CHANGELOG.md</div>
<div class="file-header">+++ b/rs/node_rewards/canister/CHANGELOG.md</div>
<div class="hunk-header">@@ -2,6 +2,15 @@</div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/626ccf507254cc6b72ae126ae4d7f7ba22b52406/rs/node_rewards/canister/CHANGELOG.md#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> INSERT NEW RELEASES HERE<a href="https://github.com/dfinity/ic/blob/626ccf507254cc6b72ae126ae4d7f7ba22b52406/rs/node_rewards/canister/CHANGELOG.md#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/626ccf507254cc6b72ae126ae4d7f7ba22b52406/rs/node_rewards/canister/CHANGELOG.md#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+5</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/626ccf507254cc6b72ae126ae4d7f7ba22b52406/rs/node_rewards/canister/CHANGELOG.md#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+6</span><span class="line-content"># 2025-09-06: Proposal 138378<a href="https://github.com/dfinity/ic/blob/626ccf507254cc6b72ae126ae4d7f7ba22b52406/rs/node_rewards/canister/CHANGELOG.md#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+7</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/626ccf507254cc6b72ae126ae4d7f7ba22b52406/rs/node_rewards/canister/CHANGELOG.md#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content">https://dashboard.internetcomputer.org/proposal/138378<a href="https://github.com/dfinity/ic/blob/626ccf507254cc6b72ae126ae4d7f7ba22b52406/rs/node_rewards/canister/CHANGELOG.md#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+9</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/626ccf507254cc6b72ae126ae4d7f7ba22b52406/rs/node_rewards/canister/CHANGELOG.md#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+10</span><span class="line-content">* Add Node Provider filtering on get_rewardable_nodes_per_provider to reduce number of instruction on query calls.<a href="https://github.com/dfinity/ic/blob/626ccf507254cc6b72ae126ae4d7f7ba22b52406/rs/node_rewards/canister/CHANGELOG.md#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+11</span><span class="line-content">* Discard historical rewards storage and API endpoints as historical rewards will be stored in Governance canister.<a href="https://github.com/dfinity/ic/blob/626ccf507254cc6b72ae126ae4d7f7ba22b52406/rs/node_rewards/canister/CHANGELOG.md#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+12</span><span class="line-content">* Disable replicated execution of query calls.<a href="https://github.com/dfinity/ic/blob/626ccf507254cc6b72ae126ae4d7f7ba22b52406/rs/node_rewards/canister/CHANGELOG.md#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+13</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/626ccf507254cc6b72ae126ae4d7f7ba22b52406/rs/node_rewards/canister/CHANGELOG.md#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> # 2025-08-30: Proposal 138288<a href="https://github.com/dfinity/ic/blob/626ccf507254cc6b72ae126ae4d7f7ba22b52406/rs/node_rewards/canister/CHANGELOG.md#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/626ccf507254cc6b72ae126ae4d7f7ba22b52406/rs/node_rewards/canister/CHANGELOG.md#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> http://dashboard.internetcomputer.org/proposal/138288<a href="https://github.com/dfinity/ic/blob/626ccf507254cc6b72ae126ae4d7f7ba22b52406/rs/node_rewards/canister/CHANGELOG.md#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -20,6 +29,7 @@ http://dashboard.internetcomputer.org/proposal/138288</div>
<div class="line context"><span class="line-number">29</span><span class="line-content"> * Replicated execution of the query endpoints `get_node_provider_rewards_calculation` and `get_historical_reward_periods`<a href="https://github.com/dfinity/ic/blob/626ccf507254cc6b72ae126ae4d7f7ba22b52406/rs/node_rewards/canister/CHANGELOG.md#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">30</span><span class="line-content">   is disabled.<a href="https://github.com/dfinity/ic/blob/626ccf507254cc6b72ae126ae4d7f7ba22b52406/rs/node_rewards/canister/CHANGELOG.md#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">31</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/626ccf507254cc6b72ae126ae4d7f7ba22b52406/rs/node_rewards/canister/CHANGELOG.md#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+32</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/626ccf507254cc6b72ae126ae4d7f7ba22b52406/rs/node_rewards/canister/CHANGELOG.md#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">33</span><span class="line-content"> # 2025-08-15: Proposal 137910<a href="https://github.com/dfinity/ic/blob/626ccf507254cc6b72ae126ae4d7f7ba22b52406/rs/node_rewards/canister/CHANGELOG.md#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">34</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/626ccf507254cc6b72ae126ae4d7f7ba22b52406/rs/node_rewards/canister/CHANGELOG.md#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">35</span><span class="line-content"> http://dashboard.internetcomputer.org/proposal/137910<a href="https://github.com/dfinity/ic/blob/626ccf507254cc6b72ae126ae4d7f7ba22b52406/rs/node_rewards/canister/CHANGELOG.md#L35" class="github-link" target="_blank">🔗</a></span></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="commit-detail">
                    <div class="commit-header">
                        <div class="commit-title">
                            <a href="https://github.com/dfinity/ic/commit/ed7dbb0a280cf0e25b712b651a05997d3ce24f92" class="commit-hash-large" target="_blank">ed7dbb0a280cf0e25b712b651a05997d3ce24f92</a>
                            <span class="badge feat">feat</span>
                        </div>
                        <div class="commit-meta">
                            <span>👤 pietrodimarco-dfinity &lt;124565147+pietrodimarco-dfinity@users.noreply.github.com&gt;</span>
                            <span>📅 2025-09-15</span>
                            <span>📁 25 files</span>
                        </div>
                        <div style="margin-top: 8px; color: #e6edf3; font-size: 0.9em;">
                            feat(NRC): Refactor NRC to compute daily rewards (#6730)
                        </div>
                        <div class="commit-actions">
                            <button class="toggle-button secondary" onclick="toggleFiles('files-8')">📁 Files (25)</button>
                            <button class="toggle-button" onclick="toggleDiff('diff-8')">🔍 Code Changes</button>
                        </div>
                        <div id="files-8" class="collapsible">
                            <div class="files-list">
                                <ul><li>rs/node_rewards/canister/api/src/provider_rewards_calculation.rs</li><li>rs/node_rewards/canister/api/src/providers_rewards.rs</li><li>rs/node_rewards/canister/node-rewards-canister.did</li><li>rs/node_rewards/canister/src/api_conversion.rs</li><li>rs/node_rewards/canister/src/canister/mod.rs</li><li>rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs</li><li>rs/node_rewards/canister/src/lib.rs</li><li>rs/node_rewards/canister/src/main.rs</li><li>rs/node_rewards/canister/src/metrics.rs</li><li>rs/node_rewards/canister/src/metrics/tests.rs</li><li>rs/node_rewards/canister/src/registry_querier.rs</li><li>rs/node_rewards/canister/src/registry_querier/tests.rs</li><li>rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs</li><li>rs/node_rewards/rewards_calculation/BUILD.bazel</li><li>rs/node_rewards/rewards_calculation/Cargo.toml</li><li>rs/node_rewards/rewards_calculation/src/lib.rs</li><li>rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs</li><li>rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs</li><li>rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs</li><li>rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs</li><li>rs/node_rewards/rewards_calculation/src/rewards_calculator/mod.rs</li><li>rs/node_rewards/rewards_calculation/src/rewards_calculator/test_utils.rs</li><li>rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs</li><li>rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs</li><li>rs/node_rewards/rewards_calculation/src/types.rs</li></ul></div></div>
                        <div id="diff-8" class="collapsible">
                            <div class="diff-container">
                                <div class="line context"><span class="line-number">1</span><span class="line-content">commit ed7dbb0a280cf0e25b712b651a05997d3ce24f92</span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content">Author: pietrodimarco-dfinity &lt;124565147+pietrodimarco-dfinity@users.noreply.github.com&gt;</span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content">Date:   Mon Sep 15 18:06:16 2025 +0200</span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content">    feat(NRC): Refactor NRC to compute daily rewards (#6730)</span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content">    Changes:</span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content">    - Replace legacy days range rewards calculation with daily rewards</span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content">    calculation</span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content">    - Adapt` metrics.rs` to extract daily metrics</span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">    - Implement</span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content">    `rewards_calculation::performance_based_algorithm::DataProvider` trait</span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content">    - Adapt API for new daily calculation</span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content">    - Adapt `registry_querier.rs` to fetch daily rewardable nodes</span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content">diff --git a/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs b/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs</span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content">index 3d674857e3..96d677460b 100644</span></div>
<div class="file-header">--- a/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs</div>
<div class="hunk-header">@@ -1,12 +1,15 @@</div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> use candid::{CandidType, Deserialize, Principal};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+2</span><span class="line-content">use ic_base_types::PrincipalId;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+3</span><span class="line-content">use ic_nervous_system_proto::pb::v1::Decimal;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+4</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> #[derive(CandidType, Clone, Deserialize)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> pub struct GetNodeProviderRewardsCalculationRequest {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-4</span><span class="line-content">    pub from_nanos: u64,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-5</span><span class="line-content">    pub to_nanos: u64,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+7</span><span class="line-content">    pub from_day_timestamp_nanos: u64,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content">    pub to_day_timestamp_nanos: u64,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content">     pub provider_id: Principal,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-9</span><span class="line-content">pub type GetNodeProviderRewardsCalculationResponse = Result&lt;NodeProviderRewards, String&gt;;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+12</span><span class="line-content">pub type GetNodeProviderRewardsCalculationResponse = Result&lt;Vec&lt;NodeProviderRewardsDaily&gt;, String&gt;;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> #[derive(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content">     PartialOrd, Ord, Eq, candid::CandidType, candid::Deserialize, Clone, Copy, PartialEq, Debug,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -17,79 +20,59 @@ pub struct DayUtc {</div>
<div class="line context"><span class="line-number">20</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">21</span><span class="line-content"> #[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">22</span><span class="line-content"> pub struct NodeMetricsDaily {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-20</span><span class="line-content">    pub subnet_assigned: Option&lt;::ic_base_types::PrincipalId&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-21</span><span class="line-content">    pub subnet_assigned_fr_percent: Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+23</span><span class="line-content">    pub subnet_assigned: Option&lt;PrincipalId&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+24</span><span class="line-content">    pub subnet_assigned_fr_percent: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">25</span><span class="line-content">     pub num_blocks_proposed: Option&lt;u64&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">26</span><span class="line-content">     pub num_blocks_failed: Option&lt;u64&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-24</span><span class="line-content">    pub original_fr_percent: Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-25</span><span class="line-content">    pub relative_fr_percent: Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-26</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-27</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-28</span><span class="line-content">#[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-29</span><span class="line-content">pub struct Assigned {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-30</span><span class="line-content">    pub node_metrics: Option&lt;NodeMetricsDaily&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+27</span><span class="line-content">    pub original_fr_percent: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+28</span><span class="line-content">    pub relative_fr_percent: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">29</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-32</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">30</span><span class="line-content"> #[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-34</span><span class="line-content">pub struct Unassigned {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-35</span><span class="line-content">    pub extrapolated_fr_percent: Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+31</span><span class="line-content">pub enum NodeStatus {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+32</span><span class="line-content">    Assigned {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+33</span><span class="line-content">        node_metrics: Option&lt;NodeMetricsDaily&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+34</span><span class="line-content">    },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+35</span><span class="line-content">    Unassigned {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+36</span><span class="line-content">        extrapolated_fr_percent: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+37</span><span class="line-content">    },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">38</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-37</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-38</span><span class="line-content">#[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-39</span><span class="line-content">pub struct NodeStatus {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-40</span><span class="line-content">    pub status: Option&lt;node_status::Status&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-41</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-42</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-43</span><span class="line-content">/// Nested message and enum types in `NodeStatus`.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-44</span><span class="line-content">pub mod node_status {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-45</span><span class="line-content">    #[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-46</span><span class="line-content">    pub enum Status {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-47</span><span class="line-content">        Assigned(super::Assigned),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-48</span><span class="line-content">        Unassigned(super::Unassigned),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-49</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-50</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-51</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-52</span><span class="line-content">#[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-53</span><span class="line-content">pub struct DailyResults {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-54</span><span class="line-content">    pub day: Option&lt;DayUtc&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-55</span><span class="line-content">    pub node_status: Option&lt;NodeStatus&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-56</span><span class="line-content">    pub performance_multiplier_percent: Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-57</span><span class="line-content">    pub rewards_reduction_percent: Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-58</span><span class="line-content">    pub base_rewards_xdr_permyriad: Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-59</span><span class="line-content">    pub adjusted_rewards_xdr_permyriad: Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-60</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-61</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">39</span><span class="line-content"> #[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">40</span><span class="line-content"> pub struct NodeResults {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-64</span><span class="line-content">    pub node_id: Option&lt;::ic_base_types::PrincipalId&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+41</span><span class="line-content">    pub node_id: Option&lt;PrincipalId&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">42</span><span class="line-content">     pub node_reward_type: Option&lt;String&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">43</span><span class="line-content">     pub region: Option&lt;String&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">44</span><span class="line-content">     pub dc_id: Option&lt;String&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-68</span><span class="line-content">    pub daily_results: Vec&lt;DailyResults&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+45</span><span class="line-content">    pub node_status: Option&lt;NodeStatus&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+46</span><span class="line-content">    pub performance_multiplier_percent: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+47</span><span class="line-content">    pub rewards_reduction_percent: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+48</span><span class="line-content">    pub base_rewards_xdr_permyriad: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+49</span><span class="line-content">    pub adjusted_rewards_xdr_permyriad: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">50</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-70</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">51</span><span class="line-content"> #[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">52</span><span class="line-content"> pub struct BaseRewards {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-73</span><span class="line-content">    pub monthly_xdr_permyriad: Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-74</span><span class="line-content">    pub daily_xdr_permyriad: Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+53</span><span class="line-content">    pub monthly_xdr_permyriad: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+54</span><span class="line-content">    pub daily_xdr_permyriad: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">55</span><span class="line-content">     pub node_reward_type: Option&lt;String&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">56</span><span class="line-content">     pub region: Option&lt;String&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">57</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-78</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">58</span><span class="line-content"> #[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-80</span><span class="line-content">pub struct DailyBaseRewardsType3 {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-81</span><span class="line-content">    pub day: Option&lt;DayUtc&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+59</span><span class="line-content">pub struct BaseRewardsType3 {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">60</span><span class="line-content">     pub region: Option&lt;String&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">61</span><span class="line-content">     pub nodes_count: Option&lt;u64&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-84</span><span class="line-content">    pub avg_rewards_xdr_permyriad: Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-85</span><span class="line-content">    pub avg_coefficient_percent: Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-86</span><span class="line-content">    pub value_xdr_permyriad: Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+62</span><span class="line-content">    pub avg_rewards_xdr_permyriad: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+63</span><span class="line-content">    pub avg_coefficient_percent: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+64</span><span class="line-content">    pub value_xdr_permyriad: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">65</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-88</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">66</span><span class="line-content"> #[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">67</span><span class="line-content"> pub struct NodeProviderRewards {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-91</span><span class="line-content">    pub rewards_total_xdr_permyriad: Option&lt;u64&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+68</span><span class="line-content">    pub rewards_total_xdr_permyriad: Option&lt;Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">69</span><span class="line-content">     pub base_rewards: Vec&lt;BaseRewards&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-93</span><span class="line-content">    pub base_rewards_type3: Vec&lt;DailyBaseRewardsType3&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+70</span><span class="line-content">    pub base_rewards_type3: Vec&lt;BaseRewardsType3&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">71</span><span class="line-content">     pub nodes_results: Vec&lt;NodeResults&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">72</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+73</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+74</span><span class="line-content">#[derive(CandidType, candid::Deserialize, Clone, Debug)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+75</span><span class="line-content">pub struct NodeProviderRewardsDaily {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+76</span><span class="line-content">    pub day_utc: Option&lt;DayUtc&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+77</span><span class="line-content">    pub node_provider_rewards: Option&lt;NodeProviderRewards&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+78</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">79</span><span class="line-content">diff --git a/rs/node_rewards/canister/api/src/providers_rewards.rs b/rs/node_rewards/canister/api/src/providers_rewards.rs<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">80</span><span class="line-content">index 14e7d28469..20f39b035f 100644<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/api/src/providers_rewards.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/api/src/providers_rewards.rs</div>
<div class="hunk-header">@@ -3,8 +3,8 @@ use std::collections::BTreeMap;</div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/providers_rewards.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> #[derive(CandidType, Clone, Deserialize)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/providers_rewards.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> pub struct GetNodeProvidersRewardsRequest {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/providers_rewards.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-6</span><span class="line-content">    pub from_nanos: u64,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/providers_rewards.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content">    pub to_nanos: u64,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/api/src/providers_rewards.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+6</span><span class="line-content">    pub from_day_timestamp_nanos: u64,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/providers_rewards.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+7</span><span class="line-content">    pub to_day_timestamp_nanos: u64,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/providers_rewards.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/providers_rewards.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> pub type GetNodeProvidersRewardsResponse = Result&lt;NodeProvidersRewards, String&gt;;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/providers_rewards.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/providers_rewards.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content">diff --git a/rs/node_rewards/canister/node-rewards-canister.did b/rs/node_rewards/canister/node-rewards-canister.did<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/providers_rewards.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">index c3c33e4f06..c79541bd5c 100644<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/api/src/providers_rewards.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/node-rewards-canister.did</div>
<div class="file-header">+++ b/rs/node_rewards/canister/node-rewards-canister.did</div>
<div class="hunk-header">@@ -1,33 +1,13 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">type GetNodeProvidersMonthlyXdrRewardsRequest = record {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content">    registry_version: opt nat64;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-3</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-4</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-5</span><span class="line-content">type GetNodeProvidersMonthlyXdrRewardsResponse = record {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-6</span><span class="line-content">    rewards : opt NodeProvidersMonthlyXdrRewards;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content">    error: opt text;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-8</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-9</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-10</span><span class="line-content">type NodeProvidersMonthlyXdrRewards = record {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-11</span><span class="line-content">    rewards: vec record { principal; nat64 };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-12</span><span class="line-content">    registry_version: opt nat64;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-13</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-14</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-15</span><span class="line-content">type GetNodeProvidersRewardsRequest = record {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-16</span><span class="line-content">  from_nanos: nat64;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-17</span><span class="line-content">  to_nanos: nat64;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-18</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-19</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-20</span><span class="line-content">type NodeProvidersRewards = record {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-21</span><span class="line-content">  rewards_xdr_permyriad: vec record {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-22</span><span class="line-content">    principal;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-23</span><span class="line-content">    nat64;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-24</span><span class="line-content">  };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-25</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">// get_node_provider_rewards_calculation<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> type Decimal = record {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content">   human_readable: opt text;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+7</span><span class="line-content">type DayUtc = record {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content">  value: opt nat64;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+9</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+10</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> type NodeMetricsDaily = record {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">   subnet_assigned: opt principal;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content">   subnet_assigned_fr_percent: opt Decimal;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -37,34 +17,9 @@ type NodeMetricsDaily = record {</div>
<div class="line context"><span class="line-number">17</span><span class="line-content">   relative_fr_percent: opt Decimal;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-40</span><span class="line-content">type Assigned = record {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-41</span><span class="line-content">  node_metrics: opt NodeMetricsDaily;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-42</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-43</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-44</span><span class="line-content">type Unassigned = record {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-45</span><span class="line-content">  extrapolated_fr_percent: opt Decimal;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-46</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-47</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-48</span><span class="line-content">type Status = variant {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-49</span><span class="line-content">  Assigned: Assigned;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-50</span><span class="line-content">  Unassigned: Unassigned;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-51</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-52</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-53</span><span class="line-content">type NodeStatus = record {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-54</span><span class="line-content">  status: opt Status;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-55</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-56</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-57</span><span class="line-content">type DayUtc = record {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-58</span><span class="line-content">  value: opt nat64;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-59</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-60</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-61</span><span class="line-content">type DailyResults = record {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-62</span><span class="line-content">  day: opt DayUtc;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-63</span><span class="line-content">  node_status: opt NodeStatus;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-64</span><span class="line-content">  performance_multiplier_percent: opt Decimal;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-65</span><span class="line-content">  rewards_reduction_percent: opt Decimal;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-66</span><span class="line-content">  base_rewards_xdr_permyriad: opt Decimal;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-67</span><span class="line-content">  adjusted_rewards_xdr_permyriad: opt Decimal;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+20</span><span class="line-content">type NodeStatus = variant {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+21</span><span class="line-content">  Assigned: record { node_metrics: opt NodeMetricsDaily };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+22</span><span class="line-content">  Unassigned: record { extrapolated_fr_percent: opt Decimal };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">23</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">24</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">25</span><span class="line-content"> type NodeResults = record {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -72,7 +27,11 @@ type NodeResults = record {</div>
<div class="line context"><span class="line-number">27</span><span class="line-content">   node_reward_type: opt text;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">28</span><span class="line-content">   region: opt text;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">29</span><span class="line-content">   dc_id: opt text;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-75</span><span class="line-content">  daily_results: vec DailyResults;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+30</span><span class="line-content">  node_status: opt NodeStatus;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+31</span><span class="line-content">  performance_multiplier_percent: opt Decimal;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+32</span><span class="line-content">  rewards_reduction_percent: opt Decimal;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+33</span><span class="line-content">  base_rewards_xdr_permyriad: opt Decimal;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+34</span><span class="line-content">  adjusted_rewards_xdr_permyriad: opt Decimal;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">35</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">36</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">37</span><span class="line-content"> type BaseRewards = record {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -82,8 +41,7 @@ type BaseRewards = record {</div>
<div class="line context"><span class="line-number">41</span><span class="line-content">   region: opt text;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">42</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">43</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-85</span><span class="line-content">type DailyBaseRewardsType3 = record {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-86</span><span class="line-content">  day: opt DayUtc;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+44</span><span class="line-content">type BaseRewardsType3 = record {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">45</span><span class="line-content">   region: opt text;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">46</span><span class="line-content">   nodes_count: opt nat64;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">47</span><span class="line-content">   avg_rewards_xdr_permyriad: opt Decimal;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -92,26 +50,62 @@ type DailyBaseRewardsType3 = record {</div>
<div class="line context"><span class="line-number">50</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">51</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">52</span><span class="line-content"> type NodeProviderRewards = record {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-95</span><span class="line-content">  rewards_total_xdr_permyriad: opt nat64;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+53</span><span class="line-content">  rewards_total_xdr_permyriad: opt Decimal;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">54</span><span class="line-content">   base_rewards: vec BaseRewards;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-97</span><span class="line-content">  base_rewards_type3: vec DailyBaseRewardsType3;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+55</span><span class="line-content">  base_rewards_type3: vec BaseRewardsType3;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">56</span><span class="line-content">   nodes_results: vec NodeResults;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">57</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">58</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+59</span><span class="line-content">type NodeProviderRewardsDaily = record {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+60</span><span class="line-content">    day_utc: opt DayUtc;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+61</span><span class="line-content">    node_provider_rewards: opt NodeProviderRewards;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+62</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+63</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+64</span><span class="line-content">type GetNodeProviderRewardsCalculationResponse = variant { Ok: vec NodeProviderRewardsDaily; Err: text };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+65</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">66</span><span class="line-content"> type GetNodeProviderRewardsCalculationRequest = record {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-102</span><span class="line-content">  from_nanos: nat64;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-103</span><span class="line-content">  to_nanos: nat64;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+67</span><span class="line-content">  from_day_timestamp_nanos: nat64;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+68</span><span class="line-content">  to_day_timestamp_nanos: nat64;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">69</span><span class="line-content">   provider_id: principal;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">70</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">71</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-107</span><span class="line-content">type GetNodeProvidersRewardsResponse = variant { Ok : NodeProvidersRewards; Err : text };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L107" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+72</span><span class="line-content">// get_node_providers_rewards<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+73</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+74</span><span class="line-content">type NodeProvidersRewards = record {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+75</span><span class="line-content">  rewards_xdr_permyriad: vec record {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+76</span><span class="line-content">    principal;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+77</span><span class="line-content">    nat64;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+78</span><span class="line-content">  };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+79</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+80</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+81</span><span class="line-content">type GetNodeProvidersRewardsRequest = record {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+82</span><span class="line-content">  from_day_timestamp_nanos: nat64;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+83</span><span class="line-content">  to_day_timestamp_nanos: nat64;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+84</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+85</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+86</span><span class="line-content">type GetNodeProvidersRewardsResponse = variant { Ok: NodeProvidersRewards; Err: text };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">87</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-109</span><span class="line-content">type GetNodeProviderRewardsCalculationResponse = variant { Ok : NodeProviderRewards; Err : text };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L109" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">88</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-111</span><span class="line-content">service : () -&gt; {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L111" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+89</span><span class="line-content">// get_node_providers_monthly_xdr_rewards<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+90</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+91</span><span class="line-content">type GetNodeProvidersMonthlyXdrRewardsRequest = record {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+92</span><span class="line-content">    registry_version: opt nat64;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+93</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+94</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L94" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+95</span><span class="line-content">type GetNodeProvidersMonthlyXdrRewardsResponse = record {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+96</span><span class="line-content">    rewards: opt NodeProvidersMonthlyXdrRewards;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L96" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+97</span><span class="line-content">    error: opt text;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+98</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L98" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+99</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+100</span><span class="line-content">type NodeProvidersMonthlyXdrRewards = record {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L100" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+101</span><span class="line-content">    rewards: vec record { principal; nat64 };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L101" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+102</span><span class="line-content">    registry_version: opt nat64;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+103</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+104</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L104" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+105</span><span class="line-content">service: () -&gt; {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L105" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">106</span><span class="line-content">     get_node_providers_monthly_xdr_rewards: (GetNodeProvidersMonthlyXdrRewardsRequest) -&gt; (<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L106" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">107</span><span class="line-content">         GetNodeProvidersMonthlyXdrRewardsResponse<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L107" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">108</span><span class="line-content">     );<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L108" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">109</span><span class="line-content">     get_node_providers_rewards: (GetNodeProvidersRewardsRequest) -&gt; (GetNodeProvidersRewardsResponse);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L109" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-116</span><span class="line-content">    get_node_provider_rewards_calculation : (GetNodeProviderRewardsCalculationRequest) -&gt; (GetNodeProviderRewardsCalculationResponse) query;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/node-rewards-canister.did#L116" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+110</span><span class="line-content">    get_node_provider_rewards_calculation: (GetNodeProviderRewardsCalculationRequest) -&gt; (GetNodeProviderRewardsCalculationResponse) query;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L110" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">111</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L111" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">112</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/api_conversion.rs b/rs/node_rewards/canister/src/api_conversion.rs<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L112" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">113</span><span class="line-content">index a8c9ec8725..98ce409b69 100644<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/node-rewards-canister.did#L113" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/api_conversion.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/api_conversion.rs</div>
<div class="hunk-header">@@ -1,83 +1,98 @@</div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">use ic_base_types::PrincipalId;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use ic_node_rewards_canister_api::provider_rewards_calculation::{<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content">    Assigned as AssignedCandid, BaseRewards as BaseRewardsCandid,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-3</span><span class="line-content">    DailyBaseRewardsType3 as DailyBaseRewardsType3Candid, DailyResults as DailyResultsCandid,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-4</span><span class="line-content">    DayUtc as DayUtcCandid, NodeMetricsDaily as NodeMetricsDailyCandid,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-5</span><span class="line-content">    NodeProviderRewards as NodeProviderRewardsCandid, NodeResults as NodeResultsCandid,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-6</span><span class="line-content">    NodeStatus as NodeStatusCandid, Unassigned as UnassignedCandid,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content">    node_status::Status as StatusCandid,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+3</span><span class="line-content">    BaseRewards as BaseRewardsCandid, BaseRewardsType3 as BaseRewardsType3Candid, DayUtc,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+4</span><span class="line-content">    GetNodeProviderRewardsCalculationResponse, NodeMetricsDaily as NodeMetricsDailyCandid,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+5</span><span class="line-content">    NodeProviderRewards as NodeProviderRewardsCandid, NodeProviderRewardsDaily,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+6</span><span class="line-content">    NodeResults as NodeResultsCandid, NodeStatus as NodeStatusCandid,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-9</span><span class="line-content">use rewards_calculation::rewards_calculator_results::{NodeProviderRewards, NodeStatus};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content">use rewards_calculation::performance_based_algorithm::results::{<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+9</span><span class="line-content">    NodeStatus, RewardsCalculatorResults,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+10</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+11</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+12</span><span class="line-content">pub fn into_rewards_calculation_results(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+13</span><span class="line-content">    results: RewardsCalculatorResults,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+14</span><span class="line-content">    provider_id: PrincipalId,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+15</span><span class="line-content">) -&gt; GetNodeProviderRewardsCalculationResponse {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+16</span><span class="line-content">    let mut daily_rewards: Vec&lt;NodeProviderRewardsDaily&gt; = Vec::new();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+17</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+18</span><span class="line-content">    for (day, mut daily_results) in results.daily_results {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+19</span><span class="line-content">        let daily_provider_results = daily_results<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+20</span><span class="line-content">            .provider_results<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+21</span><span class="line-content">            .remove(&amp;provider_id)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+22</span><span class="line-content">            .ok_or(format!(&quot;No results found for provider_id: {}&quot;, provider_id))?;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">23</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-11</span><span class="line-content">pub fn to_candid_type(rewards: NodeProviderRewards) -&gt; NodeProviderRewardsCandid {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-12</span><span class="line-content">    NodeProviderRewardsCandid {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-13</span><span class="line-content">        rewards_total_xdr_permyriad: Some(rewards.rewards_total_xdr_permyriad),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-14</span><span class="line-content">        base_rewards: rewards<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+24</span><span class="line-content">        let nodes_results = daily_provider_results<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+25</span><span class="line-content">            .nodes_results<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+26</span><span class="line-content">            .iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+27</span><span class="line-content">            .map(|nr| NodeResultsCandid {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+28</span><span class="line-content">                node_id: Some(nr.node_id.get()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+29</span><span class="line-content">                node_reward_type: Some(nr.node_reward_type.to_string()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+30</span><span class="line-content">                region: Some(nr.region.clone()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+31</span><span class="line-content">                dc_id: Some(nr.dc_id.clone()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+32</span><span class="line-content">                node_status: match &amp;nr.node_status {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+33</span><span class="line-content">                    NodeStatus::Assigned { node_metrics } =&gt; Some(NodeStatusCandid::Assigned {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+34</span><span class="line-content">                        node_metrics: Some(NodeMetricsDailyCandid {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+35</span><span class="line-content">                            subnet_assigned: Some(node_metrics.subnet_assigned.get()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+36</span><span class="line-content">                            subnet_assigned_fr_percent: Some(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+37</span><span class="line-content">                                node_metrics.subnet_assigned_fr.into(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+38</span><span class="line-content">                            ),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+39</span><span class="line-content">                            num_blocks_proposed: Some(node_metrics.num_blocks_proposed),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+40</span><span class="line-content">                            num_blocks_failed: Some(node_metrics.num_blocks_failed),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+41</span><span class="line-content">                            original_fr_percent: Some(node_metrics.original_fr.into()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+42</span><span class="line-content">                            relative_fr_percent: Some(node_metrics.relative_fr.into()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+43</span><span class="line-content">                        }),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+44</span><span class="line-content">                    }),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+45</span><span class="line-content">                    NodeStatus::Unassigned { extrapolated_fr } =&gt; {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+46</span><span class="line-content">                        Some(NodeStatusCandid::Unassigned {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+47</span><span class="line-content">                            extrapolated_fr_percent: Some((*extrapolated_fr).into()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+48</span><span class="line-content">                        })<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+49</span><span class="line-content">                    }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+50</span><span class="line-content">                },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+51</span><span class="line-content">                performance_multiplier_percent: Some(nr.performance_multiplier.into()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+52</span><span class="line-content">                rewards_reduction_percent: Some(nr.rewards_reduction.into()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+53</span><span class="line-content">                base_rewards_xdr_permyriad: Some(nr.base_rewards.into()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+54</span><span class="line-content">                adjusted_rewards_xdr_permyriad: Some(nr.adjusted_rewards.into()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+55</span><span class="line-content">            })<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+56</span><span class="line-content">            .collect();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+57</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+58</span><span class="line-content">        // Map BaseRewards<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+59</span><span class="line-content">        let base_rewards = daily_provider_results<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">60</span><span class="line-content">             .base_rewards<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-16</span><span class="line-content">            .into_iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+61</span><span class="line-content">            .iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">62</span><span class="line-content">             .map(|br| BaseRewardsCandid {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-18</span><span class="line-content">                node_reward_type: Some(br.node_reward_type.to_string()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-19</span><span class="line-content">                region: Some(br.region),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">63</span><span class="line-content">                 monthly_xdr_permyriad: Some(br.monthly.into()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">64</span><span class="line-content">                 daily_xdr_permyriad: Some(br.daily.into()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+65</span><span class="line-content">                node_reward_type: Some(br.node_reward_type.to_string()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+66</span><span class="line-content">                region: Some(br.region.clone()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">67</span><span class="line-content">             })<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-23</span><span class="line-content">            .collect(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-24</span><span class="line-content">        base_rewards_type3: rewards<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+68</span><span class="line-content">            .collect();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+69</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+70</span><span class="line-content">        // Map BaseRewardsType3<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+71</span><span class="line-content">        let base_rewards_type3 = daily_provider_results<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">72</span><span class="line-content">             .base_rewards_type3<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-26</span><span class="line-content">            .into_iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-27</span><span class="line-content">            .map(|br3| DailyBaseRewardsType3Candid {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-28</span><span class="line-content">                day: Some(DayUtcCandid {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-29</span><span class="line-content">                    value: Some(br3.day.unix_ts_at_day_end()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-30</span><span class="line-content">                }),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-31</span><span class="line-content">                region: Some(br3.region),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+73</span><span class="line-content">            .iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+74</span><span class="line-content">            .map(|br3| BaseRewardsType3Candid {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+75</span><span class="line-content">                region: Some(br3.region.clone()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">76</span><span class="line-content">                 nodes_count: Some(br3.nodes_count as u64),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">77</span><span class="line-content">                 avg_rewards_xdr_permyriad: Some(br3.avg_rewards.into()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">78</span><span class="line-content">                 avg_coefficient_percent: Some(br3.avg_coefficient.into()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">79</span><span class="line-content">                 value_xdr_permyriad: Some(br3.value.into()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">80</span><span class="line-content">             })<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-37</span><span class="line-content">            .collect(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-38</span><span class="line-content">        nodes_results: rewards<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-39</span><span class="line-content">            .nodes_results<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-40</span><span class="line-content">            .into_iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-41</span><span class="line-content">            .map(|nr| NodeResultsCandid {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-42</span><span class="line-content">                node_id: Some(nr.node_id.get()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-43</span><span class="line-content">                node_reward_type: Some(nr.node_reward_type.to_string()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-44</span><span class="line-content">                region: Some(nr.region),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-45</span><span class="line-content">                dc_id: Some(nr.dc_id),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-46</span><span class="line-content">                daily_results: nr<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-47</span><span class="line-content">                    .daily_results<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-48</span><span class="line-content">                    .into_iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-49</span><span class="line-content">                    .map(|dr| DailyResultsCandid {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-50</span><span class="line-content">                        day: Some(DayUtcCandid {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-51</span><span class="line-content">                            value: Some(dr.day.unix_ts_at_day_end()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-52</span><span class="line-content">                        }),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-53</span><span class="line-content">                        node_status: match dr.node_status {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-54</span><span class="line-content">                            NodeStatus::Assigned { node_metrics } =&gt; Some(NodeStatusCandid {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-55</span><span class="line-content">                                status: Some(StatusCandid::Assigned(AssignedCandid {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-56</span><span class="line-content">                                    node_metrics: Some(NodeMetricsDailyCandid {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-57</span><span class="line-content">                                        subnet_assigned: Some(node_metrics.subnet_assigned.get()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-58</span><span class="line-content">                                        subnet_assigned_fr_percent: Some(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-59</span><span class="line-content">                                            node_metrics.subnet_assigned_fr.into(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-60</span><span class="line-content">                                        ),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-61</span><span class="line-content">                                        num_blocks_proposed: Some(node_metrics.num_blocks_proposed),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-62</span><span class="line-content">                                        num_blocks_failed: Some(node_metrics.num_blocks_failed),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-63</span><span class="line-content">                                        original_fr_percent: Some(node_metrics.original_fr.into()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-64</span><span class="line-content">                                        relative_fr_percent: Some(node_metrics.relative_fr.into()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-65</span><span class="line-content">                                    }),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-66</span><span class="line-content">                                })),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-67</span><span class="line-content">                            }),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-68</span><span class="line-content">                            NodeStatus::Unassigned { extrapolated_fr } =&gt; Some(NodeStatusCandid {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-69</span><span class="line-content">                                status: Some(StatusCandid::Unassigned(UnassignedCandid {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-70</span><span class="line-content">                                    extrapolated_fr_percent: Some(extrapolated_fr.into()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-71</span><span class="line-content">                                })),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-72</span><span class="line-content">                            }),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-73</span><span class="line-content">                        },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-74</span><span class="line-content">                        performance_multiplier_percent: Some(dr.performance_multiplier.into()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-75</span><span class="line-content">                        rewards_reduction_percent: Some(dr.rewards_reduction.into()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-76</span><span class="line-content">                        base_rewards_xdr_permyriad: Some(dr.base_rewards.into()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-77</span><span class="line-content">                        adjusted_rewards_xdr_permyriad: Some(dr.adjusted_rewards.into()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-78</span><span class="line-content">                    })<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-79</span><span class="line-content">                    .collect(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-80</span><span class="line-content">            })<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-81</span><span class="line-content">            .collect(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/api_conversion.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+81</span><span class="line-content">            .collect();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+82</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+83</span><span class="line-content">        let node_provider_rewards = NodeProviderRewardsCandid {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+84</span><span class="line-content">            rewards_total_xdr_permyriad: Some(daily_provider_results.rewards_total.into()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+85</span><span class="line-content">            base_rewards,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+86</span><span class="line-content">            base_rewards_type3,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+87</span><span class="line-content">            nodes_results,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+88</span><span class="line-content">        };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+89</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+90</span><span class="line-content">        daily_rewards.push(NodeProviderRewardsDaily {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+91</span><span class="line-content">            day_utc: Some(DayUtc {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+92</span><span class="line-content">                value: Some(day.unix_ts_at_day_end_nanoseconds()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+93</span><span class="line-content">            }),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+94</span><span class="line-content">            node_provider_rewards: Some(node_provider_rewards),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L94" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+95</span><span class="line-content">        });<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">96</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L96" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+97</span><span class="line-content">    Ok(daily_rewards)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">98</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L98" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">99</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/canister/mod.rs b/rs/node_rewards/canister/src/canister/mod.rs<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">100</span><span class="line-content">index 62e969f73b..20eef68823 100644<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/api_conversion.rs#L100" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/canister/mod.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/canister/mod.rs</div>
<div class="hunk-header">@@ -1,4 +1,4 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">use crate::api_conversion::to_candid_type;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">use crate::api_conversion::into_rewards_calculation_results;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use crate::metrics::MetricsManager;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use crate::registry_querier::RegistryQuerier;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use crate::storage::VM;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -17,19 +17,17 @@ use ic_node_rewards_canister_api::providers_rewards::{</div>
<div class="line context"><span class="line-number">17</span><span class="line-content"> use ic_protobuf::registry::dc::v1::DataCenterRecord;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content"> use ic_protobuf::registry::node_operator::v1::NodeOperatorRecord;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content"> use ic_protobuf::registry::node_rewards::v2::NodeRewardsTable;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-20</span><span class="line-content">use ic_registry_canister_client::{<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-21</span><span class="line-content">    CanisterRegistryClient, RegistryDataStableMemory, get_decoded_value,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-22</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+20</span><span class="line-content">use ic_registry_canister_client::{CanisterRegistryClient, get_decoded_value};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">21</span><span class="line-content"> use ic_registry_keys::{<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">22</span><span class="line-content">     DATA_CENTER_KEY_PREFIX, NODE_OPERATOR_RECORD_KEY_PREFIX, NODE_REWARDS_TABLE_KEY,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">23</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">24</span><span class="line-content"> use ic_registry_node_provider_rewards::{RewardsPerNodeProvider, calculate_rewards_v0};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-27</span><span class="line-content">use ic_types::RegistryVersion;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-28</span><span class="line-content">use rewards_calculation::rewards_calculator::RewardsCalculatorInput;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-29</span><span class="line-content">use rewards_calculation::rewards_calculator_results::RewardsCalculatorResults;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-30</span><span class="line-content">use rewards_calculation::types::RewardPeriod;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+25</span><span class="line-content">use ic_types::{RegistryVersion, Time};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+26</span><span class="line-content">use rewards_calculation::performance_based_algorithm::results::RewardsCalculatorResults;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+27</span><span class="line-content">use rewards_calculation::performance_based_algorithm::v1::RewardsCalculationV1;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+28</span><span class="line-content">use rewards_calculation::types::{DayUtc, NodeMetricsDailyRaw, RewardableNode};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">29</span><span class="line-content"> use std::cell::RefCell;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-32</span><span class="line-content">use std::collections::HashSet;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+30</span><span class="line-content">use std::collections::{BTreeMap, HashSet};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">31</span><span class="line-content"> use std::rc::Rc;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">32</span><span class="line-content"> use std::sync::Arc;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">33</span><span class="line-content"> use std::thread::LocalKey;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -37,6 +35,17 @@ use std::thread::LocalKey;</div>
<div class="line context"><span class="line-number">35</span><span class="line-content"> #[cfg(test)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">36</span><span class="line-content"> mod test;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">37</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+38</span><span class="line-content">#[cfg(target_arch = &quot;wasm32&quot;)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+39</span><span class="line-content">fn current_time() -&gt; Time {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+40</span><span class="line-content">    let current_time = ic_cdk::api::time();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+41</span><span class="line-content">    Time::from_nanos_since_unix_epoch(current_time)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+42</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+43</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+44</span><span class="line-content">#[cfg(not(any(target_arch = &quot;wasm32&quot;)))]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+45</span><span class="line-content">fn current_time() -&gt; Time {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+46</span><span class="line-content">    ic_types::time::current_time()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+47</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+48</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">49</span><span class="line-content"> /// This struct represents the API for the canister.  API methods should be implemented in<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">50</span><span class="line-content"> /// main.rs and defer the important work to the methods in this struct, essentially passing<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">51</span><span class="line-content"> /// through arguments and responses with almost no logic.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -73,7 +82,7 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">82</span><span class="line-content">     pub fn get_registry_value(&amp;self, key: String) -&gt; Result&lt;Option&lt;Vec&lt;u8&gt;&gt;, String&gt; {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">83</span><span class="line-content">         self.registry_client<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">84</span><span class="line-content">             .get_value(key.as_ref(), self.registry_client.get_latest_version())<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-76</span><span class="line-content">            .map_err(|e| format!(&quot;Failed to get registry value: {e:?}&quot;))<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+85</span><span class="line-content">            .map_err(|e| format!(&quot;Failed to get registry value: {:?}&quot;, e))<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">86</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">87</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">88</span><span class="line-content">     pub async fn schedule_registry_sync(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -118,39 +127,76 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">127</span><span class="line-content">         });<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L127" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">128</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L128" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">129</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L129" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-121</span><span class="line-content">    fn calculate_rewards&lt;S: RegistryDataStableMemory&gt;(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L121" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+130</span><span class="line-content">    fn validate_reward_period(from_day: &amp;DayUtc, to_day: &amp;DayUtc) -&gt; Result&lt;(), String&gt; {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L130" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+131</span><span class="line-content">        let today: DayUtc = current_time().as_nanos_since_unix_epoch().into();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L131" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+132</span><span class="line-content">        if from_day &gt; to_day {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L132" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+133</span><span class="line-content">            return Err(&quot;from_day must be before to_day&quot;.to_string());<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L133" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+134</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L134" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+135</span><span class="line-content">        if to_day &gt;= &amp;today {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L135" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+136</span><span class="line-content">            return Err(&quot;to_day_timestamp_nanos must be earlier than today&quot;.to_string());<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L136" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+137</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L137" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+138</span><span class="line-content">        Ok(())<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L138" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+139</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L139" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+140</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L140" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+141</span><span class="line-content">    fn calculate_rewards(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L141" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">142</span><span class="line-content">         &amp;self,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L142" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">143</span><span class="line-content">         request: GetNodeProvidersRewardsRequest,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L143" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">144</span><span class="line-content">         provider_filter: Option&lt;PrincipalId&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L144" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">145</span><span class="line-content">     ) -&gt; Result&lt;RewardsCalculatorResults, String&gt; {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L145" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-126</span><span class="line-content">        let reward_period = RewardPeriod::new(request.from_nanos.into(), request.to_nanos.into())<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L126" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-127</span><span class="line-content">            .map_err(|e| e.to_string())?;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L127" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+146</span><span class="line-content">        let start_day = DayUtc::from(request.from_day_timestamp_nanos);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+147</span><span class="line-content">        let end_day = DayUtc::from(request.to_day_timestamp_nanos);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L147" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+148</span><span class="line-content">        Self::validate_reward_period(&amp;start_day, &amp;end_day)?;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L148" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+149</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+150</span><span class="line-content">        RewardsCalculationV1::calculate_rewards(&amp;start_day, &amp;end_day, provider_filter, self)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L150" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+151</span><span class="line-content">            .map_err(|e| format!(&quot;Could not calculate rewards: {e:?}&quot;))<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L151" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+152</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L152" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+153</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L153" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+154</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L154" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+155</span><span class="line-content">impl rewards_calculation::performance_based_algorithm::DataProvider for &amp;NodeRewardsCanister {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L155" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+156</span><span class="line-content">    fn get_rewards_table(&amp;self, day: &amp;DayUtc) -&gt; Result&lt;NodeRewardsTable, String&gt; {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L156" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">157</span><span class="line-content">         let registry_querier = RegistryQuerier::new(self.registry_client.clone());<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L157" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">158</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L158" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">159</span><span class="line-content">         let version = registry_querier<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L159" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-131</span><span class="line-content">            .version_for_timestamp(reward_period.from.unix_ts_at_day_end())<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L131" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+160</span><span class="line-content">            .version_for_timestamp(day.unix_ts_at_day_end_nanoseconds())<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L160" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">161</span><span class="line-content">             .ok_or_else(|| &quot;Could not find registry version for timestamp&quot;.to_string())?;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L161" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-133</span><span class="line-content">        let rewards_table = registry_querier.get_rewards_table(version);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L133" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-134</span><span class="line-content">        let daily_metrics_by_subnet = self<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L134" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-135</span><span class="line-content">            .metrics_manager<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L135" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-136</span><span class="line-content">            .daily_metrics_by_subnet(reward_period.from, reward_period.to);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L136" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-137</span><span class="line-content">        let provider_rewardable_nodes = RegistryQuerier::get_rewardable_nodes_per_provider::&lt;S&gt;(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L137" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-138</span><span class="line-content">            &amp;*self.registry_client,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L138" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-139</span><span class="line-content">            reward_period.from,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L139" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-140</span><span class="line-content">            reward_period.to,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L140" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-141</span><span class="line-content">            provider_filter,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L141" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-142</span><span class="line-content">        )<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L142" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-143</span><span class="line-content">        .map_err(|e| format!(&quot;Could not get rewardable nodes: {e:?}&quot;))?;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L143" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-144</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L144" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-145</span><span class="line-content">        let input = RewardsCalculatorInput {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L145" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-146</span><span class="line-content">            reward_period,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-147</span><span class="line-content">            rewards_table,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L147" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-148</span><span class="line-content">            daily_metrics_by_subnet,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L148" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-149</span><span class="line-content">            provider_rewardable_nodes,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-150</span><span class="line-content">        };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L150" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+162</span><span class="line-content">        Ok(registry_querier.get_rewards_table(version))<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L162" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+163</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L163" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">164</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L164" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-152</span><span class="line-content">        rewards_calculation::rewards_calculator::calculate_rewards(input)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L152" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-153</span><span class="line-content">            .map_err(|e| format!(&quot;Could not calculate rewards: {e:?}&quot;))<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L153" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+165</span><span class="line-content">    fn get_daily_metrics_by_subnet(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L165" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+166</span><span class="line-content">        &amp;self,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L166" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+167</span><span class="line-content">        day: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L167" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+168</span><span class="line-content">    ) -&gt; Result&lt;BTreeMap&lt;SubnetId, Vec&lt;NodeMetricsDailyRaw&gt;&gt;, String&gt; {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L168" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+169</span><span class="line-content">        let metrics = self.metrics_manager.metrics_by_subnet(day);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L169" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+170</span><span class="line-content">        if metrics.is_empty() {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L170" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+171</span><span class="line-content">            return Err(format!(&quot;No metrics found for day {}&quot;, day.get()));<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L171" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+172</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L172" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+173</span><span class="line-content">        Ok(metrics)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L173" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+174</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L174" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+175</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L175" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+176</span><span class="line-content">    fn get_rewardable_nodes(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L176" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+177</span><span class="line-content">        &amp;self,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L177" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+178</span><span class="line-content">        day: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L178" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+179</span><span class="line-content">    ) -&gt; Result&lt;BTreeMap&lt;PrincipalId, Vec&lt;RewardableNode&gt;&gt;, String&gt; {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L179" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+180</span><span class="line-content">        let registry_client = self.get_registry_client();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L180" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+181</span><span class="line-content">        let registry_querier = RegistryQuerier::new(registry_client.clone());<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L181" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+182</span><span class="line-content">        registry_querier<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L182" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+183</span><span class="line-content">            .get_rewardable_nodes_per_provider(day, None)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L183" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+184</span><span class="line-content">            .map_err(|e| format!(&quot;Could not get rewardable nodes: {e:?}&quot;))<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L184" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+185</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L185" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+186</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L186" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+187</span><span class="line-content">    fn get_provider_rewardable_nodes(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L187" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+188</span><span class="line-content">        &amp;self,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L188" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+189</span><span class="line-content">        day: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L189" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+190</span><span class="line-content">        provider_id: &amp;PrincipalId,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L190" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+191</span><span class="line-content">    ) -&gt; Result&lt;Vec&lt;RewardableNode&gt;, String&gt; {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L191" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+192</span><span class="line-content">        let mut all_rewardable_nodes = self.get_rewardable_nodes(day)?;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L192" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+193</span><span class="line-content">        let rewardable_nodes = all_rewardable_nodes.remove(provider_id).ok_or_else(|| {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L193" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+194</span><span class="line-content">            format!(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L194" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+195</span><span class="line-content">                &quot;No rewardable nodes found for provider {} for day {}&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L195" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+196</span><span class="line-content">                provider_id, day<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L196" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+197</span><span class="line-content">            )<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L197" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+198</span><span class="line-content">        })?;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L198" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+199</span><span class="line-content">        Ok(rewardable_nodes)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L199" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">200</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L200" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">201</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L201" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">202</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L202" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -188,7 +234,8 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">234</span><span class="line-content">             registry_client.sync_registry_stored().await.map_err(|e| {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L234" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">235</span><span class="line-content">                 format!(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L235" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">236</span><span class="line-content">                     &quot;Could not sync registry store to latest version, \<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L236" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-191</span><span class="line-content">                    please try again later: {e:?}&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L191" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+237</span><span class="line-content">                    please try again later: {:?}&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L237" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+238</span><span class="line-content">                    e<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L238" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">239</span><span class="line-content">                 )<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L239" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">240</span><span class="line-content">             })?;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L240" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">241</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L241" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -224,7 +271,7 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">271</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L271" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">272</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L272" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">273</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L273" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-227</span><span class="line-content">    pub async fn get_node_providers_rewards&lt;S: RegistryDataStableMemory&gt;(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L227" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+274</span><span class="line-content">    pub async fn get_node_providers_rewards(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L274" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">275</span><span class="line-content">         canister: &amp;&#x27;static LocalKey&lt;RefCell&lt;NodeRewardsCanister&gt;&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L275" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">276</span><span class="line-content">         request: GetNodeProvidersRewardsRequest,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L276" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">277</span><span class="line-content">     ) -&gt; GetNodeProvidersRewardsResponse {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L277" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -233,18 +280,17 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">280</span><span class="line-content">             .map_err(|e| {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L280" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">281</span><span class="line-content">                 format!(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L281" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">282</span><span class="line-content">                     &quot;Could not sync registry store to latest version, \<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L282" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-236</span><span class="line-content">                    please try again later: {e:?}&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L236" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+283</span><span class="line-content">                    please try again later: {:?}&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L283" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+284</span><span class="line-content">                    e<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L284" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">285</span><span class="line-content">                 )<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L285" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">286</span><span class="line-content">             })?;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L286" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">287</span><span class="line-content">         NodeRewardsCanister::schedule_metrics_sync(canister).await;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L287" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-240</span><span class="line-content">        let result =<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L240" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-241</span><span class="line-content">            canister.with_borrow(|canister| canister.calculate_rewards::&lt;S&gt;(request, None))?;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L241" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+288</span><span class="line-content">        let result = canister.with_borrow(|canister| canister.calculate_rewards(request, None))?;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L288" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+289</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L289" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">290</span><span class="line-content">         let rewards_xdr_permyriad = result<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L290" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-243</span><span class="line-content">            .provider_results<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L243" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-244</span><span class="line-content">            .iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L244" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-245</span><span class="line-content">            .map(|(provider_id, provider_rewards)| {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L245" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-246</span><span class="line-content">                (provider_id.0, provider_rewards.rewards_total_xdr_permyriad)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L246" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-247</span><span class="line-content">            })<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L247" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+291</span><span class="line-content">            .total_rewards_xdr_permyriad<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L291" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+292</span><span class="line-content">            .into_iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L292" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+293</span><span class="line-content">            .map(|(k, v)| (k.0, v))<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L293" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">294</span><span class="line-content">             .collect();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L294" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">295</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L295" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">296</span><span class="line-content">         Ok(NodeProvidersRewards {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L296" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -252,24 +298,18 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">298</span><span class="line-content">         })<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L298" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">299</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L299" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">300</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L300" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-255</span><span class="line-content">    pub fn get_node_provider_rewards_calculation&lt;S: RegistryDataStableMemory&gt;(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L255" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+301</span><span class="line-content">    pub fn get_node_provider_rewards_calculation(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L301" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">302</span><span class="line-content">         canister: &amp;&#x27;static LocalKey&lt;RefCell&lt;NodeRewardsCanister&gt;&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L302" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">303</span><span class="line-content">         request: GetNodeProviderRewardsCalculationRequest,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L303" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">304</span><span class="line-content">     ) -&gt; GetNodeProviderRewardsCalculationResponse {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L304" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">305</span><span class="line-content">         let provider_id = PrincipalId::from(request.provider_id);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L305" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">306</span><span class="line-content">         let request_inner = GetNodeProvidersRewardsRequest {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L306" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-261</span><span class="line-content">            from_nanos: request.from_nanos,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L261" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-262</span><span class="line-content">            to_nanos: request.to_nanos,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L262" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+307</span><span class="line-content">            from_day_timestamp_nanos: request.from_day_timestamp_nanos,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L307" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+308</span><span class="line-content">            to_day_timestamp_nanos: request.to_day_timestamp_nanos,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L308" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">309</span><span class="line-content">         };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L309" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-264</span><span class="line-content">        let mut result = canister.with_borrow(|canister| {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L264" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-265</span><span class="line-content">            canister.calculate_rewards::&lt;S&gt;(request_inner, Some(provider_id))<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L265" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-266</span><span class="line-content">        })?;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L266" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-267</span><span class="line-content">        let node_provider_rewards = result<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L267" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-268</span><span class="line-content">            .provider_results<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L268" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-269</span><span class="line-content">            .remove(&amp;provider_id)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L269" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-270</span><span class="line-content">            .ok_or(format!(&quot;No rewards found for node provider {provider_id}&quot;))?;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L270" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-271</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L271" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-272</span><span class="line-content">        Ok(to_candid_type(node_provider_rewards))<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/mod.rs#L272" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+310</span><span class="line-content">        let result = canister<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L310" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+311</span><span class="line-content">            .with_borrow(|canister| canister.calculate_rewards(request_inner, Some(provider_id)))?;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L311" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+312</span><span class="line-content">        into_rewards_calculation_results(result, provider_id)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L312" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">313</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L313" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">314</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L314" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">315</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L315" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">316</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs b/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L316" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">317</span><span class="line-content">index 041b326ddb..9171eb4ec7 100644<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/mod.rs#L317" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs</div>
<div class="hunk-header">@@ -1,13 +1,9 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">use crate::api_conversion::to_candid_type;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> use crate::canister::NodeRewardsCanister;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-3</span><span class="line-content">use crate::canister::test::test_utils::{<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-4</span><span class="line-content">    CANISTER_TEST, TestState, VM, setup_thread_local_canister_for_test,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-5</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+2</span><span class="line-content">use crate::canister::test::test_utils::{CANISTER_TEST, VM, setup_thread_local_canister_for_test};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use crate::metrics::MetricsManager;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use crate::pb::v1::{NodeMetrics, SubnetMetricsKey, SubnetMetricsValue};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use futures_util::FutureExt;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use ic_nervous_system_canisters::registry::fake::FakeRegistry;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-10</span><span class="line-content">use ic_node_rewards_canister_api::provider_rewards_calculation::GetNodeProviderRewardsCalculationRequest;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> use ic_node_rewards_canister_api::providers_rewards::{<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content">     GetNodeProvidersRewardsRequest, NodeProvidersRewards,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -20,12 +16,10 @@ use ic_registry_keys::{</div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content"> use ic_types::PrincipalId;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content"> use maplit::btreemap;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-23</span><span class="line-content">use rewards_calculation::rewards_calculator::test_utils::{<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+19</span><span class="line-content">use rewards_calculation::performance_based_algorithm::test_utils::{<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">20</span><span class="line-content">     create_rewards_table_for_region_test, test_node_id, test_provider_id, test_subnet_id,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">21</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-26</span><span class="line-content">use rewards_calculation::rewards_calculator_results::NodeProviderRewards;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">22</span><span class="line-content"> use rewards_calculation::types::DayUtc;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-28</span><span class="line-content">use std::collections::BTreeMap;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">23</span><span class="line-content"> use std::rc::Rc;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">24</span><span class="line-content"> use std::str::FromStr;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">25</span><span class="line-content"> use std::sync::Arc;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -247,7 +241,7 @@ fn setup_data_for_test_rewards_calculation(</div>
<div class="line context"><span class="line-number">241</span><span class="line-content">     // Day 1 subnet 1<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L241" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">242</span><span class="line-content">     subnets_metrics.insert(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L242" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">243</span><span class="line-content">         SubnetMetricsKey {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L243" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-250</span><span class="line-content">            timestamp_nanos: day1.unix_ts_at_day_end(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L250" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+244</span><span class="line-content">            timestamp_nanos: day1.unix_ts_at_day_end_nanoseconds(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L244" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">245</span><span class="line-content">             subnet_id: Some(subnet1.get()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L245" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">246</span><span class="line-content">         },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L246" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">247</span><span class="line-content">         SubnetMetricsValue {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L247" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -279,7 +273,7 @@ fn setup_data_for_test_rewards_calculation(</div>
<div class="line context"><span class="line-number">273</span><span class="line-content">     // Day 1 subnet 2<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L273" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">274</span><span class="line-content">     subnets_metrics.insert(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L274" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">275</span><span class="line-content">         SubnetMetricsKey {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L275" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-282</span><span class="line-content">            timestamp_nanos: day1.unix_ts_at_day_end(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L282" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+276</span><span class="line-content">            timestamp_nanos: day1.unix_ts_at_day_end_nanoseconds(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L276" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">277</span><span class="line-content">             subnet_id: Some(subnet2.get()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L277" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">278</span><span class="line-content">         },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L278" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">279</span><span class="line-content">         SubnetMetricsValue {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L279" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -294,7 +288,7 @@ fn setup_data_for_test_rewards_calculation(</div>
<div class="line context"><span class="line-number">288</span><span class="line-content">     // Day 2 subnet 1<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L288" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">289</span><span class="line-content">     subnets_metrics.insert(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L289" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">290</span><span class="line-content">         SubnetMetricsKey {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L290" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-297</span><span class="line-content">            timestamp_nanos: day2.unix_ts_at_day_end(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L297" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+291</span><span class="line-content">            timestamp_nanos: day2.unix_ts_at_day_end_nanoseconds(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L291" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">292</span><span class="line-content">             subnet_id: Some(subnet1.get()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L292" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">293</span><span class="line-content">         },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L293" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">294</span><span class="line-content">         SubnetMetricsValue {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L294" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -307,311 +301,25 @@ fn setup_data_for_test_rewards_calculation(</div>
<div class="line context"><span class="line-number">301</span><span class="line-content">     );<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L301" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">302</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L302" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">303</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L303" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-310</span><span class="line-content">const EXPECTED_TEST_1: &amp;str = r#&quot;{<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L310" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-311</span><span class="line-content">  &quot;6fyp7-3ibaa-aaaaa-aaaap-4ai&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L311" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-312</span><span class="line-content">    &quot;rewards_total_xdr_permyriad&quot;: 137200,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L312" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-313</span><span class="line-content">    &quot;base_rewards&quot;: [<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L313" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-314</span><span class="line-content">      {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L314" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-315</span><span class="line-content">        &quot;node_reward_type&quot;: &quot;Type1&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L315" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-316</span><span class="line-content">        &quot;region&quot;: &quot;Europe,Switzerland&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L316" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-317</span><span class="line-content">        &quot;monthly&quot;: &quot;304375&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L317" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-318</span><span class="line-content">        &quot;daily&quot;: &quot;10000&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L318" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-319</span><span class="line-content">      },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L319" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-320</span><span class="line-content">      {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L320" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-321</span><span class="line-content">        &quot;node_reward_type&quot;: &quot;Type3&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L321" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-322</span><span class="line-content">        &quot;region&quot;: &quot;North America,USA,California&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L322" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-323</span><span class="line-content">        &quot;monthly&quot;: &quot;913125&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L323" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-324</span><span class="line-content">        &quot;daily&quot;: &quot;30000&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L324" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-325</span><span class="line-content">      },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L325" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-326</span><span class="line-content">      {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L326" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-327</span><span class="line-content">        &quot;node_reward_type&quot;: &quot;Type3dot1&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L327" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-328</span><span class="line-content">        &quot;region&quot;: &quot;North America,USA,Nevada&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L328" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-329</span><span class="line-content">        &quot;monthly&quot;: &quot;1217500&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L329" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-330</span><span class="line-content">        &quot;daily&quot;: &quot;40000&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L330" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-331</span><span class="line-content">      }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L331" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-332</span><span class="line-content">    ],<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L332" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-333</span><span class="line-content">    &quot;base_rewards_type3&quot;: [<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L333" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-334</span><span class="line-content">      {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L334" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-335</span><span class="line-content">        &quot;day&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L335" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-336</span><span class="line-content">          &quot;value&quot;: 1704153599999999999<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L336" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-337</span><span class="line-content">        },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L337" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-338</span><span class="line-content">        &quot;region&quot;: &quot;North America:USA&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L338" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-339</span><span class="line-content">        &quot;nodes_count&quot;: 2,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L339" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-340</span><span class="line-content">        &quot;avg_rewards&quot;: &quot;35000&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L340" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-341</span><span class="line-content">        &quot;avg_coefficient&quot;: &quot;0.80&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L341" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-342</span><span class="line-content">        &quot;value&quot;: &quot;31500.00&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L342" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-343</span><span class="line-content">      },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L343" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-344</span><span class="line-content">      {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L344" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-345</span><span class="line-content">        &quot;day&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L345" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-346</span><span class="line-content">          &quot;value&quot;: 1704239999999999999<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L346" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-347</span><span class="line-content">        },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L347" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-348</span><span class="line-content">        &quot;region&quot;: &quot;North America:USA&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L348" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-349</span><span class="line-content">        &quot;nodes_count&quot;: 1,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L349" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-350</span><span class="line-content">        &quot;avg_rewards&quot;: &quot;30000&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L350" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-351</span><span class="line-content">        &quot;avg_coefficient&quot;: &quot;0.90&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L351" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-352</span><span class="line-content">        &quot;value&quot;: &quot;30000&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L352" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-353</span><span class="line-content">      }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L353" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-354</span><span class="line-content">    ],<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L354" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-355</span><span class="line-content">    &quot;nodes_results&quot;: [<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L355" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-356</span><span class="line-content">      {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L356" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-357</span><span class="line-content">        &quot;node_id&quot;: &quot;zv7tz-zylaa-aaaaa-aaaap-2ai&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L357" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-358</span><span class="line-content">        &quot;node_reward_type&quot;: &quot;Type1&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L358" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-359</span><span class="line-content">        &quot;region&quot;: &quot;Europe,Switzerland&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L359" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-360</span><span class="line-content">        &quot;dc_id&quot;: &quot;dc1&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L360" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-361</span><span class="line-content">        &quot;daily_results&quot;: [<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L361" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-362</span><span class="line-content">          {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L362" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-363</span><span class="line-content">            &quot;day&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L363" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-364</span><span class="line-content">              &quot;value&quot;: 1704153599999999999<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L364" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-365</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L365" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-366</span><span class="line-content">            &quot;node_status&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L366" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-367</span><span class="line-content">              &quot;Assigned&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L367" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-368</span><span class="line-content">                &quot;node_metrics&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L368" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-369</span><span class="line-content">                  &quot;subnet_assigned&quot;: &quot;yndj2-3ybaa-aaaaa-aaaap-yai&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L369" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-370</span><span class="line-content">                  &quot;subnet_assigned_fr&quot;: &quot;0.25&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L370" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-371</span><span class="line-content">                  &quot;num_blocks_proposed&quot;: 95,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L371" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-372</span><span class="line-content">                  &quot;num_blocks_failed&quot;: 5,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L372" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-373</span><span class="line-content">                  &quot;original_fr&quot;: &quot;0.05&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L373" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-374</span><span class="line-content">                  &quot;relative_fr&quot;: &quot;0&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L374" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-375</span><span class="line-content">                }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L375" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-376</span><span class="line-content">              }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L376" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-377</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L377" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-378</span><span class="line-content">            &quot;performance_multiplier&quot;: &quot;1&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L378" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-379</span><span class="line-content">            &quot;rewards_reduction&quot;: &quot;0&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L379" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-380</span><span class="line-content">            &quot;base_rewards&quot;: &quot;10000&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L380" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-381</span><span class="line-content">            &quot;adjusted_rewards&quot;: &quot;10000&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L381" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-382</span><span class="line-content">          },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L382" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-383</span><span class="line-content">          {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L383" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-384</span><span class="line-content">            &quot;day&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L384" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-385</span><span class="line-content">              &quot;value&quot;: 1704239999999999999<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L385" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-386</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L386" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-387</span><span class="line-content">            &quot;node_status&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L387" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-388</span><span class="line-content">              &quot;Assigned&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L388" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-389</span><span class="line-content">                &quot;node_metrics&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L389" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-390</span><span class="line-content">                  &quot;subnet_assigned&quot;: &quot;yndj2-3ybaa-aaaaa-aaaap-yai&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L390" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-391</span><span class="line-content">                  &quot;subnet_assigned_fr&quot;: &quot;0.02&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L391" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-392</span><span class="line-content">                  &quot;num_blocks_proposed&quot;: 98,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L392" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-393</span><span class="line-content">                  &quot;num_blocks_failed&quot;: 2,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L393" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-394</span><span class="line-content">                  &quot;original_fr&quot;: &quot;0.02&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L394" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-395</span><span class="line-content">                  &quot;relative_fr&quot;: &quot;0.00&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L395" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-396</span><span class="line-content">                }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L396" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-397</span><span class="line-content">              }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L397" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-398</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L398" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-399</span><span class="line-content">            &quot;performance_multiplier&quot;: &quot;1&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L399" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-400</span><span class="line-content">            &quot;rewards_reduction&quot;: &quot;0&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L400" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-401</span><span class="line-content">            &quot;base_rewards&quot;: &quot;10000&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L401" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-402</span><span class="line-content">            &quot;adjusted_rewards&quot;: &quot;10000&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L402" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-403</span><span class="line-content">          }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L403" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-404</span><span class="line-content">        ]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L404" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-405</span><span class="line-content">      },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L405" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-406</span><span class="line-content">      {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L406" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-407</span><span class="line-content">        &quot;node_id&quot;: &quot;f6rsp-hqmaa-aaaaa-aaaap-2ai&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L407" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-408</span><span class="line-content">        &quot;node_reward_type&quot;: &quot;Type3&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L408" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-409</span><span class="line-content">        &quot;region&quot;: &quot;North America,USA,California&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L409" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-410</span><span class="line-content">        &quot;dc_id&quot;: &quot;dc2&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L410" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-411</span><span class="line-content">        &quot;daily_results&quot;: [<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L411" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-412</span><span class="line-content">          {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L412" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-413</span><span class="line-content">            &quot;day&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L413" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-414</span><span class="line-content">              &quot;value&quot;: 1704153599999999999<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L414" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-415</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L415" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-416</span><span class="line-content">            &quot;node_status&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L416" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-417</span><span class="line-content">              &quot;Assigned&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L417" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-418</span><span class="line-content">                &quot;node_metrics&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L418" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-419</span><span class="line-content">                  &quot;subnet_assigned&quot;: &quot;yndj2-3ybaa-aaaaa-aaaap-yai&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L419" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-420</span><span class="line-content">                  &quot;subnet_assigned_fr&quot;: &quot;0.25&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L420" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-421</span><span class="line-content">                  &quot;num_blocks_proposed&quot;: 90,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L421" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-422</span><span class="line-content">                  &quot;num_blocks_failed&quot;: 10,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L422" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-423</span><span class="line-content">                  &quot;original_fr&quot;: &quot;0.10&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L423" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-424</span><span class="line-content">                  &quot;relative_fr&quot;: &quot;0&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L424" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-425</span><span class="line-content">                }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L425" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-426</span><span class="line-content">              }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L426" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-427</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L427" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-428</span><span class="line-content">            &quot;performance_multiplier&quot;: &quot;1&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L428" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-429</span><span class="line-content">            &quot;rewards_reduction&quot;: &quot;0&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L429" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-430</span><span class="line-content">            &quot;base_rewards&quot;: &quot;31500.00&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L430" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-431</span><span class="line-content">            &quot;adjusted_rewards&quot;: &quot;31500.00&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L431" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-432</span><span class="line-content">          },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L432" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-433</span><span class="line-content">          {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L433" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-434</span><span class="line-content">            &quot;day&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L434" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-435</span><span class="line-content">              &quot;value&quot;: 1704239999999999999<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L435" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-436</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L436" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-437</span><span class="line-content">            &quot;node_status&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L437" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-438</span><span class="line-content">              &quot;Unassigned&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L438" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-439</span><span class="line-content">                &quot;extrapolated_fr&quot;: &quot;0&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L439" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-440</span><span class="line-content">              }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L440" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-441</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L441" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-442</span><span class="line-content">            &quot;performance_multiplier&quot;: &quot;1&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L442" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-443</span><span class="line-content">            &quot;rewards_reduction&quot;: &quot;0&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L443" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-444</span><span class="line-content">            &quot;base_rewards&quot;: &quot;30000&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L444" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-445</span><span class="line-content">            &quot;adjusted_rewards&quot;: &quot;30000&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L445" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-446</span><span class="line-content">          }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L446" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-447</span><span class="line-content">        ]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L447" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-448</span><span class="line-content">      },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L448" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-449</span><span class="line-content">      {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L449" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-450</span><span class="line-content">        &quot;node_id&quot;: &quot;ybquz-ianaa-aaaaa-aaaap-2ai&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L450" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-451</span><span class="line-content">        &quot;node_reward_type&quot;: &quot;Type3dot1&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L451" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-452</span><span class="line-content">        &quot;region&quot;: &quot;North America,USA,Nevada&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L452" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-453</span><span class="line-content">        &quot;dc_id&quot;: &quot;dc3&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L453" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-454</span><span class="line-content">        &quot;daily_results&quot;: [<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L454" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-455</span><span class="line-content">          {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L455" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-456</span><span class="line-content">            &quot;day&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L456" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-457</span><span class="line-content">              &quot;value&quot;: 1704153599999999999<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L457" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-458</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L458" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-459</span><span class="line-content">            &quot;node_status&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L459" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-460</span><span class="line-content">              &quot;Assigned&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L460" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-461</span><span class="line-content">                &quot;node_metrics&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L461" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-462</span><span class="line-content">                  &quot;subnet_assigned&quot;: &quot;yndj2-3ybaa-aaaaa-aaaap-yai&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L462" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-463</span><span class="line-content">                  &quot;subnet_assigned_fr&quot;: &quot;0.25&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L463" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-464</span><span class="line-content">                  &quot;num_blocks_proposed&quot;: 75,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L464" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-465</span><span class="line-content">                  &quot;num_blocks_failed&quot;: 25,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L465" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-466</span><span class="line-content">                  &quot;original_fr&quot;: &quot;0.25&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L466" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-467</span><span class="line-content">                  &quot;relative_fr&quot;: &quot;0.00&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L467" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-468</span><span class="line-content">                }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L468" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-469</span><span class="line-content">              }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L469" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-470</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L470" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-471</span><span class="line-content">            &quot;performance_multiplier&quot;: &quot;1&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L471" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-472</span><span class="line-content">            &quot;rewards_reduction&quot;: &quot;0&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L472" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-473</span><span class="line-content">            &quot;base_rewards&quot;: &quot;31500.00&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L473" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-474</span><span class="line-content">            &quot;adjusted_rewards&quot;: &quot;31500.00&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L474" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-475</span><span class="line-content">          }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L475" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-476</span><span class="line-content">        ]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L476" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-477</span><span class="line-content">      },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L477" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-478</span><span class="line-content">      {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L478" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-479</span><span class="line-content">        &quot;node_id&quot;: &quot;fnlpp-iyoaa-aaaaa-aaaap-2ai&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L479" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-480</span><span class="line-content">        &quot;node_reward_type&quot;: &quot;Type1&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L480" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-481</span><span class="line-content">        &quot;region&quot;: &quot;Europe,Switzerland&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L481" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-482</span><span class="line-content">        &quot;dc_id&quot;: &quot;dc1&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L482" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-483</span><span class="line-content">        &quot;daily_results&quot;: [<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L483" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-484</span><span class="line-content">          {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L484" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-485</span><span class="line-content">            &quot;day&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L485" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-486</span><span class="line-content">              &quot;value&quot;: 1704153599999999999<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L486" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-487</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L487" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-488</span><span class="line-content">            &quot;node_status&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L488" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-489</span><span class="line-content">              &quot;Unassigned&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L489" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-490</span><span class="line-content">                &quot;extrapolated_fr&quot;: &quot;0.1125&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L490" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-491</span><span class="line-content">              }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L491" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-492</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L492" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-493</span><span class="line-content">            &quot;performance_multiplier&quot;: &quot;0.9800&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L493" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-494</span><span class="line-content">            &quot;rewards_reduction&quot;: &quot;0.0200&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L494" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-495</span><span class="line-content">            &quot;base_rewards&quot;: &quot;10000&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L495" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-496</span><span class="line-content">            &quot;adjusted_rewards&quot;: &quot;9800.0000&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L496" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-497</span><span class="line-content">          },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L497" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-498</span><span class="line-content">          {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L498" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-499</span><span class="line-content">            &quot;day&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L499" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-500</span><span class="line-content">              &quot;value&quot;: 1704239999999999999<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L500" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-501</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L501" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-502</span><span class="line-content">            &quot;node_status&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L502" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-503</span><span class="line-content">              &quot;Unassigned&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L503" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-504</span><span class="line-content">                &quot;extrapolated_fr&quot;: &quot;0&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L504" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-505</span><span class="line-content">              }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L505" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-506</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L506" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-507</span><span class="line-content">            &quot;performance_multiplier&quot;: &quot;1&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L507" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-508</span><span class="line-content">            &quot;rewards_reduction&quot;: &quot;0&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L508" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-509</span><span class="line-content">            &quot;base_rewards&quot;: &quot;10000&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L509" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-510</span><span class="line-content">            &quot;adjusted_rewards&quot;: &quot;10000&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L510" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-511</span><span class="line-content">          }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L511" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-512</span><span class="line-content">        ]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L512" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-513</span><span class="line-content">      },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L513" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-514</span><span class="line-content">      {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L514" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-515</span><span class="line-content">        &quot;node_id&quot;: &quot;yskjz-hipaa-aaaaa-aaaap-2ai&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L515" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-516</span><span class="line-content">        &quot;node_reward_type&quot;: &quot;Type1&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L516" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-517</span><span class="line-content">        &quot;region&quot;: &quot;Europe,Switzerland&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L517" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-518</span><span class="line-content">        &quot;dc_id&quot;: &quot;dc1&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L518" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-519</span><span class="line-content">        &quot;daily_results&quot;: [<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L519" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-520</span><span class="line-content">          {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L520" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-521</span><span class="line-content">            &quot;day&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L521" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-522</span><span class="line-content">              &quot;value&quot;: 1704153599999999999<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L522" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-523</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L523" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-524</span><span class="line-content">            &quot;node_status&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L524" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-525</span><span class="line-content">              &quot;Assigned&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L525" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-526</span><span class="line-content">                &quot;node_metrics&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L526" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-527</span><span class="line-content">                  &quot;subnet_assigned&quot;: &quot;yndj2-3ybaa-aaaaa-aaaap-yai&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L527" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-528</span><span class="line-content">                  &quot;subnet_assigned_fr&quot;: &quot;0.25&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L528" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-529</span><span class="line-content">                  &quot;num_blocks_proposed&quot;: 30,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L529" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-530</span><span class="line-content">                  &quot;num_blocks_failed&quot;: 70,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L530" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-531</span><span class="line-content">                  &quot;original_fr&quot;: &quot;0.70&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L531" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-532</span><span class="line-content">                  &quot;relative_fr&quot;: &quot;0.45&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L532" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-533</span><span class="line-content">                }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L533" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-534</span><span class="line-content">              }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L534" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-535</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L535" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-536</span><span class="line-content">            &quot;performance_multiplier&quot;: &quot;0.44&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L536" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-537</span><span class="line-content">            &quot;rewards_reduction&quot;: &quot;0.56&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L537" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-538</span><span class="line-content">            &quot;base_rewards&quot;: &quot;10000&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L538" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-539</span><span class="line-content">            &quot;adjusted_rewards&quot;: &quot;4400.00&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L539" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-540</span><span class="line-content">          }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L540" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-541</span><span class="line-content">        ]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L541" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-542</span><span class="line-content">      }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L542" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-543</span><span class="line-content">    ]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L543" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-544</span><span class="line-content">  },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L544" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-545</span><span class="line-content">  &quot;djduj-3qcaa-aaaaa-aaaap-4ai&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L545" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-546</span><span class="line-content">    &quot;rewards_total_xdr_permyriad&quot;: 10000,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L546" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-547</span><span class="line-content">    &quot;base_rewards&quot;: [<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L547" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-548</span><span class="line-content">      {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L548" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-549</span><span class="line-content">        &quot;node_reward_type&quot;: &quot;Type1&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L549" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-550</span><span class="line-content">        &quot;region&quot;: &quot;Europe,Switzerland&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L550" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-551</span><span class="line-content">        &quot;monthly&quot;: &quot;304375&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L551" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-552</span><span class="line-content">        &quot;daily&quot;: &quot;10000&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L552" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-553</span><span class="line-content">      }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L553" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-554</span><span class="line-content">    ],<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L554" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-555</span><span class="line-content">    &quot;base_rewards_type3&quot;: [],<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L555" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-556</span><span class="line-content">    &quot;nodes_results&quot;: [<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L556" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-557</span><span class="line-content">      {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L557" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-558</span><span class="line-content">        &quot;node_id&quot;: &quot;6qmi3-pavaa-aaaaa-aaaap-2ai&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L558" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-559</span><span class="line-content">        &quot;node_reward_type&quot;: &quot;Type1&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L559" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-560</span><span class="line-content">        &quot;region&quot;: &quot;Europe,Switzerland&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L560" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-561</span><span class="line-content">        &quot;dc_id&quot;: &quot;dc1&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L561" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-562</span><span class="line-content">        &quot;daily_results&quot;: [<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L562" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-563</span><span class="line-content">          {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L563" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-564</span><span class="line-content">            &quot;day&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L564" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-565</span><span class="line-content">              &quot;value&quot;: 1704153599999999999<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L565" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-566</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L566" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-567</span><span class="line-content">            &quot;node_status&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L567" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-568</span><span class="line-content">              &quot;Assigned&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L568" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-569</span><span class="line-content">                &quot;node_metrics&quot;: {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L569" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-570</span><span class="line-content">                  &quot;subnet_assigned&quot;: &quot;fbysm-3acaa-aaaaa-aaaap-yai&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L570" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-571</span><span class="line-content">                  &quot;subnet_assigned_fr&quot;: &quot;0.20&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L571" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-572</span><span class="line-content">                  &quot;num_blocks_proposed&quot;: 80,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L572" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-573</span><span class="line-content">                  &quot;num_blocks_failed&quot;: 20,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L573" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-574</span><span class="line-content">                  &quot;original_fr&quot;: &quot;0.20&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L574" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-575</span><span class="line-content">                  &quot;relative_fr&quot;: &quot;0.00&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L575" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-576</span><span class="line-content">                }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L576" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-577</span><span class="line-content">              }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L577" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-578</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L578" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-579</span><span class="line-content">            &quot;performance_multiplier&quot;: &quot;1&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L579" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-580</span><span class="line-content">            &quot;rewards_reduction&quot;: &quot;0&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L580" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-581</span><span class="line-content">            &quot;base_rewards&quot;: &quot;10000&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L581" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-582</span><span class="line-content">            &quot;adjusted_rewards&quot;: &quot;10000&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L582" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-583</span><span class="line-content">          }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L583" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-584</span><span class="line-content">        ]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L584" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-585</span><span class="line-content">      }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L585" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-586</span><span class="line-content">    ]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L586" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-587</span><span class="line-content">  }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L587" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-588</span><span class="line-content">}&quot;#;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L588" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">304</span><span class="line-content"> #[test]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L304" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">305</span><span class="line-content"> fn test_get_node_providers_rewards() {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L305" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">306</span><span class="line-content">     use pretty_assertions::assert_eq;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L306" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">307</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L307" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">308</span><span class="line-content">     let (fake_registry, metrics_manager) = setup_thread_local_canister_for_test();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L308" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">309</span><span class="line-content">     setup_data_for_test_rewards_calculation(fake_registry, metrics_manager);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L309" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+310</span><span class="line-content">    NodeRewardsCanister::schedule_registry_sync(&amp;CANISTER_TEST).now_or_never();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L310" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+311</span><span class="line-content">    NodeRewardsCanister::schedule_metrics_sync(&amp;CANISTER_TEST).now_or_never();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L311" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">312</span><span class="line-content">     let from = DayUtc::try_from(&quot;2024-01-01&quot;).unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L312" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">313</span><span class="line-content">     let to = DayUtc::try_from(&quot;2024-01-02&quot;).unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L313" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">314</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L314" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">315</span><span class="line-content">     let request = GetNodeProvidersRewardsRequest {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L315" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-599</span><span class="line-content">        from_nanos: from.unix_ts_at_day_start(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L599" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-600</span><span class="line-content">        to_nanos: to.unix_ts_at_day_end(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L600" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+316</span><span class="line-content">        from_day_timestamp_nanos: from.unix_ts_at_day_start_nanoseconds(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L316" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+317</span><span class="line-content">        to_day_timestamp_nanos: to.unix_ts_at_day_end_nanoseconds(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L317" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">318</span><span class="line-content">     };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L318" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-602</span><span class="line-content">    let result_endpoint = NodeRewardsCanister::get_node_providers_rewards::&lt;TestState&gt;(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L602" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-603</span><span class="line-content">        &amp;CANISTER_TEST,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L603" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-604</span><span class="line-content">        request.clone(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L604" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-605</span><span class="line-content">    )<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L605" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-606</span><span class="line-content">    .now_or_never()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L606" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-607</span><span class="line-content">    .unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L607" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-608</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L608" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-609</span><span class="line-content">    let inner_results = CANISTER_TEST<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L609" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-610</span><span class="line-content">        .with_borrow(|canister| canister.calculate_rewards::&lt;TestState&gt;(request, None))<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L610" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-611</span><span class="line-content">        .unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L611" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-612</span><span class="line-content">    let expected: BTreeMap&lt;PrincipalId, NodeProviderRewards&gt; =<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L612" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-613</span><span class="line-content">        serde_json::from_str(EXPECTED_TEST_1).unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L613" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-614</span><span class="line-content">    assert_eq!(inner_results.provider_results, expected);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L614" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+319</span><span class="line-content">    let result_endpoint =<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L319" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+320</span><span class="line-content">        NodeRewardsCanister::get_node_providers_rewards(&amp;CANISTER_TEST, request.clone())<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L320" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+321</span><span class="line-content">            .now_or_never()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L321" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+322</span><span class="line-content">            .unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L322" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">323</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L323" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">324</span><span class="line-content">     let expected = NodeProvidersRewards {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L324" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">325</span><span class="line-content">         rewards_xdr_permyriad: btreemap! {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L325" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -621,50 +329,3 @@ fn test_get_node_providers_rewards() {</div>
<div class="line context"><span class="line-number">329</span><span class="line-content">     };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L329" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">330</span><span class="line-content">     assert_eq!(result_endpoint, Ok(expected));<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L330" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">331</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L331" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-624</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L624" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-625</span><span class="line-content">#[test]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L625" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-626</span><span class="line-content">fn test_get_node_provider_rewards_calculation_historical() {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L626" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-627</span><span class="line-content">    use pretty_assertions::assert_eq;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L627" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-628</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L628" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-629</span><span class="line-content">    let (fake_registry, metrics_manager) = setup_thread_local_canister_for_test();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L629" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-630</span><span class="line-content">    setup_data_for_test_rewards_calculation(fake_registry, metrics_manager);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L630" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-631</span><span class="line-content">    let from = DayUtc::try_from(&quot;2024-01-01&quot;).unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L631" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-632</span><span class="line-content">    let to = DayUtc::try_from(&quot;2024-01-02&quot;).unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L632" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-633</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L633" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-634</span><span class="line-content">    let request = GetNodeProvidersRewardsRequest {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L634" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-635</span><span class="line-content">        from_nanos: from.unix_ts_at_day_end(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L635" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-636</span><span class="line-content">        to_nanos: to.unix_ts_at_day_end(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L636" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-637</span><span class="line-content">    };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L637" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-638</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L638" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-639</span><span class="line-content">    // Invoke to populate historical rewards<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L639" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-640</span><span class="line-content">    let _ = NodeRewardsCanister::get_node_providers_rewards::&lt;TestState&gt;(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L640" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-641</span><span class="line-content">        &amp;CANISTER_TEST,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L641" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-642</span><span class="line-content">        request.clone(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L642" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-643</span><span class="line-content">    )<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L643" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-644</span><span class="line-content">    .now_or_never()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L644" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-645</span><span class="line-content">    .unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L645" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-646</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L646" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-647</span><span class="line-content">    let expected: BTreeMap&lt;PrincipalId, NodeProviderRewards&gt; =<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L647" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-648</span><span class="line-content">        serde_json::from_str(EXPECTED_TEST_1).unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L648" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-649</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L649" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-650</span><span class="line-content">    for (provider_id, expected_rewards) in expected {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L650" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-651</span><span class="line-content">        let request = GetNodeProviderRewardsCalculationRequest {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L651" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-652</span><span class="line-content">            from_nanos: from.unix_ts_at_day_end(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L652" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-653</span><span class="line-content">            to_nanos: to.unix_ts_at_day_end(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L653" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-654</span><span class="line-content">            provider_id: provider_id.0,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L654" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-655</span><span class="line-content">        };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L655" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-656</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L656" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-657</span><span class="line-content">        let got = NodeRewardsCanister::get_node_provider_rewards_calculation::&lt;TestState&gt;(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L657" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-658</span><span class="line-content">            &amp;CANISTER_TEST,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L658" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-659</span><span class="line-content">            request,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L659" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-660</span><span class="line-content">        )<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L660" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-661</span><span class="line-content">        .unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L661" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-662</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L662" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-663</span><span class="line-content">        assert_eq!(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L663" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-664</span><span class="line-content">            got,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L664" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-665</span><span class="line-content">            to_candid_type(expected_rewards),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L665" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-666</span><span class="line-content">            &quot;Mismatch for provider {:?}&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L666" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-667</span><span class="line-content">            provider_id<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L667" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-668</span><span class="line-content">        );<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L668" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-669</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L669" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-670</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L670" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">332</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/lib.rs b/rs/node_rewards/canister/src/lib.rs<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L332" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">333</span><span class="line-content">index 0cf146f7ea..20af202a31 100644<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L333" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/lib.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/lib.rs</div>
<div class="hunk-header">@@ -11,7 +11,6 @@ use ic_management_canister_types::NodeMetrics;</div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> use ic_stable_structures::Storable;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/lib.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> use ic_stable_structures::storable::Bound;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/lib.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> use prost::Message;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/lib.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-14</span><span class="line-content">use rewards_calculation::types::SubnetMetricsDailyKey;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/lib.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> use std::borrow::Cow;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/lib.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/lib.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> pub mod api_conversion;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/lib.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -121,15 +120,6 @@ impl From&lt;pb::v1::SubnetIdKey&gt; for SubnetId {</div>
<div class="line context"><span class="line-number">120</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/lib.rs#L120" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">121</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/lib.rs#L121" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">122</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/lib.rs#L122" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-124</span><span class="line-content">impl From&lt;pb::v1::SubnetMetricsKey&gt; for SubnetMetricsDailyKey {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/lib.rs#L124" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-125</span><span class="line-content">    fn from(key: pb::v1::SubnetMetricsKey) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/lib.rs#L125" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-126</span><span class="line-content">        Self {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/lib.rs#L126" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-127</span><span class="line-content">            day: key.timestamp_nanos.into(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/lib.rs#L127" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-128</span><span class="line-content">            subnet_id: SubnetId::from(key.subnet_id.unwrap()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/lib.rs#L128" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-129</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/lib.rs#L129" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-130</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/lib.rs#L130" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-131</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/lib.rs#L131" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-132</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/lib.rs#L132" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">123</span><span class="line-content"> impl From&lt;NodeMetrics&gt; for pb::v1::NodeMetrics {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/lib.rs#L123" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">124</span><span class="line-content">     fn from(metrics: NodeMetrics) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/lib.rs#L124" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">125</span><span class="line-content">         pb::v1::NodeMetrics {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/lib.rs#L125" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">126</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/main.rs b/rs/node_rewards/canister/src/main.rs<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/lib.rs#L126" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">127</span><span class="line-content">index 525644133a..e05229c245 100644<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/lib.rs#L127" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/main.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/main.rs</div>
<div class="hunk-header">@@ -113,10 +113,7 @@ async fn get_node_providers_rewards(</div>
<div class="line context"><span class="line-number">113</span><span class="line-content">     request: GetNodeProvidersRewardsRequest,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/main.rs#L113" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">114</span><span class="line-content"> ) -&gt; GetNodeProvidersRewardsResponse {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/main.rs#L114" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">115</span><span class="line-content">     panic_if_caller_not_governance();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/main.rs#L115" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-116</span><span class="line-content">    NodeRewardsCanister::get_node_providers_rewards::&lt;RegistryStoreStableMemoryBorrower&gt;(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/main.rs#L116" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-117</span><span class="line-content">        &amp;CANISTER, request,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/main.rs#L117" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-118</span><span class="line-content">    )<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/main.rs#L118" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-119</span><span class="line-content">    .await<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/main.rs#L119" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+116</span><span class="line-content">    NodeRewardsCanister::get_node_providers_rewards(&amp;CANISTER, request).await<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/main.rs#L116" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">117</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/main.rs#L117" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">118</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/main.rs#L118" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">119</span><span class="line-content"> #[query]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/main.rs#L119" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -130,9 +127,7 @@ fn get_node_provider_rewards_calculation(</div>
<div class="line context"><span class="line-number">127</span><span class="line-content">         );<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/main.rs#L127" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">128</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/main.rs#L128" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">129</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/main.rs#L129" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-133</span><span class="line-content">    NodeRewardsCanister::get_node_provider_rewards_calculation::&lt;RegistryStoreStableMemoryBorrower&gt;(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/main.rs#L133" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-134</span><span class="line-content">        &amp;CANISTER, request,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/main.rs#L134" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-135</span><span class="line-content">    )<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/main.rs#L135" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+130</span><span class="line-content">    NodeRewardsCanister::get_node_provider_rewards_calculation(&amp;CANISTER, request)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/main.rs#L130" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">131</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/main.rs#L131" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">132</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/main.rs#L132" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">133</span><span class="line-content"> #[cfg(test)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/main.rs#L133" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">134</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/metrics.rs b/rs/node_rewards/canister/src/metrics.rs<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/main.rs#L134" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">135</span><span class="line-content">index 3116b784ec..9df82f44dc 100644<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/main.rs#L135" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/metrics.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/metrics.rs</div>
<div class="hunk-header">@@ -8,7 +8,7 @@ use ic_cdk::api::call::CallResult;</div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> use ic_management_canister_types::{NodeMetricsHistoryArgs, NodeMetricsHistoryRecord};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> use ic_stable_structures::StableBTreeMap;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> use itertools::Itertools;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-11</span><span class="line-content">use rewards_calculation::types::{DayUtc, NodeMetricsDailyRaw, SubnetMetricsDailyKey, UnixTsNanos};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+11</span><span class="line-content">use rewards_calculation::types::{DayUtc, NodeMetricsDailyRaw, UnixTsNanos};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> use std::cell::RefCell;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> use std::collections::{BTreeMap, HashMap};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -178,24 +178,22 @@ where</div>
<div class="line context"><span class="line-number">178</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L178" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">179</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L179" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">180</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L180" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-181</span><span class="line-content">    /// Computes daily node metrics per subnet within the specified time range.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L181" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+181</span><span class="line-content">    /// Computes daily node metrics for a specific day.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L181" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">182</span><span class="line-content">     ///<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L182" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-183</span><span class="line-content">    /// For each node in every subnet, calculates the number of proposed and failed blocks<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L183" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-184</span><span class="line-content">    /// produced during each day. This is done by subtracting the total metrics of the<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L184" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+183</span><span class="line-content">    /// This is done by subtracting the total metrics of the<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L183" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">184</span><span class="line-content">     /// previous day from those of the current day.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L184" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-186</span><span class="line-content">    pub fn daily_metrics_by_subnet(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L186" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+185</span><span class="line-content">    pub fn metrics_by_subnet(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L185" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">186</span><span class="line-content">         &amp;self,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L186" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-188</span><span class="line-content">        start_day: DayUtc,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L188" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-189</span><span class="line-content">        end_day: DayUtc,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L189" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-190</span><span class="line-content">    ) -&gt; BTreeMap&lt;SubnetMetricsDailyKey, Vec&lt;NodeMetricsDailyRaw&gt;&gt; {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L190" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-191</span><span class="line-content">        let mut daily_metrics_by_subnet = BTreeMap::new();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L191" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-192</span><span class="line-content">        let previous_day_ts = start_day.previous_day().unix_ts_at_day_start();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L192" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+187</span><span class="line-content">        day_utc: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L187" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+188</span><span class="line-content">    ) -&gt; BTreeMap&lt;SubnetId, Vec&lt;NodeMetricsDailyRaw&gt;&gt; {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L188" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+189</span><span class="line-content">        let mut metrics_by_subnet = BTreeMap::new();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L189" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+190</span><span class="line-content">        let previous_day_ts = day_utc.previous_day().unix_ts_at_day_start_nanoseconds();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L190" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">191</span><span class="line-content">         let first_key = SubnetMetricsKey {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L191" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">192</span><span class="line-content">             timestamp_nanos: previous_day_ts,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L192" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">193</span><span class="line-content">             ..SubnetMetricsKey::min_key()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L193" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">194</span><span class="line-content">         };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L194" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">195</span><span class="line-content">         let last_key = SubnetMetricsKey {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L195" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-198</span><span class="line-content">            timestamp_nanos: end_day.get(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L198" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+196</span><span class="line-content">            timestamp_nanos: day_utc.get(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L196" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">197</span><span class="line-content">             ..SubnetMetricsKey::max_key()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L197" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">198</span><span class="line-content">         };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L198" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">199</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L199" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -207,10 +205,10 @@ where</div>
<div class="line context"><span class="line-number">205</span><span class="line-content">             .into_iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L205" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">206</span><span class="line-content">             .collect();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L206" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">207</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L207" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-210</span><span class="line-content">        let mut last_total_metrics: HashMap&lt;_, _&gt; = HashMap::new();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L210" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+208</span><span class="line-content">        let mut initial_total_metrics: HashMap&lt;_, _&gt; = HashMap::new();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L208" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">209</span><span class="line-content">         if let Some((timestamp_nanos, _)) = subnets_metrics_by_day.first_key_value() {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L209" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-212</span><span class="line-content">            if timestamp_nanos &lt; &amp;start_day {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L212" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-213</span><span class="line-content">                last_total_metrics = subnets_metrics_by_day<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L213" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+210</span><span class="line-content">            if timestamp_nanos &lt; day_utc {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L210" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+211</span><span class="line-content">                initial_total_metrics = subnets_metrics_by_day<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L211" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">212</span><span class="line-content">                     .pop_first()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L212" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">213</span><span class="line-content">                     .unwrap()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L213" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">214</span><span class="line-content">                     .1<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L214" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -231,38 +229,30 @@ where</div>
<div class="line context"><span class="line-number">229</span><span class="line-content">         };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L229" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">230</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L230" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">231</span><span class="line-content">         for (_, subnets_metrics) in subnets_metrics_by_day {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L231" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-234</span><span class="line-content">            // current_total_metrics holds the total metrics for the current day per node per subnet.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L234" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-235</span><span class="line-content">            // It will be used to calculate the daily metrics for each node the next day by subtracting<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L235" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-236</span><span class="line-content">            // the last day&#x27;s total metrics from the current day&#x27;s total metrics.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L236" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-237</span><span class="line-content">            let mut current_total_metrics: HashMap&lt;_, _&gt; = HashMap::new();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L237" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">232</span><span class="line-content">             for (k, v) in subnets_metrics {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L232" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+233</span><span class="line-content">                let subnet_id = SubnetId::from(k.subnet_id.unwrap());<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L233" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+234</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L234" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">235</span><span class="line-content">                 let daily_nodes_metrics: Vec&lt;NodeMetricsDailyRaw&gt; = v<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L235" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">236</span><span class="line-content">                     .nodes_metrics<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L236" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">237</span><span class="line-content">                     .into_iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L237" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">238</span><span class="line-content">                     .map(|node| {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L238" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-243</span><span class="line-content">                        let (last_proposed_total, last_failed_total) = last_total_metrics<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L243" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+239</span><span class="line-content">                        let (initial_proposed_total, initial_failed_total) = initial_total_metrics<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L239" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">240</span><span class="line-content">                             .remove(&amp;(k.subnet_id, node.node_id))<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L240" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">241</span><span class="line-content">                             .unwrap_or_default();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L241" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-246</span><span class="line-content">                        current_total_metrics.insert(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L246" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-247</span><span class="line-content">                            (k.subnet_id, node.node_id),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L247" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-248</span><span class="line-content">                            (node.num_blocks_proposed_total, node.num_blocks_failed_total),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L248" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-249</span><span class="line-content">                        );<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L249" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-250</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L250" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">242</span><span class="line-content">                         NodeMetricsDailyRaw {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L242" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">243</span><span class="line-content">                             node_id: NodeId::from(node.node_id.unwrap()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L243" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">244</span><span class="line-content">                             num_blocks_proposed: node.num_blocks_proposed_total<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L244" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-254</span><span class="line-content">                                - last_proposed_total,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L254" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-255</span><span class="line-content">                            num_blocks_failed: node.num_blocks_failed_total - last_failed_total,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L255" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+245</span><span class="line-content">                                - initial_proposed_total,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L245" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+246</span><span class="line-content">                            num_blocks_failed: node.num_blocks_failed_total - initial_failed_total,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L246" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">247</span><span class="line-content">                         }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L247" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">248</span><span class="line-content">                     })<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L248" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">249</span><span class="line-content">                     .collect();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L249" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">250</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L250" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-260</span><span class="line-content">                daily_metrics_by_subnet.insert(k.into(), daily_nodes_metrics);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L260" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+251</span><span class="line-content">                metrics_by_subnet.insert(subnet_id, daily_nodes_metrics);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L251" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">252</span><span class="line-content">             }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L252" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-262</span><span class="line-content">            last_total_metrics = current_total_metrics;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L262" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">253</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L253" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">254</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L254" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-265</span><span class="line-content">        daily_metrics_by_subnet<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics.rs#L265" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+255</span><span class="line-content">        metrics_by_subnet<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L255" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">256</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L256" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">257</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L257" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">258</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L258" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">259</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/metrics/tests.rs b/rs/node_rewards/canister/src/metrics/tests.rs<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L259" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">260</span><span class="line-content">index 95ac66faf7..8fc016da2f 100644<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics.rs#L260" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/metrics/tests.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/metrics/tests.rs</div>
<div class="hunk-header">@@ -316,10 +316,10 @@ async fn _daily_metrics_correct_different_update_size(size: usize) {</div>
<div class="line context"><span class="line-number">316</span><span class="line-content">     for _ in 0..MAX_TIMES {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L316" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">317</span><span class="line-content">         mm.update_subnets_metrics(vec![subnet_id(1)]).await;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L317" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">318</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L318" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-319</span><span class="line-content">    let daily_metrics: Vec&lt;Vec&lt;NodeMetricsDailyRaw&gt;&gt; = mm<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L319" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-320</span><span class="line-content">        .daily_metrics_by_subnet(0.into(), (4 * ONE_DAY_NANOS).into())<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L320" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-321</span><span class="line-content">        .into_values()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L321" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-322</span><span class="line-content">        .collect();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L322" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+319</span><span class="line-content">    let daily_metrics: Vec&lt;Vec&lt;NodeMetricsDailyRaw&gt;&gt; =<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L319" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+320</span><span class="line-content">        mm.metrics_by_subnet(&amp;0.into()).into_values().collect();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L320" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+321</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L321" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+322</span><span class="line-content">    println!(&quot;{:?}&quot;, daily_metrics);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L322" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">323</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L323" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">324</span><span class="line-content">     // (7, 5)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L324" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">325</span><span class="line-content">     assert_eq!(daily_metrics[0][0].num_blocks_proposed, 7);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L325" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -328,24 +328,39 @@ async fn _daily_metrics_correct_different_update_size(size: usize) {</div>
<div class="line context"><span class="line-number">328</span><span class="line-content">     assert_eq!(daily_metrics[0][1].num_blocks_proposed, 19);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L328" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">329</span><span class="line-content">     assert_eq!(daily_metrics[0][1].num_blocks_failed, 21);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L329" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">330</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L330" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+331</span><span class="line-content">    let daily_metrics: Vec&lt;Vec&lt;NodeMetricsDailyRaw&gt;&gt; = mm<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L331" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+332</span><span class="line-content">        .metrics_by_subnet(&amp;ONE_DAY_NANOS.into())<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L332" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+333</span><span class="line-content">        .into_values()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L333" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+334</span><span class="line-content">        .collect();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L334" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+335</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L335" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">336</span><span class="line-content">     // (10 - 7, 6 - 5) = (3, 1)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L336" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">337</span><span class="line-content">     // (32 - 19, 22 - 21) = (13, 1)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L337" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-333</span><span class="line-content">    assert_eq!(daily_metrics[1][0].num_blocks_proposed, 3);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L333" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-334</span><span class="line-content">    assert_eq!(daily_metrics[1][0].num_blocks_failed, 1);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L334" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+338</span><span class="line-content">    assert_eq!(daily_metrics[0][0].num_blocks_proposed, 3);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L338" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+339</span><span class="line-content">    assert_eq!(daily_metrics[0][0].num_blocks_failed, 1);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L339" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+340</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L340" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+341</span><span class="line-content">    assert_eq!(daily_metrics[0][1].num_blocks_proposed, 13);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L341" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+342</span><span class="line-content">    assert_eq!(daily_metrics[0][1].num_blocks_failed, 1);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L342" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">343</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L343" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-336</span><span class="line-content">    assert_eq!(daily_metrics[1][1].num_blocks_proposed, 13);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L336" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-337</span><span class="line-content">    assert_eq!(daily_metrics[1][1].num_blocks_failed, 1);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L337" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+344</span><span class="line-content">    let daily_metrics: Vec&lt;Vec&lt;NodeMetricsDailyRaw&gt;&gt; = mm<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L344" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+345</span><span class="line-content">        .metrics_by_subnet(&amp;(2 * ONE_DAY_NANOS).into())<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L345" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+346</span><span class="line-content">        .into_values()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L346" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+347</span><span class="line-content">        .collect();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L347" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">348</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L348" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">349</span><span class="line-content">     // (15 - 10, 6 - 6) = (5, 0)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L349" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-340</span><span class="line-content">    assert_eq!(daily_metrics[2][0].num_blocks_proposed, 5);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L340" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-341</span><span class="line-content">    assert_eq!(daily_metrics[2][0].num_blocks_failed, 0);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L341" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+350</span><span class="line-content">    assert_eq!(daily_metrics[0][0].num_blocks_proposed, 5);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L350" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+351</span><span class="line-content">    assert_eq!(daily_metrics[0][0].num_blocks_failed, 0);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L351" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+352</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L352" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+353</span><span class="line-content">    let daily_metrics: Vec&lt;Vec&lt;NodeMetricsDailyRaw&gt;&gt; = mm<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L353" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+354</span><span class="line-content">        .metrics_by_subnet(&amp;(3 * ONE_DAY_NANOS).into())<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L354" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+355</span><span class="line-content">        .into_values()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L355" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+356</span><span class="line-content">        .collect();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L356" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">357</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L357" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">358</span><span class="line-content">     // (25 - 15, 50 - 6) = (10, 44)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L358" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-344</span><span class="line-content">    assert_eq!(daily_metrics[3][0].num_blocks_proposed, 10);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L344" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-345</span><span class="line-content">    assert_eq!(daily_metrics[3][0].num_blocks_failed, 44);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L345" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+359</span><span class="line-content">    assert_eq!(daily_metrics[0][0].num_blocks_proposed, 10);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L359" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+360</span><span class="line-content">    assert_eq!(daily_metrics[0][0].num_blocks_failed, 44);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L360" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">361</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L361" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-347</span><span class="line-content">    assert_eq!(daily_metrics[3][1].num_blocks_proposed, 10);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L347" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-348</span><span class="line-content">    assert_eq!(daily_metrics[3][1].num_blocks_failed, 10);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L348" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+362</span><span class="line-content">    assert_eq!(daily_metrics[0][1].num_blocks_proposed, 10);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L362" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+363</span><span class="line-content">    assert_eq!(daily_metrics[0][1].num_blocks_failed, 10);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L363" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">364</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L364" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">365</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L365" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">366</span><span class="line-content"> #[tokio::test]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L366" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -381,18 +396,22 @@ async fn daily_metrics_correct_2_subs() {</div>
<div class="line context"><span class="line-number">396</span><span class="line-content">         mm.update_subnets_metrics(vec![subnet_1, subnet_2]).await;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L396" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">397</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L397" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">398</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L398" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-384</span><span class="line-content">    let node_1_daily_metrics = mm<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L384" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-385</span><span class="line-content">        .daily_metrics_by_subnet(0.into(), (8 * ONE_DAY_NANOS).into())<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L385" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-386</span><span class="line-content">        .into_iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L386" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-387</span><span class="line-content">        .collect::&lt;BTreeMap&lt;_, _&gt;&gt;()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L387" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-388</span><span class="line-content">        .into_iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L388" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-389</span><span class="line-content">        .filter_map(|(sub, metrics)| {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L389" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-390</span><span class="line-content">            metrics<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L390" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-391</span><span class="line-content">                .into_iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L391" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-392</span><span class="line-content">                .find(|daily_metrics| daily_metrics.node_id == node_1)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L392" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-393</span><span class="line-content">                .map(move |metrics_node_1| (sub.subnet_id, metrics_node_1))<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L393" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-394</span><span class="line-content">        })<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L394" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-395</span><span class="line-content">        .collect::&lt;Vec&lt;_&gt;&gt;();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L395" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+399</span><span class="line-content">    let mut node_1_daily_metrics = Vec::new();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L399" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+400</span><span class="line-content">    for day in 0..8 {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L400" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+401</span><span class="line-content">        let daily_metrics = mm<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L401" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+402</span><span class="line-content">            .metrics_by_subnet(&amp;(day * ONE_DAY_NANOS).into())<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L402" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+403</span><span class="line-content">            .into_iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L403" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+404</span><span class="line-content">            .collect::&lt;BTreeMap&lt;_, _&gt;&gt;()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L404" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+405</span><span class="line-content">            .into_iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L405" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+406</span><span class="line-content">            .filter_map(|(sub, metrics)| {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L406" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+407</span><span class="line-content">                metrics<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L407" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+408</span><span class="line-content">                    .into_iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L408" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+409</span><span class="line-content">                    .find(|daily_metrics| daily_metrics.node_id == node_1)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L409" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+410</span><span class="line-content">                    .map(move |metrics_node_1| (sub, metrics_node_1))<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L410" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+411</span><span class="line-content">            })<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L411" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+412</span><span class="line-content">            .collect::&lt;Vec&lt;_&gt;&gt;();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L412" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+413</span><span class="line-content">        node_1_daily_metrics.extend(daily_metrics);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L413" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+414</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L414" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">415</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L415" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">416</span><span class="line-content">     for (day, (subnet, metrics)) in node_1_daily_metrics.into_iter().enumerate() {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L416" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">417</span><span class="line-content">         match day {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L417" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -474,18 +493,23 @@ async fn daily_metrics_correct_overlapping_days() {</div>
<div class="line context"><span class="line-number">493</span><span class="line-content">             .await;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L493" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">494</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L494" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">495</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L495" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-477</span><span class="line-content">    let daily_metrics = mm<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L477" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-478</span><span class="line-content">        .daily_metrics_by_subnet(0.into(), (4 * ONE_DAY_NANOS).into())<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L478" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-479</span><span class="line-content">        .into_iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L479" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-480</span><span class="line-content">        .collect::&lt;BTreeMap&lt;_, _&gt;&gt;()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L480" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-481</span><span class="line-content">        .into_iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L481" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-482</span><span class="line-content">        .filter_map(|(sub, metrics)| {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L482" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-483</span><span class="line-content">            metrics<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L483" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-484</span><span class="line-content">                .into_iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L484" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-485</span><span class="line-content">                .find(|daily_metrics| daily_metrics.node_id == node_1)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L485" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-486</span><span class="line-content">                .map(move |metrics_node_1| (sub.subnet_id, sub.day, metrics_node_1))<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L486" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-487</span><span class="line-content">        })<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L487" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-488</span><span class="line-content">        .collect::&lt;Vec&lt;_&gt;&gt;();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/metrics/tests.rs#L488" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+496</span><span class="line-content">    let mut daily_metrics = Vec::new();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L496" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+497</span><span class="line-content">    for idx in 0..4 {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L497" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+498</span><span class="line-content">        let day = (idx * ONE_DAY_NANOS).into();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L498" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+499</span><span class="line-content">        let metrics = mm<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L499" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+500</span><span class="line-content">            .metrics_by_subnet(&amp;day)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L500" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+501</span><span class="line-content">            .into_iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L501" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+502</span><span class="line-content">            .collect::&lt;BTreeMap&lt;_, _&gt;&gt;()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L502" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+503</span><span class="line-content">            .into_iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L503" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+504</span><span class="line-content">            .filter_map(|(sub, metrics)| {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L504" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+505</span><span class="line-content">                metrics<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L505" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+506</span><span class="line-content">                    .into_iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L506" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+507</span><span class="line-content">                    .find(|daily_metrics| daily_metrics.node_id == node_1)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L507" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+508</span><span class="line-content">                    .map(move |metrics_node_1| (sub, day, metrics_node_1))<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L508" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+509</span><span class="line-content">            })<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L509" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+510</span><span class="line-content">            .collect::&lt;Vec&lt;_&gt;&gt;();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L510" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+511</span><span class="line-content">        daily_metrics.extend(metrics);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L511" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+512</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L512" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">513</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L513" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">514</span><span class="line-content">     let overlapping_sub_1 = daily_metrics<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L514" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">515</span><span class="line-content">         .iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L515" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">516</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/registry_querier.rs b/rs/node_rewards/canister/src/registry_querier.rs<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L516" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">517</span><span class="line-content">index 18a9e474af..cfaf3eb621 100644<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/metrics/tests.rs#L517" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/registry_querier.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/registry_querier.rs</div>
<div class="hunk-header">@@ -5,17 +5,14 @@ use ic_protobuf::registry::node::v1::{NodeRecord, NodeRewardType};</div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use ic_protobuf::registry::node_operator::v1::NodeOperatorRecord;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use ic_protobuf::registry::node_rewards::v2::NodeRewardsTable;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> use ic_protobuf::registry::subnet::v1::SubnetListRecord;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-8</span><span class="line-content">use ic_registry_canister_client::{<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-9</span><span class="line-content">    CanisterRegistryClient, RegistryDataStableMemory, StorableRegistryKey, get_decoded_value,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-10</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content">use ic_registry_canister_client::{CanisterRegistryClient, get_decoded_value};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> use ic_registry_keys::{<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content">     NODE_RECORD_KEY_PREFIX, NODE_REWARDS_TABLE_KEY, make_data_center_record_key,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content">     make_node_operator_record_key, make_subnet_list_record_key,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> use ic_types::registry::RegistryClientError;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-16</span><span class="line-content">use itertools::Itertools;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> use rewards_calculation::types::{DayUtc, Region, RewardableNode, UnixTsNanos};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-18</span><span class="line-content">use std::collections::{BTreeMap, BTreeSet};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+15</span><span class="line-content">use std::collections::BTreeMap;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> use std::str::FromStr;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content"> use std::sync::Arc;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -79,22 +76,22 @@ impl RegistryQuerier {</div>
<div class="line context"><span class="line-number">76</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">77</span><span class="line-content"> // Exposed API Methods<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">78</span><span class="line-content"> impl RegistryQuerier {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-82</span><span class="line-content">    /// Computes the set of rewardable nodes, grouped by node provider, for the given range of UTC days.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-83</span><span class="line-content">    ///<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-84</span><span class="line-content">    /// A node is considered rewardable on a specific UTC day if it exists in the registry on that day.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-85</span><span class="line-content">    /// See the `nodes_in_registry_between` method for details on how this is determined.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+79</span><span class="line-content">    /// Computes the set of rewardable nodes, grouped by node provider, for the given UTC day.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">80</span><span class="line-content">     ///<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-87</span><span class="line-content">    /// Nodes without a specified `node_reward_type` are excluded from the rewardable set.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-88</span><span class="line-content">    pub fn get_rewardable_nodes_per_provider&lt;S: RegistryDataStableMemory&gt;(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-89</span><span class="line-content">        registry_client: &amp;dyn CanisterRegistryClient,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-90</span><span class="line-content">        start_day: DayUtc,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-91</span><span class="line-content">        end_day: DayUtc,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-92</span><span class="line-content">        provider_filter: Option&lt;PrincipalId&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+81</span><span class="line-content">    /// A node is considered rewardable on a specific UTC day if it exists in the last registry<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+82</span><span class="line-content">    /// version of that day.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+83</span><span class="line-content">    pub fn get_rewardable_nodes_per_provider(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+84</span><span class="line-content">        &amp;self,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+85</span><span class="line-content">        day_utc: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+86</span><span class="line-content">        provider_filter: Option&lt;&amp;PrincipalId&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">87</span><span class="line-content">     ) -&gt; Result&lt;BTreeMap&lt;PrincipalId, Vec&lt;RewardableNode&gt;&gt;, RegistryClientError&gt; {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">88</span><span class="line-content">         let mut rewardable_nodes_per_provider: BTreeMap&lt;_, Vec&lt;RewardableNode&gt;&gt; = BTreeMap::new();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-95</span><span class="line-content">        let nodes_in_range = Self::nodes_in_registry_between::&lt;S&gt;(start_day, end_day);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+89</span><span class="line-content">        let registry_version = self<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+90</span><span class="line-content">            .version_for_timestamp(day_utc.unix_ts_at_day_end_nanoseconds())<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+91</span><span class="line-content">            .unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+92</span><span class="line-content">        let nodes = self.nodes_in_version(registry_version)?;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">93</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-97</span><span class="line-content">        for (node_id, (node_record, latest_version, rewardable_days)) in nodes_in_range {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+94</span><span class="line-content">        for (node_id, node_record) in nodes {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L94" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">95</span><span class="line-content">             let node_operator_id: PrincipalId = node_record<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">96</span><span class="line-content">                 .node_operator_id<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L96" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">97</span><span class="line-content">                 .try_into()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -105,18 +102,17 @@ impl RegistryQuerier {</div>
<div class="line context"><span class="line-number">102</span><span class="line-content">                 dc_id,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">103</span><span class="line-content">                 region,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">104</span><span class="line-content">                 ..<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L104" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-108</span><span class="line-content">            }) = Self::node_operator_data(registry_client, node_operator_id, latest_version)?<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L108" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+105</span><span class="line-content">            }) = self.node_operator_data(node_operator_id, registry_version)?<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L105" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">106</span><span class="line-content">             else {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L106" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">107</span><span class="line-content">                 ic_cdk::println!(&quot;Node {} has no NodeOperatorData: skipping&quot;, node_id);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L107" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">108</span><span class="line-content">                 continue;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L108" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">109</span><span class="line-content">             };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L109" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">110</span><span class="line-content">             if let Some(provider_filter) = provider_filter {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L110" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-114</span><span class="line-content">                if node_provider_id != provider_filter {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L114" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+111</span><span class="line-content">                if &amp;node_provider_id != provider_filter {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L111" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">112</span><span class="line-content">                     continue;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L112" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">113</span><span class="line-content">                 }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L113" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">114</span><span class="line-content">             }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L114" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">115</span><span class="line-content">             let Some(some_reward_type) = node_record.node_reward_type else {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L115" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-119</span><span class="line-content">                ic_cdk::println!(&quot;Node {} has no node_reward_type: skipping&quot;, node_id);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L119" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">116</span><span class="line-content">                 // If the node does not have a node_reward_type, we skip it.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L116" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">117</span><span class="line-content">                 continue;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L117" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">118</span><span class="line-content">             };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L118" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -129,7 +125,6 @@ impl RegistryQuerier {</div>
<div class="line context"><span class="line-number">125</span><span class="line-content">                 .or_default()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L125" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">126</span><span class="line-content">                 .push(RewardableNode {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L126" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">127</span><span class="line-content">                     node_id,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L127" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-132</span><span class="line-content">                    rewardable_days,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L132" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">128</span><span class="line-content">                     node_reward_type,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L128" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">129</span><span class="line-content">                     dc_id: dc_id.clone(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L129" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">130</span><span class="line-content">                     region: region.clone(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L130" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -138,125 +133,43 @@ impl RegistryQuerier {</div>
<div class="line context"><span class="line-number">133</span><span class="line-content">         Ok(rewardable_nodes_per_provider)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L133" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">134</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L134" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">135</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L135" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-141</span><span class="line-content">    /// Returns a map of all nodes that were present in the registry in a day range.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L141" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-142</span><span class="line-content">    ///<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L142" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-143</span><span class="line-content">    /// Let&#x27;s define the following for a day `D` in the range:<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L143" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-144</span><span class="line-content">    ///<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L144" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-145</span><span class="line-content">    /// - `A`: the start of the day (00:00:00 UTC) for the day.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L145" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-146</span><span class="line-content">    /// - `B`: the end of the day (23:59:59 UTC) for the day.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-147</span><span class="line-content">    ///<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L147" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-148</span><span class="line-content">    /// A node is considered to be in the registry on a day `D` if:<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L148" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-149</span><span class="line-content">    ///<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-150</span><span class="line-content">    /// - it has been added in a registry version corresponding to a timestamp ts &lt;= `B`<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L150" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-151</span><span class="line-content">    /// - it has NOT been removed in a registry version corresponding to a timestamp ts &lt; `A`<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L151" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-152</span><span class="line-content">    ///<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L152" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-153</span><span class="line-content">    /// For each node, are returned:<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L153" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-154</span><span class="line-content">    /// - the most recent `NodeRecord` before `B` inclusive,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L154" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-155</span><span class="line-content">    /// - the corresponding `RegistryVersion`,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L155" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-156</span><span class="line-content">    /// - the sorted list of `DayUTC`s the node is in the registry.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L156" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-157</span><span class="line-content">    fn nodes_in_registry_between&lt;S: RegistryDataStableMemory&gt;(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L157" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-158</span><span class="line-content">        day_start: DayUtc,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L158" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-159</span><span class="line-content">        day_end: DayUtc,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L159" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-160</span><span class="line-content">    ) -&gt; BTreeMap&lt;NodeId, (NodeRecord, RegistryVersion, Vec&lt;DayUtc&gt;)&gt; {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L160" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-161</span><span class="line-content">        let start_ts = day_start.unix_ts_at_day_start();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L161" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-162</span><span class="line-content">        let end_ts = day_end.unix_ts_at_day_end();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L162" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+136</span><span class="line-content">    /// Returns a map of all nodes that were present in the registry at the specified version.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L136" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+137</span><span class="line-content">    fn nodes_in_version(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L137" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+138</span><span class="line-content">        &amp;self,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L138" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+139</span><span class="line-content">        registry_version: RegistryVersion,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L139" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+140</span><span class="line-content">    ) -&gt; Result&lt;BTreeMap&lt;NodeId, NodeRecord&gt;, RegistryClientError&gt; {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L140" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+141</span><span class="line-content">        let nodes_raw = self<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L141" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+142</span><span class="line-content">            .registry_client<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L142" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+143</span><span class="line-content">            .get_key_family_with_values(NODE_RECORD_KEY_PREFIX, registry_version)?;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L143" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">144</span><span class="line-content">         let prefix_length = NODE_RECORD_KEY_PREFIX.len();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L144" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">145</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L145" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-165</span><span class="line-content">        let start_key = StorableRegistryKey {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L165" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-166</span><span class="line-content">            key: NODE_RECORD_KEY_PREFIX.to_string(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L166" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-167</span><span class="line-content">            ..Default::default()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L167" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-168</span><span class="line-content">        };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L168" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-169</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L169" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-170</span><span class="line-content">        S::with_registry_map(|registry_map| {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L170" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-171</span><span class="line-content">            registry_map<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L171" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-172</span><span class="line-content">                .range(start_key..)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L172" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-173</span><span class="line-content">                .filter(|(k, _)| {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L173" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-174</span><span class="line-content">                    k.timestamp_nanoseconds &lt;= end_ts &amp;&amp; k.key.starts_with(NODE_RECORD_KEY_PREFIX)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L174" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-175</span><span class="line-content">                })<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L175" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-176</span><span class="line-content">                .map(|(k, v)| (k.key, k.version, k.timestamp_nanoseconds, v.0))<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L176" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-177</span><span class="line-content">                .group_by(|(node_key, _, _, _)| node_key.clone())<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L177" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-178</span><span class="line-content">                .into_iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L178" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-179</span><span class="line-content">                .filter_map(|(node_key, node_mutations)| {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L179" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-180</span><span class="line-content">                    let mut days = BTreeSet::new();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L180" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-181</span><span class="line-content">                    let mut last_present_ts: Option&lt;UnixTsNanos&gt; = None;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L181" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-182</span><span class="line-content">                    let mut latest_value: Option&lt;Vec&lt;u8&gt;&gt; = None;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L182" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-183</span><span class="line-content">                    let mut latest_version = RegistryVersion::default().get();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L183" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-184</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L184" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-185</span><span class="line-content">                    // Process node&#x27;s mutations history.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L185" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-186</span><span class="line-content">                    for (_, version, ts, maybe_value) in node_mutations {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L186" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-187</span><span class="line-content">                        if maybe_value.is_some() {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L187" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-188</span><span class="line-content">                            // A creation or update<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L188" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-189</span><span class="line-content">                            latest_value = maybe_value;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L189" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-190</span><span class="line-content">                            latest_version = version;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L190" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-191</span><span class="line-content">                            if last_present_ts.is_none() {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L191" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-192</span><span class="line-content">                                // Node was absent, now it&#x27;s present.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L192" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-193</span><span class="line-content">                                // If it became present before the window, track it from the start.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L193" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-194</span><span class="line-content">                                // Otherwise, track it from the actual timestamp.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L194" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-195</span><span class="line-content">                                last_present_ts = Some(ts.max(start_ts));<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L195" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-196</span><span class="line-content">                            }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L196" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-197</span><span class="line-content">                        } else {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L197" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-198</span><span class="line-content">                            // A deletion<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L198" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-199</span><span class="line-content">                            if let Some(start_of_interval) = last_present_ts.take() {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L199" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-200</span><span class="line-content">                                // The node was present and is now gone. Finalize the interval.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L200" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-201</span><span class="line-content">                                let mut days_between = DayUtc::from(start_of_interval)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L201" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-202</span><span class="line-content">                                    .days_until(&amp;DayUtc::from(ts))<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L202" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-203</span><span class="line-content">                                    .unwrap_or_default();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L203" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-204</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L204" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-205</span><span class="line-content">                                // If a node is deleted it will be rewarded until the day before deletion.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L205" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-206</span><span class="line-content">                                if !days_between.is_empty() {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L206" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-207</span><span class="line-content">                                    days_between.truncate(days_between.len() - 1);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L207" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-208</span><span class="line-content">                                }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L208" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-209</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L209" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-210</span><span class="line-content">                                days.extend(days_between);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L210" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-211</span><span class="line-content">                            }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L211" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-212</span><span class="line-content">                        }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L212" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-213</span><span class="line-content">                    }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L213" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-214</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L214" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-215</span><span class="line-content">                    // After all mutations, if the node is still present, finalize the last interval.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L215" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-216</span><span class="line-content">                    if let Some(start_of_interval) = last_present_ts {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L216" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-217</span><span class="line-content">                        let days_between =<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L217" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-218</span><span class="line-content">                            DayUtc::from(start_of_interval).days_until(&amp;DayUtc::from(end_ts));<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L218" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-219</span><span class="line-content">                        days.extend(days_between.unwrap_or_default());<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L219" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-220</span><span class="line-content">                    }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L220" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-221</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L221" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-222</span><span class="line-content">                    // If the node was present at any time and we have its record, decode and return it.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L222" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-223</span><span class="line-content">                    if !days.is_empty() {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L223" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-224</span><span class="line-content">                        if let Some(final_value) = latest_value {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L224" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-225</span><span class="line-content">                            let principal = PrincipalId::from_str(&amp;node_key[prefix_length..])<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L225" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-226</span><span class="line-content">                                .expect(&quot;Invalid node key&quot;);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L226" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-227</span><span class="line-content">                            let node_id = NodeId::from(principal);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L227" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-228</span><span class="line-content">                            let node_record = NodeRecord::decode(final_value.as_slice())<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L228" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-229</span><span class="line-content">                                .expect(&quot;Failed to decode NodeRecord&quot;);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L229" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-230</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L230" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-231</span><span class="line-content">                            return Some((<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L231" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-232</span><span class="line-content">                                node_id,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L232" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-233</span><span class="line-content">                                (<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L233" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-234</span><span class="line-content">                                    node_record,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L234" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-235</span><span class="line-content">                                    RegistryVersion::from(latest_version),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L235" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-236</span><span class="line-content">                                    days.into_iter().sorted().collect(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L236" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-237</span><span class="line-content">                                ),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L237" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-238</span><span class="line-content">                            ));<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L238" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-239</span><span class="line-content">                        }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L239" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-240</span><span class="line-content">                    }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L240" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-241</span><span class="line-content">                    None<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L241" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-242</span><span class="line-content">                })<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L242" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-243</span><span class="line-content">                .collect()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L243" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-244</span><span class="line-content">        })<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L244" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+146</span><span class="line-content">        let nodes = nodes_raw<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+147</span><span class="line-content">            .into_iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L147" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+148</span><span class="line-content">            .map(|(node_key, node_value)| {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L148" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+149</span><span class="line-content">                let principal =<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+150</span><span class="line-content">                    PrincipalId::from_str(&amp;node_key[prefix_length..]).expect(&quot;Invalid node key&quot;);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L150" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+151</span><span class="line-content">                let node_id = NodeId::from(principal);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L151" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+152</span><span class="line-content">                let node_record =<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L152" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+153</span><span class="line-content">                    NodeRecord::decode(node_value.as_slice()).expect(&quot;Failed to decode NodeRecord&quot;);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L153" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+154</span><span class="line-content">                (node_id, node_record)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L154" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+155</span><span class="line-content">            })<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L155" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+156</span><span class="line-content">            .collect();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L156" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+157</span><span class="line-content">        Ok(nodes)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L157" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">158</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L158" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">159</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L159" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">160</span><span class="line-content">     fn node_operator_data(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L160" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-248</span><span class="line-content">        registry_client: &amp;dyn CanisterRegistryClient,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L248" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+161</span><span class="line-content">        &amp;self,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L161" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">162</span><span class="line-content">         node_operator: PrincipalId,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L162" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">163</span><span class="line-content">         version: RegistryVersion,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L163" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">164</span><span class="line-content">     ) -&gt; Result&lt;Option&lt;NodeOperatorData&gt;, RegistryClientError&gt; {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L164" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">165</span><span class="line-content">         let node_operator_record_key = make_node_operator_record_key(node_operator);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L165" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">166</span><span class="line-content">         let Some(node_operator_record) = get_decoded_value::&lt;NodeOperatorRecord&gt;(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L166" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-254</span><span class="line-content">            registry_client,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L254" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+167</span><span class="line-content">            &amp;*self.registry_client,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L167" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">168</span><span class="line-content">             node_operator_record_key.as_str(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L168" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">169</span><span class="line-content">             version,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L169" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">170</span><span class="line-content">         )<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L170" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">171</span><span class="line-content">         .map_err(|e| RegistryClientError::DecodeError {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L171" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-259</span><span class="line-content">            error: format!(&quot;Failed to decode NodeOperatorRecord: {e}&quot;),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L259" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+172</span><span class="line-content">            error: format!(&quot;Failed to decode NodeOperatorRecord: {}&quot;, e),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L172" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">173</span><span class="line-content">         })?<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L173" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">174</span><span class="line-content">         else {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L174" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">175</span><span class="line-content">             return Ok(None);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L175" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -264,12 +177,12 @@ impl RegistryQuerier {</div>
<div class="line context"><span class="line-number">177</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L177" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">178</span><span class="line-content">         let data_center_key = make_data_center_record_key(node_operator_record.dc_id.as_str());<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L178" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">179</span><span class="line-content">         let Some(data_center_record) = get_decoded_value::&lt;DataCenterRecord&gt;(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L179" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-267</span><span class="line-content">            registry_client,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L267" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+180</span><span class="line-content">            &amp;*self.registry_client,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L180" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">181</span><span class="line-content">             data_center_key.as_str(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L181" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">182</span><span class="line-content">             version,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L182" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">183</span><span class="line-content">         )<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L183" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">184</span><span class="line-content">         .map_err(|e| RegistryClientError::DecodeError {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L184" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-272</span><span class="line-content">            error: format!(&quot;Failed to decode DataCenterRecord: {e}&quot;),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier.rs#L272" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+185</span><span class="line-content">            error: format!(&quot;Failed to decode DataCenterRecord: {}&quot;, e),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L185" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">186</span><span class="line-content">         })?<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L186" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">187</span><span class="line-content">         else {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L187" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">188</span><span class="line-content">             return Ok(None);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L188" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">189</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/registry_querier/tests.rs b/rs/node_rewards/canister/src/registry_querier/tests.rs<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L189" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">190</span><span class="line-content">index 0272e7e2df..33514945ba 100644<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier.rs#L190" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/registry_querier/tests.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/registry_querier/tests.rs</div>
<div class="hunk-header">@@ -17,7 +17,7 @@ use ic_registry_keys::{</div>
<div class="line context"><span class="line-number">17</span><span class="line-content"> use ic_stable_structures::memory_manager::{MemoryId, MemoryManager, VirtualMemory};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content"> use ic_stable_structures::{DefaultMemoryImpl, StableBTreeMap};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content"> use maplit::btreemap;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-20</span><span class="line-content">use rewards_calculation::types::{DayUtc, RewardPeriod, RewardableNode};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+20</span><span class="line-content">use rewards_calculation::types::{DayUtc, RewardableNode};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">21</span><span class="line-content"> use std::cell::RefCell;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">22</span><span class="line-content"> use std::sync::Arc;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">23</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -45,7 +45,7 @@ fn add_record_helper(</div>
<div class="line context"><span class="line-number">45</span><span class="line-content">     datetime_str: &amp;str,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">46</span><span class="line-content"> ) {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">47</span><span class="line-content">     let ts = DayUtc::try_from(datetime_str).unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-48</span><span class="line-content">    add_record_helper_ts(key, version, value, ts.unix_ts_at_day_end());<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+48</span><span class="line-content">    add_record_helper_ts(key, version, value, ts.unix_ts_at_day_end_nanoseconds());<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">49</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">50</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">51</span><span class="line-content"> fn add_record_helper_ts(key: &amp;str, version: u64, value: Option&lt;impl ::prost::Message&gt;, ts: u64) {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -88,7 +88,7 @@ fn generate_node_operator_key_value(</div>
<div class="line context"><span class="line-number">88</span><span class="line-content">         dc_id,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">89</span><span class="line-content">         ..NodeOperatorRecord::default()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">90</span><span class="line-content">     };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-91</span><span class="line-content">    let key = format!(&quot;{NODE_OPERATOR_RECORD_KEY_PREFIX}{principal_id}&quot;);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+91</span><span class="line-content">    let key = format!(&quot;{}{}&quot;, NODE_OPERATOR_RECORD_KEY_PREFIX, principal_id);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">92</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">93</span><span class="line-content">     (key, value)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">94</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L94" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -99,7 +99,7 @@ fn generate_dc_key_value(dc_id: String) -&gt; (String, DataCenterRecord) {</div>
<div class="line context"><span class="line-number">99</span><span class="line-content">         region: &quot;A&quot;.to_string(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">100</span><span class="line-content">         ..DataCenterRecord::default()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L100" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">101</span><span class="line-content">     };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L101" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-102</span><span class="line-content">    let key = format!(&quot;{DATA_CENTER_KEY_PREFIX}{dc_id}&quot;);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+102</span><span class="line-content">    let key = format!(&quot;{}{}&quot;, DATA_CENTER_KEY_PREFIX, dc_id);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">103</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">104</span><span class="line-content">     (key, value)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L104" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">105</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L105" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -143,7 +143,7 @@ fn add_dummy_data() {</div>
<div class="line context"><span class="line-number">143</span><span class="line-content">     // Removed and re-added node_3 same day<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L143" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">144</span><span class="line-content">     let ts_removed = DayUtc::try_from(&quot;2025-07-16&quot;)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L144" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">145</span><span class="line-content">         .unwrap()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L145" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-146</span><span class="line-content">        .unix_ts_at_day_start()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+146</span><span class="line-content">        .unix_ts_at_day_start_nanoseconds()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">147</span><span class="line-content">         + 1;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L147" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">148</span><span class="line-content">     add_record_helper_ts(&amp;node_3_k, 39676, None::&lt;NodeRecord&gt;, ts_removed);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L148" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">149</span><span class="line-content">     let ts_readded = ts_removed + 1;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -159,17 +159,6 @@ fn client_for_tests() -&gt; RegistryQuerier {</div>
<div class="line context"><span class="line-number">159</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L159" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">160</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L160" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">161</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L161" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-162</span><span class="line-content">fn node_rewardable_days(rewardable_nodes: &amp;[RewardableNode], node_id: u64) -&gt; Vec&lt;DayUtc&gt; {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L162" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-163</span><span class="line-content">    let node_id = NodeId::from(PrincipalId::new_node_test_id(node_id));<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L163" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-164</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L164" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-165</span><span class="line-content">    rewardable_nodes<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L165" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-166</span><span class="line-content">        .iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L166" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-167</span><span class="line-content">        .find(|n| n.node_id == node_id)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L167" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-168</span><span class="line-content">        .unwrap_or_else(|| panic!(&quot;Node {node_id} should be present&quot;))<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L168" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-169</span><span class="line-content">        .clone()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L169" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-170</span><span class="line-content">        .rewardable_days<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L170" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-171</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L171" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-172</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L172" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">162</span><span class="line-content"> #[test]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L162" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">163</span><span class="line-content"> fn test_subnets_list_returns_expected_subnets() {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L163" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">164</span><span class="line-content">     let client = client_for_tests();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L164" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -232,159 +221,51 @@ fn test_get_rewards_table_returns_correct_record() {</div>
<div class="line context"><span class="line-number">221</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L221" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">222</span><span class="line-content">     assert_eq!(result, table);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L222" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">223</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L223" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-235</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L235" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-236</span><span class="line-content">#[test]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L236" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-237</span><span class="line-content">fn test_nodes_in_registry_returns_expected_days() {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L237" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-238</span><span class="line-content">    let _client = client_for_tests();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L238" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-239</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L239" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-240</span><span class="line-content">    // Time range where:<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L240" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-241</span><span class="line-content">    // - node_1 exists until 2025-07-07<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L241" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-242</span><span class="line-content">    // - node_2 is always present<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L242" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-243</span><span class="line-content">    // - node_3 appears on 2025-07-11<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L243" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-244</span><span class="line-content">    let from = DayUtc::try_from(&quot;2025-07-03&quot;).unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L244" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-245</span><span class="line-content">    let to = DayUtc::try_from(&quot;2025-07-16&quot;).unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L245" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-246</span><span class="line-content">    let nodes_map = RegistryQuerier::nodes_in_registry_between::&lt;DummyState&gt;(from, to);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L246" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-247</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L247" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-248</span><span class="line-content">    let node_1_id = NodeId::from(PrincipalId::new_node_test_id(1));<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L248" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-249</span><span class="line-content">    let node_2_id = NodeId::from(PrincipalId::new_node_test_id(2));<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L249" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-250</span><span class="line-content">    let node_3_id = NodeId::from(PrincipalId::new_node_test_id(3));<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L250" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-251</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L251" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-252</span><span class="line-content">    let (_, _, node_1_days) = &amp;nodes_map[&amp;node_1_id];<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L252" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-253</span><span class="line-content">    let expected_node_1_days: Vec&lt;DayUtc&gt; = vec![<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L253" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-254</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-03&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L254" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-255</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-04&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L255" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-256</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-05&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L256" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-257</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-06&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L257" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-258</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-07&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L258" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-259</span><span class="line-content">    ];<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L259" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-260</span><span class="line-content">    assert_eq!(node_1_days, &amp;expected_node_1_days);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L260" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-261</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L261" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-262</span><span class="line-content">    let (_, _, node_2_days) = &amp;nodes_map[&amp;node_2_id];<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L262" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-263</span><span class="line-content">    let expected_node_2_days: Vec&lt;DayUtc&gt; = vec![<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L263" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-264</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-04&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L264" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-265</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-05&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L265" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-266</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-06&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L266" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-267</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-07&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L267" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-268</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-08&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L268" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-269</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-09&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L269" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-270</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-10&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L270" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-271</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-11&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L271" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-272</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-12&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L272" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-273</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-13&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L273" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-274</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-14&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L274" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-275</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-15&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L275" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-276</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-16&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L276" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-277</span><span class="line-content">    ];<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L277" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-278</span><span class="line-content">    assert_eq!(node_2_days, &amp;expected_node_2_days);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L278" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-279</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L279" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-280</span><span class="line-content">    let (_, _, node_3_days) = &amp;nodes_map[&amp;node_3_id];<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L280" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-281</span><span class="line-content">    let expected_node_3_days: Vec&lt;DayUtc&gt; = vec![<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L281" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-282</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-11&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L282" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-283</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-12&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L283" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-284</span><span class="line-content">        // node_3 was deleted on 2025-07-13, so it should not be present on 2025-07-14<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L284" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-285</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-15&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L285" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-286</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-16&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L286" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-287</span><span class="line-content">    ];<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L287" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-288</span><span class="line-content">    assert_eq!(node_3_days, &amp;expected_node_3_days);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L288" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+224</span><span class="line-content">fn contains_node(nodes: &amp;[RewardableNode], node_num: u64) -&gt; bool {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L224" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+225</span><span class="line-content">    nodes<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L225" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+226</span><span class="line-content">        .iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L226" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+227</span><span class="line-content">        .any(|n| n.node_id == NodeId::from(PrincipalId::new_node_test_id(node_num)))<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L227" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">228</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L228" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-290</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L290" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">229</span><span class="line-content"> #[test]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L229" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">230</span><span class="line-content"> fn test_rewardable_nodes_deleted_nodes() {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L230" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-293</span><span class="line-content">    let _client = client_for_tests();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L293" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-294</span><span class="line-content">    // Define the range for which we want to check rewardable nodes.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L294" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-295</span><span class="line-content">    // This is *after* node_1 was deleted.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L295" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-296</span><span class="line-content">    let from = DayUtc::try_from(&quot;2025-07-12&quot;).unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L296" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-297</span><span class="line-content">    let to = DayUtc::try_from(&quot;2025-07-13&quot;).unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L297" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-298</span><span class="line-content">    let _reward_period = RewardPeriod::new(from, to).expect(&quot;Failed to create reward period&quot;);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L298" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-299</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L299" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-300</span><span class="line-content">    let mut rewardables = RegistryQuerier::get_rewardable_nodes_per_provider::&lt;DummyState&gt;(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L300" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-301</span><span class="line-content">        &amp;*REGISTRY_STORE.with(|store| store.clone()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L301" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-302</span><span class="line-content">        from,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L302" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-303</span><span class="line-content">        to,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L303" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-304</span><span class="line-content">        None,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L304" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-305</span><span class="line-content">    )<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L305" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-306</span><span class="line-content">    .expect(&quot;Failed to fetch rewardable nodes&quot;);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L306" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+231</span><span class="line-content">    let client = client_for_tests();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L231" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+232</span><span class="line-content">    let day1 = DayUtc::try_from(&quot;2025-07-12&quot;).unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L232" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+233</span><span class="line-content">    let day2 = DayUtc::try_from(&quot;2025-07-13&quot;).unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L233" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+234</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L234" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+235</span><span class="line-content">    let mut rewardable_nodes_day1 = client<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L235" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+236</span><span class="line-content">        .get_rewardable_nodes_per_provider(&amp;day1, None)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L236" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+237</span><span class="line-content">        .unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L237" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+238</span><span class="line-content">    let mut rewardable_nodes_day2 = client<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L238" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+239</span><span class="line-content">        .get_rewardable_nodes_per_provider(&amp;day2, None)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L239" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+240</span><span class="line-content">        .unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L240" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">241</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L241" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">242</span><span class="line-content">     let np_1_id = PrincipalId::new_user_test_id(20);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L242" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-309</span><span class="line-content">    let np_1_rewardables = rewardables<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L309" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-310</span><span class="line-content">        .remove(&amp;np_1_id)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L310" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-311</span><span class="line-content">        .expect(&quot;No rewardables found for node provider&quot;);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L311" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+243</span><span class="line-content">    let rewardables_day1 = rewardable_nodes_day1.remove(&amp;np_1_id).unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L243" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+244</span><span class="line-content">    let rewardables_day2 = rewardable_nodes_day2.remove(&amp;np_1_id).unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L244" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">245</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L245" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-313</span><span class="line-content">    // Node 1 was deleted before this period, so it should NOT be present.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L313" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+246</span><span class="line-content">    // Day 1 expectations<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L246" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">247</span><span class="line-content">     assert!(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L247" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-315</span><span class="line-content">        !np_1_rewardables<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L315" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-316</span><span class="line-content">            .iter()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L316" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-317</span><span class="line-content">            .any(|n| n.node_id == NodeId::from(PrincipalId::new_node_test_id(1))),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L317" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-318</span><span class="line-content">        &quot;Node 1 should not be rewardable after it was deleted&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L318" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+248</span><span class="line-content">        !contains_node(&amp;rewardables_day1, 1),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L248" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+249</span><span class="line-content">        &quot;Node 1 should not be rewardable after deletion&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L249" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">250</span><span class="line-content">     );<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L250" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-320</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L320" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-321</span><span class="line-content">    // Node 2 should be rewardable in this period.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L321" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-322</span><span class="line-content">    let node_2_rewardable_days = node_rewardable_days(&amp;np_1_rewardables, 2);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L322" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-323</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L323" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-324</span><span class="line-content">    assert_eq!(node_2_rewardable_days.first(), Some(&amp;from));<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L324" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-325</span><span class="line-content">    assert_eq!(node_2_rewardable_days.last(), Some(&amp;to));<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L325" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-326</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L326" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-327</span><span class="line-content">    let node_3_rewardable_days = node_rewardable_days(&amp;np_1_rewardables, 3);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L327" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-328</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L328" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-329</span><span class="line-content">    // Node 3 should be rewardable until 2025-07-12 because on 2025-07-13 got deleted.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L329" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-330</span><span class="line-content">    assert_eq!(node_3_rewardable_days.first(), Some(&amp;from));<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L330" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-331</span><span class="line-content">    assert_eq!(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L331" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-332</span><span class="line-content">        node_3_rewardable_days.last(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L332" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-333</span><span class="line-content">        Some(&amp;DayUtc::try_from(&quot;2025-07-12&quot;).unwrap())<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L333" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+251</span><span class="line-content">    assert!(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L251" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+252</span><span class="line-content">        contains_node(&amp;rewardables_day1, 2),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L252" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+253</span><span class="line-content">        &quot;Node 2 should be rewardable on day 1&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L253" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">254</span><span class="line-content">     );<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L254" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-335</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L335" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-336</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L336" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-337</span><span class="line-content">#[test]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L337" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-338</span><span class="line-content">fn test_rewardable_nodes_rewardables_till_deleted() {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L338" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-339</span><span class="line-content">    let _client = client_for_tests();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L339" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-340</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L340" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-341</span><span class="line-content">    // Define a time range that spans:<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L341" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-342</span><span class="line-content">    // - The active time of node_1 (until deletion on 2025-07-08),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L342" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-343</span><span class="line-content">    // - Node_2&#x27;s full active range,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L343" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-344</span><span class="line-content">    // - Node_3&#x27;s creation (on 2025-07-11).<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L344" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-345</span><span class="line-content">    let from = DayUtc::try_from(&quot;2025-07-03&quot;).unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L345" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-346</span><span class="line-content">    let to = DayUtc::try_from(&quot;2025-07-12&quot;).unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L346" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-347</span><span class="line-content">    let _reward_period = RewardPeriod::new(from, to).expect(&quot;Failed to create reward period&quot;);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L347" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-348</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L348" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-349</span><span class="line-content">    let mut rewardables = RegistryQuerier::get_rewardable_nodes_per_provider::&lt;DummyState&gt;(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L349" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-350</span><span class="line-content">        &amp;*REGISTRY_STORE.with(|store| store.clone()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L350" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-351</span><span class="line-content">        from,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L351" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-352</span><span class="line-content">        to,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L352" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-353</span><span class="line-content">        None,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L353" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-354</span><span class="line-content">    )<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L354" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-355</span><span class="line-content">    .expect(&quot;Failed to fetch rewardable nodes&quot;);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L355" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-356</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L356" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-357</span><span class="line-content">    let np_1_id = PrincipalId::new_user_test_id(20);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L357" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-358</span><span class="line-content">    let np_1_rewardables = rewardables<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L358" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-359</span><span class="line-content">        .remove(&amp;np_1_id)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L359" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-360</span><span class="line-content">        .expect(&quot;No rewardables found for node provider&quot;);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L360" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-361</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L361" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-362</span><span class="line-content">    // Node 1 was deleted on 2025-07-08, so its rewardable period ends there.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L362" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-363</span><span class="line-content">    let node_1_rewardable_days = node_rewardable_days(&amp;np_1_rewardables, 1);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L363" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-364</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L364" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-365</span><span class="line-content">    assert_eq!(node_1_rewardable_days.first(), Some(&amp;from));<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L365" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-366</span><span class="line-content">    assert_eq!(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L366" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-367</span><span class="line-content">        node_1_rewardable_days.last(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L367" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-368</span><span class="line-content">        Some(&amp;DayUtc::try_from(&quot;2025-07-07&quot;).unwrap())<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L368" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+255</span><span class="line-content">    assert!(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L255" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+256</span><span class="line-content">        contains_node(&amp;rewardables_day1, 3),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L256" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+257</span><span class="line-content">        &quot;Node 3 should be rewardable on day 1&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L257" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">258</span><span class="line-content">     );<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L258" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">259</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L259" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-371</span><span class="line-content">    // Node 2 is active throughout the whole range.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L371" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-372</span><span class="line-content">    let node_2_rewardable_days = node_rewardable_days(&amp;np_1_rewardables, 2);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L372" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-373</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L373" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-374</span><span class="line-content">    assert_eq!(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L374" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-375</span><span class="line-content">        node_2_rewardable_days.first(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L375" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-376</span><span class="line-content">        Some(&amp;DayUtc::try_from(&quot;2025-07-04&quot;).unwrap())<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L376" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+260</span><span class="line-content">    // Day 2 expectations<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L260" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+261</span><span class="line-content">    assert!(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L261" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+262</span><span class="line-content">        !contains_node(&amp;rewardables_day2, 3),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L262" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+263</span><span class="line-content">        &quot;Node 3 should NOT be rewardable on day 2 because it was removed&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L263" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">264</span><span class="line-content">     );<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L264" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-378</span><span class="line-content">    assert_eq!(node_2_rewardable_days.last(), Some(&amp;to));<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L378" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-379</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L379" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-380</span><span class="line-content">    // Node 3 became active on 2025-07-11.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L380" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-381</span><span class="line-content">    let node_3_rewardable_days = node_rewardable_days(&amp;np_1_rewardables, 3);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L381" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-382</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L382" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-383</span><span class="line-content">    assert_eq!(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L383" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-384</span><span class="line-content">        node_3_rewardable_days.first(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L384" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-385</span><span class="line-content">        Some(&amp;DayUtc::try_from(&quot;2025-07-11&quot;).unwrap())<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L385" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+265</span><span class="line-content">    assert!(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L265" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+266</span><span class="line-content">        contains_node(&amp;rewardables_day2, 2),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L266" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+267</span><span class="line-content">        &quot;Node 2 should be rewardable on day 2&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L267" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">268</span><span class="line-content">     );<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L268" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-387</span><span class="line-content">    assert_eq!(node_3_rewardable_days.last(), Some(&amp;to));<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L387" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">269</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L269" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">270</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L270" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">271</span><span class="line-content"> #[test]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L271" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -392,9 +273,8 @@ fn test_node_re_registered_after_deletion() {</div>
<div class="line context"><span class="line-number">273</span><span class="line-content">     let node_1_id = 1;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L273" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">274</span><span class="line-content">     let no_1_id = 10;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L274" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">275</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L275" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-395</span><span class="line-content">    // Re-register node_1 after it was deleted<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L395" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">276</span><span class="line-content">     let node_id = PrincipalId::new_node_test_id(node_1_id);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L276" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-397</span><span class="line-content">    let node_key = format!(&quot;{NODE_RECORD_KEY_PREFIX}{node_id}&quot;);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L397" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+277</span><span class="line-content">    let node_key = format!(&quot;{}{}&quot;, NODE_RECORD_KEY_PREFIX, node_id);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L277" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">278</span><span class="line-content">     let node_record = NodeRecord {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L278" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">279</span><span class="line-content">         node_reward_type: Some(NodeRewardType::Type0 as i32),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L279" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">280</span><span class="line-content">         node_operator_id: PrincipalId::new_user_test_id(no_1_id).to_vec(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L280" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -403,74 +283,50 @@ fn test_node_re_registered_after_deletion() {</div>
<div class="line context"><span class="line-number">283</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L283" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">284</span><span class="line-content">     add_record_helper(&amp;node_key, 39668, Some(node_record), &quot;2025-07-11&quot;);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L284" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">285</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L285" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-406</span><span class="line-content">    let _client = client_for_tests();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L406" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+286</span><span class="line-content">    let client = client_for_tests();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L286" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">287</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L287" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-408</span><span class="line-content">    // Range that includes both the deletion and re-registration periods<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L408" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">288</span><span class="line-content">     let from = DayUtc::try_from(&quot;2025-07-07&quot;).unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L288" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">289</span><span class="line-content">     let to = DayUtc::try_from(&quot;2025-07-12&quot;).unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L289" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-411</span><span class="line-content">    let _reward_period = RewardPeriod::new(from, to).expect(&quot;Failed to create reward period&quot;);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L411" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-412</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L412" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-413</span><span class="line-content">    let mut rewardables = RegistryQuerier::get_rewardable_nodes_per_provider::&lt;DummyState&gt;(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L413" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-414</span><span class="line-content">        &amp;*REGISTRY_STORE.with(|store| store.clone()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L414" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-415</span><span class="line-content">        from,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L415" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-416</span><span class="line-content">        to,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L416" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-417</span><span class="line-content">        None,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L417" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-418</span><span class="line-content">    )<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L418" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-419</span><span class="line-content">    .expect(&quot;Failed to fetch rewardables&quot;);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L419" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-420</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L420" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-421</span><span class="line-content">    let np_1_id = PrincipalId::new_user_test_id(20);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L421" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-422</span><span class="line-content">    let np_1_rewardables = rewardables<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L422" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-423</span><span class="line-content">        .remove(&amp;np_1_id)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L423" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-424</span><span class="line-content">        .expect(&quot;No rewardables for node provider&quot;);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L424" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-425</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L425" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-426</span><span class="line-content">    let node_1_rewardable_days = node_rewardable_days(&amp;np_1_rewardables, node_1_id);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L426" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-427</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L427" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-428</span><span class="line-content">    let expected_days: Vec&lt;DayUtc&gt; = vec![<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L428" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-429</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-07&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L429" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-430</span><span class="line-content">        // On 2025-07-08, node_1 was deleted, so it should not be rewardable until the 2025-07-11.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L430" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-431</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-11&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L431" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-432</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-12&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L432" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+290</span><span class="line-content">    let mut current_day = from;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L290" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+291</span><span class="line-content">    let expected_absent = [<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L291" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+292</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-08&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L292" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+293</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-09&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L293" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+294</span><span class="line-content">        DayUtc::try_from(&quot;2025-07-10&quot;).unwrap(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L294" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">295</span><span class="line-content">     ];<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L295" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">296</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L296" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-435</span><span class="line-content">    assert_eq!(node_1_rewardable_days, expected_days);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L435" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-436</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L436" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-437</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L437" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-438</span><span class="line-content">#[test]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L438" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-439</span><span class="line-content">fn test_rewardables_nodes_provider_filtered() {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L439" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-440</span><span class="line-content">    let _client = client_for_tests();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L440" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-441</span><span class="line-content">    let from = DayUtc::try_from(&quot;2025-07-12&quot;).unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L441" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-442</span><span class="line-content">    let to = DayUtc::try_from(&quot;2025-07-17&quot;).unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L442" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-443</span><span class="line-content">    let _reward_period = RewardPeriod::new(from, to).expect(&quot;Failed to create reward period&quot;);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L443" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-444</span><span class="line-content">    let np_2_id = PrincipalId::new_user_test_id(50);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L444" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-445</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L445" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-446</span><span class="line-content">    let rewardables = RegistryQuerier::get_rewardable_nodes_per_provider::&lt;DummyState&gt;(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L446" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-447</span><span class="line-content">        &amp;*REGISTRY_STORE.with(|store| store.clone()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L447" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-448</span><span class="line-content">        from,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L448" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-449</span><span class="line-content">        to,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L449" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-450</span><span class="line-content">        Some(np_2_id),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L450" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-451</span><span class="line-content">    )<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L451" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-452</span><span class="line-content">    .expect(&quot;Failed to fetch rewardable nodes&quot;);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L452" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-453</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L453" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-454</span><span class="line-content">    assert_eq!(rewardables.len(), 1);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L454" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-455</span><span class="line-content">    let np_2_rewardables = rewardables.get(&amp;np_2_id).unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L455" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-456</span><span class="line-content">    assert_eq!(np_2_rewardables.len(), 1);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L456" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-457</span><span class="line-content">    let expected_node_4 = NodeId::from(PrincipalId::new_node_test_id(4));<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L457" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-458</span><span class="line-content">    assert_eq!(np_2_rewardables[0].node_id, expected_node_4);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L458" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+297</span><span class="line-content">    while current_day &lt;= to {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L297" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+298</span><span class="line-content">        let rewardables = client<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L298" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+299</span><span class="line-content">            .get_rewardable_nodes_per_provider(&amp;current_day, None)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L299" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+300</span><span class="line-content">            .unwrap()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L300" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+301</span><span class="line-content">            .remove(&amp;PrincipalId::new_user_test_id(20))<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L301" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+302</span><span class="line-content">            .unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L302" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+303</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L303" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+304</span><span class="line-content">        if expected_absent.contains(&amp;current_day) {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L304" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+305</span><span class="line-content">            assert!(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L305" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+306</span><span class="line-content">                !contains_node(&amp;rewardables, 1),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L306" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+307</span><span class="line-content">                &quot;Node 1 should not be rewardable after deletion&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L307" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+308</span><span class="line-content">            );<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L308" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+309</span><span class="line-content">        } else {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L309" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+310</span><span class="line-content">            assert!(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L310" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+311</span><span class="line-content">                contains_node(&amp;rewardables, 1),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L311" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+312</span><span class="line-content">                &quot;Node 1 should be rewardable on day 1&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L312" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+313</span><span class="line-content">            );<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L313" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+314</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L314" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+315</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L315" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+316</span><span class="line-content">        current_day = current_day.next_day();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L316" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+317</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L317" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">318</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L318" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">319</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L319" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">320</span><span class="line-content"> #[test]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L320" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">321</span><span class="line-content"> fn test_node_operator_data_returns_expected_data() {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L321" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-463</span><span class="line-content">    let _client = client_for_tests();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L463" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+322</span><span class="line-content">    let client = client_for_tests();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L322" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">323</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L323" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">324</span><span class="line-content">     let version = 39667;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L324" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">325</span><span class="line-content">     let no_2_id = PrincipalId::new_user_test_id(30);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L325" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-467</span><span class="line-content">    let data = RegistryQuerier::node_operator_data(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L467" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-468</span><span class="line-content">        &amp;*REGISTRY_STORE.with(|store| store.clone()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L468" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-469</span><span class="line-content">        no_2_id,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L469" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-470</span><span class="line-content">        version.into(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L470" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-471</span><span class="line-content">    )<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L471" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-472</span><span class="line-content">    .unwrap()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L472" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-473</span><span class="line-content">    .unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L473" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+326</span><span class="line-content">    let data = client<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L326" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+327</span><span class="line-content">        .node_operator_data(no_2_id, version.into())<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L327" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+328</span><span class="line-content">        .unwrap()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L328" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+329</span><span class="line-content">        .unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L329" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">330</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L330" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">331</span><span class="line-content">     assert_eq!(data.node_provider_id, PrincipalId::new_user_test_id(20));<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L331" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">332</span><span class="line-content">     assert_eq!(data.dc_id, &quot;y&quot;);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L332" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -478,27 +334,23 @@ fn test_node_operator_data_returns_expected_data() {</div>
<div class="line context"><span class="line-number">334</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L334" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">335</span><span class="line-content">     let version = 39675;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L335" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">336</span><span class="line-content">     let no_1_id = PrincipalId::new_user_test_id(10);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L336" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-481</span><span class="line-content">    let data = RegistryQuerier::node_operator_data(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L481" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-482</span><span class="line-content">        &amp;*REGISTRY_STORE.with(|store| store.clone()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L482" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-483</span><span class="line-content">        no_1_id,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L483" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-484</span><span class="line-content">        version.into(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L484" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-485</span><span class="line-content">    )<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L485" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-486</span><span class="line-content">    .unwrap()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L486" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-487</span><span class="line-content">    .unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L487" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+337</span><span class="line-content">    let data = client<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L337" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+338</span><span class="line-content">        .node_operator_data(no_1_id, version.into())<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L338" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+339</span><span class="line-content">        .unwrap()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L339" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+340</span><span class="line-content">        .unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L340" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">341</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L341" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">342</span><span class="line-content">     assert_eq!(data.node_provider_id, PrincipalId::new_user_test_id(20));<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L342" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">343</span><span class="line-content">     assert_eq!(data.dc_id, &quot;x&quot;);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L343" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">344</span><span class="line-content">     assert_eq!(data.region, &quot;A&quot;);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L344" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">345</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L345" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">346</span><span class="line-content">     let not_yet_added_no_version = 39652;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L346" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-494</span><span class="line-content">    let data = RegistryQuerier::node_operator_data(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L494" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-495</span><span class="line-content">        &amp;*REGISTRY_STORE.with(|store| store.clone()),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L495" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-496</span><span class="line-content">        no_1_id,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L496" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-497</span><span class="line-content">        not_yet_added_no_version.into(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L497" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-498</span><span class="line-content">    )<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L498" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-499</span><span class="line-content">    .unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L499" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+347</span><span class="line-content">    let data = client<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L347" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+348</span><span class="line-content">        .node_operator_data(no_1_id, not_yet_added_no_version.into())<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L348" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+349</span><span class="line-content">        .unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L349" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+350</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L350" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">351</span><span class="line-content">     assert!(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L351" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">352</span><span class="line-content">         data.is_none(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L352" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-502</span><span class="line-content">        &quot;Data should not exist for version {not_yet_added_no_version} because Operator was not yet added&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L502" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+353</span><span class="line-content">        &quot;Data should not exist for version {} because Operator was not yet added&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L353" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+354</span><span class="line-content">        not_yet_added_no_version<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L354" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">355</span><span class="line-content">     );<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L355" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">356</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L356" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">357</span><span class="line-content">diff --git a/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs b/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L357" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">358</span><span class="line-content">index c475ed4ceb..bd5f326c7a 100644<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/src/registry_querier/tests.rs#L358" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs</div>
<div class="hunk-header">@@ -76,8 +76,8 @@ async fn get_node_provider_rewards_calculation_is_only_callable_in_nonreplicated</div>
<div class="line context"><span class="line-number">76</span><span class="line-content">     pocket_ic.tick().await;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">77</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">78</span><span class="line-content">     let request = GetNodeProviderRewardsCalculationRequest {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-79</span><span class="line-content">        from_nanos: past_time_nanos,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-80</span><span class="line-content">        to_nanos: past_time_nanos,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+79</span><span class="line-content">        from_day_timestamp_nanos: past_time_nanos,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+80</span><span class="line-content">        to_day_timestamp_nanos: past_time_nanos,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">81</span><span class="line-content">         provider_id: Principal::anonymous(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">82</span><span class="line-content">     };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">83</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -92,7 +92,10 @@ async fn get_node_provider_rewards_calculation_is_only_callable_in_nonreplicated</div>
<div class="line context"><span class="line-number">92</span><span class="line-content">     .unwrap()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">93</span><span class="line-content">     .0<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">94</span><span class="line-content">     .unwrap_err();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L94" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-95</span><span class="line-content">    assert_eq!(err, &quot;No rewards found for node provider 2vxsx-fae&quot;);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+95</span><span class="line-content">    assert_eq!(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+96</span><span class="line-content">        err,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L96" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+97</span><span class="line-content">        &quot;Could not calculate rewards: \&quot;No metrics found for day 1620345599999999999\&quot;&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+98</span><span class="line-content">    );<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L98" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">99</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">100</span><span class="line-content">     // Replicated update call is not allowed.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L100" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">101</span><span class="line-content">     let err = update_candid::&lt;_, (GetNodeProviderRewardsCalculationResponse,)&gt;(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L101" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">102</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/BUILD.bazel b/rs/node_rewards/rewards_calculation/BUILD.bazel<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">103</span><span class="line-content">index 7c5089e056..abe52d044d 100644<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/BUILD.bazel</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/BUILD.bazel</div>
<div class="hunk-header">@@ -6,10 +6,8 @@ DEPENDENCIES = [</div>
<div class="line context"><span class="line-number">6</span><span class="line-content">     # Keep sorted.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/BUILD.bazel#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content">     &quot;//rs/protobuf&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/BUILD.bazel#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content">     &quot;//rs/types/base_types&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/BUILD.bazel#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-9</span><span class="line-content">    &quot;//rs/types/types&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/BUILD.bazel#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content">     &quot;@crate_index//:candid&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/BUILD.bazel#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content">     &quot;@crate_index//:chrono_canisters&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/BUILD.bazel#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-12</span><span class="line-content">    &quot;@crate_index//:ic-cdk&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/BUILD.bazel#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content">     &quot;@crate_index//:itertools&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/BUILD.bazel#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">     &quot;@crate_index//:maplit&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/BUILD.bazel#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content">     &quot;@crate_index//:rust_decimal&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/BUILD.bazel#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/Cargo.toml b/rs/node_rewards/rewards_calculation/Cargo.toml<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/BUILD.bazel#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content">index f9e5a8e5df..d3de985e51 100644<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/BUILD.bazel#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/Cargo.toml</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/Cargo.toml</div>
<div class="hunk-header">@@ -10,8 +10,6 @@ documentation.workspace = true</div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> path = &quot;src/lib.rs&quot;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/Cargo.toml#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/Cargo.toml#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> [dependencies]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/Cargo.toml#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-13</span><span class="line-content">ic-cdk = { workspace = true }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/Cargo.toml#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-14</span><span class="line-content">ic-types = { path = &quot;../../types/types&quot; }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/Cargo.toml#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> ic-base-types = { path = &quot;../../types/base_types&quot; }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/Cargo.toml#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> itertools = { workspace = true }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/Cargo.toml#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> ic-protobuf = { path = &quot;../../protobuf&quot; }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/Cargo.toml#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/lib.rs b/rs/node_rewards/rewards_calculation/src/lib.rs<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/Cargo.toml#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content">index f198983a33..069d06b865 100644<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/Cargo.toml#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/lib.rs</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/lib.rs</div>
<div class="hunk-header">@@ -1,4 +1,2 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">mod performance_based_algorithm;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/lib.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content">pub mod rewards_calculator;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/lib.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-3</span><span class="line-content">pub mod rewards_calculator_results;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/lib.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">pub mod performance_based_algorithm;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/lib.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> pub mod types;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/lib.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/lib.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content">index 3977717337..3634cdcafb 100644<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/lib.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs</div>
<div class="hunk-header">@@ -1,15 +1,13 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">#![allow(dead_code)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> use crate::performance_based_algorithm::results::{<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content">     BaseRewards, BaseRewardsType3, DailyResults, NodeMetricsDaily, NodeProviderRewards,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content">     NodeResults, NodeStatus, Percent, RewardsCalculatorResults, XDRPermyriad,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-6</span><span class="line-content">use crate::performance_based_algorithm::test_utils::RewardableNode;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content">use crate::types::{DayUtc, NodeMetricsDailyRaw, Region};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+5</span><span class="line-content">use crate::types::{DayUtc, NodeMetricsDailyRaw, Region, RewardableNode};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use ic_base_types::{NodeId, PrincipalId, SubnetId};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> use ic_protobuf::registry::node::v1::NodeRewardType;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> use ic_protobuf::registry::node_rewards::v2::NodeRewardsTable;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-11</span><span class="line-content">use ic_types::Time;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> use itertools::Itertools;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+10</span><span class="line-content">use maplit::btreemap;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> use rust_decimal::Decimal;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> use rust_decimal::prelude::ToPrimitive;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> use rust_decimal_macros::dec;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -17,7 +15,7 @@ use std::cmp::max;</div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> use std::collections::BTreeMap;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content"> pub mod results;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-20</span><span class="line-content">mod test_utils;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+18</span><span class="line-content">pub mod test_utils;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content"> pub mod v1;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">20</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">21</span><span class="line-content"> // ================================================================================================<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -72,17 +70,6 @@ struct AdjustedRewardsResults {</div>
<div class="line context"><span class="line-number">70</span><span class="line-content">     adjusted_rewards: BTreeMap&lt;NodeId, XDRPermyriad&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">71</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">72</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-75</span><span class="line-content">#[cfg(target_arch = &quot;wasm32&quot;)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-76</span><span class="line-content">fn current_time() -&gt; Time {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-77</span><span class="line-content">    let current_time = ic_cdk::api::time();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-78</span><span class="line-content">    Time::from_nanos_since_unix_epoch(current_time)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-79</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-80</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-81</span><span class="line-content">#[cfg(not(any(target_arch = &quot;wasm32&quot;)))]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-82</span><span class="line-content">fn current_time() -&gt; Time {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-83</span><span class="line-content">    ic_types::time::current_time()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-84</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-85</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">73</span><span class="line-content"> pub trait DataProvider {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">74</span><span class="line-content">     fn get_rewards_table(&amp;self, day: &amp;DayUtc) -&gt; Result&lt;NodeRewardsTable, String&gt;;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">75</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -100,7 +87,7 @@ pub trait DataProvider {</div>
<div class="line context"><span class="line-number">87</span><span class="line-content">         &amp;self,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">88</span><span class="line-content">         day: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">89</span><span class="line-content">         provider_id: &amp;PrincipalId,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-103</span><span class="line-content">    ) -&gt; Result&lt;BTreeMap&lt;PrincipalId, Vec&lt;RewardableNode&gt;&gt;, String&gt;;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+90</span><span class="line-content">    ) -&gt; Result&lt;Vec&lt;RewardableNode&gt;, String&gt;;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">91</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">92</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">93</span><span class="line-content"> trait PerformanceBasedAlgorithm {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -127,24 +114,15 @@ trait PerformanceBasedAlgorithm {</div>
<div class="line context"><span class="line-number">114</span><span class="line-content">     /// 2629800 / 86400 = 30.4375 days of rewards<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L114" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">115</span><span class="line-content">     const REWARDS_TABLE_DAYS: Decimal = dec!(30.4375);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L115" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">116</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L116" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-130</span><span class="line-content">    fn validate_reward_period(from_day: &amp;DayUtc, to_day: &amp;DayUtc) -&gt; Result&lt;(), String&gt; {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L130" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-131</span><span class="line-content">        let today: DayUtc = current_time().as_nanos_since_unix_epoch().into();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L131" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-132</span><span class="line-content">        if from_day &gt; to_day {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L132" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-133</span><span class="line-content">            return Err(&quot;from_day must be before to_day&quot;.to_string());<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L133" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-134</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L134" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-135</span><span class="line-content">        if to_day &gt;= &amp;today {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L135" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-136</span><span class="line-content">            return Err(&quot;to_day_timestamp_nanos must be earlier than today&quot;.to_string());<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L136" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-137</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L137" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-138</span><span class="line-content">        Ok(())<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L138" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-139</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L139" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-140</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L140" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">117</span><span class="line-content">     fn calculate_rewards(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L117" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">118</span><span class="line-content">         from_day: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L118" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">119</span><span class="line-content">         to_day: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L119" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">120</span><span class="line-content">         node_provider_filter: Option&lt;PrincipalId&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L120" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">121</span><span class="line-content">         data_provider: impl DataProvider,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L121" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">122</span><span class="line-content">     ) -&gt; Result&lt;RewardsCalculatorResults, String&gt; {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L122" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-147</span><span class="line-content">        Self::validate_reward_period(from_day, to_day)?;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L147" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+123</span><span class="line-content">        if from_day &gt; to_day {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L123" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+124</span><span class="line-content">            return Err(&quot;from_day must be before to_day&quot;.to_string());<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L124" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+125</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L125" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">126</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L126" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">127</span><span class="line-content">         let reward_period = from_day.days_until(to_day)?;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L127" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">128</span><span class="line-content">         let mut total_rewards_per_provider = BTreeMap::new();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L128" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -184,7 +162,8 @@ trait PerformanceBasedAlgorithm {</div>
<div class="line context"><span class="line-number">162</span><span class="line-content">         let rewards_table = data_provider.get_rewards_table(day)?;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L162" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">163</span><span class="line-content">         let metrics_by_subnet = data_provider.get_daily_metrics_by_subnet(day)?;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L163" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">164</span><span class="line-content">         let providers_rewardable_nodes = if let Some(provider_id) = node_provider_filter {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L164" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-187</span><span class="line-content">            data_provider.get_provider_rewardable_nodes(day, provider_id)?<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L187" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+165</span><span class="line-content">            let rewardable_nodes = data_provider.get_provider_rewardable_nodes(day, provider_id)?;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L165" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+166</span><span class="line-content">            btreemap! { *provider_id =&gt; rewardable_nodes }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L166" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">167</span><span class="line-content">         } else {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L167" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">168</span><span class="line-content">             data_provider.get_rewardable_nodes(day)?<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L168" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">169</span><span class="line-content">         };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L169" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -308,11 +287,15 @@ trait PerformanceBasedAlgorithm {</div>
<div class="line context"><span class="line-number">287</span><span class="line-content">                 })<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L287" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">288</span><span class="line-content">                 .collect::&lt;BTreeMap&lt;_, _&gt;&gt;();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L288" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">289</span><span class="line-content">             let nodes_fr = nodes_original_fr.values().cloned().collect::&lt;Vec&lt;_&gt;&gt;();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L289" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-311</span><span class="line-content">            let failure_rates = nodes_fr.iter().sorted().collect::&lt;Vec&lt;_&gt;&gt;();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L311" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-312</span><span class="line-content">            let index = ((nodes_fr.len() as f64) * Self::SUBNET_FAILURE_RATE_PERCENTILE).ceil()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L312" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-313</span><span class="line-content">                as usize<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L313" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-314</span><span class="line-content">                - 1;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L314" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-315</span><span class="line-content">            let subnet_fr = *failure_rates[index];<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L315" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+290</span><span class="line-content">            let subnet_fr = if nodes_fr.is_empty() {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L290" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+291</span><span class="line-content">                Decimal::ZERO<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L291" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+292</span><span class="line-content">            } else {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L292" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+293</span><span class="line-content">                let failure_rates = nodes_fr.iter().sorted().collect::&lt;Vec&lt;_&gt;&gt;();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L293" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+294</span><span class="line-content">                let index = ((nodes_fr.len() as f64) * Self::SUBNET_FAILURE_RATE_PERCENTILE).ceil()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L294" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+295</span><span class="line-content">                    as usize<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L295" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+296</span><span class="line-content">                    - 1;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L296" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+297</span><span class="line-content">                *failure_rates[index]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L297" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+298</span><span class="line-content">            };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L298" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">299</span><span class="line-content">             result.subnets_fr.insert(subnet_id, subnet_fr);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L299" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">300</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L300" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">301</span><span class="line-content">             for NodeMetricsDailyRaw {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L301" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">302</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L302" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">303</span><span class="line-content">index a5201b3a24..2d066a435b 100644<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L303" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs</div>
<div class="hunk-header">@@ -1,4 +1,3 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">#![allow(dead_code)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> use crate::types::DayUtc;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use ic_base_types::{NodeId, PrincipalId, SubnetId};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use ic_protobuf::registry::node::v1::NodeRewardType;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content">index ea7ee0e044..f7134e2b3c 100644<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs</div>
<div class="hunk-header">@@ -1,5 +1,4 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">#![allow(dead_code)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content">use crate::types::{NodeMetricsDailyRaw, Region};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">use crate::types::{NodeMetricsDailyRaw, Region, RewardableNode};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use ic_base_types::{NodeId, PrincipalId, SubnetId};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use ic_protobuf::registry::node::v1::NodeRewardType;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use ic_protobuf::registry::node_rewards::v2::{NodeRewardRate, NodeRewardRates, NodeRewardsTable};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -18,14 +17,6 @@ pub fn test_subnet_id(id: u64) -&gt; SubnetId {</div>
<div class="line context"><span class="line-number">17</span><span class="line-content">     SubnetId::from(PrincipalId::new_subnet_test_id(id))<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-21</span><span class="line-content">#[derive(Eq, Hash, PartialEq, Clone, Ord, PartialOrd, Debug)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-22</span><span class="line-content">pub struct RewardableNode {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-23</span><span class="line-content">    pub node_id: NodeId,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-24</span><span class="line-content">    pub region: Region,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-25</span><span class="line-content">    pub node_reward_type: NodeRewardType,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-26</span><span class="line-content">    pub dc_id: String,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-27</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-28</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">20</span><span class="line-content"> impl Default for RewardableNode {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">21</span><span class="line-content">     fn default() -&gt; Self {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">22</span><span class="line-content">         RewardableNode {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">23</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">24</span><span class="line-content">index 63a9a5ccbc..83deedbb20 100644<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs</div>
<div class="hunk-header">@@ -1,5 +1,3 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">#![allow(dead_code)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content">#![allow(unused_imports)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> use crate::performance_based_algorithm::results::RewardsCalculatorResults;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use crate::performance_based_algorithm::{DataProvider, PerformanceBasedAlgorithm};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use crate::types::DayUtc;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -52,15 +50,17 @@ impl RewardsCalculationV1 {</div>
<div class="line context"><span class="line-number">50</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">51</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">52</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+53</span><span class="line-content">#[cfg(test)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">54</span><span class="line-content"> mod tests {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-56</span><span class="line-content">    #![allow(dead_code)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-57</span><span class="line-content">    use crate::performance_based_algorithm::PerformanceBasedAlgorithm;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">55</span><span class="line-content">     use crate::performance_based_algorithm::test_utils::{<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-59</span><span class="line-content">        RewardableNode, build_daily_metrics, create_rewards_table_for_region_test,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-60</span><span class="line-content">        generate_rewardable_nodes, test_node_id, test_subnet_id,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+56</span><span class="line-content">        build_daily_metrics, create_rewards_table_for_region_test, generate_rewardable_nodes,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+57</span><span class="line-content">        test_node_id, test_subnet_id,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">58</span><span class="line-content">     };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">59</span><span class="line-content">     use crate::performance_based_algorithm::v1::RewardsCalculationV1;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-63</span><span class="line-content">    use crate::performance_based_algorithm::{AdjustedRewardsResults, BaseRewardsResults};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+60</span><span class="line-content">    use crate::performance_based_algorithm::{<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+61</span><span class="line-content">        AdjustedRewardsResults, BaseRewardsResults, PerformanceBasedAlgorithm,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+62</span><span class="line-content">    };<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+63</span><span class="line-content">    use crate::types::RewardableNode;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">64</span><span class="line-content">     use ic_protobuf::registry::node::v1::NodeRewardType;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">65</span><span class="line-content">     use maplit::btreemap;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">66</span><span class="line-content">     use rust_decimal_macros::dec;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">67</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/rewards_calculator/mod.rs b/rs/node_rewards/rewards_calculation/src/rewards_calculator/mod.rs<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">68</span><span class="line-content">deleted file mode 100644<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">69</span><span class="line-content">index 31ef7811fc..0000000000<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/rewards_calculator/mod.rs</div>
<div class="file-header">+++ /dev/null</div>
<div class="hunk-header">@@ -1,629 +0,0 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">use crate::rewards_calculator_results::{</span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content">    BaseRewards, DailyBaseRewardsType3, DailyResults, NodeMetricsDaily, NodeProviderRewards,</span></div>
<div class="line removed"><span class="line-number">-3</span><span class="line-content">    NodeResults, NodeStatus, Percent, RewardCalculatorError, RewardsCalculatorResults,</span></div>
<div class="line removed"><span class="line-number">-4</span><span class="line-content">    XDRPermyriad,</span></div>
<div class="line removed"><span class="line-number">-5</span><span class="line-content">};</span></div>
<div class="line removed"><span class="line-number">-6</span><span class="line-content">use crate::types::{</span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content">    DayUtc, NodeMetricsDailyRaw, Region, RewardPeriod, RewardableNode, SubnetMetricsDailyKey,</span></div>
<div class="line removed"><span class="line-number">-8</span><span class="line-content">};</span></div>
<div class="line removed"><span class="line-number">-9</span><span class="line-content">use ic_base_types::{NodeId, PrincipalId, SubnetId};</span></div>
<div class="line removed"><span class="line-number">-10</span><span class="line-content">use ic_protobuf::registry::node::v1::NodeRewardType;</span></div>
<div class="line removed"><span class="line-number">-11</span><span class="line-content">use ic_protobuf::registry::node_rewards::v2::NodeRewardsTable;</span></div>
<div class="line removed"><span class="line-number">-12</span><span class="line-content">use itertools::Itertools;</span></div>
<div class="line removed"><span class="line-number">-13</span><span class="line-content">use rust_decimal::Decimal;</span></div>
<div class="line removed"><span class="line-number">-14</span><span class="line-content">use rust_decimal::prelude::ToPrimitive;</span></div>
<div class="line removed"><span class="line-number">-15</span><span class="line-content">use rust_decimal_macros::dec;</span></div>
<div class="line removed"><span class="line-number">-16</span><span class="line-content">use std::cmp::max;</span></div>
<div class="line removed"><span class="line-number">-17</span><span class="line-content">use std::collections::{BTreeMap, HashMap, HashSet};</span></div>
<div class="line removed"><span class="line-number">-18</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-19</span><span class="line-content">pub mod test_utils;</span></div>
<div class="line removed"><span class="line-number">-20</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-21</span><span class="line-content">pub struct RewardsCalculatorInput {</span></div>
<div class="line removed"><span class="line-number">-22</span><span class="line-content">    pub reward_period: RewardPeriod,</span></div>
<div class="line removed"><span class="line-number">-23</span><span class="line-content">    pub rewards_table: NodeRewardsTable,</span></div>
<div class="line removed"><span class="line-number">-24</span><span class="line-content">    pub daily_metrics_by_subnet: BTreeMap&lt;SubnetMetricsDailyKey, Vec&lt;NodeMetricsDailyRaw&gt;&gt;,</span></div>
<div class="line removed"><span class="line-number">-25</span><span class="line-content">    pub provider_rewardable_nodes: BTreeMap&lt;PrincipalId, Vec&lt;RewardableNode&gt;&gt;,</span></div>
<div class="line removed"><span class="line-number">-26</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-27</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-28</span><span class="line-content">fn validate_input(input: &amp;RewardsCalculatorInput) -&gt; Result&lt;(), RewardCalculatorError&gt; {</span></div>
<div class="line removed"><span class="line-number">-29</span><span class="line-content">    for (key, daily_metrics) in input.daily_metrics_by_subnet.iter() {</span></div>
<div class="line removed"><span class="line-number">-30</span><span class="line-content">        // Check if all metrics are within the reward period</span></div>
<div class="line removed"><span class="line-number">-31</span><span class="line-content">        if !input.reward_period.contains(key.day) {</span></div>
<div class="line removed"><span class="line-number">-32</span><span class="line-content">            return Err(RewardCalculatorError::SubnetMetricsOutOfRange {</span></div>
<div class="line removed"><span class="line-number">-33</span><span class="line-content">                subnet_id: key.subnet_id,</span></div>
<div class="line removed"><span class="line-number">-34</span><span class="line-content">                day: key.day,</span></div>
<div class="line removed"><span class="line-number">-35</span><span class="line-content">                reward_period: input.reward_period.clone(),</span></div>
<div class="line removed"><span class="line-number">-36</span><span class="line-content">            });</span></div>
<div class="line removed"><span class="line-number">-37</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-38</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-39</span><span class="line-content">        // Metrics are unique if there are no duplicate entries for the same day and subnet.</span></div>
<div class="line removed"><span class="line-number">-40</span><span class="line-content">        // Metrics with the same timestamp and different subnet are allowed.</span></div>
<div class="line removed"><span class="line-number">-41</span><span class="line-content">        let unique_node = daily_metrics</span></div>
<div class="line removed"><span class="line-number">-42</span><span class="line-content">            .iter()</span></div>
<div class="line removed"><span class="line-number">-43</span><span class="line-content">            .map(|entry| entry.node_id)</span></div>
<div class="line removed"><span class="line-number">-44</span><span class="line-content">            .collect::&lt;HashSet&lt;_&gt;&gt;();</span></div>
<div class="line removed"><span class="line-number">-45</span><span class="line-content">        if unique_node.len() != daily_metrics.len() {</span></div>
<div class="line removed"><span class="line-number">-46</span><span class="line-content">            return Err(RewardCalculatorError::DuplicateMetrics(</span></div>
<div class="line removed"><span class="line-number">-47</span><span class="line-content">                key.subnet_id,</span></div>
<div class="line removed"><span class="line-number">-48</span><span class="line-content">                key.day,</span></div>
<div class="line removed"><span class="line-number">-49</span><span class="line-content">            ));</span></div>
<div class="line removed"><span class="line-number">-50</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-51</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-52</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-53</span><span class="line-content">    Ok(())</span></div>
<div class="line removed"><span class="line-number">-54</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-55</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-56</span><span class="line-content">pub fn calculate_rewards(</span></div>
<div class="line removed"><span class="line-number">-57</span><span class="line-content">    input: RewardsCalculatorInput,</span></div>
<div class="line removed"><span class="line-number">-58</span><span class="line-content">) -&gt; Result&lt;RewardsCalculatorResults, RewardCalculatorError&gt; {</span></div>
<div class="line removed"><span class="line-number">-59</span><span class="line-content">    validate_input(&amp;input)?;</span></div>
<div class="line removed"><span class="line-number">-60</span><span class="line-content">    let mut results_per_provider = BTreeMap::new();</span></div>
<div class="line removed"><span class="line-number">-61</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-62</span><span class="line-content">    // Step 0: Pre-compute subnets and nodes failure rates</span></div>
<div class="line removed"><span class="line-number">-63</span><span class="line-content">    let Step0Results {</span></div>
<div class="line removed"><span class="line-number">-64</span><span class="line-content">        subnets_fr,</span></div>
<div class="line removed"><span class="line-number">-65</span><span class="line-content">        mut nodes_metrics_daily,</span></div>
<div class="line removed"><span class="line-number">-66</span><span class="line-content">    } = step_0_subnets_nodes_fr(input.daily_metrics_by_subnet);</span></div>
<div class="line removed"><span class="line-number">-67</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-68</span><span class="line-content">    for (provider_id, rewardable_nodes) in input.provider_rewardable_nodes {</span></div>
<div class="line removed"><span class="line-number">-69</span><span class="line-content">        // Step 1: Extract Provider Nodes metrics daily</span></div>
<div class="line removed"><span class="line-number">-70</span><span class="line-content">        let Step1Results {</span></div>
<div class="line removed"><span class="line-number">-71</span><span class="line-content">            provider_nodes_metrics_daily,</span></div>
<div class="line removed"><span class="line-number">-72</span><span class="line-content">        } = step_1_provider_nodes_metrics_daily(&amp;rewardable_nodes, &amp;mut nodes_metrics_daily);</span></div>
<div class="line removed"><span class="line-number">-73</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-74</span><span class="line-content">        // Step 2: Extrapolated failure rate for each provider</span></div>
<div class="line removed"><span class="line-number">-75</span><span class="line-content">        let Step2Results { extrapolated_fr } =</span></div>
<div class="line removed"><span class="line-number">-76</span><span class="line-content">            step_2_extrapolated_fr(&amp;rewardable_nodes, &amp;provider_nodes_metrics_daily);</span></div>
<div class="line removed"><span class="line-number">-77</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-78</span><span class="line-content">        // Step 3: Compute performance multiplier for each node for each provider</span></div>
<div class="line removed"><span class="line-number">-79</span><span class="line-content">        let relative_nodes_fr = provider_nodes_metrics_daily</span></div>
<div class="line removed"><span class="line-number">-80</span><span class="line-content">            .iter()</span></div>
<div class="line removed"><span class="line-number">-81</span><span class="line-content">            .map(|((day, node_id), metrics)| ((*day, *node_id), metrics.relative_fr))</span></div>
<div class="line removed"><span class="line-number">-82</span><span class="line-content">            .collect::&lt;BTreeMap&lt;_, _&gt;&gt;();</span></div>
<div class="line removed"><span class="line-number">-83</span><span class="line-content">        let Step3Results {</span></div>
<div class="line removed"><span class="line-number">-84</span><span class="line-content">            reward_reduction,</span></div>
<div class="line removed"><span class="line-number">-85</span><span class="line-content">            performance_multiplier,</span></div>
<div class="line removed"><span class="line-number">-86</span><span class="line-content">        } = step_3_performance_multiplier(&amp;rewardable_nodes, &amp;relative_nodes_fr, &amp;extrapolated_fr);</span></div>
<div class="line removed"><span class="line-number">-87</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-88</span><span class="line-content">        // Step 4: Compute base rewards for each node based on its region and node type</span></div>
<div class="line removed"><span class="line-number">-89</span><span class="line-content">        let Step4Results {</span></div>
<div class="line removed"><span class="line-number">-90</span><span class="line-content">            base_rewards_per_node,</span></div>
<div class="line removed"><span class="line-number">-91</span><span class="line-content">            base_rewards,</span></div>
<div class="line removed"><span class="line-number">-92</span><span class="line-content">            base_rewards_type3,</span></div>
<div class="line removed"><span class="line-number">-93</span><span class="line-content">        } = step_4_compute_base_rewards_type_region(&amp;input.rewards_table, &amp;rewardable_nodes);</span></div>
<div class="line removed"><span class="line-number">-94</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-95</span><span class="line-content">        // Step 5: Adjusted rewards for all the nodes based on their performance</span></div>
<div class="line removed"><span class="line-number">-96</span><span class="line-content">        let Step5Results { adjusted_rewards } = step_5_adjust_node_rewards(</span></div>
<div class="line removed"><span class="line-number">-97</span><span class="line-content">            &amp;rewardable_nodes,</span></div>
<div class="line removed"><span class="line-number">-98</span><span class="line-content">            &amp;base_rewards_per_node,</span></div>
<div class="line removed"><span class="line-number">-99</span><span class="line-content">            &amp;performance_multiplier,</span></div>
<div class="line removed"><span class="line-number">-100</span><span class="line-content">        );</span></div>
<div class="line removed"><span class="line-number">-101</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-102</span><span class="line-content">        // Step 6: Construct provider results</span></div>
<div class="line removed"><span class="line-number">-103</span><span class="line-content">        let provider_results = step_6_construct_provider_results(</span></div>
<div class="line removed"><span class="line-number">-104</span><span class="line-content">            rewardable_nodes,</span></div>
<div class="line removed"><span class="line-number">-105</span><span class="line-content">            provider_nodes_metrics_daily,</span></div>
<div class="line removed"><span class="line-number">-106</span><span class="line-content">            extrapolated_fr,</span></div>
<div class="line removed"><span class="line-number">-107</span><span class="line-content">            reward_reduction,</span></div>
<div class="line removed"><span class="line-number">-108</span><span class="line-content">            performance_multiplier,</span></div>
<div class="line removed"><span class="line-number">-109</span><span class="line-content">            base_rewards_per_node,</span></div>
<div class="line removed"><span class="line-number">-110</span><span class="line-content">            adjusted_rewards,</span></div>
<div class="line removed"><span class="line-number">-111</span><span class="line-content">            base_rewards,</span></div>
<div class="line removed"><span class="line-number">-112</span><span class="line-content">            base_rewards_type3,</span></div>
<div class="line removed"><span class="line-number">-113</span><span class="line-content">        );</span></div>
<div class="line removed"><span class="line-number">-114</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-115</span><span class="line-content">        results_per_provider.insert(provider_id, provider_results);</span></div>
<div class="line removed"><span class="line-number">-116</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-117</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-118</span><span class="line-content">    Ok(RewardsCalculatorResults {</span></div>
<div class="line removed"><span class="line-number">-119</span><span class="line-content">        start_day: input.reward_period.from,</span></div>
<div class="line removed"><span class="line-number">-120</span><span class="line-content">        end_day: input.reward_period.to,</span></div>
<div class="line removed"><span class="line-number">-121</span><span class="line-content">        subnets_fr,</span></div>
<div class="line removed"><span class="line-number">-122</span><span class="line-content">        provider_results: results_per_provider,</span></div>
<div class="line removed"><span class="line-number">-123</span><span class="line-content">    })</span></div>
<div class="line removed"><span class="line-number">-124</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-125</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-126</span><span class="line-content">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line removed"><span class="line-number">-127</span><span class="line-content">// Step 0: Pre-compute subnets and nodes failure rates</span></div>
<div class="line removed"><span class="line-number">-128</span><span class="line-content">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line removed"><span class="line-number">-129</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-130</span><span class="line-content">/// The percentile used to calculate the failure rate for a subnet.</span></div>
<div class="line removed"><span class="line-number">-131</span><span class="line-content">const SUBNET_FAILURE_RATE_PERCENTILE: f64 = 0.75;</span></div>
<div class="line removed"><span class="line-number">-132</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-133</span><span class="line-content">#[derive(Default)]</span></div>
<div class="line removed"><span class="line-number">-134</span><span class="line-content">struct Step0Results {</span></div>
<div class="line removed"><span class="line-number">-135</span><span class="line-content">    subnets_fr: BTreeMap&lt;(DayUtc, SubnetId), Percent&gt;,</span></div>
<div class="line removed"><span class="line-number">-136</span><span class="line-content">    nodes_metrics_daily: BTreeMap&lt;(DayUtc, NodeId), NodeMetricsDaily&gt;,</span></div>
<div class="line removed"><span class="line-number">-137</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-138</span><span class="line-content">fn step_0_subnets_nodes_fr(</span></div>
<div class="line removed"><span class="line-number">-139</span><span class="line-content">    daily_metrics_by_subnet: BTreeMap&lt;SubnetMetricsDailyKey, Vec&lt;NodeMetricsDailyRaw&gt;&gt;,</span></div>
<div class="line removed"><span class="line-number">-140</span><span class="line-content">) -&gt; Step0Results {</span></div>
<div class="line removed"><span class="line-number">-141</span><span class="line-content">    fn calculate_daily_node_fr(num_blocks_proposed: u64, num_blocks_failed: u64) -&gt; Decimal {</span></div>
<div class="line removed"><span class="line-number">-142</span><span class="line-content">        let total_blocks = Decimal::from(num_blocks_proposed + num_blocks_failed);</span></div>
<div class="line removed"><span class="line-number">-143</span><span class="line-content">        if total_blocks == Decimal::ZERO {</span></div>
<div class="line removed"><span class="line-number">-144</span><span class="line-content">            Decimal::ZERO</span></div>
<div class="line removed"><span class="line-number">-145</span><span class="line-content">        } else {</span></div>
<div class="line removed"><span class="line-number">-146</span><span class="line-content">            let num_blocks_failed = Decimal::from(num_blocks_failed);</span></div>
<div class="line removed"><span class="line-number">-147</span><span class="line-content">            num_blocks_failed / total_blocks</span></div>
<div class="line removed"><span class="line-number">-148</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-149</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-150</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-151</span><span class="line-content">    fn calculate_daily_subnet_fr(nodes_fr: &amp;[Decimal]) -&gt; Decimal {</span></div>
<div class="line removed"><span class="line-number">-152</span><span class="line-content">        let failure_rates = nodes_fr.iter().sorted().collect::&lt;Vec&lt;_&gt;&gt;();</span></div>
<div class="line removed"><span class="line-number">-153</span><span class="line-content">        let index = ((nodes_fr.len() as f64) * SUBNET_FAILURE_RATE_PERCENTILE).ceil() as usize - 1;</span></div>
<div class="line removed"><span class="line-number">-154</span><span class="line-content">        *failure_rates[index]</span></div>
<div class="line removed"><span class="line-number">-155</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-156</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-157</span><span class="line-content">    let mut result = Step0Results::default();</span></div>
<div class="line removed"><span class="line-number">-158</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-159</span><span class="line-content">    for (SubnetMetricsDailyKey { subnet_id, day }, subnet_nodes_metrics) in daily_metrics_by_subnet</span></div>
<div class="line removed"><span class="line-number">-160</span><span class="line-content">    {</span></div>
<div class="line removed"><span class="line-number">-161</span><span class="line-content">        let nodes_original_fr = subnet_nodes_metrics</span></div>
<div class="line removed"><span class="line-number">-162</span><span class="line-content">            .iter()</span></div>
<div class="line removed"><span class="line-number">-163</span><span class="line-content">            .map(|metrics| {</span></div>
<div class="line removed"><span class="line-number">-164</span><span class="line-content">                let original_fr =</span></div>
<div class="line removed"><span class="line-number">-165</span><span class="line-content">                    calculate_daily_node_fr(metrics.num_blocks_proposed, metrics.num_blocks_failed);</span></div>
<div class="line removed"><span class="line-number">-166</span><span class="line-content">                (metrics.node_id, original_fr)</span></div>
<div class="line removed"><span class="line-number">-167</span><span class="line-content">            })</span></div>
<div class="line removed"><span class="line-number">-168</span><span class="line-content">            .collect::&lt;BTreeMap&lt;_, _&gt;&gt;();</span></div>
<div class="line removed"><span class="line-number">-169</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-170</span><span class="line-content">        let subnet_fr =</span></div>
<div class="line removed"><span class="line-number">-171</span><span class="line-content">            calculate_daily_subnet_fr(&amp;nodes_original_fr.values().cloned().collect::&lt;Vec&lt;_&gt;&gt;());</span></div>
<div class="line removed"><span class="line-number">-172</span><span class="line-content">        result.subnets_fr.insert((day, subnet_id), subnet_fr);</span></div>
<div class="line removed"><span class="line-number">-173</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-174</span><span class="line-content">        for NodeMetricsDailyRaw {</span></div>
<div class="line removed"><span class="line-number">-175</span><span class="line-content">            node_id,</span></div>
<div class="line removed"><span class="line-number">-176</span><span class="line-content">            num_blocks_proposed,</span></div>
<div class="line removed"><span class="line-number">-177</span><span class="line-content">            num_blocks_failed,</span></div>
<div class="line removed"><span class="line-number">-178</span><span class="line-content">        } in subnet_nodes_metrics</span></div>
<div class="line removed"><span class="line-number">-179</span><span class="line-content">        {</span></div>
<div class="line removed"><span class="line-number">-180</span><span class="line-content">            let original_fr = nodes_original_fr[&amp;node_id];</span></div>
<div class="line removed"><span class="line-number">-181</span><span class="line-content">            let relative_fr = max(Decimal::ZERO, original_fr - subnet_fr);</span></div>
<div class="line removed"><span class="line-number">-182</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-183</span><span class="line-content">            result.nodes_metrics_daily.insert(</span></div>
<div class="line removed"><span class="line-number">-184</span><span class="line-content">                (day, node_id),</span></div>
<div class="line removed"><span class="line-number">-185</span><span class="line-content">                NodeMetricsDaily {</span></div>
<div class="line removed"><span class="line-number">-186</span><span class="line-content">                    subnet_assigned: subnet_id,</span></div>
<div class="line removed"><span class="line-number">-187</span><span class="line-content">                    subnet_assigned_fr: subnet_fr,</span></div>
<div class="line removed"><span class="line-number">-188</span><span class="line-content">                    num_blocks_proposed,</span></div>
<div class="line removed"><span class="line-number">-189</span><span class="line-content">                    num_blocks_failed,</span></div>
<div class="line removed"><span class="line-number">-190</span><span class="line-content">                    original_fr,</span></div>
<div class="line removed"><span class="line-number">-191</span><span class="line-content">                    relative_fr,</span></div>
<div class="line removed"><span class="line-number">-192</span><span class="line-content">                },</span></div>
<div class="line removed"><span class="line-number">-193</span><span class="line-content">            );</span></div>
<div class="line removed"><span class="line-number">-194</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-195</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-196</span><span class="line-content">    result</span></div>
<div class="line removed"><span class="line-number">-197</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-198</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-199</span><span class="line-content">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line removed"><span class="line-number">-200</span><span class="line-content">// Step 1: Extract Provider Nodes metrics daily</span></div>
<div class="line removed"><span class="line-number">-201</span><span class="line-content">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line removed"><span class="line-number">-202</span><span class="line-content">#[derive(Default)]</span></div>
<div class="line removed"><span class="line-number">-203</span><span class="line-content">struct Step1Results {</span></div>
<div class="line removed"><span class="line-number">-204</span><span class="line-content">    provider_nodes_metrics_daily: BTreeMap&lt;(DayUtc, NodeId), NodeMetricsDaily&gt;,</span></div>
<div class="line removed"><span class="line-number">-205</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-206</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-207</span><span class="line-content">fn step_1_provider_nodes_metrics_daily(</span></div>
<div class="line removed"><span class="line-number">-208</span><span class="line-content">    rewardable_nodes: &amp;[RewardableNode],</span></div>
<div class="line removed"><span class="line-number">-209</span><span class="line-content">    node_metrics_daily: &amp;mut BTreeMap&lt;(DayUtc, NodeId), NodeMetricsDaily&gt;,</span></div>
<div class="line removed"><span class="line-number">-210</span><span class="line-content">) -&gt; Step1Results {</span></div>
<div class="line removed"><span class="line-number">-211</span><span class="line-content">    let mut provider_nodes_metrics_daily = BTreeMap::new();</span></div>
<div class="line removed"><span class="line-number">-212</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-213</span><span class="line-content">    for node in rewardable_nodes {</span></div>
<div class="line removed"><span class="line-number">-214</span><span class="line-content">        for day in &amp;node.rewardable_days {</span></div>
<div class="line removed"><span class="line-number">-215</span><span class="line-content">            if let Some(metrics) = node_metrics_daily.remove(&amp;(*day, node.node_id)) {</span></div>
<div class="line removed"><span class="line-number">-216</span><span class="line-content">                provider_nodes_metrics_daily.insert((*day, node.node_id), metrics.clone());</span></div>
<div class="line removed"><span class="line-number">-217</span><span class="line-content">            }</span></div>
<div class="line removed"><span class="line-number">-218</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-219</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-220</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-221</span><span class="line-content">    Step1Results {</span></div>
<div class="line removed"><span class="line-number">-222</span><span class="line-content">        provider_nodes_metrics_daily,</span></div>
<div class="line removed"><span class="line-number">-223</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-224</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-225</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-226</span><span class="line-content">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line removed"><span class="line-number">-227</span><span class="line-content">// Step 2: Extrapolated failure rate for each provider</span></div>
<div class="line removed"><span class="line-number">-228</span><span class="line-content">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line removed"><span class="line-number">-229</span><span class="line-content">#[derive(Default)]</span></div>
<div class="line removed"><span class="line-number">-230</span><span class="line-content">struct Step2Results {</span></div>
<div class="line removed"><span class="line-number">-231</span><span class="line-content">    extrapolated_fr: HashMap&lt;DayUtc, Percent&gt;,</span></div>
<div class="line removed"><span class="line-number">-232</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-233</span><span class="line-content">fn step_2_extrapolated_fr(</span></div>
<div class="line removed"><span class="line-number">-234</span><span class="line-content">    rewardable_nodes: &amp;[RewardableNode],</span></div>
<div class="line removed"><span class="line-number">-235</span><span class="line-content">    nodes_metrics_daily: &amp;BTreeMap&lt;(DayUtc, NodeId), NodeMetricsDaily&gt;,</span></div>
<div class="line removed"><span class="line-number">-236</span><span class="line-content">) -&gt; Step2Results {</span></div>
<div class="line removed"><span class="line-number">-237</span><span class="line-content">    let mut result = Step2Results::default();</span></div>
<div class="line removed"><span class="line-number">-238</span><span class="line-content">    // Collect all relative FRs for this provider&#x27;s nodes grouped by day.</span></div>
<div class="line removed"><span class="line-number">-239</span><span class="line-content">    let mut grouped_fr: BTreeMap&lt;DayUtc, Vec&lt;Decimal&gt;&gt; = BTreeMap::new();</span></div>
<div class="line removed"><span class="line-number">-240</span><span class="line-content">    for ((day, _), metrics) in nodes_metrics_daily {</span></div>
<div class="line removed"><span class="line-number">-241</span><span class="line-content">        grouped_fr</span></div>
<div class="line removed"><span class="line-number">-242</span><span class="line-content">            .entry(*day)</span></div>
<div class="line removed"><span class="line-number">-243</span><span class="line-content">            .or_default()</span></div>
<div class="line removed"><span class="line-number">-244</span><span class="line-content">            .push(metrics.relative_fr);</span></div>
<div class="line removed"><span class="line-number">-245</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-246</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-247</span><span class="line-content">    // Include all rewardable days even if there was no data</span></div>
<div class="line removed"><span class="line-number">-248</span><span class="line-content">    let all_rewardable_days: HashSet&lt;DayUtc&gt; = rewardable_nodes</span></div>
<div class="line removed"><span class="line-number">-249</span><span class="line-content">        .iter()</span></div>
<div class="line removed"><span class="line-number">-250</span><span class="line-content">        .flat_map(|n| n.rewardable_days.clone())</span></div>
<div class="line removed"><span class="line-number">-251</span><span class="line-content">        .collect();</span></div>
<div class="line removed"><span class="line-number">-252</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-253</span><span class="line-content">    for day in all_rewardable_days {</span></div>
<div class="line removed"><span class="line-number">-254</span><span class="line-content">        let frs = grouped_fr.remove(&amp;day).unwrap_or_default();</span></div>
<div class="line removed"><span class="line-number">-255</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-256</span><span class="line-content">        // If there are no relative FRs for this day, the extrapolated FR is set to 0</span></div>
<div class="line removed"><span class="line-number">-257</span><span class="line-content">        let avg_fr = avg(&amp;frs).unwrap_or_default();</span></div>
<div class="line removed"><span class="line-number">-258</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-259</span><span class="line-content">        result.extrapolated_fr.insert(day, avg_fr);</span></div>
<div class="line removed"><span class="line-number">-260</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-261</span><span class="line-content">    result</span></div>
<div class="line removed"><span class="line-number">-262</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-263</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-264</span><span class="line-content">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line removed"><span class="line-number">-265</span><span class="line-content">// Step 3: Compute performance multiplier for each node for each provider</span></div>
<div class="line removed"><span class="line-number">-266</span><span class="line-content">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line removed"><span class="line-number">-267</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-268</span><span class="line-content">/// The minimum and maximum failure rates for a node.</span></div>
<div class="line removed"><span class="line-number">-269</span><span class="line-content">/// Nodes with a failure rate below `MIN_FAILURE_RATE` will not be penalized.</span></div>
<div class="line removed"><span class="line-number">-270</span><span class="line-content">/// Nodes with a failure rate above `MAX_FAILURE_RATE` will be penalized with `MAX_REWARDS_REDUCTION`.</span></div>
<div class="line removed"><span class="line-number">-271</span><span class="line-content">const MIN_FAILURE_RATE: Decimal = dec!(0.1);</span></div>
<div class="line removed"><span class="line-number">-272</span><span class="line-content">const MAX_FAILURE_RATE: Decimal = dec!(0.6);</span></div>
<div class="line removed"><span class="line-number">-273</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-274</span><span class="line-content">/// The minimum and maximum rewards reduction for a node.</span></div>
<div class="line removed"><span class="line-number">-275</span><span class="line-content">const MIN_REWARDS_REDUCTION: Decimal = dec!(0);</span></div>
<div class="line removed"><span class="line-number">-276</span><span class="line-content">const MAX_REWARDS_REDUCTION: Decimal = dec!(0.8);</span></div>
<div class="line removed"><span class="line-number">-277</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-278</span><span class="line-content">#[derive(Default)]</span></div>
<div class="line removed"><span class="line-number">-279</span><span class="line-content">struct Step3Results {</span></div>
<div class="line removed"><span class="line-number">-280</span><span class="line-content">    reward_reduction: HashMap&lt;(DayUtc, NodeId), Percent&gt;,</span></div>
<div class="line removed"><span class="line-number">-281</span><span class="line-content">    performance_multiplier: HashMap&lt;(DayUtc, NodeId), Percent&gt;,</span></div>
<div class="line removed"><span class="line-number">-282</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-283</span><span class="line-content">fn step_3_performance_multiplier(</span></div>
<div class="line removed"><span class="line-number">-284</span><span class="line-content">    rewardable_nodes: &amp;[RewardableNode],</span></div>
<div class="line removed"><span class="line-number">-285</span><span class="line-content">    relative_nodes_fr: &amp;BTreeMap&lt;(DayUtc, NodeId), Decimal&gt;,</span></div>
<div class="line removed"><span class="line-number">-286</span><span class="line-content">    extrapolated_fr: &amp;HashMap&lt;DayUtc, Decimal&gt;,</span></div>
<div class="line removed"><span class="line-number">-287</span><span class="line-content">) -&gt; Step3Results {</span></div>
<div class="line removed"><span class="line-number">-288</span><span class="line-content">    let mut results = Step3Results::default();</span></div>
<div class="line removed"><span class="line-number">-289</span><span class="line-content">    fn calculate_rewards_reduction(fr: Decimal) -&gt; Decimal {</span></div>
<div class="line removed"><span class="line-number">-290</span><span class="line-content">        if fr &lt; MIN_FAILURE_RATE {</span></div>
<div class="line removed"><span class="line-number">-291</span><span class="line-content">            MIN_REWARDS_REDUCTION</span></div>
<div class="line removed"><span class="line-number">-292</span><span class="line-content">        } else if fr &gt; MAX_FAILURE_RATE {</span></div>
<div class="line removed"><span class="line-number">-293</span><span class="line-content">            MAX_REWARDS_REDUCTION</span></div>
<div class="line removed"><span class="line-number">-294</span><span class="line-content">        } else {</span></div>
<div class="line removed"><span class="line-number">-295</span><span class="line-content">            // Linear interpolation between MIN_REWARDS_REDUCTION and MAX_REWARDS_REDUCTION</span></div>
<div class="line removed"><span class="line-number">-296</span><span class="line-content">            (fr - MIN_FAILURE_RATE) / (MAX_FAILURE_RATE - MIN_FAILURE_RATE) * MAX_REWARDS_REDUCTION</span></div>
<div class="line removed"><span class="line-number">-297</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-298</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-299</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-300</span><span class="line-content">    for node in rewardable_nodes {</span></div>
<div class="line removed"><span class="line-number">-301</span><span class="line-content">        for day in &amp;node.rewardable_days {</span></div>
<div class="line removed"><span class="line-number">-302</span><span class="line-content">            let daily_fr_used;</span></div>
<div class="line removed"><span class="line-number">-303</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-304</span><span class="line-content">            if let Some(relative_fr) = relative_nodes_fr.get(&amp;(*day, node.node_id)) {</span></div>
<div class="line removed"><span class="line-number">-305</span><span class="line-content">                // If the node is assigned on this day, use the relative failure rate for that day.</span></div>
<div class="line removed"><span class="line-number">-306</span><span class="line-content">                daily_fr_used = *relative_fr;</span></div>
<div class="line removed"><span class="line-number">-307</span><span class="line-content">            } else {</span></div>
<div class="line removed"><span class="line-number">-308</span><span class="line-content">                // If the node is not assigned on this day, use the extrapolated failure rate for that day.</span></div>
<div class="line removed"><span class="line-number">-309</span><span class="line-content">                daily_fr_used = *extrapolated_fr</span></div>
<div class="line removed"><span class="line-number">-310</span><span class="line-content">                    .get(day)</span></div>
<div class="line removed"><span class="line-number">-311</span><span class="line-content">                    .expect(&quot;Extrapolated FR expected for every provider&quot;);</span></div>
<div class="line removed"><span class="line-number">-312</span><span class="line-content">            }</span></div>
<div class="line removed"><span class="line-number">-313</span><span class="line-content">            let rewards_reduction = calculate_rewards_reduction(daily_fr_used);</span></div>
<div class="line removed"><span class="line-number">-314</span><span class="line-content">            let performance_multiplier = dec!(1) - rewards_reduction;</span></div>
<div class="line removed"><span class="line-number">-315</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-316</span><span class="line-content">            results</span></div>
<div class="line removed"><span class="line-number">-317</span><span class="line-content">                .reward_reduction</span></div>
<div class="line removed"><span class="line-number">-318</span><span class="line-content">                .insert((*day, node.node_id), rewards_reduction);</span></div>
<div class="line removed"><span class="line-number">-319</span><span class="line-content">            results</span></div>
<div class="line removed"><span class="line-number">-320</span><span class="line-content">                .performance_multiplier</span></div>
<div class="line removed"><span class="line-number">-321</span><span class="line-content">                .insert((*day, node.node_id), performance_multiplier);</span></div>
<div class="line removed"><span class="line-number">-322</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-323</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-324</span><span class="line-content">    results</span></div>
<div class="line removed"><span class="line-number">-325</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-326</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-327</span><span class="line-content">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line removed"><span class="line-number">-328</span><span class="line-content">// Step 4: Compute base rewards for each node based on its region and node type</span></div>
<div class="line removed"><span class="line-number">-329</span><span class="line-content">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line removed"><span class="line-number">-330</span><span class="line-content">type RewardsCoefficientPercent = Decimal;</span></div>
<div class="line removed"><span class="line-number">-331</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-332</span><span class="line-content">/// From constant [NODE_PROVIDER_REWARD_PERIOD_SECONDS]</span></div>
<div class="line removed"><span class="line-number">-333</span><span class="line-content">/// const NODE_PROVIDER_REWARD_PERIOD_SECONDS: u64 = 2629800;</span></div>
<div class="line removed"><span class="line-number">-334</span><span class="line-content">/// const SECONDS_IN_DAY: u64 = 86400;</span></div>
<div class="line removed"><span class="line-number">-335</span><span class="line-content">/// 2629800 / 86400 = 30.4375 days of rewards</span></div>
<div class="line removed"><span class="line-number">-336</span><span class="line-content">const REWARDS_TABLE_DAYS: Decimal = dec!(30.4375);</span></div>
<div class="line removed"><span class="line-number">-337</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-338</span><span class="line-content">#[derive(Default)]</span></div>
<div class="line removed"><span class="line-number">-339</span><span class="line-content">struct Step4Results {</span></div>
<div class="line removed"><span class="line-number">-340</span><span class="line-content">    base_rewards: Vec&lt;BaseRewards&gt;,</span></div>
<div class="line removed"><span class="line-number">-341</span><span class="line-content">    base_rewards_type3: Vec&lt;DailyBaseRewardsType3&gt;,</span></div>
<div class="line removed"><span class="line-number">-342</span><span class="line-content">    base_rewards_per_node: BTreeMap&lt;(DayUtc, NodeId), XDRPermyriad&gt;,</span></div>
<div class="line removed"><span class="line-number">-343</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-344</span><span class="line-content">fn step_4_compute_base_rewards_type_region(</span></div>
<div class="line removed"><span class="line-number">-345</span><span class="line-content">    node_rewards_table: &amp;NodeRewardsTable,</span></div>
<div class="line removed"><span class="line-number">-346</span><span class="line-content">    rewardable_nodes: &amp;[RewardableNode],</span></div>
<div class="line removed"><span class="line-number">-347</span><span class="line-content">) -&gt; Step4Results {</span></div>
<div class="line removed"><span class="line-number">-348</span><span class="line-content">    fn get_monthly_rate(</span></div>
<div class="line removed"><span class="line-number">-349</span><span class="line-content">        rewards_table: &amp;NodeRewardsTable,</span></div>
<div class="line removed"><span class="line-number">-350</span><span class="line-content">        region: &amp;Region,</span></div>
<div class="line removed"><span class="line-number">-351</span><span class="line-content">        node_reward_type: &amp;NodeRewardType,</span></div>
<div class="line removed"><span class="line-number">-352</span><span class="line-content">    ) -&gt; (Decimal, RewardsCoefficientPercent) {</span></div>
<div class="line removed"><span class="line-number">-353</span><span class="line-content">        rewards_table</span></div>
<div class="line removed"><span class="line-number">-354</span><span class="line-content">            .get_rate(region, &amp;node_reward_type.to_string())</span></div>
<div class="line removed"><span class="line-number">-355</span><span class="line-content">            .map(|rate| {</span></div>
<div class="line removed"><span class="line-number">-356</span><span class="line-content">                let base_rewards_monthly = Decimal::from(rate.xdr_permyriad_per_node_per_month);</span></div>
<div class="line removed"><span class="line-number">-357</span><span class="line-content">                // Default reward_coefficient_percent is set to 80%, which is used as a fallback only in the</span></div>
<div class="line removed"><span class="line-number">-358</span><span class="line-content">                // unlikely case that the type3 entry in the reward table:</span></div>
<div class="line removed"><span class="line-number">-359</span><span class="line-content">                // a) has xdr_permyriad_per_node_per_month entry set for this region, but</span></div>
<div class="line removed"><span class="line-number">-360</span><span class="line-content">                // b) does NOT have the reward_coefficient_percent value set</span></div>
<div class="line removed"><span class="line-number">-361</span><span class="line-content">                let reward_coefficient_percent =</span></div>
<div class="line removed"><span class="line-number">-362</span><span class="line-content">                    Decimal::from(rate.reward_coefficient_percent.unwrap_or(80)) / dec!(100);</span></div>
<div class="line removed"><span class="line-number">-363</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-364</span><span class="line-content">                (base_rewards_monthly, reward_coefficient_percent)</span></div>
<div class="line removed"><span class="line-number">-365</span><span class="line-content">            })</span></div>
<div class="line removed"><span class="line-number">-366</span><span class="line-content">            .unwrap_or((dec!(1), dec!(1)))</span></div>
<div class="line removed"><span class="line-number">-367</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-368</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-369</span><span class="line-content">    fn is_type3(node_type: &amp;NodeRewardType) -&gt; bool {</span></div>
<div class="line removed"><span class="line-number">-370</span><span class="line-content">        node_type == &amp;NodeRewardType::Type3 || node_type == &amp;NodeRewardType::Type3dot1</span></div>
<div class="line removed"><span class="line-number">-371</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-372</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-373</span><span class="line-content">    fn type3_region_key(region: &amp;Region) -&gt; String {</span></div>
<div class="line removed"><span class="line-number">-374</span><span class="line-content">        region</span></div>
<div class="line removed"><span class="line-number">-375</span><span class="line-content">            .splitn(3, &#x27;,&#x27;)</span></div>
<div class="line removed"><span class="line-number">-376</span><span class="line-content">            .take(2)</span></div>
<div class="line removed"><span class="line-number">-377</span><span class="line-content">            .collect::&lt;Vec&lt;&amp;str&gt;&gt;()</span></div>
<div class="line removed"><span class="line-number">-378</span><span class="line-content">            .join(&quot;:&quot;)</span></div>
<div class="line removed"><span class="line-number">-379</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-380</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-381</span><span class="line-content">    let mut base_rewards = BTreeMap::new();</span></div>
<div class="line removed"><span class="line-number">-382</span><span class="line-content">    let mut base_rewards_type3 = BTreeMap::new();</span></div>
<div class="line removed"><span class="line-number">-383</span><span class="line-content">    let mut base_rewards_per_node = BTreeMap::new();</span></div>
<div class="line removed"><span class="line-number">-384</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-385</span><span class="line-content">    for node in rewardable_nodes {</span></div>
<div class="line removed"><span class="line-number">-386</span><span class="line-content">        let (base_rewards_monthly, coefficient) =</span></div>
<div class="line removed"><span class="line-number">-387</span><span class="line-content">            get_monthly_rate(node_rewards_table, &amp;node.region, &amp;node.node_reward_type);</span></div>
<div class="line removed"><span class="line-number">-388</span><span class="line-content">        let base_rewards_daily = base_rewards_monthly / REWARDS_TABLE_DAYS;</span></div>
<div class="line removed"><span class="line-number">-389</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-390</span><span class="line-content">        base_rewards</span></div>
<div class="line removed"><span class="line-number">-391</span><span class="line-content">            .entry((node.node_reward_type, node.region.clone()))</span></div>
<div class="line removed"><span class="line-number">-392</span><span class="line-content">            .or_insert((base_rewards_daily, base_rewards_monthly));</span></div>
<div class="line removed"><span class="line-number">-393</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-394</span><span class="line-content">        // For nodes which are type3* the base rewards for the single node is computed as the average of base rewards</span></div>
<div class="line removed"><span class="line-number">-395</span><span class="line-content">        // on DC Country level. Moreover, to de-stimulate the same NP having too many nodes in the same country,</span></div>
<div class="line removed"><span class="line-number">-396</span><span class="line-content">        // the node rewards is reduced for each node the NP has in the given country. The reduction coefficient is</span></div>
<div class="line removed"><span class="line-number">-397</span><span class="line-content">        // computed as the average of reduction coefficients on DC Country level.</span></div>
<div class="line removed"><span class="line-number">-398</span><span class="line-content">        if is_type3(&amp;node.node_reward_type) {</span></div>
<div class="line removed"><span class="line-number">-399</span><span class="line-content">            // The rewards table contains entries of this form DC Continent + DC Country + DC State/City.</span></div>
<div class="line removed"><span class="line-number">-400</span><span class="line-content">            // The grouping for type3* nodes will be on DC Continent + DC Country level. This group is used for computing</span></div>
<div class="line removed"><span class="line-number">-401</span><span class="line-content">            // the reduction coefficient and base reward for the group.</span></div>
<div class="line removed"><span class="line-number">-402</span><span class="line-content">            let region_key = type3_region_key(&amp;node.region);</span></div>
<div class="line removed"><span class="line-number">-403</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-404</span><span class="line-content">            for day in &amp;node.rewardable_days {</span></div>
<div class="line removed"><span class="line-number">-405</span><span class="line-content">                let key = (day, region_key.clone());</span></div>
<div class="line removed"><span class="line-number">-406</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-407</span><span class="line-content">                base_rewards_type3</span></div>
<div class="line removed"><span class="line-number">-408</span><span class="line-content">                    .entry(key)</span></div>
<div class="line removed"><span class="line-number">-409</span><span class="line-content">                    .and_modify(</span></div>
<div class="line removed"><span class="line-number">-410</span><span class="line-content">                        |(rates, coeffs): &amp;mut (Vec&lt;Decimal&gt;, Vec&lt;RewardsCoefficientPercent&gt;)| {</span></div>
<div class="line removed"><span class="line-number">-411</span><span class="line-content">                            rates.push(base_rewards_daily);</span></div>
<div class="line removed"><span class="line-number">-412</span><span class="line-content">                            coeffs.push(coefficient);</span></div>
<div class="line removed"><span class="line-number">-413</span><span class="line-content">                        },</span></div>
<div class="line removed"><span class="line-number">-414</span><span class="line-content">                    )</span></div>
<div class="line removed"><span class="line-number">-415</span><span class="line-content">                    .or_insert((vec![base_rewards_daily], vec![coefficient]));</span></div>
<div class="line removed"><span class="line-number">-416</span><span class="line-content">            }</span></div>
<div class="line removed"><span class="line-number">-417</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-418</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-419</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-420</span><span class="line-content">    let base_rewards_type3 = base_rewards_type3</span></div>
<div class="line removed"><span class="line-number">-421</span><span class="line-content">        .into_iter()</span></div>
<div class="line removed"><span class="line-number">-422</span><span class="line-content">        .map(|((day, region), (rates, coeff))| {</span></div>
<div class="line removed"><span class="line-number">-423</span><span class="line-content">            let nodes_count = rates.len();</span></div>
<div class="line removed"><span class="line-number">-424</span><span class="line-content">            let avg_rate = avg(rates.as_slice()).unwrap_or_default();</span></div>
<div class="line removed"><span class="line-number">-425</span><span class="line-content">            let avg_coeff = avg(coeff.as_slice()).unwrap_or_default();</span></div>
<div class="line removed"><span class="line-number">-426</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-427</span><span class="line-content">            let mut running_coefficient = dec!(1);</span></div>
<div class="line removed"><span class="line-number">-428</span><span class="line-content">            let mut region_rewards = Vec::new();</span></div>
<div class="line removed"><span class="line-number">-429</span><span class="line-content">            for _ in 0..nodes_count {</span></div>
<div class="line removed"><span class="line-number">-430</span><span class="line-content">                region_rewards.push(avg_rate * running_coefficient);</span></div>
<div class="line removed"><span class="line-number">-431</span><span class="line-content">                running_coefficient *= avg_coeff;</span></div>
<div class="line removed"><span class="line-number">-432</span><span class="line-content">            }</span></div>
<div class="line removed"><span class="line-number">-433</span><span class="line-content">            let region_rewards_avg = avg(&amp;region_rewards).unwrap_or_default();</span></div>
<div class="line removed"><span class="line-number">-434</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-435</span><span class="line-content">            (</span></div>
<div class="line removed"><span class="line-number">-436</span><span class="line-content">                (day, region),</span></div>
<div class="line removed"><span class="line-number">-437</span><span class="line-content">                (region_rewards_avg, nodes_count, avg_rate, avg_coeff),</span></div>
<div class="line removed"><span class="line-number">-438</span><span class="line-content">            )</span></div>
<div class="line removed"><span class="line-number">-439</span><span class="line-content">        })</span></div>
<div class="line removed"><span class="line-number">-440</span><span class="line-content">        .collect::&lt;BTreeMap&lt;_, _&gt;&gt;();</span></div>
<div class="line removed"><span class="line-number">-441</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-442</span><span class="line-content">    for node in rewardable_nodes {</span></div>
<div class="line removed"><span class="line-number">-443</span><span class="line-content">        for day in &amp;node.rewardable_days {</span></div>
<div class="line removed"><span class="line-number">-444</span><span class="line-content">            let base_rewards_for_day = if is_type3(&amp;node.node_reward_type) {</span></div>
<div class="line removed"><span class="line-number">-445</span><span class="line-content">                let region_key = type3_region_key(&amp;node.region);</span></div>
<div class="line removed"><span class="line-number">-446</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-447</span><span class="line-content">                let (base_rewards_daily, _, _, _) = base_rewards_type3</span></div>
<div class="line removed"><span class="line-number">-448</span><span class="line-content">                    .get(&amp;(day, region_key))</span></div>
<div class="line removed"><span class="line-number">-449</span><span class="line-content">                    .expect(&quot;Type3 base rewards expected for provider&quot;);</span></div>
<div class="line removed"><span class="line-number">-450</span><span class="line-content">                base_rewards_daily</span></div>
<div class="line removed"><span class="line-number">-451</span><span class="line-content">            } else {</span></div>
<div class="line removed"><span class="line-number">-452</span><span class="line-content">                let (base_rewards_daily, _) = base_rewards</span></div>
<div class="line removed"><span class="line-number">-453</span><span class="line-content">                    .get(&amp;(node.node_reward_type, node.region.clone()))</span></div>
<div class="line removed"><span class="line-number">-454</span><span class="line-content">                    .expect(&quot;base rewards expected for each node&quot;);</span></div>
<div class="line removed"><span class="line-number">-455</span><span class="line-content">                base_rewards_daily</span></div>
<div class="line removed"><span class="line-number">-456</span><span class="line-content">            };</span></div>
<div class="line removed"><span class="line-number">-457</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-458</span><span class="line-content">            base_rewards_per_node.insert((*day, node.node_id), *base_rewards_for_day);</span></div>
<div class="line removed"><span class="line-number">-459</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-460</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-461</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-462</span><span class="line-content">    let base_rewards_type3 = base_rewards_type3</span></div>
<div class="line removed"><span class="line-number">-463</span><span class="line-content">        .into_iter()</span></div>
<div class="line removed"><span class="line-number">-464</span><span class="line-content">        .map(</span></div>
<div class="line removed"><span class="line-number">-465</span><span class="line-content">            |((day, region), (daily_rewards, nodes_count, avg_rewards, avg_coefficient))| {</span></div>
<div class="line removed"><span class="line-number">-466</span><span class="line-content">                DailyBaseRewardsType3 {</span></div>
<div class="line removed"><span class="line-number">-467</span><span class="line-content">                    day: *day,</span></div>
<div class="line removed"><span class="line-number">-468</span><span class="line-content">                    region,</span></div>
<div class="line removed"><span class="line-number">-469</span><span class="line-content">                    nodes_count,</span></div>
<div class="line removed"><span class="line-number">-470</span><span class="line-content">                    avg_rewards,</span></div>
<div class="line removed"><span class="line-number">-471</span><span class="line-content">                    avg_coefficient,</span></div>
<div class="line removed"><span class="line-number">-472</span><span class="line-content">                    value: daily_rewards,</span></div>
<div class="line removed"><span class="line-number">-473</span><span class="line-content">                }</span></div>
<div class="line removed"><span class="line-number">-474</span><span class="line-content">            },</span></div>
<div class="line removed"><span class="line-number">-475</span><span class="line-content">        )</span></div>
<div class="line removed"><span class="line-number">-476</span><span class="line-content">        .collect();</span></div>
<div class="line removed"><span class="line-number">-477</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-478</span><span class="line-content">    let base_rewards = base_rewards</span></div>
<div class="line removed"><span class="line-number">-479</span><span class="line-content">        .into_iter()</span></div>
<div class="line removed"><span class="line-number">-480</span><span class="line-content">        .map(</span></div>
<div class="line removed"><span class="line-number">-481</span><span class="line-content">            |((node_reward_type, region), (daily_rewards, monthly_rewards))| BaseRewards {</span></div>
<div class="line removed"><span class="line-number">-482</span><span class="line-content">                node_reward_type,</span></div>
<div class="line removed"><span class="line-number">-483</span><span class="line-content">                region,</span></div>
<div class="line removed"><span class="line-number">-484</span><span class="line-content">                monthly: monthly_rewards,</span></div>
<div class="line removed"><span class="line-number">-485</span><span class="line-content">                daily: daily_rewards,</span></div>
<div class="line removed"><span class="line-number">-486</span><span class="line-content">            },</span></div>
<div class="line removed"><span class="line-number">-487</span><span class="line-content">        )</span></div>
<div class="line removed"><span class="line-number">-488</span><span class="line-content">        .collect();</span></div>
<div class="line removed"><span class="line-number">-489</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-490</span><span class="line-content">    Step4Results {</span></div>
<div class="line removed"><span class="line-number">-491</span><span class="line-content">        base_rewards_per_node,</span></div>
<div class="line removed"><span class="line-number">-492</span><span class="line-content">        base_rewards_type3,</span></div>
<div class="line removed"><span class="line-number">-493</span><span class="line-content">        base_rewards,</span></div>
<div class="line removed"><span class="line-number">-494</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-495</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-496</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-497</span><span class="line-content">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line removed"><span class="line-number">-498</span><span class="line-content">// Step 5: Adjusted rewards for all the nodes based on their performance</span></div>
<div class="line removed"><span class="line-number">-499</span><span class="line-content">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line removed"><span class="line-number">-500</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-501</span><span class="line-content">#[derive(Default)]</span></div>
<div class="line removed"><span class="line-number">-502</span><span class="line-content">struct Step5Results {</span></div>
<div class="line removed"><span class="line-number">-503</span><span class="line-content">    adjusted_rewards: BTreeMap&lt;(DayUtc, NodeId), XDRPermyriad&gt;,</span></div>
<div class="line removed"><span class="line-number">-504</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-505</span><span class="line-content">fn step_5_adjust_node_rewards(</span></div>
<div class="line removed"><span class="line-number">-506</span><span class="line-content">    rewardable_nodes: &amp;[RewardableNode],</span></div>
<div class="line removed"><span class="line-number">-507</span><span class="line-content">    base_rewards: &amp;BTreeMap&lt;(DayUtc, NodeId), Decimal&gt;,</span></div>
<div class="line removed"><span class="line-number">-508</span><span class="line-content">    performance_multiplier: &amp;HashMap&lt;(DayUtc, NodeId), Decimal&gt;,</span></div>
<div class="line removed"><span class="line-number">-509</span><span class="line-content">) -&gt; Step5Results {</span></div>
<div class="line removed"><span class="line-number">-510</span><span class="line-content">    let mut result = Step5Results::default();</span></div>
<div class="line removed"><span class="line-number">-511</span><span class="line-content">    for node in rewardable_nodes {</span></div>
<div class="line removed"><span class="line-number">-512</span><span class="line-content">        for day in &amp;node.rewardable_days {</span></div>
<div class="line removed"><span class="line-number">-513</span><span class="line-content">            let base_rewards_for_day = base_rewards</span></div>
<div class="line removed"><span class="line-number">-514</span><span class="line-content">                .get(&amp;(*day, node.node_id))</span></div>
<div class="line removed"><span class="line-number">-515</span><span class="line-content">                .expect(&quot;Base rewards expected for each node&quot;);</span></div>
<div class="line removed"><span class="line-number">-516</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-517</span><span class="line-content">            let performance_multiplier = performance_multiplier</span></div>
<div class="line removed"><span class="line-number">-518</span><span class="line-content">                .get(&amp;(*day, node.node_id))</span></div>
<div class="line removed"><span class="line-number">-519</span><span class="line-content">                .expect(&quot;Performance multiplier expected for every node&quot;);</span></div>
<div class="line removed"><span class="line-number">-520</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-521</span><span class="line-content">            let adjusted_rewards_for_day = base_rewards_for_day * performance_multiplier;</span></div>
<div class="line removed"><span class="line-number">-522</span><span class="line-content">            result</span></div>
<div class="line removed"><span class="line-number">-523</span><span class="line-content">                .adjusted_rewards</span></div>
<div class="line removed"><span class="line-number">-524</span><span class="line-content">                .insert((*day, node.node_id), adjusted_rewards_for_day);</span></div>
<div class="line removed"><span class="line-number">-525</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-526</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-527</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-528</span><span class="line-content">    result</span></div>
<div class="line removed"><span class="line-number">-529</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-530</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-531</span><span class="line-content">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line removed"><span class="line-number">-532</span><span class="line-content">// Step 6: Construct provider results</span></div>
<div class="line removed"><span class="line-number">-533</span><span class="line-content">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line removed"><span class="line-number">-534</span><span class="line-content">fn step_6_construct_provider_results(</span></div>
<div class="line removed"><span class="line-number">-535</span><span class="line-content">    rewardable_nodes: Vec&lt;RewardableNode&gt;,</span></div>
<div class="line removed"><span class="line-number">-536</span><span class="line-content">    mut provider_nodes_metrics_daily: BTreeMap&lt;(DayUtc, NodeId), NodeMetricsDaily&gt;,</span></div>
<div class="line removed"><span class="line-number">-537</span><span class="line-content">    extrapolated_fr: HashMap&lt;DayUtc, Percent&gt;,</span></div>
<div class="line removed"><span class="line-number">-538</span><span class="line-content">    mut reward_reduction: HashMap&lt;(DayUtc, NodeId), Percent&gt;,</span></div>
<div class="line removed"><span class="line-number">-539</span><span class="line-content">    mut performance_multiplier: HashMap&lt;(DayUtc, NodeId), Percent&gt;,</span></div>
<div class="line removed"><span class="line-number">-540</span><span class="line-content">    mut base_rewards_per_node: BTreeMap&lt;(DayUtc, NodeId), XDRPermyriad&gt;,</span></div>
<div class="line removed"><span class="line-number">-541</span><span class="line-content">    mut adjusted_rewards: BTreeMap&lt;(DayUtc, NodeId), XDRPermyriad&gt;,</span></div>
<div class="line removed"><span class="line-number">-542</span><span class="line-content">    base_rewards: Vec&lt;BaseRewards&gt;,</span></div>
<div class="line removed"><span class="line-number">-543</span><span class="line-content">    base_rewards_type3: Vec&lt;DailyBaseRewardsType3&gt;,</span></div>
<div class="line removed"><span class="line-number">-544</span><span class="line-content">) -&gt; NodeProviderRewards {</span></div>
<div class="line removed"><span class="line-number">-545</span><span class="line-content">    let mut results_by_node = Vec::new();</span></div>
<div class="line removed"><span class="line-number">-546</span><span class="line-content">    let mut rewards_total_xdr_permyriad = Decimal::ZERO;</span></div>
<div class="line removed"><span class="line-number">-547</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-548</span><span class="line-content">    for node in rewardable_nodes {</span></div>
<div class="line removed"><span class="line-number">-549</span><span class="line-content">        let node_reward_type = node.node_reward_type;</span></div>
<div class="line removed"><span class="line-number">-550</span><span class="line-content">        let region = node.region;</span></div>
<div class="line removed"><span class="line-number">-551</span><span class="line-content">        let dc_id = node.dc_id;</span></div>
<div class="line removed"><span class="line-number">-552</span><span class="line-content">        let mut daily_results = Vec::new();</span></div>
<div class="line removed"><span class="line-number">-553</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-554</span><span class="line-content">        for day in node.rewardable_days {</span></div>
<div class="line removed"><span class="line-number">-555</span><span class="line-content">            let node_status = if let Some(node_metrics) =</span></div>
<div class="line removed"><span class="line-number">-556</span><span class="line-content">                provider_nodes_metrics_daily.remove(&amp;(day, node.node_id))</span></div>
<div class="line removed"><span class="line-number">-557</span><span class="line-content">            {</span></div>
<div class="line removed"><span class="line-number">-558</span><span class="line-content">                NodeStatus::Assigned { node_metrics }</span></div>
<div class="line removed"><span class="line-number">-559</span><span class="line-content">            } else {</span></div>
<div class="line removed"><span class="line-number">-560</span><span class="line-content">                let extrapolated_fr = extrapolated_fr</span></div>
<div class="line removed"><span class="line-number">-561</span><span class="line-content">                    .get(&amp;day)</span></div>
<div class="line removed"><span class="line-number">-562</span><span class="line-content">                    .expect(&quot;Extrapolated FR expected for every provider&quot;);</span></div>
<div class="line removed"><span class="line-number">-563</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-564</span><span class="line-content">                NodeStatus::Unassigned {</span></div>
<div class="line removed"><span class="line-number">-565</span><span class="line-content">                    extrapolated_fr: *extrapolated_fr,</span></div>
<div class="line removed"><span class="line-number">-566</span><span class="line-content">                }</span></div>
<div class="line removed"><span class="line-number">-567</span><span class="line-content">            };</span></div>
<div class="line removed"><span class="line-number">-568</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-569</span><span class="line-content">            let rewards_reduction_percent = reward_reduction</span></div>
<div class="line removed"><span class="line-number">-570</span><span class="line-content">                .remove(&amp;(day, node.node_id))</span></div>
<div class="line removed"><span class="line-number">-571</span><span class="line-content">                .expect(&quot;Rewards reduction should be present in rewards&quot;);</span></div>
<div class="line removed"><span class="line-number">-572</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-573</span><span class="line-content">            let performance_multiplier_percent = performance_multiplier</span></div>
<div class="line removed"><span class="line-number">-574</span><span class="line-content">                .remove(&amp;(day, node.node_id))</span></div>
<div class="line removed"><span class="line-number">-575</span><span class="line-content">                .expect(&quot;Performance multiplier should be present in rewards&quot;);</span></div>
<div class="line removed"><span class="line-number">-576</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-577</span><span class="line-content">            let base_rewards_xdr_permyriad = base_rewards_per_node</span></div>
<div class="line removed"><span class="line-number">-578</span><span class="line-content">                .remove(&amp;(day, node.node_id))</span></div>
<div class="line removed"><span class="line-number">-579</span><span class="line-content">                .expect(&quot;Base rewards should be present in rewards&quot;);</span></div>
<div class="line removed"><span class="line-number">-580</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-581</span><span class="line-content">            let adjusted_rewards_xdr_permyriad = adjusted_rewards</span></div>
<div class="line removed"><span class="line-number">-582</span><span class="line-content">                .remove(&amp;(day, node.node_id))</span></div>
<div class="line removed"><span class="line-number">-583</span><span class="line-content">                .expect(&quot;Adjusted rewards should be present in rewards&quot;);</span></div>
<div class="line removed"><span class="line-number">-584</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-585</span><span class="line-content">            rewards_total_xdr_permyriad += adjusted_rewards_xdr_permyriad;</span></div>
<div class="line removed"><span class="line-number">-586</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-587</span><span class="line-content">            daily_results.push(DailyResults {</span></div>
<div class="line removed"><span class="line-number">-588</span><span class="line-content">                day,</span></div>
<div class="line removed"><span class="line-number">-589</span><span class="line-content">                node_status,</span></div>
<div class="line removed"><span class="line-number">-590</span><span class="line-content">                performance_multiplier: performance_multiplier_percent,</span></div>
<div class="line removed"><span class="line-number">-591</span><span class="line-content">                rewards_reduction: rewards_reduction_percent,</span></div>
<div class="line removed"><span class="line-number">-592</span><span class="line-content">                base_rewards: base_rewards_xdr_permyriad,</span></div>
<div class="line removed"><span class="line-number">-593</span><span class="line-content">                adjusted_rewards: adjusted_rewards_xdr_permyriad,</span></div>
<div class="line removed"><span class="line-number">-594</span><span class="line-content">            });</span></div>
<div class="line removed"><span class="line-number">-595</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-596</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-597</span><span class="line-content">        results_by_node.push(NodeResults {</span></div>
<div class="line removed"><span class="line-number">-598</span><span class="line-content">            node_id: node.node_id,</span></div>
<div class="line removed"><span class="line-number">-599</span><span class="line-content">            node_reward_type,</span></div>
<div class="line removed"><span class="line-number">-600</span><span class="line-content">            region,</span></div>
<div class="line removed"><span class="line-number">-601</span><span class="line-content">            dc_id,</span></div>
<div class="line removed"><span class="line-number">-602</span><span class="line-content">            daily_results,</span></div>
<div class="line removed"><span class="line-number">-603</span><span class="line-content">        });</span></div>
<div class="line removed"><span class="line-number">-604</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-605</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-606</span><span class="line-content">    let rewards_total_xdr_permyriad = rewards_total_xdr_permyriad.trunc().to_u64().unwrap();</span></div>
<div class="line removed"><span class="line-number">-607</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-608</span><span class="line-content">    NodeProviderRewards {</span></div>
<div class="line removed"><span class="line-number">-609</span><span class="line-content">        rewards_total_xdr_permyriad,</span></div>
<div class="line removed"><span class="line-number">-610</span><span class="line-content">        base_rewards,</span></div>
<div class="line removed"><span class="line-number">-611</span><span class="line-content">        base_rewards_type3,</span></div>
<div class="line removed"><span class="line-number">-612</span><span class="line-content">        nodes_results: results_by_node,</span></div>
<div class="line removed"><span class="line-number">-613</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-614</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-615</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-616</span><span class="line-content">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line removed"><span class="line-number">-617</span><span class="line-content">// Helpers</span></div>
<div class="line removed"><span class="line-number">-618</span><span class="line-content">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line removed"><span class="line-number">-619</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-620</span><span class="line-content">fn avg(values: &amp;[Decimal]) -&gt; Option&lt;Decimal&gt; {</span></div>
<div class="line removed"><span class="line-number">-621</span><span class="line-content">    if values.is_empty() {</span></div>
<div class="line removed"><span class="line-number">-622</span><span class="line-content">        None</span></div>
<div class="line removed"><span class="line-number">-623</span><span class="line-content">    } else {</span></div>
<div class="line removed"><span class="line-number">-624</span><span class="line-content">        Some(values.iter().sum::&lt;Decimal&gt;() / Decimal::from(values.len()))</span></div>
<div class="line removed"><span class="line-number">-625</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-626</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-627</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-628</span><span class="line-content">#[cfg(test)]</span></div>
<div class="line removed"><span class="line-number">-629</span><span class="line-content">pub mod tests;</span></div>
<div class="line context"><span class="line-number">0</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/rewards_calculator/test_utils.rs b/rs/node_rewards/rewards_calculation/src/rewards_calculator/test_utils.rs</span></div>
<div class="line context"><span class="line-number">1</span><span class="line-content">deleted file mode 100644</span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content">index 49f5a0bda0..0000000000</span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/rewards_calculator/test_utils.rs</div>
<div class="file-header">+++ /dev/null</div>
<div class="hunk-header">@@ -1,98 +0,0 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">use crate::types::{DayUtc, NodeMetricsDailyRaw, Region, RewardableNode, SubnetMetricsDailyKey};</span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content">use ic_base_types::{NodeId, PrincipalId, SubnetId};</span></div>
<div class="line removed"><span class="line-number">-3</span><span class="line-content">use ic_protobuf::registry::node::v1::NodeRewardType;</span></div>
<div class="line removed"><span class="line-number">-4</span><span class="line-content">use ic_protobuf::registry::node_rewards::v2::{NodeRewardRate, NodeRewardRates, NodeRewardsTable};</span></div>
<div class="line removed"><span class="line-number">-5</span><span class="line-content">use maplit::btreemap;</span></div>
<div class="line removed"><span class="line-number">-6</span><span class="line-content">use std::collections::BTreeMap;</span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-8</span><span class="line-content">pub fn test_node_id(id: u64) -&gt; NodeId {</span></div>
<div class="line removed"><span class="line-number">-9</span><span class="line-content">    NodeId::from(PrincipalId::new_node_test_id(id))</span></div>
<div class="line removed"><span class="line-number">-10</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-11</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-12</span><span class="line-content">pub fn test_provider_id(id: u64) -&gt; PrincipalId {</span></div>
<div class="line removed"><span class="line-number">-13</span><span class="line-content">    PrincipalId::new_user_test_id(id)</span></div>
<div class="line removed"><span class="line-number">-14</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-15</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-16</span><span class="line-content">pub fn test_subnet_id(id: u64) -&gt; SubnetId {</span></div>
<div class="line removed"><span class="line-number">-17</span><span class="line-content">    SubnetId::from(PrincipalId::new_subnet_test_id(id))</span></div>
<div class="line removed"><span class="line-number">-18</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-19</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-20</span><span class="line-content">impl Default for RewardableNode {</span></div>
<div class="line removed"><span class="line-number">-21</span><span class="line-content">    fn default() -&gt; Self {</span></div>
<div class="line removed"><span class="line-number">-22</span><span class="line-content">        RewardableNode {</span></div>
<div class="line removed"><span class="line-number">-23</span><span class="line-content">            node_id: NodeId::from(PrincipalId::new_node_test_id(0)),</span></div>
<div class="line removed"><span class="line-number">-24</span><span class="line-content">            rewardable_days: vec![],</span></div>
<div class="line removed"><span class="line-number">-25</span><span class="line-content">            region: Region::default(),</span></div>
<div class="line removed"><span class="line-number">-26</span><span class="line-content">            node_reward_type: NodeRewardType::default(),</span></div>
<div class="line removed"><span class="line-number">-27</span><span class="line-content">            dc_id: &quot;default_dc&quot;.into(),</span></div>
<div class="line removed"><span class="line-number">-28</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-29</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-30</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-31</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-32</span><span class="line-content">pub fn build_daily_metrics(</span></div>
<div class="line removed"><span class="line-number">-33</span><span class="line-content">    subnet_id: SubnetId,</span></div>
<div class="line removed"><span class="line-number">-34</span><span class="line-content">    day: DayUtc,</span></div>
<div class="line removed"><span class="line-number">-35</span><span class="line-content">    nodes_data: &amp;[(NodeId, u64, u64)],</span></div>
<div class="line removed"><span class="line-number">-36</span><span class="line-content">) -&gt; (SubnetMetricsDailyKey, Vec&lt;NodeMetricsDailyRaw&gt;) {</span></div>
<div class="line removed"><span class="line-number">-37</span><span class="line-content">    let key = SubnetMetricsDailyKey { subnet_id, day };</span></div>
<div class="line removed"><span class="line-number">-38</span><span class="line-content">    let metrics = nodes_data</span></div>
<div class="line removed"><span class="line-number">-39</span><span class="line-content">        .iter()</span></div>
<div class="line removed"><span class="line-number">-40</span><span class="line-content">        .map(|(node_id, proposed, failed)| NodeMetricsDailyRaw {</span></div>
<div class="line removed"><span class="line-number">-41</span><span class="line-content">            node_id: *node_id,</span></div>
<div class="line removed"><span class="line-number">-42</span><span class="line-content">            num_blocks_proposed: *proposed,</span></div>
<div class="line removed"><span class="line-number">-43</span><span class="line-content">            num_blocks_failed: *failed,</span></div>
<div class="line removed"><span class="line-number">-44</span><span class="line-content">        })</span></div>
<div class="line removed"><span class="line-number">-45</span><span class="line-content">        .collect();</span></div>
<div class="line removed"><span class="line-number">-46</span><span class="line-content">    (key, metrics)</span></div>
<div class="line removed"><span class="line-number">-47</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-48</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-49</span><span class="line-content">pub fn generate_rewardable_nodes(</span></div>
<div class="line removed"><span class="line-number">-50</span><span class="line-content">    nodes_with_rewardable_days: Vec&lt;(NodeId, Vec&lt;DayUtc&gt;)&gt;,</span></div>
<div class="line removed"><span class="line-number">-51</span><span class="line-content">) -&gt; Vec&lt;RewardableNode&gt; {</span></div>
<div class="line removed"><span class="line-number">-52</span><span class="line-content">    nodes_with_rewardable_days</span></div>
<div class="line removed"><span class="line-number">-53</span><span class="line-content">        .into_iter()</span></div>
<div class="line removed"><span class="line-number">-54</span><span class="line-content">        .map(|(node_id, rewardable_days)| RewardableNode {</span></div>
<div class="line removed"><span class="line-number">-55</span><span class="line-content">            node_id,</span></div>
<div class="line removed"><span class="line-number">-56</span><span class="line-content">            rewardable_days,</span></div>
<div class="line removed"><span class="line-number">-57</span><span class="line-content">            ..Default::default()</span></div>
<div class="line removed"><span class="line-number">-58</span><span class="line-content">        })</span></div>
<div class="line removed"><span class="line-number">-59</span><span class="line-content">        .collect()</span></div>
<div class="line removed"><span class="line-number">-60</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-61</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-62</span><span class="line-content">pub fn create_rewards_table_for_region_test() -&gt; NodeRewardsTable {</span></div>
<div class="line removed"><span class="line-number">-63</span><span class="line-content">    let mut table = BTreeMap::new();</span></div>
<div class="line removed"><span class="line-number">-64</span><span class="line-content">    table.insert(</span></div>
<div class="line removed"><span class="line-number">-65</span><span class="line-content">        &quot;Europe,Switzerland&quot;.to_string(),</span></div>
<div class="line removed"><span class="line-number">-66</span><span class="line-content">        NodeRewardRates {</span></div>
<div class="line removed"><span class="line-number">-67</span><span class="line-content">            rates: btreemap! {</span></div>
<div class="line removed"><span class="line-number">-68</span><span class="line-content">                NodeRewardType::Type1.to_string() =&gt; NodeRewardRate {</span></div>
<div class="line removed"><span class="line-number">-69</span><span class="line-content">                    xdr_permyriad_per_node_per_month: 304375, // -&gt; 10000 / day</span></div>
<div class="line removed"><span class="line-number">-70</span><span class="line-content">                    reward_coefficient_percent: None,</span></div>
<div class="line removed"><span class="line-number">-71</span><span class="line-content">                },</span></div>
<div class="line removed"><span class="line-number">-72</span><span class="line-content">            },</span></div>
<div class="line removed"><span class="line-number">-73</span><span class="line-content">        },</span></div>
<div class="line removed"><span class="line-number">-74</span><span class="line-content">    );</span></div>
<div class="line removed"><span class="line-number">-75</span><span class="line-content">    table.insert(</span></div>
<div class="line removed"><span class="line-number">-76</span><span class="line-content">        &quot;North America,USA,California&quot;.to_string(),</span></div>
<div class="line removed"><span class="line-number">-77</span><span class="line-content">        NodeRewardRates {</span></div>
<div class="line removed"><span class="line-number">-78</span><span class="line-content">            rates: btreemap! {</span></div>
<div class="line removed"><span class="line-number">-79</span><span class="line-content">                NodeRewardType::Type3.to_string() =&gt; NodeRewardRate {</span></div>
<div class="line removed"><span class="line-number">-80</span><span class="line-content">                    xdr_permyriad_per_node_per_month: 913125, // -&gt; 30000 / day</span></div>
<div class="line removed"><span class="line-number">-81</span><span class="line-content">                    reward_coefficient_percent: Some(90),</span></div>
<div class="line removed"><span class="line-number">-82</span><span class="line-content">                },</span></div>
<div class="line removed"><span class="line-number">-83</span><span class="line-content">            },</span></div>
<div class="line removed"><span class="line-number">-84</span><span class="line-content">        },</span></div>
<div class="line removed"><span class="line-number">-85</span><span class="line-content">    );</span></div>
<div class="line removed"><span class="line-number">-86</span><span class="line-content">    table.insert(</span></div>
<div class="line removed"><span class="line-number">-87</span><span class="line-content">        &quot;North America,USA,Nevada&quot;.to_string(),</span></div>
<div class="line removed"><span class="line-number">-88</span><span class="line-content">        NodeRewardRates {</span></div>
<div class="line removed"><span class="line-number">-89</span><span class="line-content">            rates: btreemap! {</span></div>
<div class="line removed"><span class="line-number">-90</span><span class="line-content">                NodeRewardType::Type3dot1.to_string() =&gt; NodeRewardRate {</span></div>
<div class="line removed"><span class="line-number">-91</span><span class="line-content">                    xdr_permyriad_per_node_per_month: 1217500, // -&gt; 40000 / day</span></div>
<div class="line removed"><span class="line-number">-92</span><span class="line-content">                    reward_coefficient_percent: Some(70),</span></div>
<div class="line removed"><span class="line-number">-93</span><span class="line-content">                },</span></div>
<div class="line removed"><span class="line-number">-94</span><span class="line-content">            },</span></div>
<div class="line removed"><span class="line-number">-95</span><span class="line-content">        },</span></div>
<div class="line removed"><span class="line-number">-96</span><span class="line-content">    );</span></div>
<div class="line removed"><span class="line-number">-97</span><span class="line-content">    NodeRewardsTable { table }</span></div>
<div class="line removed"><span class="line-number">-98</span><span class="line-content">}</span></div>
<div class="line context"><span class="line-number">0</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs b/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs</span></div>
<div class="line context"><span class="line-number">1</span><span class="line-content">deleted file mode 100644</span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content">index c588dac7ee..0000000000</span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs</div>
<div class="file-header">+++ /dev/null</div>
<div class="hunk-header">@@ -1,356 +0,0 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">use super::*;</span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content">use crate::rewards_calculator::test_utils::{</span></div>
<div class="line removed"><span class="line-number">-3</span><span class="line-content">    build_daily_metrics, create_rewards_table_for_region_test, generate_rewardable_nodes,</span></div>
<div class="line removed"><span class="line-number">-4</span><span class="line-content">    test_node_id, test_subnet_id,</span></div>
<div class="line removed"><span class="line-number">-5</span><span class="line-content">};</span></div>
<div class="line removed"><span class="line-number">-6</span><span class="line-content">use crate::types::RewardableNode;</span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content">use maplit::{btreemap, hashmap};</span></div>
<div class="line removed"><span class="line-number">-8</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-9</span><span class="line-content">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line removed"><span class="line-number">-10</span><span class="line-content">// Step 0: Pre-compute subnets and nodes failure rates</span></div>
<div class="line removed"><span class="line-number">-11</span><span class="line-content">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line removed"><span class="line-number">-12</span><span class="line-content">#[test]</span></div>
<div class="line removed"><span class="line-number">-13</span><span class="line-content">fn test_compute_subnets_nodes_fr() {</span></div>
<div class="line removed"><span class="line-number">-14</span><span class="line-content">    let day1 = &quot;2024-01-01&quot;.try_into().unwrap();</span></div>
<div class="line removed"><span class="line-number">-15</span><span class="line-content">    let day2 = &quot;2024-01-02&quot;.try_into().unwrap();</span></div>
<div class="line removed"><span class="line-number">-16</span><span class="line-content">    let subnet1 = test_subnet_id(1);</span></div>
<div class="line removed"><span class="line-number">-17</span><span class="line-content">    let subnet2 = test_subnet_id(2);</span></div>
<div class="line removed"><span class="line-number">-18</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-19</span><span class="line-content">    // Nodes for Subnet 1</span></div>
<div class="line removed"><span class="line-number">-20</span><span class="line-content">    let s1_node1 = test_node_id(11);</span></div>
<div class="line removed"><span class="line-number">-21</span><span class="line-content">    let s1_node2 = test_node_id(12);</span></div>
<div class="line removed"><span class="line-number">-22</span><span class="line-content">    let s1_node3 = test_node_id(13);</span></div>
<div class="line removed"><span class="line-number">-23</span><span class="line-content">    let s1_node4 = test_node_id(14);</span></div>
<div class="line removed"><span class="line-number">-24</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-25</span><span class="line-content">    // Nodes for Subnet 2</span></div>
<div class="line removed"><span class="line-number">-26</span><span class="line-content">    let s2_node1 = test_node_id(21);</span></div>
<div class="line removed"><span class="line-number">-27</span><span class="line-content">    let s2_node2 = test_node_id(22);</span></div>
<div class="line removed"><span class="line-number">-28</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-29</span><span class="line-content">    // --- Data Setup ---</span></div>
<div class="line removed"><span class="line-number">-30</span><span class="line-content">    let daily_metrics_by_subnet = BTreeMap::from_iter(vec![</span></div>
<div class="line removed"><span class="line-number">-31</span><span class="line-content">        // Day 1, Subnet 1</span></div>
<div class="line removed"><span class="line-number">-32</span><span class="line-content">        build_daily_metrics(</span></div>
<div class="line removed"><span class="line-number">-33</span><span class="line-content">            subnet1,</span></div>
<div class="line removed"><span class="line-number">-34</span><span class="line-content">            day1,</span></div>
<div class="line removed"><span class="line-number">-35</span><span class="line-content">            &amp;[</span></div>
<div class="line removed"><span class="line-number">-36</span><span class="line-content">                (s1_node1, 75, 25), // FR = 0.25</span></div>
<div class="line removed"><span class="line-number">-37</span><span class="line-content">                (s1_node2, 90, 10), // FR = 0.10</span></div>
<div class="line removed"><span class="line-number">-38</span><span class="line-content">                (s1_node3, 95, 5),  // FR = 0.05</span></div>
<div class="line removed"><span class="line-number">-39</span><span class="line-content">                (s1_node4, 50, 50), // FR = 0.50</span></div>
<div class="line removed"><span class="line-number">-40</span><span class="line-content">            ],</span></div>
<div class="line removed"><span class="line-number">-41</span><span class="line-content">        ),</span></div>
<div class="line removed"><span class="line-number">-42</span><span class="line-content">        // Day 1, Subnet 2</span></div>
<div class="line removed"><span class="line-number">-43</span><span class="line-content">        build_daily_metrics(</span></div>
<div class="line removed"><span class="line-number">-44</span><span class="line-content">            subnet2,</span></div>
<div class="line removed"><span class="line-number">-45</span><span class="line-content">            day1,</span></div>
<div class="line removed"><span class="line-number">-46</span><span class="line-content">            &amp;[</span></div>
<div class="line removed"><span class="line-number">-47</span><span class="line-content">                (s2_node1, 80, 20), // FR = 0.20</span></div>
<div class="line removed"><span class="line-number">-48</span><span class="line-content">                (s2_node2, 60, 40), // FR = 0.40</span></div>
<div class="line removed"><span class="line-number">-49</span><span class="line-content">            ],</span></div>
<div class="line removed"><span class="line-number">-50</span><span class="line-content">        ),</span></div>
<div class="line removed"><span class="line-number">-51</span><span class="line-content">        // Day 2, Subnet 1</span></div>
<div class="line removed"><span class="line-number">-52</span><span class="line-content">        build_daily_metrics(</span></div>
<div class="line removed"><span class="line-number">-53</span><span class="line-content">            subnet1,</span></div>
<div class="line removed"><span class="line-number">-54</span><span class="line-content">            day2,</span></div>
<div class="line removed"><span class="line-number">-55</span><span class="line-content">            &amp;[</span></div>
<div class="line removed"><span class="line-number">-56</span><span class="line-content">                (s1_node1, 99, 1), // FR = 0.01</span></div>
<div class="line removed"><span class="line-number">-57</span><span class="line-content">                (s1_node2, 0, 0),  // FR = 0.0, but not in rewardable_nodes for day2 so ignored</span></div>
<div class="line removed"><span class="line-number">-58</span><span class="line-content">            ],</span></div>
<div class="line removed"><span class="line-number">-59</span><span class="line-content">        ),</span></div>
<div class="line removed"><span class="line-number">-60</span><span class="line-content">    ]);</span></div>
<div class="line removed"><span class="line-number">-61</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-62</span><span class="line-content">    // --- Execution ---</span></div>
<div class="line removed"><span class="line-number">-63</span><span class="line-content">    let result = step_0_subnets_nodes_fr(daily_metrics_by_subnet);</span></div>
<div class="line removed"><span class="line-number">-64</span><span class="line-content">    let subnets_fr = result.subnets_fr;</span></div>
<div class="line removed"><span class="line-number">-65</span><span class="line-content">    let original_nodes_fr: BTreeMap&lt;_, _&gt; = result</span></div>
<div class="line removed"><span class="line-number">-66</span><span class="line-content">        .nodes_metrics_daily</span></div>
<div class="line removed"><span class="line-number">-67</span><span class="line-content">        .iter()</span></div>
<div class="line removed"><span class="line-number">-68</span><span class="line-content">        .map(|(k, v)| (*k, v.original_fr))</span></div>
<div class="line removed"><span class="line-number">-69</span><span class="line-content">        .collect();</span></div>
<div class="line removed"><span class="line-number">-70</span><span class="line-content">    let relative_nodes_fr: BTreeMap&lt;_, _&gt; = result</span></div>
<div class="line removed"><span class="line-number">-71</span><span class="line-content">        .nodes_metrics_daily</span></div>
<div class="line removed"><span class="line-number">-72</span><span class="line-content">        .iter()</span></div>
<div class="line removed"><span class="line-number">-73</span><span class="line-content">        .map(|(k, v)| (*k, v.relative_fr))</span></div>
<div class="line removed"><span class="line-number">-74</span><span class="line-content">        .collect();</span></div>
<div class="line removed"><span class="line-number">-75</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-76</span><span class="line-content">    // --- Assertions for Day 1, Subnet 1 ---</span></div>
<div class="line removed"><span class="line-number">-77</span><span class="line-content">    // Sorted FRs: 0.05, 0.10, 0.25, 0.50</span></div>
<div class="line removed"><span class="line-number">-78</span><span class="line-content">    // 75th percentile index = ceil(4 * 0.75) - 1 = 2. Value is 0.25</span></div>
<div class="line removed"><span class="line-number">-79</span><span class="line-content">    let expected_subnet1_day1_fr = dec!(0.25);</span></div>
<div class="line removed"><span class="line-number">-80</span><span class="line-content">    assert_eq!(</span></div>
<div class="line removed"><span class="line-number">-81</span><span class="line-content">        subnets_fr.get(&amp;(day1, subnet1)),</span></div>
<div class="line removed"><span class="line-number">-82</span><span class="line-content">        Some(&amp;expected_subnet1_day1_fr)</span></div>
<div class="line removed"><span class="line-number">-83</span><span class="line-content">    );</span></div>
<div class="line removed"><span class="line-number">-84</span><span class="line-content">    assert_eq!(original_nodes_fr.get(&amp;(day1, s1_node1)), Some(&amp;dec!(0.25)));</span></div>
<div class="line removed"><span class="line-number">-85</span><span class="line-content">    // Relative FR = max(0, original - subnet_fr)</span></div>
<div class="line removed"><span class="line-number">-86</span><span class="line-content">    assert_eq!(relative_nodes_fr.get(&amp;(day1, s1_node1)), Some(&amp;dec!(0.0))); // 0.25 - 0.25 = 0</span></div>
<div class="line removed"><span class="line-number">-87</span><span class="line-content">    assert_eq!(relative_nodes_fr.get(&amp;(day1, s1_node2)), Some(&amp;dec!(0.0))); // 0.10 - 0.25 &lt; 0</span></div>
<div class="line removed"><span class="line-number">-88</span><span class="line-content">    assert_eq!(relative_nodes_fr.get(&amp;(day1, s1_node4)), Some(&amp;dec!(0.25))); // 0.50 - 0.25 = 0.25</span></div>
<div class="line removed"><span class="line-number">-89</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-90</span><span class="line-content">    // --- Assertions for Day 1, Subnet 2 ---</span></div>
<div class="line removed"><span class="line-number">-91</span><span class="line-content">    // Sorted FRs: 0.20, 0.40</span></div>
<div class="line removed"><span class="line-number">-92</span><span class="line-content">    // 75th percentile index = ceil(2 * 0.75) - 1 = 1. Value is 0.40</span></div>
<div class="line removed"><span class="line-number">-93</span><span class="line-content">    let expected_subnet2_day1_fr = dec!(0.40);</span></div>
<div class="line removed"><span class="line-number">-94</span><span class="line-content">    assert_eq!(</span></div>
<div class="line removed"><span class="line-number">-95</span><span class="line-content">        subnets_fr.get(&amp;(day1, subnet2)),</span></div>
<div class="line removed"><span class="line-number">-96</span><span class="line-content">        Some(&amp;expected_subnet2_day1_fr)</span></div>
<div class="line removed"><span class="line-number">-97</span><span class="line-content">    );</span></div>
<div class="line removed"><span class="line-number">-98</span><span class="line-content">    assert_eq!(original_nodes_fr.get(&amp;(day1, s2_node1)), Some(&amp;dec!(0.20)));</span></div>
<div class="line removed"><span class="line-number">-99</span><span class="line-content">    assert_eq!(relative_nodes_fr.get(&amp;(day1, s2_node1)), Some(&amp;dec!(0.0))); // 0.20 - 0.40 &lt; 0</span></div>
<div class="line removed"><span class="line-number">-100</span><span class="line-content">    assert_eq!(relative_nodes_fr.get(&amp;(day1, s2_node2)), Some(&amp;dec!(0.0))); // 0.40 - 0.40 = 0</span></div>
<div class="line removed"><span class="line-number">-101</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-102</span><span class="line-content">    // --- Assertions for Day 2, Subnet 1 ---</span></div>
<div class="line removed"><span class="line-number">-103</span><span class="line-content">    // Sorted FRs: 0.0, 0.01</span></div>
<div class="line removed"><span class="line-number">-104</span><span class="line-content">    // 75th percentile index = ceil(2 * 0.75) - 1 = 1. Value is 0.01</span></div>
<div class="line removed"><span class="line-number">-105</span><span class="line-content">    let expected_subnet1_day2_fr = dec!(0.01);</span></div>
<div class="line removed"><span class="line-number">-106</span><span class="line-content">    assert_eq!(</span></div>
<div class="line removed"><span class="line-number">-107</span><span class="line-content">        subnets_fr.get(&amp;(day2, subnet1)),</span></div>
<div class="line removed"><span class="line-number">-108</span><span class="line-content">        Some(&amp;expected_subnet1_day2_fr)</span></div>
<div class="line removed"><span class="line-number">-109</span><span class="line-content">    );</span></div>
<div class="line removed"><span class="line-number">-110</span><span class="line-content">    assert_eq!(original_nodes_fr.get(&amp;(day2, s1_node1)), Some(&amp;dec!(0.01)));</span></div>
<div class="line removed"><span class="line-number">-111</span><span class="line-content">    assert_eq!(relative_nodes_fr.get(&amp;(day2, s1_node1)), Some(&amp;dec!(0.0))); // 0.01 - 0.01 = 0</span></div>
<div class="line removed"><span class="line-number">-112</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-113</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-114</span><span class="line-content">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line removed"><span class="line-number">-115</span><span class="line-content">// Step 2: Extrapolated failure rate for each provider</span></div>
<div class="line removed"><span class="line-number">-116</span><span class="line-content">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line removed"><span class="line-number">-117</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-118</span><span class="line-content">impl Default for NodeMetricsDaily {</span></div>
<div class="line removed"><span class="line-number">-119</span><span class="line-content">    fn default() -&gt; Self {</span></div>
<div class="line removed"><span class="line-number">-120</span><span class="line-content">        Self {</span></div>
<div class="line removed"><span class="line-number">-121</span><span class="line-content">            subnet_assigned: test_subnet_id(0),</span></div>
<div class="line removed"><span class="line-number">-122</span><span class="line-content">            subnet_assigned_fr: dec!(0.0),</span></div>
<div class="line removed"><span class="line-number">-123</span><span class="line-content">            num_blocks_proposed: 0,</span></div>
<div class="line removed"><span class="line-number">-124</span><span class="line-content">            num_blocks_failed: 0,</span></div>
<div class="line removed"><span class="line-number">-125</span><span class="line-content">            original_fr: dec!(0.0),</span></div>
<div class="line removed"><span class="line-number">-126</span><span class="line-content">            relative_fr: dec!(0.0),</span></div>
<div class="line removed"><span class="line-number">-127</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-128</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-129</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-130</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-131</span><span class="line-content">#[test]</span></div>
<div class="line removed"><span class="line-number">-132</span><span class="line-content">fn test_compute_providers_extrapolated_fr() {</span></div>
<div class="line removed"><span class="line-number">-133</span><span class="line-content">    let day = &quot;2024-01-01&quot;.try_into().unwrap();</span></div>
<div class="line removed"><span class="line-number">-134</span><span class="line-content">    let p1_node1 = test_node_id(1);</span></div>
<div class="line removed"><span class="line-number">-135</span><span class="line-content">    let p2_node1 = test_node_id(2);</span></div>
<div class="line removed"><span class="line-number">-136</span><span class="line-content">    let p2_node2 = test_node_id(3);</span></div>
<div class="line removed"><span class="line-number">-137</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-138</span><span class="line-content">    // --- P1 Data: No nodes with metrics ---</span></div>
<div class="line removed"><span class="line-number">-139</span><span class="line-content">    let p1_nodes = generate_rewardable_nodes(vec![(p1_node1, vec![day])]);</span></div>
<div class="line removed"><span class="line-number">-140</span><span class="line-content">    let p1_metrics = BTreeMap::new(); // No metrics available</span></div>
<div class="line removed"><span class="line-number">-141</span><span class="line-content">    let result_p1 = step_2_extrapolated_fr(&amp;p1_nodes, &amp;p1_metrics);</span></div>
<div class="line removed"><span class="line-number">-142</span><span class="line-content">    // Extrapolated FR for P1 should be 0 since no nodes are assigned</span></div>
<div class="line removed"><span class="line-number">-143</span><span class="line-content">    assert_eq!(result_p1.extrapolated_fr.get(&amp;day), Some(&amp;Decimal::ZERO));</span></div>
<div class="line removed"><span class="line-number">-144</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-145</span><span class="line-content">    // --- P2 Data: Two nodes with metrics ---</span></div>
<div class="line removed"><span class="line-number">-146</span><span class="line-content">    let p2_nodes = generate_rewardable_nodes(vec![(p2_node1, vec![day]), (p2_node2, vec![day])]);</span></div>
<div class="line removed"><span class="line-number">-147</span><span class="line-content">    let p2_metrics = btreemap! {</span></div>
<div class="line removed"><span class="line-number">-148</span><span class="line-content">        (day, p2_node1) =&gt; NodeMetricsDaily { relative_fr: dec!(0.2), ..Default::default() },</span></div>
<div class="line removed"><span class="line-number">-149</span><span class="line-content">        (day, p2_node2) =&gt; NodeMetricsDaily { relative_fr: dec!(0.4), ..Default::default() },</span></div>
<div class="line removed"><span class="line-number">-150</span><span class="line-content">    };</span></div>
<div class="line removed"><span class="line-number">-151</span><span class="line-content">    let result_p2 = step_2_extrapolated_fr(&amp;p2_nodes, &amp;p2_metrics);</span></div>
<div class="line removed"><span class="line-number">-152</span><span class="line-content">    // Extrapolated FR for P2 should be the average of its nodes&#x27; relative FR</span></div>
<div class="line removed"><span class="line-number">-153</span><span class="line-content">    let expected_fr_p2 = (dec!(0.2) + dec!(0.4)) / dec!(2); // 0.3</span></div>
<div class="line removed"><span class="line-number">-154</span><span class="line-content">    assert_eq!(result_p2.extrapolated_fr.get(&amp;day), Some(&amp;expected_fr_p2));</span></div>
<div class="line removed"><span class="line-number">-155</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-156</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-157</span><span class="line-content">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line removed"><span class="line-number">-158</span><span class="line-content">// Step 3: Compute performance multiplier for each node for each provider</span></div>
<div class="line removed"><span class="line-number">-159</span><span class="line-content">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line removed"><span class="line-number">-160</span><span class="line-content">#[test]</span></div>
<div class="line removed"><span class="line-number">-161</span><span class="line-content">fn test_compute_nodes_performance_multiplier() {</span></div>
<div class="line removed"><span class="line-number">-162</span><span class="line-content">    let day = &quot;2024-01-01&quot;.try_into().unwrap();</span></div>
<div class="line removed"><span class="line-number">-163</span><span class="line-content">    let node_good = test_node_id(1); // FR below threshold</span></div>
<div class="line removed"><span class="line-number">-164</span><span class="line-content">    let node_mid = test_node_id(2); // FR in penalty zone</span></div>
<div class="line removed"><span class="line-number">-165</span><span class="line-content">    let node_bad = test_node_id(3); // FR above threshold</span></div>
<div class="line removed"><span class="line-number">-166</span><span class="line-content">    let node_unassigned = test_node_id(4); // Uses extrapolated FR</span></div>
<div class="line removed"><span class="line-number">-167</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-168</span><span class="line-content">    // --- Data Setup ---</span></div>
<div class="line removed"><span class="line-number">-169</span><span class="line-content">    let rewardable_nodes = generate_rewardable_nodes(vec![</span></div>
<div class="line removed"><span class="line-number">-170</span><span class="line-content">        (node_good, vec![day]),</span></div>
<div class="line removed"><span class="line-number">-171</span><span class="line-content">        (node_mid, vec![day]),</span></div>
<div class="line removed"><span class="line-number">-172</span><span class="line-content">        (node_bad, vec![day]),</span></div>
<div class="line removed"><span class="line-number">-173</span><span class="line-content">        (node_unassigned, vec![day]),</span></div>
<div class="line removed"><span class="line-number">-174</span><span class="line-content">    ]);</span></div>
<div class="line removed"><span class="line-number">-175</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-176</span><span class="line-content">    // Assigned nodes&#x27; relative FR</span></div>
<div class="line removed"><span class="line-number">-177</span><span class="line-content">    let relative_nodes_fr = btreemap! {</span></div>
<div class="line removed"><span class="line-number">-178</span><span class="line-content">        (day, node_good) =&gt; dec!(0.05), // &lt; 0.1</span></div>
<div class="line removed"><span class="line-number">-179</span><span class="line-content">        (day, node_mid) =&gt; dec!(0.35), // (0.35-0.1)/(0.6-0.1)*0.8 = 0.4</span></div>
<div class="line removed"><span class="line-number">-180</span><span class="line-content">        (day, node_bad) =&gt; dec!(0.7),  // &gt; 0.6</span></div>
<div class="line removed"><span class="line-number">-181</span><span class="line-content">    };</span></div>
<div class="line removed"><span class="line-number">-182</span><span class="line-content">    // Unassigned nodes use extrapolated FR</span></div>
<div class="line removed"><span class="line-number">-183</span><span class="line-content">    let extrapolated_fr = hashmap! {</span></div>
<div class="line removed"><span class="line-number">-184</span><span class="line-content">        day =&gt; dec!(0.35)</span></div>
<div class="line removed"><span class="line-number">-185</span><span class="line-content">    };</span></div>
<div class="line removed"><span class="line-number">-186</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-187</span><span class="line-content">    // --- Execution ---</span></div>
<div class="line removed"><span class="line-number">-188</span><span class="line-content">    let result =</span></div>
<div class="line removed"><span class="line-number">-189</span><span class="line-content">        step_3_performance_multiplier(&amp;rewardable_nodes, &amp;relative_nodes_fr, &amp;extrapolated_fr);</span></div>
<div class="line removed"><span class="line-number">-190</span><span class="line-content">    let reward_reduction = result.reward_reduction;</span></div>
<div class="line removed"><span class="line-number">-191</span><span class="line-content">    let performance_multiplier = result.performance_multiplier;</span></div>
<div class="line removed"><span class="line-number">-192</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-193</span><span class="line-content">    // --- Assertions ---</span></div>
<div class="line removed"><span class="line-number">-194</span><span class="line-content">    // Good node: reduction = 0, multiplier = 1</span></div>
<div class="line removed"><span class="line-number">-195</span><span class="line-content">    assert_eq!(</span></div>
<div class="line removed"><span class="line-number">-196</span><span class="line-content">        reward_reduction.get(&amp;(day, node_good)),</span></div>
<div class="line removed"><span class="line-number">-197</span><span class="line-content">        Some(&amp;MIN_REWARDS_REDUCTION)</span></div>
<div class="line removed"><span class="line-number">-198</span><span class="line-content">    );</span></div>
<div class="line removed"><span class="line-number">-199</span><span class="line-content">    assert_eq!(</span></div>
<div class="line removed"><span class="line-number">-200</span><span class="line-content">        performance_multiplier.get(&amp;(day, node_good)),</span></div>
<div class="line removed"><span class="line-number">-201</span><span class="line-content">        Some(&amp;dec!(1.0))</span></div>
<div class="line removed"><span class="line-number">-202</span><span class="line-content">    );</span></div>
<div class="line removed"><span class="line-number">-203</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-204</span><span class="line-content">    // Mid node: reduction = 0.4, multiplier = 0.6</span></div>
<div class="line removed"><span class="line-number">-205</span><span class="line-content">    assert_eq!(reward_reduction.get(&amp;(day, node_mid)), Some(&amp;dec!(0.4)));</span></div>
<div class="line removed"><span class="line-number">-206</span><span class="line-content">    assert_eq!(</span></div>
<div class="line removed"><span class="line-number">-207</span><span class="line-content">        performance_multiplier.get(&amp;(day, node_mid)),</span></div>
<div class="line removed"><span class="line-number">-208</span><span class="line-content">        Some(&amp;dec!(0.6))</span></div>
<div class="line removed"><span class="line-number">-209</span><span class="line-content">    );</span></div>
<div class="line removed"><span class="line-number">-210</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-211</span><span class="line-content">    // Bad node: reduction = 0.8, multiplier = 0.2</span></div>
<div class="line removed"><span class="line-number">-212</span><span class="line-content">    assert_eq!(</span></div>
<div class="line removed"><span class="line-number">-213</span><span class="line-content">        reward_reduction.get(&amp;(day, node_bad)),</span></div>
<div class="line removed"><span class="line-number">-214</span><span class="line-content">        Some(&amp;MAX_REWARDS_REDUCTION)</span></div>
<div class="line removed"><span class="line-number">-215</span><span class="line-content">    );</span></div>
<div class="line removed"><span class="line-number">-216</span><span class="line-content">    assert_eq!(</span></div>
<div class="line removed"><span class="line-number">-217</span><span class="line-content">        performance_multiplier.get(&amp;(day, node_bad)),</span></div>
<div class="line removed"><span class="line-number">-218</span><span class="line-content">        Some(&amp;dec!(0.2))</span></div>
<div class="line removed"><span class="line-number">-219</span><span class="line-content">    );</span></div>
<div class="line removed"><span class="line-number">-220</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-221</span><span class="line-content">    // Unassigned node (uses extrapolated FR, same as mid)</span></div>
<div class="line removed"><span class="line-number">-222</span><span class="line-content">    assert_eq!(</span></div>
<div class="line removed"><span class="line-number">-223</span><span class="line-content">        performance_multiplier.get(&amp;(day, node_unassigned)),</span></div>
<div class="line removed"><span class="line-number">-224</span><span class="line-content">        Some(&amp;dec!(0.6))</span></div>
<div class="line removed"><span class="line-number">-225</span><span class="line-content">    );</span></div>
<div class="line removed"><span class="line-number">-226</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-227</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-228</span><span class="line-content">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line removed"><span class="line-number">-229</span><span class="line-content">// Step 4: Compute base rewards for each node based on its region and node type</span></div>
<div class="line removed"><span class="line-number">-230</span><span class="line-content">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line removed"><span class="line-number">-231</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-232</span><span class="line-content">#[test]</span></div>
<div class="line removed"><span class="line-number">-233</span><span class="line-content">fn test_compute_base_rewards() {</span></div>
<div class="line removed"><span class="line-number">-234</span><span class="line-content">    let day = &quot;2024-01-01&quot;.try_into().unwrap();</span></div>
<div class="line removed"><span class="line-number">-235</span><span class="line-content">    let type1_node = test_node_id(1);</span></div>
<div class="line removed"><span class="line-number">-236</span><span class="line-content">    let type3_node_ca = test_node_id(2);</span></div>
<div class="line removed"><span class="line-number">-237</span><span class="line-content">    let type3_node_nv = test_node_id(3);</span></div>
<div class="line removed"><span class="line-number">-238</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-239</span><span class="line-content">    let rewardable_nodes = vec![</span></div>
<div class="line removed"><span class="line-number">-240</span><span class="line-content">        RewardableNode {</span></div>
<div class="line removed"><span class="line-number">-241</span><span class="line-content">            node_id: type1_node,</span></div>
<div class="line removed"><span class="line-number">-242</span><span class="line-content">            node_reward_type: NodeRewardType::Type1,</span></div>
<div class="line removed"><span class="line-number">-243</span><span class="line-content">            region: &quot;Europe,Switzerland&quot;.into(),</span></div>
<div class="line removed"><span class="line-number">-244</span><span class="line-content">            rewardable_days: vec![day],</span></div>
<div class="line removed"><span class="line-number">-245</span><span class="line-content">            dc_id: &quot;dc1&quot;.into(),</span></div>
<div class="line removed"><span class="line-number">-246</span><span class="line-content">        },</span></div>
<div class="line removed"><span class="line-number">-247</span><span class="line-content">        RewardableNode {</span></div>
<div class="line removed"><span class="line-number">-248</span><span class="line-content">            node_id: type3_node_ca,</span></div>
<div class="line removed"><span class="line-number">-249</span><span class="line-content">            node_reward_type: NodeRewardType::Type3,</span></div>
<div class="line removed"><span class="line-number">-250</span><span class="line-content">            region: &quot;North America,USA,California&quot;.into(),</span></div>
<div class="line removed"><span class="line-number">-251</span><span class="line-content">            rewardable_days: vec![day],</span></div>
<div class="line removed"><span class="line-number">-252</span><span class="line-content">            dc_id: &quot;dc2&quot;.into(),</span></div>
<div class="line removed"><span class="line-number">-253</span><span class="line-content">        },</span></div>
<div class="line removed"><span class="line-number">-254</span><span class="line-content">        RewardableNode {</span></div>
<div class="line removed"><span class="line-number">-255</span><span class="line-content">            node_id: type3_node_nv,</span></div>
<div class="line removed"><span class="line-number">-256</span><span class="line-content">            node_reward_type: NodeRewardType::Type3dot1,</span></div>
<div class="line removed"><span class="line-number">-257</span><span class="line-content">            region: &quot;North America,USA,Nevada&quot;.into(),</span></div>
<div class="line removed"><span class="line-number">-258</span><span class="line-content">            rewardable_days: vec![day],</span></div>
<div class="line removed"><span class="line-number">-259</span><span class="line-content">            dc_id: &quot;dc3&quot;.into(),</span></div>
<div class="line removed"><span class="line-number">-260</span><span class="line-content">        },</span></div>
<div class="line removed"><span class="line-number">-261</span><span class="line-content">    ];</span></div>
<div class="line removed"><span class="line-number">-262</span><span class="line-content">    let rewards_table = create_rewards_table_for_region_test();</span></div>
<div class="line removed"><span class="line-number">-263</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-264</span><span class="line-content">    // --- Execution ---</span></div>
<div class="line removed"><span class="line-number">-265</span><span class="line-content">    let Step4Results {</span></div>
<div class="line removed"><span class="line-number">-266</span><span class="line-content">        base_rewards_per_node,</span></div>
<div class="line removed"><span class="line-number">-267</span><span class="line-content">        ..</span></div>
<div class="line removed"><span class="line-number">-268</span><span class="line-content">    } = step_4_compute_base_rewards_type_region(&amp;rewards_table, &amp;rewardable_nodes);</span></div>
<div class="line removed"><span class="line-number">-269</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-270</span><span class="line-content">    // --- Assertions ---</span></div>
<div class="line removed"><span class="line-number">-271</span><span class="line-content">    assert_eq!(</span></div>
<div class="line removed"><span class="line-number">-272</span><span class="line-content">        base_rewards_per_node.get(&amp;(day, type1_node)),</span></div>
<div class="line removed"><span class="line-number">-273</span><span class="line-content">        Some(&amp;dec!(10000))</span></div>
<div class="line removed"><span class="line-number">-274</span><span class="line-content">    );</span></div>
<div class="line removed"><span class="line-number">-275</span><span class="line-content">    assert_eq!(</span></div>
<div class="line removed"><span class="line-number">-276</span><span class="line-content">        base_rewards_per_node.get(&amp;(day, type3_node_ca)),</span></div>
<div class="line removed"><span class="line-number">-277</span><span class="line-content">        Some(&amp;dec!(31500))</span></div>
<div class="line removed"><span class="line-number">-278</span><span class="line-content">    );</span></div>
<div class="line removed"><span class="line-number">-279</span><span class="line-content">    assert_eq!(</span></div>
<div class="line removed"><span class="line-number">-280</span><span class="line-content">        base_rewards_per_node.get(&amp;(day, type3_node_nv)),</span></div>
<div class="line removed"><span class="line-number">-281</span><span class="line-content">        Some(&amp;dec!(31500))</span></div>
<div class="line removed"><span class="line-number">-282</span><span class="line-content">    );</span></div>
<div class="line removed"><span class="line-number">-283</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-284</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-285</span><span class="line-content">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line removed"><span class="line-number">-286</span><span class="line-content">// Step 5: Adjust nodes rewards based on performance and number of nodes</span></div>
<div class="line removed"><span class="line-number">-287</span><span class="line-content">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line removed"><span class="line-number">-288</span><span class="line-content">#[test]</span></div>
<div class="line removed"><span class="line-number">-289</span><span class="line-content">fn test_adjust_nodes_rewards() {</span></div>
<div class="line removed"><span class="line-number">-290</span><span class="line-content">    let day1 = &quot;2024-01-01&quot;.try_into().unwrap();</span></div>
<div class="line removed"><span class="line-number">-291</span><span class="line-content">    let day2 = &quot;2024-01-02&quot;.try_into().unwrap();</span></div>
<div class="line removed"><span class="line-number">-292</span><span class="line-content">    let day3 = &quot;2024-01-03&quot;.try_into().unwrap();</span></div>
<div class="line removed"><span class="line-number">-293</span><span class="line-content">    let node1 = test_node_id(1);</span></div>
<div class="line removed"><span class="line-number">-294</span><span class="line-content">    let node2 = test_node_id(2);</span></div>
<div class="line removed"><span class="line-number">-295</span><span class="line-content">    let node3 = test_node_id(3);</span></div>
<div class="line removed"><span class="line-number">-296</span><span class="line-content">    let node4 = test_node_id(4);</span></div>
<div class="line removed"><span class="line-number">-297</span><span class="line-content">    let node5 = test_node_id(5);</span></div>
<div class="line removed"><span class="line-number">-298</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-299</span><span class="line-content">    // Day 1 has 5 nodes, Day 2 and Day 3 has 3 nodes.</span></div>
<div class="line removed"><span class="line-number">-300</span><span class="line-content">    let rewardable_nodes = generate_rewardable_nodes(vec![</span></div>
<div class="line removed"><span class="line-number">-301</span><span class="line-content">        (node1, vec![day1, day2, day3]),</span></div>
<div class="line removed"><span class="line-number">-302</span><span class="line-content">        (node2, vec![day1, day2, day3]),</span></div>
<div class="line removed"><span class="line-number">-303</span><span class="line-content">        (node3, vec![day1, day2, day3]),</span></div>
<div class="line removed"><span class="line-number">-304</span><span class="line-content">        (node4, vec![day1]),</span></div>
<div class="line removed"><span class="line-number">-305</span><span class="line-content">        (node5, vec![day1]),</span></div>
<div class="line removed"><span class="line-number">-306</span><span class="line-content">    ]);</span></div>
<div class="line removed"><span class="line-number">-307</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-308</span><span class="line-content">    let mut base_rewards = BTreeMap::new();</span></div>
<div class="line removed"><span class="line-number">-309</span><span class="line-content">    let mut performance_multiplier = HashMap::new();</span></div>
<div class="line removed"><span class="line-number">-310</span><span class="line-content">    for node in &amp;rewardable_nodes {</span></div>
<div class="line removed"><span class="line-number">-311</span><span class="line-content">        for day in &amp;node.rewardable_days {</span></div>
<div class="line removed"><span class="line-number">-312</span><span class="line-content">            base_rewards.insert((*day, node.node_id), dec!(1000));</span></div>
<div class="line removed"><span class="line-number">-313</span><span class="line-content">            if *day == day1 || *day == day2 {</span></div>
<div class="line removed"><span class="line-number">-314</span><span class="line-content">                // Assigned nodes</span></div>
<div class="line removed"><span class="line-number">-315</span><span class="line-content">                performance_multiplier.insert((*day, node.node_id), dec!(0.5));</span></div>
<div class="line removed"><span class="line-number">-316</span><span class="line-content">            } else {</span></div>
<div class="line removed"><span class="line-number">-317</span><span class="line-content">                // Unassigned nodes</span></div>
<div class="line removed"><span class="line-number">-318</span><span class="line-content">                performance_multiplier.insert((*day, node.node_id), dec!(1.0));</span></div>
<div class="line removed"><span class="line-number">-319</span><span class="line-content">            }</span></div>
<div class="line removed"><span class="line-number">-320</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-321</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-322</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-323</span><span class="line-content">    // --- Execution ---</span></div>
<div class="line removed"><span class="line-number">-324</span><span class="line-content">    let Step5Results { adjusted_rewards } =</span></div>
<div class="line removed"><span class="line-number">-325</span><span class="line-content">        step_5_adjust_node_rewards(&amp;rewardable_nodes, &amp;base_rewards, &amp;performance_multiplier);</span></div>
<div class="line removed"><span class="line-number">-326</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-327</span><span class="line-content">    // --- Assertions ---</span></div>
<div class="line removed"><span class="line-number">-328</span><span class="line-content">    // Case 1: More than 4 nodes (5 on day1), penalty applies</span></div>
<div class="line removed"><span class="line-number">-329</span><span class="line-content">    let expected = dec!(1000) * dec!(0.5);</span></div>
<div class="line removed"><span class="line-number">-330</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-331</span><span class="line-content">    for node in &amp;[node1, node2, node3, node4, node5] {</span></div>
<div class="line removed"><span class="line-number">-332</span><span class="line-content">        assert_eq!(</span></div>
<div class="line removed"><span class="line-number">-333</span><span class="line-content">            adjusted_rewards.get(&amp;(day1, *node)),</span></div>
<div class="line removed"><span class="line-number">-334</span><span class="line-content">            Some(&amp;expected),</span></div>
<div class="line removed"><span class="line-number">-335</span><span class="line-content">            &quot;Unexpected reward for node {node:?} on day {day1:?}&quot;</span></div>
<div class="line removed"><span class="line-number">-336</span><span class="line-content">        );</span></div>
<div class="line removed"><span class="line-number">-337</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-338</span><span class="line-content">    // Case 2: fewer than 4 nodes (3 on day2), all assigned penalty applies</span></div>
<div class="line removed"><span class="line-number">-339</span><span class="line-content">    for node in &amp;[node1, node2, node3] {</span></div>
<div class="line removed"><span class="line-number">-340</span><span class="line-content">        assert_eq!(</span></div>
<div class="line removed"><span class="line-number">-341</span><span class="line-content">            adjusted_rewards.get(&amp;(day2, *node)),</span></div>
<div class="line removed"><span class="line-number">-342</span><span class="line-content">            Some(&amp;expected),</span></div>
<div class="line removed"><span class="line-number">-343</span><span class="line-content">            &quot;Unexpected reward for node {node:?} on day {day2:?}&quot;</span></div>
<div class="line removed"><span class="line-number">-344</span><span class="line-content">        );</span></div>
<div class="line removed"><span class="line-number">-345</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-346</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-347</span><span class="line-content">    let expected = dec!(1000);</span></div>
<div class="line removed"><span class="line-number">-348</span><span class="line-content">    // Case 3: fewer than 4 nodes (3 on day3), all unassigned full rewards</span></div>
<div class="line removed"><span class="line-number">-349</span><span class="line-content">    for node in &amp;[node1, node2, node3] {</span></div>
<div class="line removed"><span class="line-number">-350</span><span class="line-content">        assert_eq!(</span></div>
<div class="line removed"><span class="line-number">-351</span><span class="line-content">            adjusted_rewards.get(&amp;(day3, *node)),</span></div>
<div class="line removed"><span class="line-number">-352</span><span class="line-content">            Some(&amp;expected),</span></div>
<div class="line removed"><span class="line-number">-353</span><span class="line-content">            &quot;Unexpected reward for node {node:?} on day {day3:?}&quot;</span></div>
<div class="line removed"><span class="line-number">-354</span><span class="line-content">        );</span></div>
<div class="line removed"><span class="line-number">-355</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-356</span><span class="line-content">}</span></div>
<div class="line context"><span class="line-number">0</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs b/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs</span></div>
<div class="line context"><span class="line-number">1</span><span class="line-content">deleted file mode 100644</span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content">index 35dbfbfaa1..0000000000</span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs</div>
<div class="file-header">+++ /dev/null</div>
<div class="hunk-header">@@ -1,148 +0,0 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">use crate::types::{DayUtc, Region, RewardPeriod, RewardPeriodError};</span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content">use ic_base_types::{NodeId, PrincipalId, SubnetId};</span></div>
<div class="line removed"><span class="line-number">-3</span><span class="line-content">use ic_protobuf::registry::node::v1::NodeRewardType;</span></div>
<div class="line removed"><span class="line-number">-4</span><span class="line-content">use rust_decimal::Decimal;</span></div>
<div class="line removed"><span class="line-number">-5</span><span class="line-content">use serde::{Deserialize, Serialize};</span></div>
<div class="line removed"><span class="line-number">-6</span><span class="line-content">use std::collections::BTreeMap;</span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content">use std::fmt;</span></div>
<div class="line removed"><span class="line-number">-8</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-9</span><span class="line-content">pub type XDRPermyriad = Decimal;</span></div>
<div class="line removed"><span class="line-number">-10</span><span class="line-content">pub type Percent = Decimal;</span></div>
<div class="line removed"><span class="line-number">-11</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-12</span><span class="line-content">#[derive(Serialize, Deserialize, Clone, Debug, PartialEq)]</span></div>
<div class="line removed"><span class="line-number">-13</span><span class="line-content">pub struct NodeMetricsDaily {</span></div>
<div class="line removed"><span class="line-number">-14</span><span class="line-content">    pub subnet_assigned: SubnetId,</span></div>
<div class="line removed"><span class="line-number">-15</span><span class="line-content">    pub subnet_assigned_fr: Percent,</span></div>
<div class="line removed"><span class="line-number">-16</span><span class="line-content">    pub num_blocks_proposed: u64,</span></div>
<div class="line removed"><span class="line-number">-17</span><span class="line-content">    pub num_blocks_failed: u64,</span></div>
<div class="line removed"><span class="line-number">-18</span><span class="line-content">    /// The failure rate before subnet failure rate reduction.</span></div>
<div class="line removed"><span class="line-number">-19</span><span class="line-content">    /// Calculated as `blocks_failed` / (`blocks_proposed` + `blocks_failed`)</span></div>
<div class="line removed"><span class="line-number">-20</span><span class="line-content">    pub original_fr: Percent,</span></div>
<div class="line removed"><span class="line-number">-21</span><span class="line-content">    /// The failure rate reduced by the subnet assigned failure rate.</span></div>
<div class="line removed"><span class="line-number">-22</span><span class="line-content">    /// Calculated as Max(0, `original_fr` - `subnet_assigned_fr`)</span></div>
<div class="line removed"><span class="line-number">-23</span><span class="line-content">    pub relative_fr: Percent,</span></div>
<div class="line removed"><span class="line-number">-24</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-25</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-26</span><span class="line-content">#[derive(Serialize, Deserialize, Debug, PartialEq, Clone)]</span></div>
<div class="line removed"><span class="line-number">-27</span><span class="line-content">pub enum NodeStatus {</span></div>
<div class="line removed"><span class="line-number">-28</span><span class="line-content">    Assigned { node_metrics: NodeMetricsDaily },</span></div>
<div class="line removed"><span class="line-number">-29</span><span class="line-content">    Unassigned { extrapolated_fr: Percent },</span></div>
<div class="line removed"><span class="line-number">-30</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-31</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-32</span><span class="line-content">#[derive(Serialize, Deserialize, Debug, PartialEq, Clone)]</span></div>
<div class="line removed"><span class="line-number">-33</span><span class="line-content">pub struct DailyResults {</span></div>
<div class="line removed"><span class="line-number">-34</span><span class="line-content">    pub day: DayUtc,</span></div>
<div class="line removed"><span class="line-number">-35</span><span class="line-content">    pub node_status: NodeStatus,</span></div>
<div class="line removed"><span class="line-number">-36</span><span class="line-content">    pub performance_multiplier: Percent,</span></div>
<div class="line removed"><span class="line-number">-37</span><span class="line-content">    pub rewards_reduction: Percent,</span></div>
<div class="line removed"><span class="line-number">-38</span><span class="line-content">    pub base_rewards: XDRPermyriad,</span></div>
<div class="line removed"><span class="line-number">-39</span><span class="line-content">    pub adjusted_rewards: XDRPermyriad,</span></div>
<div class="line removed"><span class="line-number">-40</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-41</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-42</span><span class="line-content">#[derive(Serialize, Deserialize, Debug, PartialEq, Clone)]</span></div>
<div class="line removed"><span class="line-number">-43</span><span class="line-content">pub struct NodeResults {</span></div>
<div class="line removed"><span class="line-number">-44</span><span class="line-content">    pub node_id: NodeId,</span></div>
<div class="line removed"><span class="line-number">-45</span><span class="line-content">    pub node_reward_type: NodeRewardType,</span></div>
<div class="line removed"><span class="line-number">-46</span><span class="line-content">    pub region: String,</span></div>
<div class="line removed"><span class="line-number">-47</span><span class="line-content">    pub dc_id: String,</span></div>
<div class="line removed"><span class="line-number">-48</span><span class="line-content">    pub daily_results: Vec&lt;DailyResults&gt;,</span></div>
<div class="line removed"><span class="line-number">-49</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-50</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-51</span><span class="line-content">#[derive(Serialize, Deserialize, Debug, PartialEq, Clone)]</span></div>
<div class="line removed"><span class="line-number">-52</span><span class="line-content">pub struct BaseRewards {</span></div>
<div class="line removed"><span class="line-number">-53</span><span class="line-content">    pub node_reward_type: NodeRewardType,</span></div>
<div class="line removed"><span class="line-number">-54</span><span class="line-content">    pub region: Region,</span></div>
<div class="line removed"><span class="line-number">-55</span><span class="line-content">    pub monthly: XDRPermyriad,</span></div>
<div class="line removed"><span class="line-number">-56</span><span class="line-content">    pub daily: XDRPermyriad,</span></div>
<div class="line removed"><span class="line-number">-57</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-58</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-59</span><span class="line-content">#[derive(Serialize, Deserialize, Debug, PartialEq, Clone)]</span></div>
<div class="line removed"><span class="line-number">-60</span><span class="line-content">pub struct DailyBaseRewardsType3 {</span></div>
<div class="line removed"><span class="line-number">-61</span><span class="line-content">    pub day: DayUtc,</span></div>
<div class="line removed"><span class="line-number">-62</span><span class="line-content">    pub region: Region,</span></div>
<div class="line removed"><span class="line-number">-63</span><span class="line-content">    pub nodes_count: usize,</span></div>
<div class="line removed"><span class="line-number">-64</span><span class="line-content">    pub avg_rewards: XDRPermyriad,</span></div>
<div class="line removed"><span class="line-number">-65</span><span class="line-content">    pub avg_coefficient: Percent,</span></div>
<div class="line removed"><span class="line-number">-66</span><span class="line-content">    pub value: XDRPermyriad,</span></div>
<div class="line removed"><span class="line-number">-67</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-68</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-69</span><span class="line-content">#[derive(Serialize, Deserialize, Debug, PartialEq, Clone)]</span></div>
<div class="line removed"><span class="line-number">-70</span><span class="line-content">pub struct NodeProviderRewards {</span></div>
<div class="line removed"><span class="line-number">-71</span><span class="line-content">    pub rewards_total_xdr_permyriad: u64,</span></div>
<div class="line removed"><span class="line-number">-72</span><span class="line-content">    pub base_rewards: Vec&lt;BaseRewards&gt;,</span></div>
<div class="line removed"><span class="line-number">-73</span><span class="line-content">    pub base_rewards_type3: Vec&lt;DailyBaseRewardsType3&gt;,</span></div>
<div class="line removed"><span class="line-number">-74</span><span class="line-content">    pub nodes_results: Vec&lt;NodeResults&gt;,</span></div>
<div class="line removed"><span class="line-number">-75</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-76</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-77</span><span class="line-content">pub struct RewardsCalculatorResults {</span></div>
<div class="line removed"><span class="line-number">-78</span><span class="line-content">    pub start_day: DayUtc,</span></div>
<div class="line removed"><span class="line-number">-79</span><span class="line-content">    pub end_day: DayUtc,</span></div>
<div class="line removed"><span class="line-number">-80</span><span class="line-content">    pub subnets_fr: BTreeMap&lt;(DayUtc, SubnetId), Percent&gt;,</span></div>
<div class="line removed"><span class="line-number">-81</span><span class="line-content">    pub provider_results: BTreeMap&lt;PrincipalId, NodeProviderRewards&gt;,</span></div>
<div class="line removed"><span class="line-number">-82</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-83</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-84</span><span class="line-content">#[derive(Debug, PartialEq)]</span></div>
<div class="line removed"><span class="line-number">-85</span><span class="line-content">pub enum RewardCalculatorError {</span></div>
<div class="line removed"><span class="line-number">-86</span><span class="line-content">    RewardPeriodError(RewardPeriodError),</span></div>
<div class="line removed"><span class="line-number">-87</span><span class="line-content">    EmptyMetrics,</span></div>
<div class="line removed"><span class="line-number">-88</span><span class="line-content">    SubnetMetricsOutOfRange {</span></div>
<div class="line removed"><span class="line-number">-89</span><span class="line-content">        subnet_id: SubnetId,</span></div>
<div class="line removed"><span class="line-number">-90</span><span class="line-content">        day: DayUtc,</span></div>
<div class="line removed"><span class="line-number">-91</span><span class="line-content">        reward_period: RewardPeriod,</span></div>
<div class="line removed"><span class="line-number">-92</span><span class="line-content">    },</span></div>
<div class="line removed"><span class="line-number">-93</span><span class="line-content">    DuplicateMetrics(SubnetId, DayUtc),</span></div>
<div class="line removed"><span class="line-number">-94</span><span class="line-content">    ProviderNotFound(PrincipalId),</span></div>
<div class="line removed"><span class="line-number">-95</span><span class="line-content">    NodeNotInRewardables(NodeId),</span></div>
<div class="line removed"><span class="line-number">-96</span><span class="line-content">    RewardableNodeOutOfRange(NodeId),</span></div>
<div class="line removed"><span class="line-number">-97</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-98</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-99</span><span class="line-content">impl From&lt;RewardPeriodError&gt; for RewardCalculatorError {</span></div>
<div class="line removed"><span class="line-number">-100</span><span class="line-content">    fn from(err: RewardPeriodError) -&gt; Self {</span></div>
<div class="line removed"><span class="line-number">-101</span><span class="line-content">        RewardCalculatorError::RewardPeriodError(err)</span></div>
<div class="line removed"><span class="line-number">-102</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-103</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-104</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-105</span><span class="line-content">impl std::error::Error for RewardCalculatorError {}</span></div>
<div class="line removed"><span class="line-number">-106</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-107</span><span class="line-content">impl fmt::Display for RewardCalculatorError {</span></div>
<div class="line removed"><span class="line-number">-108</span><span class="line-content">    fn fmt(&amp;self, f: &amp;mut fmt::Formatter&lt;&#x27;_&gt;) -&gt; fmt::Result {</span></div>
<div class="line removed"><span class="line-number">-109</span><span class="line-content">        match self {</span></div>
<div class="line removed"><span class="line-number">-110</span><span class="line-content">            RewardCalculatorError::EmptyMetrics =&gt; {</span></div>
<div class="line removed"><span class="line-number">-111</span><span class="line-content">                write!(f, &quot;No daily_metrics_by_node&quot;)</span></div>
<div class="line removed"><span class="line-number">-112</span><span class="line-content">            }</span></div>
<div class="line removed"><span class="line-number">-113</span><span class="line-content">            RewardCalculatorError::SubnetMetricsOutOfRange {</span></div>
<div class="line removed"><span class="line-number">-114</span><span class="line-content">                subnet_id,</span></div>
<div class="line removed"><span class="line-number">-115</span><span class="line-content">                day,</span></div>
<div class="line removed"><span class="line-number">-116</span><span class="line-content">                reward_period,</span></div>
<div class="line removed"><span class="line-number">-117</span><span class="line-content">            } =&gt; {</span></div>
<div class="line removed"><span class="line-number">-118</span><span class="line-content">                write!(</span></div>
<div class="line removed"><span class="line-number">-119</span><span class="line-content">                    f,</span></div>
<div class="line removed"><span class="line-number">-120</span><span class="line-content">                    &quot;Node {} has metrics outside the reward period: timestamp: {} not in {}&quot;,</span></div>
<div class="line removed"><span class="line-number">-121</span><span class="line-content">                    subnet_id,</span></div>
<div class="line removed"><span class="line-number">-122</span><span class="line-content">                    day.get(),</span></div>
<div class="line removed"><span class="line-number">-123</span><span class="line-content">                    reward_period</span></div>
<div class="line removed"><span class="line-number">-124</span><span class="line-content">                )</span></div>
<div class="line removed"><span class="line-number">-125</span><span class="line-content">            }</span></div>
<div class="line removed"><span class="line-number">-126</span><span class="line-content">            RewardCalculatorError::DuplicateMetrics(subnet_id, day) =&gt; {</span></div>
<div class="line removed"><span class="line-number">-127</span><span class="line-content">                write!(</span></div>
<div class="line removed"><span class="line-number">-128</span><span class="line-content">                    f,</span></div>
<div class="line removed"><span class="line-number">-129</span><span class="line-content">                    &quot;Subnet {} has multiple metrics for the same node at ts {}&quot;,</span></div>
<div class="line removed"><span class="line-number">-130</span><span class="line-content">                    subnet_id,</span></div>
<div class="line removed"><span class="line-number">-131</span><span class="line-content">                    day.unix_ts_at_day_end()</span></div>
<div class="line removed"><span class="line-number">-132</span><span class="line-content">                )</span></div>
<div class="line removed"><span class="line-number">-133</span><span class="line-content">            }</span></div>
<div class="line removed"><span class="line-number">-134</span><span class="line-content">            RewardCalculatorError::RewardPeriodError(err) =&gt; {</span></div>
<div class="line removed"><span class="line-number">-135</span><span class="line-content">                write!(f, &quot;Reward period error: {err}&quot;)</span></div>
<div class="line removed"><span class="line-number">-136</span><span class="line-content">            }</span></div>
<div class="line removed"><span class="line-number">-137</span><span class="line-content">            RewardCalculatorError::ProviderNotFound(provider_id) =&gt; {</span></div>
<div class="line removed"><span class="line-number">-138</span><span class="line-content">                write!(f, &quot;Node Provider: {provider_id} not found&quot;)</span></div>
<div class="line removed"><span class="line-number">-139</span><span class="line-content">            }</span></div>
<div class="line removed"><span class="line-number">-140</span><span class="line-content">            RewardCalculatorError::NodeNotInRewardables(node_id) =&gt; {</span></div>
<div class="line removed"><span class="line-number">-141</span><span class="line-content">                write!(f, &quot;Node: {node_id} has metrics but is not rewardable&quot;)</span></div>
<div class="line removed"><span class="line-number">-142</span><span class="line-content">            }</span></div>
<div class="line removed"><span class="line-number">-143</span><span class="line-content">            RewardCalculatorError::RewardableNodeOutOfRange(node_id) =&gt; {</span></div>
<div class="line removed"><span class="line-number">-144</span><span class="line-content">                write!(f, &quot;Node: {node_id} is not rewardable in the reward period&quot;)</span></div>
<div class="line removed"><span class="line-number">-145</span><span class="line-content">            }</span></div>
<div class="line removed"><span class="line-number">-146</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-147</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-148</span><span class="line-content">}</span></div>
<div class="line context"><span class="line-number">0</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/types.rs b/rs/node_rewards/rewards_calculation/src/types.rs</span></div>
<div class="line context"><span class="line-number">1</span><span class="line-content">index 61159260b0..0eec8c16e3 100644</span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/types.rs</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/types.rs</div>
<div class="hunk-header">@@ -1,15 +1,12 @@</div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> use chrono::{DateTime, NaiveDateTime, ParseError, Utc};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content">use ic_base_types::{NodeId, SubnetId};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+2</span><span class="line-content">use ic_base_types::NodeId;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use ic_protobuf::registry::node::v1::NodeRewardType;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-4</span><span class="line-content">use ic_types::Time;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use serde::{Deserialize, Serialize};<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-6</span><span class="line-content">use std::error::Error;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use std::fmt;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use std::fmt::Display;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> pub type UnixTsNanos = u64;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> pub type NodesCount = u64;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-12</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> pub type Region = String;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> const NANOS_PER_DAY: UnixTsNanos = 24 * 60 * 60 * 1_000_000_000;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -19,6 +16,17 @@ pub struct DayUtc {</div>
<div class="line context"><span class="line-number">16</span><span class="line-content">     value: UnixTsNanos,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+19</span><span class="line-content">impl Display for DayUtc {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+20</span><span class="line-content">    fn fmt(&amp;self, f: &amp;mut fmt::Formatter&lt;&#x27;_&gt;) -&gt; fmt::Result {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+21</span><span class="line-content">        let dd_mm_yyyy =<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+22</span><span class="line-content">            DateTime::from_timestamp_nanos(self.unix_ts_at_day_end_nanoseconds() as i64)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+23</span><span class="line-content">                .naive_utc()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+24</span><span class="line-content">                .format(&quot;%d-%m-%Y&quot;)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+25</span><span class="line-content">                .to_string();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+26</span><span class="line-content">        write!(f, &quot;{}&quot;, dd_mm_yyyy)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+27</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+28</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+29</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">30</span><span class="line-content"> impl From&lt;UnixTsNanos&gt; for DayUtc {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">31</span><span class="line-content">     fn from(value: UnixTsNanos) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">32</span><span class="line-content">         let day_end = ((value / NANOS_PER_DAY) + 1) * NANOS_PER_DAY - 1;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -30,7 +38,7 @@ impl TryFrom&lt;&amp;str&gt; for DayUtc {</div>
<div class="line context"><span class="line-number">38</span><span class="line-content">     type Error = ParseError;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">39</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">40</span><span class="line-content">     fn try_from(value: &amp;str) -&gt; Result&lt;Self, Self::Error&gt; {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-33</span><span class="line-content">        let dt = format!(&quot;{value} 00:00:00&quot;);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+41</span><span class="line-content">        let dt = format!(&quot;{} 00:00:00&quot;, value);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">42</span><span class="line-content">         let naive = NaiveDateTime::parse_from_str(&amp;dt, &quot;%Y-%m-%d %H:%M:%S&quot;)?;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">43</span><span class="line-content">         let datetime: DateTime&lt;Utc&gt; = DateTime::from_naive_utc_and_offset(naive, Utc);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">44</span><span class="line-content">         let ts = datetime.timestamp_nanos_opt().unwrap() as u64;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -45,19 +53,8 @@ impl Default for DayUtc {</div>
<div class="line context"><span class="line-number">53</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">54</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">55</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-48</span><span class="line-content">impl Display for DayUtc {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-49</span><span class="line-content">    fn fmt(&amp;self, f: &amp;mut fmt::Formatter&lt;&#x27;_&gt;) -&gt; fmt::Result {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-50</span><span class="line-content">        let dd_mm_yyyy = DateTime::from_timestamp_nanos(self.unix_ts_at_day_end() as i64)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-51</span><span class="line-content">            .naive_utc()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-52</span><span class="line-content">            .format(&quot;%d-%m-%Y&quot;)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-53</span><span class="line-content">            .to_string();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-54</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-55</span><span class="line-content">        write!(f, &quot;{dd_mm_yyyy}&quot;)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-56</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-57</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-58</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">56</span><span class="line-content"> impl DayUtc {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-60</span><span class="line-content">    pub fn unix_ts_at_day_end(&amp;self) -&gt; UnixTsNanos {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+57</span><span class="line-content">    pub fn unix_ts_at_day_end_nanoseconds(&amp;self) -&gt; UnixTsNanos {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">58</span><span class="line-content">         self.value<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">59</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">60</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -65,10 +62,14 @@ impl DayUtc {</div>
<div class="line context"><span class="line-number">62</span><span class="line-content">         self.value<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">63</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">64</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-68</span><span class="line-content">    pub fn unix_ts_at_day_start(&amp;self) -&gt; UnixTsNanos {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+65</span><span class="line-content">    pub fn unix_ts_at_day_start_nanoseconds(&amp;self) -&gt; UnixTsNanos {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">66</span><span class="line-content">         (self.value / NANOS_PER_DAY) * NANOS_PER_DAY<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">67</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">68</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+69</span><span class="line-content">    pub fn unix_ts_at_day_end_seconds(&amp;self) -&gt; u64 {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+70</span><span class="line-content">        self.unix_ts_at_day_end_nanoseconds() / 1_000_000_000<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+71</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+72</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">73</span><span class="line-content">     pub fn next_day(&amp;self) -&gt; DayUtc {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">74</span><span class="line-content">         DayUtc {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">75</span><span class="line-content">             value: self.value + NANOS_PER_DAY,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -101,103 +102,21 @@ impl DayUtc {</div>
<div class="line context"><span class="line-number">102</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">103</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">104</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L104" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-104</span><span class="line-content">#[cfg(target_arch = &quot;wasm32&quot;)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L104" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-105</span><span class="line-content">fn current_time() -&gt; Time {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L105" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-106</span><span class="line-content">    let current_time = ic_cdk::api::time();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L106" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-107</span><span class="line-content">    Time::from_nanos_since_unix_epoch(current_time)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L107" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-108</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L108" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-109</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L109" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-110</span><span class="line-content">#[cfg(not(any(target_arch = &quot;wasm32&quot;)))]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L110" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-111</span><span class="line-content">fn current_time() -&gt; Time {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L111" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-112</span><span class="line-content">    ic_types::time::current_time()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L112" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-113</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L113" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-114</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L114" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-115</span><span class="line-content">/// Reward period in which we want to reward the node providers<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L115" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-116</span><span class="line-content">///<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L116" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-117</span><span class="line-content">/// This period ensures that all `BlockmakerMetrics` collected during the reward period are included consistently<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L117" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-118</span><span class="line-content">/// with the invariant defined in [`ic_replicated_state::metadata_state::BlockmakerMetricsTimeSeries`].<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L118" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-119</span><span class="line-content">#[derive(Debug, Clone, PartialEq)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L119" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-120</span><span class="line-content">pub struct RewardPeriod {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L120" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-121</span><span class="line-content">    pub from: DayUtc,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L121" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-122</span><span class="line-content">    pub to: DayUtc,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L122" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-123</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L123" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-124</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L124" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-125</span><span class="line-content">impl Display for RewardPeriod {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L125" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-126</span><span class="line-content">    fn fmt(&amp;self, f: &amp;mut fmt::Formatter&lt;&#x27;_&gt;) -&gt; fmt::Result {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L126" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-127</span><span class="line-content">        write!(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L127" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-128</span><span class="line-content">            f,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L128" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-129</span><span class="line-content">            &quot;RewardPeriod: {} - {}&quot;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L129" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-130</span><span class="line-content">            self.from.unix_ts_at_day_start(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L130" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-131</span><span class="line-content">            self.to.unix_ts_at_day_end()<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L131" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-132</span><span class="line-content">        )<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L132" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-133</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L133" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-134</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L134" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-135</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L135" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-136</span><span class="line-content">impl RewardPeriod {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L136" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-137</span><span class="line-content">    pub fn new(from: DayUtc, to: DayUtc) -&gt; Result&lt;Self, RewardPeriodError&gt; {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L137" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-138</span><span class="line-content">        if from &gt; to {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L138" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-139</span><span class="line-content">            return Err(RewardPeriodError::FromDayUtcLaterThanToDayUtc);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L139" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-140</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L140" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-141</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L141" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-142</span><span class="line-content">        // Metrics are collected at the end of the day, so we need to ensure that<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L142" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-143</span><span class="line-content">        // the end timestamp is not later than the first ts of today.<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L143" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-144</span><span class="line-content">        let today: DayUtc = current_time().as_nanos_since_unix_epoch().into();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L144" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-145</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L145" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-146</span><span class="line-content">        if to &gt;= today {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-147</span><span class="line-content">            return Err(RewardPeriodError::ToDayUtcLaterThanToday);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L147" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-148</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L148" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-149</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-150</span><span class="line-content">        Ok(Self { from, to })<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L150" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-151</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L151" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-152</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L152" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-153</span><span class="line-content">    pub fn contains(&amp;self, day: DayUtc) -&gt; bool {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L153" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-154</span><span class="line-content">        day &gt;= self.from &amp;&amp; day &lt;= self.to<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L154" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-155</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L155" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-156</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L156" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-157</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L157" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-158</span><span class="line-content">#[derive(Debug, PartialEq)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L158" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-159</span><span class="line-content">pub enum RewardPeriodError {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L159" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-160</span><span class="line-content">    FromDayUtcLaterThanToDayUtc,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L160" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-161</span><span class="line-content">    ToDayUtcLaterThanToday,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L161" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-162</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L162" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-163</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L163" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-164</span><span class="line-content">impl fmt::Display for RewardPeriodError {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L164" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-165</span><span class="line-content">    fn fmt(&amp;self, f: &amp;mut fmt::Formatter&lt;&#x27;_&gt;) -&gt; fmt::Result {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L165" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-166</span><span class="line-content">        match self {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L166" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-167</span><span class="line-content">            RewardPeriodError::FromDayUtcLaterThanToDayUtc =&gt; {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L167" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-168</span><span class="line-content">                write!(f, &quot;FromDayUtc must be earlier or equal ToDayUtc.&quot;)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L168" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-169</span><span class="line-content">            }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L169" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-170</span><span class="line-content">            RewardPeriodError::ToDayUtcLaterThanToday =&gt; {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L170" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-171</span><span class="line-content">                write!(f, &quot;ToDayUtc must be earlier than today&quot;)<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L171" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-172</span><span class="line-content">            }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L172" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-173</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L173" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-174</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L174" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+105</span><span class="line-content">#[derive(Clone, Debug, PartialEq, Eq, PartialOrd, Ord)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L105" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+106</span><span class="line-content">pub struct NodeMetricsDailyRaw {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L106" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+107</span><span class="line-content">    pub node_id: NodeId,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L107" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+108</span><span class="line-content">    pub num_blocks_proposed: u64,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L108" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+109</span><span class="line-content">    pub num_blocks_failed: u64,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L109" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">110</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L110" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">111</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L111" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-177</span><span class="line-content">impl Error for RewardPeriodError {}<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L177" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-178</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L178" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">112</span><span class="line-content"> #[derive(Eq, Hash, PartialEq, Clone, Ord, PartialOrd, Debug)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L112" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">113</span><span class="line-content"> pub struct RewardableNode {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L113" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">114</span><span class="line-content">     pub node_id: NodeId,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L114" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-182</span><span class="line-content">    pub rewardable_days: Vec&lt;DayUtc&gt;,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L182" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">115</span><span class="line-content">     pub region: Region,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L115" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">116</span><span class="line-content">     pub node_reward_type: NodeRewardType,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L116" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">117</span><span class="line-content">     pub dc_id: String,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L117" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">118</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L118" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">119</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L119" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-188</span><span class="line-content">#[derive(Clone, Debug, PartialEq, Eq, PartialOrd, Ord)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L188" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-189</span><span class="line-content">pub struct NodeMetricsDailyRaw {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L189" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-190</span><span class="line-content">    pub node_id: NodeId,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L190" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-191</span><span class="line-content">    pub num_blocks_proposed: u64,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L191" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-192</span><span class="line-content">    pub num_blocks_failed: u64,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L192" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-193</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L193" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-194</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L194" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-195</span><span class="line-content">#[derive(Clone, Debug, Eq, PartialEq, PartialOrd, Ord, Hash)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L195" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-196</span><span class="line-content">pub struct SubnetMetricsDailyKey {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L196" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-197</span><span class="line-content">    pub subnet_id: SubnetId,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L197" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-198</span><span class="line-content">    pub day: DayUtc,<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L198" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-199</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L199" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-200</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L200" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">120</span><span class="line-content"> #[cfg(test)]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L120" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">121</span><span class="line-content"> mod tests {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L121" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">122</span><span class="line-content">     use super::*;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L122" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -213,45 +132,15 @@ mod tests {</div>
<div class="line context"><span class="line-number">132</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L132" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">133</span><span class="line-content">     #[test]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L133" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">134</span><span class="line-content">     fn test_valid_rewarding_period() {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L134" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-216</span><span class="line-content">        let from_ts = ymdh_to_ts(2020, 1, 12, 12);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L216" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-217</span><span class="line-content">        let end_ts = ymdh_to_ts(2020, 1, 15, 15);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L217" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-218</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L218" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-219</span><span class="line-content">        let rp = RewardPeriod::new(DayUtc::from(from_ts), DayUtc::from(end_ts)).unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L219" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-220</span><span class="line-content">        let expected_start_ts = ymdh_to_ts(2020, 1, 12, 0);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L220" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-221</span><span class="line-content">        let expected_end_ts = ymdh_to_ts(2020, 1, 16, 0) - 1;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L221" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-222</span><span class="line-content">        let days = rp.from.days_until(&amp;rp.to).unwrap().len();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L222" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+135</span><span class="line-content">        let from_day: DayUtc = ymdh_to_ts(2020, 1, 12, 0).into();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L135" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+136</span><span class="line-content">        let to_day = (ymdh_to_ts(2020, 1, 16, 0) - 1).into();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L136" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+137</span><span class="line-content">        let days = from_day.days_until(&amp;to_day).unwrap().len();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L137" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">138</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L138" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-224</span><span class="line-content">        assert_eq!(rp.from.unix_ts_at_day_start(), expected_start_ts);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L224" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-225</span><span class="line-content">        assert_eq!(rp.to.unix_ts_at_day_end(), expected_end_ts);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L225" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">139</span><span class="line-content">         assert_eq!(days, 4);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L139" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">140</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L140" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-228</span><span class="line-content">        let end_ts = ymdh_to_ts(2020, 1, 12, 13);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L228" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-229</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L229" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-230</span><span class="line-content">        let rp = RewardPeriod::new(DayUtc::from(from_ts), DayUtc::from(end_ts)).unwrap();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L230" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-231</span><span class="line-content">        let days = rp.from.days_until(&amp;rp.to).unwrap().len();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L231" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+141</span><span class="line-content">        let to_day = ymdh_to_ts(2020, 1, 12, 13).into();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L141" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+142</span><span class="line-content">        let days = from_day.days_until(&amp;to_day).unwrap().len();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L142" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">143</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L143" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">144</span><span class="line-content">         assert_eq!(days, 1);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L144" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">145</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L145" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-235</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L235" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-236</span><span class="line-content">    #[test]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L236" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-237</span><span class="line-content">    fn test_error_too_recent_end_ts() {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L237" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-238</span><span class="line-content">        let to_ts = current_time().as_nanos_since_unix_epoch();<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L238" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-239</span><span class="line-content">        let from_ts = 0;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L239" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-240</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L240" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-241</span><span class="line-content">        let rp = RewardPeriod::new(DayUtc::from(from_ts), DayUtc::from(to_ts));<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L241" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-242</span><span class="line-content">        assert_eq!(rp.unwrap_err(), RewardPeriodError::ToDayUtcLaterThanToday);<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L242" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-243</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L243" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-244</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L244" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-245</span><span class="line-content">    #[test]<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L245" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-246</span><span class="line-content">    fn test_error_unaligned_start_ts_greater_unaligned_end_ts() {<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L246" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-247</span><span class="line-content">        let to_ts = 0;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L247" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-248</span><span class="line-content">        let from_ts = 86499999999999;<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L248" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-249</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L249" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-250</span><span class="line-content">        let rp = RewardPeriod::new(DayUtc::from(from_ts), DayUtc::from(to_ts));<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L250" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-251</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L251" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-252</span><span class="line-content">        assert_eq!(<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L252" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-253</span><span class="line-content">            rp.unwrap_err(),<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L253" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-254</span><span class="line-content">            RewardPeriodError::FromDayUtcLaterThanToDayUtc<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L254" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-255</span><span class="line-content">        );<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L255" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-256</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92~1/rs/node_rewards/rewards_calculation/src/types.rs#L256" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">146</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/ed7dbb0a280cf0e25b712b651a05997d3ce24f92/rs/node_rewards/rewards_calculation/src/types.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="commit-detail">
                    <div class="commit-header">
                        <div class="commit-title">
                            <a href="https://github.com/dfinity/ic/commit/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3" class="commit-hash-large" target="_blank">b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3</a>
                            <span class="badge chore">chore</span>
                        </div>
                        <div class="commit-meta">
                            <span>👤 Nikola Milosavljevic &lt;73236646+NikolaMilosa@users.noreply.github.com&gt;</span>
                            <span>📅 2025-09-12</span>
                            <span>📁 23 files</span>
                        </div>
                        <div style="margin-top: 8px; color: #e6edf3; font-size: 0.9em;">
                            chore: bumping edition to 2024 (#6715)
                        </div>
                        <div class="commit-actions">
                            <button class="toggle-button secondary" onclick="toggleFiles('files-9')">📁 Files (23)</button>
                            <button class="toggle-button" onclick="toggleDiff('diff-9')">🔍 Code Changes</button>
                        </div>
                        <div id="files-9" class="collapsible">
                            <div class="files-list">
                                <ul><li>rs/node_rewards/canister/protobuf_generator/src/main.rs</li><li>rs/node_rewards/canister/src/api_conversion.rs</li><li>rs/node_rewards/canister/src/canister/mod.rs</li><li>rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs</li><li>rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs</li><li>rs/node_rewards/canister/src/canister/test/sync_all.rs</li><li>rs/node_rewards/canister/src/canister/test/test_utils.rs</li><li>rs/node_rewards/canister/src/lib.rs</li><li>rs/node_rewards/canister/src/main.rs</li><li>rs/node_rewards/canister/src/metrics.rs</li><li>rs/node_rewards/canister/src/metrics/tests.rs</li><li>rs/node_rewards/canister/src/registry_querier.rs</li><li>rs/node_rewards/canister/src/registry_querier/tests.rs</li><li>rs/node_rewards/canister/src/telemetry.rs</li><li>rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs</li><li>rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs</li><li>rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs</li><li>rs/node_rewards/rewards_calculation/src/rewards_calculator/mod.rs</li><li>rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs</li><li>rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs</li><li>rs/node_rewards/rewards_calculation/src/types.rs</li><li>rs/registry/node_provider_rewards/src/lib.rs</li><li>rs/registry/node_provider_rewards/src/logs.rs</li></ul></div></div>
                        <div id="diff-9" class="collapsible">
                            <div class="diff-container">
                                <div class="line context"><span class="line-number">1</span><span class="line-content">commit b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3</span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content">Author: Nikola Milosavljevic &lt;73236646+NikolaMilosa@users.noreply.github.com&gt;</span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content">Date:   Fri Sep 12 22:02:32 2025 +0200</span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content">    chore: bumping edition to 2024 (#6715)</span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content">    This PR bumps the edition to the newest one.</span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content">    **NOTE**: 99% of the code is `rustfmt` + `cargo clippy —fix` and `cargo</span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content">    fix`. 1% is some borrowchecker differences</span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">diff --git a/rs/node_rewards/canister/protobuf_generator/src/main.rs b/rs/node_rewards/canister/protobuf_generator/src/main.rs</span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content">index 8bc35247d6..53783daaca 100644</span></div>
<div class="file-header">--- a/rs/node_rewards/canister/protobuf_generator/src/main.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/protobuf_generator/src/main.rs</div>
<div class="hunk-header">@@ -1,4 +1,4 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">use ic_node_rewards_protobuf_generator::{generate_prost_files, ProtoPaths};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/protobuf_generator/src/main.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">use ic_node_rewards_protobuf_generator::{ProtoPaths, generate_prost_files};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/protobuf_generator/src/main.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use std::path::PathBuf;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/protobuf_generator/src/main.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/protobuf_generator/src/main.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> fn main() {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/protobuf_generator/src/main.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/api_conversion.rs b/rs/node_rewards/canister/src/api_conversion.rs<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/protobuf_generator/src/main.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content">index 6c2a12443a..a8c9ec8725 100644<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/protobuf_generator/src/main.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/api_conversion.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/api_conversion.rs</div>
<div class="hunk-header">@@ -1,10 +1,10 @@</div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> use ic_node_rewards_canister_api::provider_rewards_calculation::{<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/api_conversion.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content">    node_status::Status as StatusCandid, Assigned as AssignedCandid,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/api_conversion.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-3</span><span class="line-content">    BaseRewards as BaseRewardsCandid, DailyBaseRewardsType3 as DailyBaseRewardsType3Candid,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/api_conversion.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-4</span><span class="line-content">    DailyResults as DailyResultsCandid, DayUtc as DayUtcCandid,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/api_conversion.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-5</span><span class="line-content">    NodeMetricsDaily as NodeMetricsDailyCandid, NodeProviderRewards as NodeProviderRewardsCandid,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/api_conversion.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-6</span><span class="line-content">    NodeResults as NodeResultsCandid, NodeStatus as NodeStatusCandid,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/api_conversion.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content">    Unassigned as UnassignedCandid,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/api_conversion.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+2</span><span class="line-content">    Assigned as AssignedCandid, BaseRewards as BaseRewardsCandid,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/api_conversion.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+3</span><span class="line-content">    DailyBaseRewardsType3 as DailyBaseRewardsType3Candid, DailyResults as DailyResultsCandid,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/api_conversion.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+4</span><span class="line-content">    DayUtc as DayUtcCandid, NodeMetricsDaily as NodeMetricsDailyCandid,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/api_conversion.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+5</span><span class="line-content">    NodeProviderRewards as NodeProviderRewardsCandid, NodeResults as NodeResultsCandid,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/api_conversion.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+6</span><span class="line-content">    NodeStatus as NodeStatusCandid, Unassigned as UnassignedCandid,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/api_conversion.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+7</span><span class="line-content">    node_status::Status as StatusCandid,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/api_conversion.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/api_conversion.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> use rewards_calculation::rewards_calculator_results::{NodeProviderRewards, NodeStatus};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/api_conversion.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/api_conversion.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/canister/mod.rs b/rs/node_rewards/canister/src/canister/mod.rs<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/api_conversion.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">index c0bec07e99..62e969f73b 100644<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/api_conversion.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/canister/mod.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/canister/mod.rs</div>
<div class="hunk-header">@@ -18,12 +18,12 @@ use ic_protobuf::registry::dc::v1::DataCenterRecord;</div>
<div class="line context"><span class="line-number">18</span><span class="line-content"> use ic_protobuf::registry::node_operator::v1::NodeOperatorRecord;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content"> use ic_protobuf::registry::node_rewards::v2::NodeRewardsTable;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">20</span><span class="line-content"> use ic_registry_canister_client::{<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-21</span><span class="line-content">    get_decoded_value, CanisterRegistryClient, RegistryDataStableMemory,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/canister/mod.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+21</span><span class="line-content">    CanisterRegistryClient, RegistryDataStableMemory, get_decoded_value,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">22</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">23</span><span class="line-content"> use ic_registry_keys::{<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">24</span><span class="line-content">     DATA_CENTER_KEY_PREFIX, NODE_OPERATOR_RECORD_KEY_PREFIX, NODE_REWARDS_TABLE_KEY,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">25</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-26</span><span class="line-content">use ic_registry_node_provider_rewards::{calculate_rewards_v0, RewardsPerNodeProvider};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/canister/mod.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+26</span><span class="line-content">use ic_registry_node_provider_rewards::{RewardsPerNodeProvider, calculate_rewards_v0};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">27</span><span class="line-content"> use ic_types::RegistryVersion;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">28</span><span class="line-content"> use rewards_calculation::rewards_calculator::RewardsCalculatorInput;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">29</span><span class="line-content"> use rewards_calculation::rewards_calculator_results::RewardsCalculatorResults;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -73,7 +73,7 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">73</span><span class="line-content">     pub fn get_registry_value(&amp;self, key: String) -&gt; Result&lt;Option&lt;Vec&lt;u8&gt;&gt;, String&gt; {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">74</span><span class="line-content">         self.registry_client<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">75</span><span class="line-content">             .get_value(key.as_ref(), self.registry_client.get_latest_version())<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-76</span><span class="line-content">            .map_err(|e| format!(&quot;Failed to get registry value: {:?}&quot;, e))<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/canister/mod.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+76</span><span class="line-content">            .map_err(|e| format!(&quot;Failed to get registry value: {e:?}&quot;))<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">77</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">78</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">79</span><span class="line-content">     pub async fn schedule_registry_sync(<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -148,10 +148,9 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">148</span><span class="line-content">             daily_metrics_by_subnet,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L148" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">149</span><span class="line-content">             provider_rewardable_nodes,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">150</span><span class="line-content">         };<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L150" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-151</span><span class="line-content">        let result = rewards_calculation::rewards_calculator::calculate_rewards(input)<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/canister/mod.rs#L151" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-152</span><span class="line-content">            .map_err(|e| format!(&quot;Could not calculate rewards: {e:?}&quot;));<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/canister/mod.rs#L152" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">151</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L151" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-154</span><span class="line-content">        result<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/canister/mod.rs#L154" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+152</span><span class="line-content">        rewards_calculation::rewards_calculator::calculate_rewards(input)<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L152" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+153</span><span class="line-content">            .map_err(|e| format!(&quot;Could not calculate rewards: {e:?}&quot;))<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L153" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">154</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L154" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">155</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L155" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">156</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L156" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -189,8 +188,7 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">188</span><span class="line-content">             registry_client.sync_registry_stored().await.map_err(|e| {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L188" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">189</span><span class="line-content">                 format!(<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L189" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">190</span><span class="line-content">                     &quot;Could not sync registry store to latest version, \<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L190" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-192</span><span class="line-content">                    please try again later: {:?}&quot;,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/canister/mod.rs#L192" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-193</span><span class="line-content">                    e<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/canister/mod.rs#L193" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+191</span><span class="line-content">                    please try again later: {e:?}&quot;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L191" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">192</span><span class="line-content">                 )<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L192" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">193</span><span class="line-content">             })?;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L193" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">194</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L194" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -235,8 +233,7 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">233</span><span class="line-content">             .map_err(|e| {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L233" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">234</span><span class="line-content">                 format!(<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L234" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">235</span><span class="line-content">                     &quot;Could not sync registry store to latest version, \<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L235" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-238</span><span class="line-content">                    please try again later: {:?}&quot;,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/canister/mod.rs#L238" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-239</span><span class="line-content">                    e<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/canister/mod.rs#L239" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+236</span><span class="line-content">                    please try again later: {e:?}&quot;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L236" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">237</span><span class="line-content">                 )<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L237" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">238</span><span class="line-content">             })?;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L238" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">239</span><span class="line-content">         NodeRewardsCanister::schedule_metrics_sync(canister).await;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L239" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -267,10 +264,10 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">264</span><span class="line-content">         let mut result = canister.with_borrow(|canister| {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L264" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">265</span><span class="line-content">             canister.calculate_rewards::&lt;S&gt;(request_inner, Some(provider_id))<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L265" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">266</span><span class="line-content">         })?;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L266" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-270</span><span class="line-content">        let node_provider_rewards = result.provider_results.remove(&amp;provider_id).ok_or(format!(<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/canister/mod.rs#L270" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-271</span><span class="line-content">            &quot;No rewards found for node provider {}&quot;,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/canister/mod.rs#L271" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-272</span><span class="line-content">            provider_id<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/canister/mod.rs#L272" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-273</span><span class="line-content">        ))?;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/canister/mod.rs#L273" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+267</span><span class="line-content">        let node_provider_rewards = result<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L267" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+268</span><span class="line-content">            .provider_results<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L268" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+269</span><span class="line-content">            .remove(&amp;provider_id)<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L269" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+270</span><span class="line-content">            .ok_or(format!(&quot;No rewards found for node provider {provider_id}&quot;))?;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L270" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">271</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L271" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">272</span><span class="line-content">         Ok(to_candid_type(node_provider_rewards))<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L272" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">273</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L273" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">274</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs b/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L274" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">275</span><span class="line-content">index 0ecd48f44a..53becdff51 100644<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/mod.rs#L275" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs</div>
<div class="hunk-header">@@ -1,5 +1,5 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">use crate::canister::test::test_utils::{setup_thread_local_canister_for_test, CANISTER_TEST};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> use crate::canister::NodeRewardsCanister;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+2</span><span class="line-content">use crate::canister::test::test_utils::{CANISTER_TEST, setup_thread_local_canister_for_test};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use futures_util::FutureExt;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use ic_nervous_system_canisters::registry::fake::FakeRegistry;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use ic_nns_test_utils::registry::invariant_compliant_mutation;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -13,7 +13,7 @@ use ic_protobuf::registry::node_rewards::v2::{</div>
<div class="line context"><span class="line-number">13</span><span class="line-content">     NodeRewardRate, NodeRewardRates, NodeRewardsTable, UpdateNodeRewardsTableProposalPayload,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> use ic_registry_keys::{<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-16</span><span class="line-content">    make_data_center_record_key, make_node_operator_record_key, NODE_REWARDS_TABLE_KEY,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+16</span><span class="line-content">    NODE_REWARDS_TABLE_KEY, make_data_center_record_key, make_node_operator_record_key,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content"> use ic_types::PrincipalId;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content"> use maplit::btreemap;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -535,7 +535,7 @@ fn test_get_node_providers_monthly_xdr_rewards_type3() {</div>
<div class="line context"><span class="line-number">535</span><span class="line-content">     let mut np2_expected_reward_ch = 0;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L535" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">536</span><span class="line-content">     let mut node_reward_ch = 22000000.0;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L536" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">537</span><span class="line-content">     for _ in 0..14 {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L537" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-538</span><span class="line-content">        println!(&quot;node_reward CH {}&quot;, node_reward_ch);<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L538" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+538</span><span class="line-content">        println!(&quot;node_reward CH {node_reward_ch}&quot;);<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L538" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">539</span><span class="line-content">         np2_expected_reward_ch += node_reward_ch as u64;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L539" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">540</span><span class="line-content">         node_reward_ch *= 0.7;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L540" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">541</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L541" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -561,7 +561,7 @@ fn test_get_node_providers_monthly_xdr_rewards_type3() {</div>
<div class="line context"><span class="line-number">561</span><span class="line-content">     let mut np2_expected_reward_de = 0;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L561" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">562</span><span class="line-content">     let mut node_reward_de = 22000000.0;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L562" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">563</span><span class="line-content">     for _ in 0..11 {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L563" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-564</span><span class="line-content">        println!(&quot;node_reward DE {}&quot;, node_reward_de);<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L564" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+564</span><span class="line-content">        println!(&quot;node_reward DE {node_reward_de}&quot;);<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L564" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">565</span><span class="line-content">         np2_expected_reward_de += node_reward_de as u64;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L565" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">566</span><span class="line-content">         node_reward_de *= 0.7;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L566" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">567</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L567" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -597,7 +597,7 @@ fn test_get_node_providers_monthly_xdr_rewards_type3() {</div>
<div class="line context"><span class="line-number">597</span><span class="line-content">     );<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L597" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">598</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L598" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">599</span><span class="line-content">     for _ in 0..10 {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L599" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-600</span><span class="line-content">        println!(&quot;node_reward CH {}&quot;, node_reward_ch);<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L600" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+600</span><span class="line-content">        println!(&quot;node_reward CH {node_reward_ch}&quot;);<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L600" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">601</span><span class="line-content">         np2_expected_reward_ch += node_reward_ch as u64;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L601" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">602</span><span class="line-content">         node_reward_ch *= 0.7;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L602" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">603</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L603" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">604</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs b/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L604" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">605</span><span class="line-content">index eb3db428bf..041b326ddb 100644<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_monthly_xdr_rewards.rs#L605" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs</div>
<div class="hunk-header">@@ -1,8 +1,8 @@</div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> use crate::api_conversion::to_candid_type;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+2</span><span class="line-content">use crate::canister::NodeRewardsCanister;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use crate::canister::test::test_utils::{<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-3</span><span class="line-content">    setup_thread_local_canister_for_test, TestState, CANISTER_TEST, VM,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+4</span><span class="line-content">    CANISTER_TEST, TestState, VM, setup_thread_local_canister_for_test,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-5</span><span class="line-content">use crate::canister::NodeRewardsCanister;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use crate::metrics::MetricsManager;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> use crate::pb::v1::{NodeMetrics, SubnetMetricsKey, SubnetMetricsValue};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> use futures_util::FutureExt;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -15,8 +15,8 @@ use ic_protobuf::registry::dc::v1::DataCenterRecord;</div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> use ic_protobuf::registry::node::v1::{NodeRecord, NodeRewardType};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> use ic_protobuf::registry::node_operator::v1::NodeOperatorRecord;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content"> use ic_registry_keys::{<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-18</span><span class="line-content">    make_data_center_record_key, make_node_operator_record_key, make_node_record_key,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-19</span><span class="line-content">    NODE_REWARDS_TABLE_KEY,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+18</span><span class="line-content">    NODE_REWARDS_TABLE_KEY, make_data_center_record_key, make_node_operator_record_key,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+19</span><span class="line-content">    make_node_record_key,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">20</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">21</span><span class="line-content"> use ic_types::PrincipalId;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">22</span><span class="line-content"> use maplit::btreemap;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">23</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/canister/test/sync_all.rs b/rs/node_rewards/canister/src/canister/test/sync_all.rs<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">24</span><span class="line-content">index b51b9a4a7c..ba53d290a5 100644<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/canister/test/sync_all.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/canister/test/sync_all.rs</div>
<div class="hunk-header">@@ -1,10 +1,10 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">use crate::canister::test::test_utils::{setup_thread_local_canister_for_test, CANISTER_TEST};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/canister/test/sync_all.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> use crate::canister::NodeRewardsCanister;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/sync_all.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+2</span><span class="line-content">use crate::canister::test::test_utils::{CANISTER_TEST, setup_thread_local_canister_for_test};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/sync_all.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use crate::metrics::tests::subnet_id;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/sync_all.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use futures_util::FutureExt;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/sync_all.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use ic_base_types::{RegistryVersion, SubnetId};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/sync_all.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-6</span><span class="line-content">use ic_nervous_system_canisters::registry::fake::FakeRegistry;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/canister/test/sync_all.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use ic_nervous_system_canisters::registry::Registry;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/sync_all.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+7</span><span class="line-content">use ic_nervous_system_canisters::registry::fake::FakeRegistry;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/sync_all.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> use ic_protobuf::registry::subnet::v1::SubnetListRecord;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/sync_all.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> use ic_registry_keys::make_subnet_list_record_key;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/sync_all.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> use std::sync::Arc;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/sync_all.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/canister/test/test_utils.rs b/rs/node_rewards/canister/src/canister/test/test_utils.rs<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/sync_all.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">index 317b1fcf03..248313de41 100644<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/sync_all.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/canister/test/test_utils.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/canister/test/test_utils.rs</div>
<div class="hunk-header">@@ -7,8 +7,8 @@ use ic_management_canister_types::NodeMetricsHistoryRecord;</div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> use ic_nervous_system_canisters::registry::fake::FakeRegistry;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/test_utils.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> use ic_registry_canister_client::RegistryDataStableMemory;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/test_utils.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> use ic_registry_canister_client::{<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/test_utils.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-10</span><span class="line-content">    test_registry_data_stable_memory_impl, StableCanisterRegistryClient, StorableRegistryKey,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/canister/test/test_utils.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-11</span><span class="line-content">    StorableRegistryValue,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/canister/test/test_utils.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+10</span><span class="line-content">    StableCanisterRegistryClient, StorableRegistryKey, StorableRegistryValue,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/test_utils.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+11</span><span class="line-content">    test_registry_data_stable_memory_impl,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/test_utils.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/test_utils.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> use ic_stable_structures::memory_manager::{MemoryId, MemoryManager, VirtualMemory};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/test_utils.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> use ic_stable_structures::{DefaultMemoryImpl, StableBTreeMap};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/test_utils.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/lib.rs b/rs/node_rewards/canister/src/lib.rs<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/test_utils.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content">index 37cb0670d6..0cf146f7ea 100644<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/canister/test/test_utils.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/lib.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/lib.rs</div>
<div class="hunk-header">@@ -8,8 +8,8 @@</div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> use candid::Principal;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/lib.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> use ic_base_types::{PrincipalId, SubnetId};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/lib.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> use ic_management_canister_types::NodeMetrics;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/lib.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-11</span><span class="line-content">use ic_stable_structures::storable::Bound;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/lib.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> use ic_stable_structures::Storable;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/lib.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+12</span><span class="line-content">use ic_stable_structures::storable::Bound;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/lib.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> use prost::Message;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/lib.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> use rewards_calculation::types::SubnetMetricsDailyKey;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/lib.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> use std::borrow::Cow;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/lib.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/main.rs b/rs/node_rewards/canister/src/main.rs<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/lib.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content">index 9e71766aa1..525644133a 100644<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/lib.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/main.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/main.rs</div>
<div class="hunk-header">@@ -3,7 +3,7 @@ use ic_cdk::{init, post_upgrade, pre_upgrade, query, update};</div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use ic_nervous_system_canisters::registry::RegistryCanister;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/main.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use ic_nns_constants::GOVERNANCE_CANISTER_ID;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/main.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use ic_node_rewards_canister::canister::NodeRewardsCanister;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/main.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-6</span><span class="line-content">use ic_node_rewards_canister::storage::{RegistryStoreStableMemoryBorrower, METRICS_MANAGER};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/main.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+6</span><span class="line-content">use ic_node_rewards_canister::storage::{METRICS_MANAGER, RegistryStoreStableMemoryBorrower};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/main.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> use ic_node_rewards_canister::telemetry;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/main.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> use ic_node_rewards_canister_api::monthly_rewards::{<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/main.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content">     GetNodeProvidersMonthlyXdrRewardsRequest, GetNodeProvidersMonthlyXdrRewardsResponse,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/main.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -138,7 +138,7 @@ fn get_node_provider_rewards_calculation(</div>
<div class="line context"><span class="line-number">138</span><span class="line-content"> #[cfg(test)]<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/main.rs#L138" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">139</span><span class="line-content"> mod tests {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/main.rs#L139" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">140</span><span class="line-content">     use super::*;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/main.rs#L140" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-141</span><span class="line-content">    use candid_parser::utils::{service_equal, CandidSource};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/main.rs#L141" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+141</span><span class="line-content">    use candid_parser::utils::{CandidSource, service_equal};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/main.rs#L141" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">142</span><span class="line-content">     #[test]<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/main.rs#L142" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">143</span><span class="line-content">     fn test_implemented_interface_matches_declared_interface_exactly() {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/main.rs#L143" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">144</span><span class="line-content">         let declared_interface = CandidSource::Text(include_str!(&quot;../node-rewards-canister.did&quot;));<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/main.rs#L144" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">145</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/metrics.rs b/rs/node_rewards/canister/src/metrics.rs<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/main.rs#L145" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">146</span><span class="line-content">index 8d9c7a6629..3116b784ec 100644<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/main.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/metrics.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/metrics.rs</div>
<div class="hunk-header">@@ -1,6 +1,6 @@</div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> #![allow(deprecated)]<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content">use crate::pb::v1::{SubnetIdKey, SubnetMetricsKey, SubnetMetricsValue};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/metrics.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use crate::KeyRange;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+3</span><span class="line-content">use crate::pb::v1::{SubnetIdKey, SubnetMetricsKey, SubnetMetricsValue};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use async_trait::async_trait;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use candid::Principal;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use ic_base_types::{NodeId, SubnetId};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/metrics/tests.rs b/rs/node_rewards/canister/src/metrics/tests.rs<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content">index 5813510bfc..95ac66faf7 100644<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/metrics/tests.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/metrics/tests.rs</div>
<div class="hunk-header">@@ -3,8 +3,8 @@ use crate::pb::v1::SubnetMetricsKey;</div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use ic_base_types::{NodeId, PrincipalId, SubnetId};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics/tests.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use ic_cdk::api::call::{CallResult, RejectionCode};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics/tests.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use ic_management_canister_types::{NodeMetrics, NodeMetricsHistoryArgs, NodeMetricsHistoryRecord};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics/tests.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-6</span><span class="line-content">use ic_stable_structures::memory_manager::{MemoryId, VirtualMemory};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/metrics/tests.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use ic_stable_structures::DefaultMemoryImpl;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics/tests.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+7</span><span class="line-content">use ic_stable_structures::memory_manager::{MemoryId, VirtualMemory};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics/tests.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> use rewards_calculation::types::{DayUtc, NodeMetricsDailyRaw};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics/tests.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> use std::cell::RefCell;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics/tests.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> use std::collections::{BTreeMap, HashMap};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics/tests.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -122,8 +122,7 @@ async fn multiple_subnets_metrics_added_correctly() {</div>
<div class="line context"><span class="line-number">122</span><span class="line-content">             };<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics/tests.rs#L122" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">123</span><span class="line-content">             assert!(<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics/tests.rs#L123" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">124</span><span class="line-content">                 mm.subnets_metrics.borrow().get(&amp;key).is_some(),<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics/tests.rs#L124" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-125</span><span class="line-content">                &quot;Metrics missing for subnet {:?}&quot;,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/metrics/tests.rs#L125" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-126</span><span class="line-content">                subnet<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/metrics/tests.rs#L126" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+125</span><span class="line-content">                &quot;Metrics missing for subnet {subnet:?}&quot;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics/tests.rs#L125" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">126</span><span class="line-content">             );<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics/tests.rs#L126" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">127</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics/tests.rs#L127" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">128</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics/tests.rs#L128" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -146,8 +145,7 @@ async fn retry_count_increments_on_failure() {</div>
<div class="line context"><span class="line-number">145</span><span class="line-content">         assert_eq!(<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics/tests.rs#L145" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">146</span><span class="line-content">             mm.subnets_to_retry.borrow().get(&amp;subnet_1.into()),<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics/tests.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">147</span><span class="line-content">             Some(retry_attempt),<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics/tests.rs#L147" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-149</span><span class="line-content">            &quot;Retry count should be {}&quot;,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/metrics/tests.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-150</span><span class="line-content">            retry_attempt<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/metrics/tests.rs#L150" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+148</span><span class="line-content">            &quot;Retry count should be {retry_attempt}&quot;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics/tests.rs#L148" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">149</span><span class="line-content">         );<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics/tests.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">150</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics/tests.rs#L150" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">151</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics/tests.rs#L151" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">152</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/registry_querier.rs b/rs/node_rewards/canister/src/registry_querier.rs<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics/tests.rs#L152" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">153</span><span class="line-content">index 1404d61db6..18a9e474af 100644<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/metrics/tests.rs#L153" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/registry_querier.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/registry_querier.rs</div>
<div class="hunk-header">@@ -6,11 +6,11 @@ use ic_protobuf::registry::node_operator::v1::NodeOperatorRecord;</div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use ic_protobuf::registry::node_rewards::v2::NodeRewardsTable;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> use ic_protobuf::registry::subnet::v1::SubnetListRecord;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> use ic_registry_canister_client::{<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-9</span><span class="line-content">    get_decoded_value, CanisterRegistryClient, RegistryDataStableMemory, StorableRegistryKey,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/registry_querier.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+9</span><span class="line-content">    CanisterRegistryClient, RegistryDataStableMemory, StorableRegistryKey, get_decoded_value,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> use ic_registry_keys::{<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-12</span><span class="line-content">    make_data_center_record_key, make_node_operator_record_key, make_subnet_list_record_key,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/registry_querier.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-13</span><span class="line-content">    NODE_RECORD_KEY_PREFIX, NODE_REWARDS_TABLE_KEY,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/registry_querier.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+12</span><span class="line-content">    NODE_RECORD_KEY_PREFIX, NODE_REWARDS_TABLE_KEY, make_data_center_record_key,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+13</span><span class="line-content">    make_node_operator_record_key, make_subnet_list_record_key,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> use ic_types::registry::RegistryClientError;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> use itertools::Itertools;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -256,7 +256,7 @@ impl RegistryQuerier {</div>
<div class="line context"><span class="line-number">256</span><span class="line-content">             version,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier.rs#L256" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">257</span><span class="line-content">         )<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier.rs#L257" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">258</span><span class="line-content">         .map_err(|e| RegistryClientError::DecodeError {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier.rs#L258" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-259</span><span class="line-content">            error: format!(&quot;Failed to decode NodeOperatorRecord: {}&quot;, e),<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/registry_querier.rs#L259" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+259</span><span class="line-content">            error: format!(&quot;Failed to decode NodeOperatorRecord: {e}&quot;),<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier.rs#L259" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">260</span><span class="line-content">         })?<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier.rs#L260" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">261</span><span class="line-content">         else {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier.rs#L261" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">262</span><span class="line-content">             return Ok(None);<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier.rs#L262" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -269,7 +269,7 @@ impl RegistryQuerier {</div>
<div class="line context"><span class="line-number">269</span><span class="line-content">             version,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier.rs#L269" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">270</span><span class="line-content">         )<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier.rs#L270" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">271</span><span class="line-content">         .map_err(|e| RegistryClientError::DecodeError {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier.rs#L271" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-272</span><span class="line-content">            error: format!(&quot;Failed to decode DataCenterRecord: {}&quot;, e),<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/registry_querier.rs#L272" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+272</span><span class="line-content">            error: format!(&quot;Failed to decode DataCenterRecord: {e}&quot;),<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier.rs#L272" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">273</span><span class="line-content">         })?<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier.rs#L273" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">274</span><span class="line-content">         else {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier.rs#L274" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">275</span><span class="line-content">             return Ok(None);<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier.rs#L275" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">276</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/registry_querier/tests.rs b/rs/node_rewards/canister/src/registry_querier/tests.rs<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier.rs#L276" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">277</span><span class="line-content">index 698399c713..0272e7e2df 100644<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier.rs#L277" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/registry_querier/tests.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/registry_querier/tests.rs</div>
<div class="hunk-header">@@ -7,12 +7,12 @@ use ic_protobuf::registry::node_operator::v1::NodeOperatorRecord;</div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> use ic_protobuf::registry::node_rewards::v2::{NodeRewardRate, NodeRewardRates, NodeRewardsTable};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> use ic_protobuf::registry::subnet::v1::SubnetListRecord;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> use ic_registry_canister_client::{<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-10</span><span class="line-content">    test_registry_data_stable_memory_impl, RegistryDataStableMemory, StableCanisterRegistryClient,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-11</span><span class="line-content">    StorableRegistryKey, StorableRegistryValue,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+10</span><span class="line-content">    RegistryDataStableMemory, StableCanisterRegistryClient, StorableRegistryKey,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+11</span><span class="line-content">    StorableRegistryValue, test_registry_data_stable_memory_impl,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> use ic_registry_keys::{<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-14</span><span class="line-content">    make_subnet_list_record_key, DATA_CENTER_KEY_PREFIX, NODE_OPERATOR_RECORD_KEY_PREFIX,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-15</span><span class="line-content">    NODE_RECORD_KEY_PREFIX, NODE_REWARDS_TABLE_KEY,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+14</span><span class="line-content">    DATA_CENTER_KEY_PREFIX, NODE_OPERATOR_RECORD_KEY_PREFIX, NODE_RECORD_KEY_PREFIX,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+15</span><span class="line-content">    NODE_REWARDS_TABLE_KEY, make_subnet_list_record_key,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content"> use ic_stable_structures::memory_manager::{MemoryId, MemoryManager, VirtualMemory};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content"> use ic_stable_structures::{DefaultMemoryImpl, StableBTreeMap};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -88,7 +88,7 @@ fn generate_node_operator_key_value(</div>
<div class="line context"><span class="line-number">88</span><span class="line-content">         dc_id,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">89</span><span class="line-content">         ..NodeOperatorRecord::default()<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">90</span><span class="line-content">     };<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-91</span><span class="line-content">    let key = format!(&quot;{}{}&quot;, NODE_OPERATOR_RECORD_KEY_PREFIX, principal_id);<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+91</span><span class="line-content">    let key = format!(&quot;{NODE_OPERATOR_RECORD_KEY_PREFIX}{principal_id}&quot;);<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">92</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">93</span><span class="line-content">     (key, value)<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">94</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L94" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -99,7 +99,7 @@ fn generate_dc_key_value(dc_id: String) -&gt; (String, DataCenterRecord) {</div>
<div class="line context"><span class="line-number">99</span><span class="line-content">         region: &quot;A&quot;.to_string(),<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">100</span><span class="line-content">         ..DataCenterRecord::default()<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L100" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">101</span><span class="line-content">     };<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L101" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-102</span><span class="line-content">    let key = format!(&quot;{}{}&quot;, DATA_CENTER_KEY_PREFIX, dc_id);<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+102</span><span class="line-content">    let key = format!(&quot;{DATA_CENTER_KEY_PREFIX}{dc_id}&quot;);<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">103</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">104</span><span class="line-content">     (key, value)<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L104" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">105</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L105" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -165,7 +165,7 @@ fn node_rewardable_days(rewardable_nodes: &amp;[RewardableNode], node_id: u64) -&gt; Ve</div>
<div class="line context"><span class="line-number">165</span><span class="line-content">     rewardable_nodes<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L165" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">166</span><span class="line-content">         .iter()<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L166" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">167</span><span class="line-content">         .find(|n| n.node_id == node_id)<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L167" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-168</span><span class="line-content">        .unwrap_or_else(|| panic!(&quot;Node {} should be present&quot;, node_id))<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L168" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+168</span><span class="line-content">        .unwrap_or_else(|| panic!(&quot;Node {node_id} should be present&quot;))<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L168" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">169</span><span class="line-content">         .clone()<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L169" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">170</span><span class="line-content">         .rewardable_days<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L170" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">171</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L171" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -394,7 +394,7 @@ fn test_node_re_registered_after_deletion() {</div>
<div class="line context"><span class="line-number">394</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L394" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">395</span><span class="line-content">     // Re-register node_1 after it was deleted<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L395" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">396</span><span class="line-content">     let node_id = PrincipalId::new_node_test_id(node_1_id);<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L396" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-397</span><span class="line-content">    let node_key = format!(&quot;{}{}&quot;, NODE_RECORD_KEY_PREFIX, node_id);<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L397" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+397</span><span class="line-content">    let node_key = format!(&quot;{NODE_RECORD_KEY_PREFIX}{node_id}&quot;);<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L397" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">398</span><span class="line-content">     let node_record = NodeRecord {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L398" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">399</span><span class="line-content">         node_reward_type: Some(NodeRewardType::Type0 as i32),<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L399" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">400</span><span class="line-content">         node_operator_id: PrincipalId::new_user_test_id(no_1_id).to_vec(),<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L400" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -499,7 +499,6 @@ fn test_node_operator_data_returns_expected_data() {</div>
<div class="line context"><span class="line-number">499</span><span class="line-content">     .unwrap();<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L499" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">500</span><span class="line-content">     assert!(<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L500" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">501</span><span class="line-content">         data.is_none(),<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L501" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-502</span><span class="line-content">        &quot;Data should not exist for version {} because Operator was not yet added&quot;,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L502" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-503</span><span class="line-content">        not_yet_added_no_version<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/registry_querier/tests.rs#L503" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+502</span><span class="line-content">        &quot;Data should not exist for version {not_yet_added_no_version} because Operator was not yet added&quot;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L502" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">503</span><span class="line-content">     );<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L503" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">504</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L504" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">505</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/telemetry.rs b/rs/node_rewards/canister/src/telemetry.rs<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L505" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">506</span><span class="line-content">index 08a508d5b9..4e85ffbcb8 100644<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/registry_querier/tests.rs#L506" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/telemetry.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/telemetry.rs</div>
<div class="hunk-header">@@ -71,12 +71,9 @@ static LAST_SYNC_START_HELP: &amp;str = &quot;Last time the sync of metrics started.  If</div>
<div class="line context"><span class="line-number">71</span><span class="line-content"> static LAST_SYNC_END_HELP: &amp;str = &quot;Last time the sync of metrics ended (successfully or with failure).  If this metric is present but zero, the first sync during this canister&#x27;s current execution has not started or finished yet, either successfully or with errors.   Else, subtracting this from the last sync start should yield a positive value if the sync ended (successfully or with errors), and a negative value if the sync is still ongoing but has not finished.&quot;;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/telemetry.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">72</span><span class="line-content"> static LAST_SYNC_SUCCESS_HELP: &amp;str = &quot;Last time the sync of metrics succeeded.  If this metric is present but zero, no sync has yet succeeded during this canister&#x27;s current execution.  Else, subtracting this number from last_sync_start_timestamp_seconds gives a positive time delta when the last sync succeeded, or a negative value if either the last sync failed or a sync is currently being performed.  By definition, this and last_sync_end_timestamp_seconds will be identical when the last sync succeeded.&quot;;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/telemetry.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">73</span><span class="line-content"> static LAST_SYNC_INSTRUCTIONS_HELP: &amp;str = &quot;Count of instructions that the last sync incurred.  Label total is the sum total of instructions, and the other labels represent different phases.&quot;;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/telemetry.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-74</span><span class="line-content">static QUERY_CALL_INSTRUCTIONS_HELP: &amp;str =<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/telemetry.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-75</span><span class="line-content">    &quot;Count of instructions for the query call as labeled by the method being invoked.  Query calls are exercised hourly unless stated otherwise.&quot;;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/telemetry.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-76</span><span class="line-content">static QUERY_CALL_SUCCESS_HELP: &amp;str =<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/telemetry.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-77</span><span class="line-content">    &quot;Whether the the query call as labeled by the method being invoked was successful.  Query calls are exercised hourly unless stated otherwise.&quot;;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/telemetry.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-78</span><span class="line-content">static QUERY_CALL_RESPONSE_SIZE_BYTES_HELP: &amp;str =<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/telemetry.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-79</span><span class="line-content">    &quot;The size in bytes of the response generated by the query call.  Query calls are exercised hourly unless stated otherwise.&quot;;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/src/telemetry.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+74</span><span class="line-content">static QUERY_CALL_INSTRUCTIONS_HELP: &amp;str = &quot;Count of instructions for the query call as labeled by the method being invoked.  Query calls are exercised hourly unless stated otherwise.&quot;;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/telemetry.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+75</span><span class="line-content">static QUERY_CALL_SUCCESS_HELP: &amp;str = &quot;Whether the the query call as labeled by the method being invoked was successful.  Query calls are exercised hourly unless stated otherwise.&quot;;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/telemetry.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+76</span><span class="line-content">static QUERY_CALL_RESPONSE_SIZE_BYTES_HELP: &amp;str = &quot;The size in bytes of the response generated by the query call.  Query calls are exercised hourly unless stated otherwise.&quot;;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/telemetry.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">77</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/telemetry.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">78</span><span class="line-content"> impl&lt;&#x27;b&gt; PrometheusMetrics&lt;&#x27;b&gt; {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/telemetry.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">79</span><span class="line-content">     fn new() -&gt; Self {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/telemetry.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">80</span><span class="line-content">diff --git a/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs b/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/telemetry.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">81</span><span class="line-content">index fb5983a549..c475ed4ceb 100644<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/src/telemetry.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs</div>
<div class="hunk-header">@@ -1,6 +1,6 @@</div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> use candid::{Encode, Principal};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content">use ic_nervous_system_agent::nns::node_rewards::get_node_providers_monthly_xdr_rewards;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use ic_nervous_system_agent::AgentFor;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+3</span><span class="line-content">use ic_nervous_system_agent::nns::node_rewards::get_node_providers_monthly_xdr_rewards;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use ic_nns_constants::NODE_REWARDS_CANISTER_ID;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use ic_nns_test_utils::common::build_node_rewards_test_wasm;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use ic_node_rewards_canister_api::monthly_rewards::GetNodeProvidersMonthlyXdrRewardsRequest;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -8,9 +8,9 @@ use ic_node_rewards_canister_api::provider_rewards_calculation::{</div>
<div class="line context"><span class="line-number">8</span><span class="line-content">     GetNodeProviderRewardsCalculationRequest, GetNodeProviderRewardsCalculationResponse,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> use ic_types::PrincipalId;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-11</span><span class="line-content">use pocket_ic::common::rest::{IcpFeatures, IcpFeaturesConfig};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-12</span><span class="line-content">use pocket_ic::nonblocking::{query_candid, update_candid, PocketIc};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> use pocket_ic::PocketIcBuilder;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+12</span><span class="line-content">use pocket_ic::common::rest::{IcpFeatures, IcpFeaturesConfig};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+13</span><span class="line-content">use pocket_ic::nonblocking::{PocketIc, query_candid, update_candid};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> use std::time::Duration;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> async fn setup_env() -&gt; PocketIc {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -57,8 +57,7 @@ async fn get_node_providers_monthly_xdr_rewards_is_only_callable_by_governance()</div>
<div class="line context"><span class="line-number">57</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">58</span><span class="line-content">     assert!(<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">59</span><span class="line-content">         error.contains(&quot;Only the governance canister can call this method&quot;),<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-60</span><span class="line-content">        &quot;Expected error message not found, was {}&quot;,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-61</span><span class="line-content">        error<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+60</span><span class="line-content">        &quot;Expected error message not found, was {error}&quot;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">61</span><span class="line-content">     );<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">62</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">63</span><span class="line-content">     let governance_agent = pocket_ic.agent_for(ic_nns_constants::GOVERNANCE_CANISTER_ID.get());<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">64</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">65</span><span class="line-content">index 4a2b82bd5f..3977717337 100644<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs</div>
<div class="hunk-header">@@ -10,8 +10,8 @@ use ic_protobuf::registry::node::v1::NodeRewardType;</div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> use ic_protobuf::registry::node_rewards::v2::NodeRewardsTable;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> use ic_types::Time;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> use itertools::Itertools;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-13</span><span class="line-content">use rust_decimal::prelude::ToPrimitive;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> use rust_decimal::Decimal;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+14</span><span class="line-content">use rust_decimal::prelude::ToPrimitive;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> use rust_decimal_macros::dec;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> use std::cmp::max;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content"> use std::collections::BTreeMap;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content">index 06e233718f..63a9a5ccbc 100644<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs</div>
<div class="hunk-header">@@ -54,12 +54,12 @@ impl RewardsCalculationV1 {</div>
<div class="line context"><span class="line-number">54</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">55</span><span class="line-content"> mod tests {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">56</span><span class="line-content">     #![allow(dead_code)]<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+57</span><span class="line-content">    use crate::performance_based_algorithm::PerformanceBasedAlgorithm;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">58</span><span class="line-content">     use crate::performance_based_algorithm::test_utils::{<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-58</span><span class="line-content">        build_daily_metrics, create_rewards_table_for_region_test, generate_rewardable_nodes,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-59</span><span class="line-content">        test_node_id, test_subnet_id, RewardableNode,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+59</span><span class="line-content">        RewardableNode, build_daily_metrics, create_rewards_table_for_region_test,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+60</span><span class="line-content">        generate_rewardable_nodes, test_node_id, test_subnet_id,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">61</span><span class="line-content">     };<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">62</span><span class="line-content">     use crate::performance_based_algorithm::v1::RewardsCalculationV1;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-62</span><span class="line-content">    use crate::performance_based_algorithm::PerformanceBasedAlgorithm;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">63</span><span class="line-content">     use crate::performance_based_algorithm::{AdjustedRewardsResults, BaseRewardsResults};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">64</span><span class="line-content">     use ic_protobuf::registry::node::v1::NodeRewardType;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">65</span><span class="line-content">     use maplit::btreemap;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">66</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/rewards_calculator/mod.rs b/rs/node_rewards/rewards_calculation/src/rewards_calculator/mod.rs<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">67</span><span class="line-content">index 9a5f9d77a6..31ef7811fc 100644<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/rewards_calculator/mod.rs</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/rewards_calculator/mod.rs</div>
<div class="hunk-header">@@ -10,8 +10,8 @@ use ic_base_types::{NodeId, PrincipalId, SubnetId};</div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> use ic_protobuf::registry::node::v1::NodeRewardType;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/mod.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> use ic_protobuf::registry::node_rewards::v2::NodeRewardsTable;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/mod.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> use itertools::Itertools;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/mod.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-13</span><span class="line-content">use rust_decimal::prelude::ToPrimitive;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/rewards_calculation/src/rewards_calculator/mod.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> use rust_decimal::Decimal;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/mod.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+14</span><span class="line-content">use rust_decimal::prelude::ToPrimitive;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/mod.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> use rust_decimal_macros::dec;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/mod.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> use std::cmp::max;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/mod.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content"> use std::collections::{BTreeMap, HashMap, HashSet};<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/mod.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs b/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/mod.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content">index 978d4dafdd..c588dac7ee 100644<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/mod.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs</div>
<div class="hunk-header">@@ -332,9 +332,7 @@ fn test_adjust_nodes_rewards() {</div>
<div class="line context"><span class="line-number">332</span><span class="line-content">         assert_eq!(<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L332" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">333</span><span class="line-content">             adjusted_rewards.get(&amp;(day1, *node)),<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L333" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">334</span><span class="line-content">             Some(&amp;expected),<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L334" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-335</span><span class="line-content">            &quot;Unexpected reward for node {:?} on day {:?}&quot;,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L335" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-336</span><span class="line-content">            node,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L336" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-337</span><span class="line-content">            day1<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L337" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+335</span><span class="line-content">            &quot;Unexpected reward for node {node:?} on day {day1:?}&quot;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L335" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">336</span><span class="line-content">         );<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L336" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">337</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L337" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">338</span><span class="line-content">     // Case 2: fewer than 4 nodes (3 on day2), all assigned penalty applies<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L338" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -342,9 +340,7 @@ fn test_adjust_nodes_rewards() {</div>
<div class="line context"><span class="line-number">340</span><span class="line-content">         assert_eq!(<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L340" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">341</span><span class="line-content">             adjusted_rewards.get(&amp;(day2, *node)),<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L341" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">342</span><span class="line-content">             Some(&amp;expected),<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L342" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-345</span><span class="line-content">            &quot;Unexpected reward for node {:?} on day {:?}&quot;,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L345" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-346</span><span class="line-content">            node,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L346" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-347</span><span class="line-content">            day2<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L347" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+343</span><span class="line-content">            &quot;Unexpected reward for node {node:?} on day {day2:?}&quot;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L343" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">344</span><span class="line-content">         );<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L344" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">345</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L345" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">346</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L346" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -354,9 +350,7 @@ fn test_adjust_nodes_rewards() {</div>
<div class="line context"><span class="line-number">350</span><span class="line-content">         assert_eq!(<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L350" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">351</span><span class="line-content">             adjusted_rewards.get(&amp;(day3, *node)),<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L351" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">352</span><span class="line-content">             Some(&amp;expected),<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L352" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-357</span><span class="line-content">            &quot;Unexpected reward for node {:?} on day {:?}&quot;,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L357" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-358</span><span class="line-content">            node,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L358" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-359</span><span class="line-content">            day3<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L359" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+353</span><span class="line-content">            &quot;Unexpected reward for node {node:?} on day {day3:?}&quot;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L353" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">354</span><span class="line-content">         );<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L354" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">355</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L355" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">356</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L356" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">357</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs b/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L357" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">358</span><span class="line-content">index 0440b9f4f7..35dbfbfaa1 100644<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator/tests.rs#L358" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs</div>
<div class="hunk-header">@@ -132,20 +132,16 @@ impl fmt::Display for RewardCalculatorError {</div>
<div class="line context"><span class="line-number">132</span><span class="line-content">                 )<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs#L132" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">133</span><span class="line-content">             }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs#L133" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">134</span><span class="line-content">             RewardCalculatorError::RewardPeriodError(err) =&gt; {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs#L134" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-135</span><span class="line-content">                write!(f, &quot;Reward period error: {}&quot;, err)<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs#L135" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+135</span><span class="line-content">                write!(f, &quot;Reward period error: {err}&quot;)<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs#L135" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">136</span><span class="line-content">             }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs#L136" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">137</span><span class="line-content">             RewardCalculatorError::ProviderNotFound(provider_id) =&gt; {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs#L137" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-138</span><span class="line-content">                write!(f, &quot;Node Provider: {} not found&quot;, provider_id)<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs#L138" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+138</span><span class="line-content">                write!(f, &quot;Node Provider: {provider_id} not found&quot;)<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs#L138" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">139</span><span class="line-content">             }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs#L139" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">140</span><span class="line-content">             RewardCalculatorError::NodeNotInRewardables(node_id) =&gt; {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs#L140" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-141</span><span class="line-content">                write!(f, &quot;Node: {} has metrics but is not rewardable&quot;, node_id)<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs#L141" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+141</span><span class="line-content">                write!(f, &quot;Node: {node_id} has metrics but is not rewardable&quot;)<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs#L141" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">142</span><span class="line-content">             }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs#L142" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">143</span><span class="line-content">             RewardCalculatorError::RewardableNodeOutOfRange(node_id) =&gt; {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs#L143" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-144</span><span class="line-content">                write!(<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs#L144" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-145</span><span class="line-content">                    f,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs#L145" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-146</span><span class="line-content">                    &quot;Node: {} is not rewardable in the reward period&quot;,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-147</span><span class="line-content">                    node_id<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs#L147" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-148</span><span class="line-content">                )<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs#L148" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+144</span><span class="line-content">                write!(f, &quot;Node: {node_id} is not rewardable in the reward period&quot;)<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs#L144" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">145</span><span class="line-content">             }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs#L145" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">146</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">147</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs#L147" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">148</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/types.rs b/rs/node_rewards/rewards_calculation/src/types.rs<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs#L148" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">149</span><span class="line-content">index 7ad33e89bd..61159260b0 100644<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/rewards_calculator_results.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/types.rs</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/types.rs</div>
<div class="hunk-header">@@ -30,7 +30,7 @@ impl TryFrom&lt;&amp;str&gt; for DayUtc {</div>
<div class="line context"><span class="line-number">30</span><span class="line-content">     type Error = ParseError;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/types.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">31</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/types.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">32</span><span class="line-content">     fn try_from(value: &amp;str) -&gt; Result&lt;Self, Self::Error&gt; {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/types.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-33</span><span class="line-content">        let dt = format!(&quot;{} 00:00:00&quot;, value);<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/rewards_calculation/src/types.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+33</span><span class="line-content">        let dt = format!(&quot;{value} 00:00:00&quot;);<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/types.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">34</span><span class="line-content">         let naive = NaiveDateTime::parse_from_str(&amp;dt, &quot;%Y-%m-%d %H:%M:%S&quot;)?;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/types.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">35</span><span class="line-content">         let datetime: DateTime&lt;Utc&gt; = DateTime::from_naive_utc_and_offset(naive, Utc);<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/types.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">36</span><span class="line-content">         let ts = datetime.timestamp_nanos_opt().unwrap() as u64;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/types.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -52,7 +52,7 @@ impl Display for DayUtc {</div>
<div class="line context"><span class="line-number">52</span><span class="line-content">             .format(&quot;%d-%m-%Y&quot;)<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/types.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">53</span><span class="line-content">             .to_string();<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/types.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">54</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/types.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-55</span><span class="line-content">        write!(f, &quot;{}&quot;, dd_mm_yyyy)<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/node_rewards/rewards_calculation/src/types.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+55</span><span class="line-content">        write!(f, &quot;{dd_mm_yyyy}&quot;)<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/types.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">56</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/types.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">57</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/types.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">58</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/types.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">59</span><span class="line-content">diff --git a/rs/registry/node_provider_rewards/src/lib.rs b/rs/registry/node_provider_rewards/src/lib.rs<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/types.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">60</span><span class="line-content">index cfbe1d52e2..0efc64b0f0 100644<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/node_rewards/rewards_calculation/src/types.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/registry/node_provider_rewards/src/lib.rs</div>
<div class="file-header">+++ b/rs/registry/node_provider_rewards/src/lib.rs</div>
<div class="hunk-header">@@ -31,17 +31,15 @@ pub fn calculate_rewards_v0(</div>
<div class="line context"><span class="line-number">31</span><span class="line-content">         let node_operator_id = PrincipalId::try_from(&amp;node_operator.node_operator_principal_id)<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/lib.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">32</span><span class="line-content">             .map_err(|e| {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/lib.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">33</span><span class="line-content">                 format!(<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/lib.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-34</span><span class="line-content">                    &quot;Node Operator key &#x27;{:?}&#x27; cannot be parsed as a PrincipalId: &#x27;{}&#x27;&quot;,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/registry/node_provider_rewards/src/lib.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-35</span><span class="line-content">                    key_string, e<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/registry/node_provider_rewards/src/lib.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+34</span><span class="line-content">                    &quot;Node Operator key &#x27;{key_string:?}&#x27; cannot be parsed as a PrincipalId: &#x27;{e}&#x27;&quot;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/lib.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">35</span><span class="line-content">                 )<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/lib.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">36</span><span class="line-content">             })?;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/lib.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">37</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/lib.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">38</span><span class="line-content">         let node_provider_id = PrincipalId::try_from(&amp;node_operator.node_provider_principal_id)<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/lib.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">39</span><span class="line-content">             .map_err(|e| {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/lib.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">40</span><span class="line-content">                 format!(<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/lib.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-42</span><span class="line-content">                    &quot;Node Operator with key &#x27;{}&#x27; has a node_provider_principal_id \<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/registry/node_provider_rewards/src/lib.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-43</span><span class="line-content">                                 that cannot be parsed as a PrincipalId: &#x27;{}&#x27;&quot;,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/registry/node_provider_rewards/src/lib.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-44</span><span class="line-content">                    node_operator_id, e<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/registry/node_provider_rewards/src/lib.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+41</span><span class="line-content">                    &quot;Node Operator with key &#x27;{node_operator_id}&#x27; has a node_provider_principal_id \<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/lib.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+42</span><span class="line-content">                                 that cannot be parsed as a PrincipalId: &#x27;{e}&#x27;&quot;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/lib.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">43</span><span class="line-content">                 )<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/lib.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">44</span><span class="line-content">             })?;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/lib.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">45</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/lib.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">46</span><span class="line-content">diff --git a/rs/registry/node_provider_rewards/src/logs.rs b/rs/registry/node_provider_rewards/src/logs.rs<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/lib.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">47</span><span class="line-content">index 9d90e1524a..39811537ea 100644<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/lib.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/registry/node_provider_rewards/src/logs.rs</div>
<div class="file-header">+++ b/rs/registry/node_provider_rewards/src/logs.rs</div>
<div class="hunk-header">@@ -37,8 +37,7 @@ impl std::fmt::Display for LogEntry {</div>
<div class="line context"><span class="line-number">37</span><span class="line-content">                 write!(<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/logs.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">38</span><span class="line-content">                     f,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/logs.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">39</span><span class="line-content">                     &quot;The Node Rewards Table does not have an entry for \<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/logs.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-40</span><span class="line-content">                    node type &#x27;{}&#x27; within region &#x27;{}&#x27; or parent region, defaulting to 1 xdr per month per node, for Node Operator &#x27;{}&#x27;&quot;,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/registry/node_provider_rewards/src/logs.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-41</span><span class="line-content">                    region, node_type, node_operator_id<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/registry/node_provider_rewards/src/logs.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+40</span><span class="line-content">                    node type &#x27;{region}&#x27; within region &#x27;{node_type}&#x27; or parent region, defaulting to 1 xdr per month per node, for Node Operator &#x27;{node_operator_id}&#x27;&quot;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/logs.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">41</span><span class="line-content">                 )<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/logs.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">42</span><span class="line-content">             }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/logs.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">43</span><span class="line-content">             LogEntry::NodeRewards {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/logs.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -49,8 +48,7 @@ impl std::fmt::Display for LogEntry {</div>
<div class="line context"><span class="line-number">48</span><span class="line-content">                 rewards_xdr_permyriad,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/logs.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">49</span><span class="line-content">             } =&gt; write!(<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/logs.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">50</span><span class="line-content">                 f,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/logs.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-52</span><span class="line-content">                &quot;{}/{} {} node in {} DC: rewarded {}&quot;,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/registry/node_provider_rewards/src/logs.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-53</span><span class="line-content">                node_idx, rewardable_count, node_type, dc_id, rewards_xdr_permyriad<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/registry/node_provider_rewards/src/logs.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+51</span><span class="line-content">                &quot;{node_idx}/{rewardable_count} {node_type} node in {dc_id} DC: rewarded {rewards_xdr_permyriad}&quot;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/logs.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">52</span><span class="line-content">             ),<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/logs.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">53</span><span class="line-content">             LogEntry::DCRewards {<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/logs.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">54</span><span class="line-content">                 dc_id,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/logs.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -59,8 +57,7 @@ impl std::fmt::Display for LogEntry {</div>
<div class="line context"><span class="line-number">57</span><span class="line-content">                 rewards_xdr_permyriad,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/logs.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">58</span><span class="line-content">             } =&gt; write!(<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/logs.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">59</span><span class="line-content">                 f,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/logs.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-62</span><span class="line-content">                &quot;Rewards for all {} {} nodes in {} DC: reward {}&quot;,<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/registry/node_provider_rewards/src/logs.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-63</span><span class="line-content">                rewardable_count, node_type, dc_id, rewards_xdr_permyriad<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3~1/rs/registry/node_provider_rewards/src/logs.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+60</span><span class="line-content">                &quot;Rewards for all {rewardable_count} {node_type} nodes in {dc_id} DC: reward {rewards_xdr_permyriad}&quot;<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/logs.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">61</span><span class="line-content">             ),<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/logs.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">62</span><span class="line-content">         }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/logs.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">63</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/b9221277cd5e0dc9a2cd5af5ed7ddc9aff10e7a3/rs/registry/node_provider_rewards/src/logs.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="commit-detail">
                    <div class="commit-header">
                        <div class="commit-title">
                            <a href="https://github.com/dfinity/ic/commit/0226e886d73fa5396d39d71d297e2527cb8cb43f" class="commit-hash-large" target="_blank">0226e886d73fa5396d39d71d297e2527cb8cb43f</a>
                            <span class="badge feat">feat</span>
                        </div>
                        <div class="commit-meta">
                            <span>👤 pietrodimarco-dfinity &lt;124565147+pietrodimarco-dfinity@users.noreply.github.com&gt;</span>
                            <span>📅 2025-09-12</span>
                            <span>📁 5 files</span>
                        </div>
                        <div style="margin-top: 8px; color: #e6edf3; font-size: 0.9em;">
                            feat(NRC): Refactor rewards calculator to compute daily rewards (#6724)
                        </div>
                        <div class="commit-actions">
                            <button class="toggle-button secondary" onclick="toggleFiles('files-10')">📁 Files (5)</button>
                            <button class="toggle-button" onclick="toggleDiff('diff-10')">🔍 Code Changes</button>
                        </div>
                        <div id="files-10" class="collapsible">
                            <div class="files-list">
                                <ul><li>rs/node_rewards/rewards_calculation/src/lib.rs</li><li>rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs</li><li>rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs</li><li>rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs</li><li>rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs</li></ul></div></div>
                        <div id="diff-10" class="collapsible">
                            <div class="diff-container">
                                <div class="line context"><span class="line-number">1</span><span class="line-content">commit 0226e886d73fa5396d39d71d297e2527cb8cb43f</span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content">Author: pietrodimarco-dfinity &lt;124565147+pietrodimarco-dfinity@users.noreply.github.com&gt;</span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content">Date:   Fri Sep 12 10:01:45 2025 +0200</span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content">    feat(NRC): Refactor rewards calculator to compute daily rewards (#6724)</span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/lib.rs b/rs/node_rewards/rewards_calculation/src/lib.rs</span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content">index 78c1b3dabd..f198983a33 100644</span></div>
<div class="file-header">--- a/rs/node_rewards/rewards_calculation/src/lib.rs</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/lib.rs</div>
<div class="hunk-header">@@ -1,3 +1,4 @@</div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">mod performance_based_algorithm;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/lib.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> pub mod rewards_calculator;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/lib.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> pub mod rewards_calculator_results;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/lib.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> pub mod types;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/lib.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/lib.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content">new file mode 100644<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/lib.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content">index 0000000000..4a2b82bd5f<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/lib.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- /dev/null</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs</div>
<div class="hunk-header">@@ -0,0 +1,627 @@</div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">#![allow(dead_code)]<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+2</span><span class="line-content">use crate::performance_based_algorithm::results::{<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+3</span><span class="line-content">    BaseRewards, BaseRewardsType3, DailyResults, NodeMetricsDaily, NodeProviderRewards,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+4</span><span class="line-content">    NodeResults, NodeStatus, Percent, RewardsCalculatorResults, XDRPermyriad,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+5</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+6</span><span class="line-content">use crate::performance_based_algorithm::test_utils::RewardableNode;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+7</span><span class="line-content">use crate::types::{DayUtc, NodeMetricsDailyRaw, Region};<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content">use ic_base_types::{NodeId, PrincipalId, SubnetId};<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+9</span><span class="line-content">use ic_protobuf::registry::node::v1::NodeRewardType;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+10</span><span class="line-content">use ic_protobuf::registry::node_rewards::v2::NodeRewardsTable;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+11</span><span class="line-content">use ic_types::Time;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+12</span><span class="line-content">use itertools::Itertools;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+13</span><span class="line-content">use rust_decimal::prelude::ToPrimitive;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+14</span><span class="line-content">use rust_decimal::Decimal;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+15</span><span class="line-content">use rust_decimal_macros::dec;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+16</span><span class="line-content">use std::cmp::max;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+17</span><span class="line-content">use std::collections::BTreeMap;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+18</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+19</span><span class="line-content">pub mod results;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+20</span><span class="line-content">mod test_utils;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+21</span><span class="line-content">pub mod v1;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+22</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+23</span><span class="line-content">// ================================================================================================<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+24</span><span class="line-content">// VERSIONING SAFETY WARNING<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+25</span><span class="line-content">// ================================================================================================<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+26</span><span class="line-content">//<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+27</span><span class="line-content">// This PerformanceBasedAlgorithm trait defines the core reward calculation interface.<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+28</span><span class="line-content">//<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+29</span><span class="line-content">// The trait methods in this module should NOT be modified directly as they serve as the<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+30</span><span class="line-content">// stable API contract for all reward calculation versions. Instead, new algorithm versions<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+31</span><span class="line-content">// should be created by implementing this trait with different behavior, as demonstrated<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+32</span><span class="line-content">// by RewardsCalculationV1.<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+33</span><span class="line-content">//<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+34</span><span class="line-content">// This approach ensures:<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+35</span><span class="line-content">//<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+36</span><span class="line-content">// 1. **API Stability**: The trait interface remains consistent across versions<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+37</span><span class="line-content">// 2. **Backward Compatibility**: Existing implementations continue to work<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+38</span><span class="line-content">// 3. **Version Isolation**: Each version can have its own calculation logic<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+39</span><span class="line-content">// 4. **Historical Reproducibility**: Past calculations remain verifiable<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+40</span><span class="line-content">//<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+41</span><span class="line-content">//<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+42</span><span class="line-content">// To create a new algorithm version:<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+43</span><span class="line-content">// 1. Create a new module (e.g., v2.rs)<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+44</span><span class="line-content">// 2. Implement the PerformanceBasedAlgorithm trait<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+45</span><span class="line-content">// 3. Override only the methods that need different behavior<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+46</span><span class="line-content">// 4. Keep the same trait interface for compatibility<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+47</span><span class="line-content">// ================================================================================================<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+48</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+49</span><span class="line-content">#[derive(Default)]<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+50</span><span class="line-content">struct FailureRateResults {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+51</span><span class="line-content">    subnets_fr: BTreeMap&lt;SubnetId, Percent&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+52</span><span class="line-content">    nodes_metrics_daily: BTreeMap&lt;NodeId, NodeMetricsDaily&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+53</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+54</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+55</span><span class="line-content">#[derive(Default)]<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+56</span><span class="line-content">struct PerformanceMultiplierResults {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+57</span><span class="line-content">    reward_reduction: BTreeMap&lt;NodeId, Percent&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+58</span><span class="line-content">    performance_multiplier: BTreeMap&lt;NodeId, Percent&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+59</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+60</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+61</span><span class="line-content">#[derive(Default)]<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+62</span><span class="line-content">struct BaseRewardsResults {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+63</span><span class="line-content">    base_rewards: Vec&lt;BaseRewards&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+64</span><span class="line-content">    base_rewards_type3: Vec&lt;BaseRewardsType3&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+65</span><span class="line-content">    base_rewards_per_node: BTreeMap&lt;NodeId, XDRPermyriad&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+66</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+67</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+68</span><span class="line-content">type RewardsCoefficientPercent = Decimal;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+69</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+70</span><span class="line-content">#[derive(Default)]<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+71</span><span class="line-content">struct AdjustedRewardsResults {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+72</span><span class="line-content">    adjusted_rewards: BTreeMap&lt;NodeId, XDRPermyriad&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+73</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+74</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+75</span><span class="line-content">#[cfg(target_arch = &quot;wasm32&quot;)]<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+76</span><span class="line-content">fn current_time() -&gt; Time {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+77</span><span class="line-content">    let current_time = ic_cdk::api::time();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+78</span><span class="line-content">    Time::from_nanos_since_unix_epoch(current_time)<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+79</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+80</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+81</span><span class="line-content">#[cfg(not(any(target_arch = &quot;wasm32&quot;)))]<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+82</span><span class="line-content">fn current_time() -&gt; Time {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+83</span><span class="line-content">    ic_types::time::current_time()<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+84</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+85</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+86</span><span class="line-content">pub trait DataProvider {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+87</span><span class="line-content">    fn get_rewards_table(&amp;self, day: &amp;DayUtc) -&gt; Result&lt;NodeRewardsTable, String&gt;;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+88</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+89</span><span class="line-content">    fn get_daily_metrics_by_subnet(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+90</span><span class="line-content">        &amp;self,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+91</span><span class="line-content">        day: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+92</span><span class="line-content">    ) -&gt; Result&lt;BTreeMap&lt;SubnetId, Vec&lt;NodeMetricsDailyRaw&gt;&gt;, String&gt;;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+93</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+94</span><span class="line-content">    fn get_rewardable_nodes(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L94" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+95</span><span class="line-content">        &amp;self,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+96</span><span class="line-content">        day: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L96" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+97</span><span class="line-content">    ) -&gt; Result&lt;BTreeMap&lt;PrincipalId, Vec&lt;RewardableNode&gt;&gt;, String&gt;;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+98</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L98" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+99</span><span class="line-content">    fn get_provider_rewardable_nodes(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+100</span><span class="line-content">        &amp;self,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L100" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+101</span><span class="line-content">        day: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L101" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+102</span><span class="line-content">        provider_id: &amp;PrincipalId,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+103</span><span class="line-content">    ) -&gt; Result&lt;BTreeMap&lt;PrincipalId, Vec&lt;RewardableNode&gt;&gt;, String&gt;;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+104</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L104" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+105</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L105" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+106</span><span class="line-content">trait PerformanceBasedAlgorithm {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L106" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+107</span><span class="line-content">    /// The percentile used to calculate the failure rate for a subnet.<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L107" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+108</span><span class="line-content">    const SUBNET_FAILURE_RATE_PERCENTILE: f64;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L108" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+109</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L109" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+110</span><span class="line-content">    /// The minimum and maximum failure rates for a node.<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L110" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+111</span><span class="line-content">    /// Nodes with a failure rate below `MIN_FAILURE_RATE` will not be penalized.<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L111" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+112</span><span class="line-content">    const MIN_FAILURE_RATE: Decimal;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L112" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+113</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L113" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+114</span><span class="line-content">    /// The maximum failure rate for a node.<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L114" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+115</span><span class="line-content">    /// Nodes with a failure rate above `MAX_FAILURE_RATE` will be penalized with `MAX_REWARDS_REDUCTION`.<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L115" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+116</span><span class="line-content">    const MAX_FAILURE_RATE: Decimal;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L116" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+117</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L117" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+118</span><span class="line-content">    /// The minimum rewards reduction for a node.<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L118" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+119</span><span class="line-content">    const MIN_REWARDS_REDUCTION: Decimal;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L119" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+120</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L120" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+121</span><span class="line-content">    /// The maximum rewards reduction for a node.<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L121" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+122</span><span class="line-content">    const MAX_REWARDS_REDUCTION: Decimal;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L122" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+123</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L123" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+124</span><span class="line-content">    /// From constant [NODE_PROVIDER_REWARD_PERIOD_SECONDS]<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L124" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+125</span><span class="line-content">    /// const NODE_PROVIDER_REWARD_PERIOD_SECONDS: u64 = 2629800;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L125" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+126</span><span class="line-content">    /// const SECONDS_IN_DAY: u64 = 86400;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L126" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+127</span><span class="line-content">    /// 2629800 / 86400 = 30.4375 days of rewards<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L127" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+128</span><span class="line-content">    const REWARDS_TABLE_DAYS: Decimal = dec!(30.4375);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L128" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+129</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L129" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+130</span><span class="line-content">    fn validate_reward_period(from_day: &amp;DayUtc, to_day: &amp;DayUtc) -&gt; Result&lt;(), String&gt; {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L130" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+131</span><span class="line-content">        let today: DayUtc = current_time().as_nanos_since_unix_epoch().into();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L131" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+132</span><span class="line-content">        if from_day &gt; to_day {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L132" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+133</span><span class="line-content">            return Err(&quot;from_day must be before to_day&quot;.to_string());<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L133" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+134</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L134" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+135</span><span class="line-content">        if to_day &gt;= &amp;today {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L135" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+136</span><span class="line-content">            return Err(&quot;to_day_timestamp_nanos must be earlier than today&quot;.to_string());<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L136" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+137</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L137" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+138</span><span class="line-content">        Ok(())<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L138" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+139</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L139" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+140</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L140" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+141</span><span class="line-content">    fn calculate_rewards(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L141" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+142</span><span class="line-content">        from_day: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L142" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+143</span><span class="line-content">        to_day: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L143" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+144</span><span class="line-content">        node_provider_filter: Option&lt;PrincipalId&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L144" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+145</span><span class="line-content">        data_provider: impl DataProvider,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L145" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+146</span><span class="line-content">    ) -&gt; Result&lt;RewardsCalculatorResults, String&gt; {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+147</span><span class="line-content">        Self::validate_reward_period(from_day, to_day)?;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L147" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+148</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L148" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+149</span><span class="line-content">        let reward_period = from_day.days_until(to_day)?;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+150</span><span class="line-content">        let mut total_rewards_per_provider = BTreeMap::new();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L150" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+151</span><span class="line-content">        let mut daily_results = BTreeMap::new();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L151" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+152</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L152" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+153</span><span class="line-content">        // Process each day in the reward period<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L153" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+154</span><span class="line-content">        for day in reward_period {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L154" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+155</span><span class="line-content">            let result_for_day =<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L155" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+156</span><span class="line-content">                Self::calculate_daily_rewards(&amp;data_provider, &amp;day, &amp;node_provider_filter)?;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L156" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+157</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L157" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+158</span><span class="line-content">            // Accumulate total rewards per provider across all days<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L158" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+159</span><span class="line-content">            for (provider_id, provider_rewards) in &amp;result_for_day.provider_results {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L159" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+160</span><span class="line-content">                total_rewards_per_provider<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L160" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+161</span><span class="line-content">                    .entry(*provider_id)<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L161" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+162</span><span class="line-content">                    .and_modify(|total| *total += provider_rewards.rewards_total)<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L162" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+163</span><span class="line-content">                    .or_insert(provider_rewards.rewards_total);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L163" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+164</span><span class="line-content">            }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L164" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+165</span><span class="line-content">            daily_results.insert(day, result_for_day);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L165" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+166</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L166" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+167</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L167" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+168</span><span class="line-content">        let total_rewards_xdr_permyriad = total_rewards_per_provider<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L168" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+169</span><span class="line-content">            .into_iter()<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L169" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+170</span><span class="line-content">            .map(|(provider_id, total)| (provider_id, total.trunc().to_u64().unwrap()))<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L170" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+171</span><span class="line-content">            .collect();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L171" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+172</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L172" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+173</span><span class="line-content">        Ok(RewardsCalculatorResults {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L173" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+174</span><span class="line-content">            total_rewards_xdr_permyriad,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L174" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+175</span><span class="line-content">            daily_results,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L175" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+176</span><span class="line-content">        })<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L176" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+177</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L177" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+178</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L178" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+179</span><span class="line-content">    fn calculate_daily_rewards(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L179" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+180</span><span class="line-content">        data_provider: &amp;impl DataProvider,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L180" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+181</span><span class="line-content">        day: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L181" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+182</span><span class="line-content">        node_provider_filter: &amp;Option&lt;PrincipalId&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L182" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+183</span><span class="line-content">    ) -&gt; Result&lt;DailyResults, String&gt; {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L183" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+184</span><span class="line-content">        let rewards_table = data_provider.get_rewards_table(day)?;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L184" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+185</span><span class="line-content">        let metrics_by_subnet = data_provider.get_daily_metrics_by_subnet(day)?;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L185" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+186</span><span class="line-content">        let providers_rewardable_nodes = if let Some(provider_id) = node_provider_filter {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L186" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+187</span><span class="line-content">            data_provider.get_provider_rewardable_nodes(day, provider_id)?<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L187" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+188</span><span class="line-content">        } else {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L188" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+189</span><span class="line-content">            data_provider.get_rewardable_nodes(day)?<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L189" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+190</span><span class="line-content">        };<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L190" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+191</span><span class="line-content">        let mut results_per_provider = BTreeMap::new();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L191" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+192</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L192" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+193</span><span class="line-content">        // Calculate failure rates for subnets and individual nodes<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L193" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+194</span><span class="line-content">        let FailureRateResults {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L194" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+195</span><span class="line-content">            subnets_fr,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L195" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+196</span><span class="line-content">            mut nodes_metrics_daily,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L196" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+197</span><span class="line-content">        } = Self::calculate_failure_rates(metrics_by_subnet);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L197" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+198</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L198" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+199</span><span class="line-content">        // Process each provider&#x27;s nodes<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L199" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+200</span><span class="line-content">        for (provider_id, rewardable_nodes) in providers_rewardable_nodes {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L200" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+201</span><span class="line-content">            let provider_results = Self::calculate_provider_rewards(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L201" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+202</span><span class="line-content">                &amp;rewards_table,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L202" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+203</span><span class="line-content">                &amp;mut nodes_metrics_daily,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L203" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+204</span><span class="line-content">                rewardable_nodes,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L204" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+205</span><span class="line-content">            );<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L205" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+206</span><span class="line-content">            results_per_provider.insert(provider_id, provider_results);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L206" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+207</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L207" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+208</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L208" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+209</span><span class="line-content">        Ok(DailyResults {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L209" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+210</span><span class="line-content">            subnets_fr,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L210" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+211</span><span class="line-content">            provider_results: results_per_provider,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L211" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+212</span><span class="line-content">        })<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L212" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+213</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L213" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+214</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L214" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+215</span><span class="line-content">    fn calculate_provider_rewards(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L215" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+216</span><span class="line-content">        rewards_table: &amp;NodeRewardsTable,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L216" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+217</span><span class="line-content">        nodes_metrics_daily: &amp;mut BTreeMap&lt;NodeId, NodeMetricsDaily&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L217" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+218</span><span class="line-content">        rewardable_nodes: Vec&lt;RewardableNode&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L218" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+219</span><span class="line-content">    ) -&gt; NodeProviderRewards {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L219" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+220</span><span class="line-content">        let mut provider_nodes_metrics_daily = BTreeMap::new();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L220" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+221</span><span class="line-content">        for node in &amp;rewardable_nodes {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L221" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+222</span><span class="line-content">            if let Some(metrics) = nodes_metrics_daily.remove(&amp;node.node_id) {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L222" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+223</span><span class="line-content">                provider_nodes_metrics_daily.insert(node.node_id, metrics);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L223" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+224</span><span class="line-content">            }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L224" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+225</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L225" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+226</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L226" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+227</span><span class="line-content">        let relative_nodes_fr: BTreeMap&lt;NodeId, Decimal&gt; = provider_nodes_metrics_daily<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L227" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+228</span><span class="line-content">            .iter()<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L228" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+229</span><span class="line-content">            .map(|(node_id, metrics)| (*node_id, metrics.relative_fr))<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L229" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+230</span><span class="line-content">            .collect();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L230" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+231</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L231" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+232</span><span class="line-content">        // Calculate extrapolated failure rate for unassigned nodes<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L232" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+233</span><span class="line-content">        // This is the average of relative failure rates for assigned nodes<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L233" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+234</span><span class="line-content">        let extrapolated_fr = if !relative_nodes_fr.is_empty() {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L234" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+235</span><span class="line-content">            let values: Vec&lt;Decimal&gt; = relative_nodes_fr.values().cloned().collect();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L235" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+236</span><span class="line-content">            avg(&amp;values).unwrap_or_default()<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L236" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+237</span><span class="line-content">        } else {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L237" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+238</span><span class="line-content">            Decimal::ZERO<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L238" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+239</span><span class="line-content">        };<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L239" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+240</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L240" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+241</span><span class="line-content">        // Calculate performance multipliers based on failure rates<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L241" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+242</span><span class="line-content">        // Assigned nodes use actual failure rate, unassigned nodes use extrapolated rate<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L242" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+243</span><span class="line-content">        let PerformanceMultiplierResults {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L243" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+244</span><span class="line-content">            reward_reduction,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L244" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+245</span><span class="line-content">            performance_multiplier,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L245" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+246</span><span class="line-content">        } = Self::calculate_performance_multipliers(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L246" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+247</span><span class="line-content">            &amp;rewardable_nodes,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L247" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+248</span><span class="line-content">            &amp;relative_nodes_fr,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L248" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+249</span><span class="line-content">            &amp;extrapolated_fr,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L249" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+250</span><span class="line-content">        );<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L250" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+251</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L251" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+252</span><span class="line-content">        // Calculate base rewards for each node based on region and node type<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L252" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+253</span><span class="line-content">        // Handles special logic for Type3 nodes (grouped by country, with reduction coefficients)<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L253" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+254</span><span class="line-content">        let BaseRewardsResults {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L254" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+255</span><span class="line-content">            base_rewards_per_node,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L255" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+256</span><span class="line-content">            base_rewards,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L256" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+257</span><span class="line-content">            base_rewards_type3,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L257" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+258</span><span class="line-content">        } = Self::calculate_base_rewards_by_region_and_type(rewards_table, &amp;rewardable_nodes);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L258" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+259</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L259" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+260</span><span class="line-content">        // Apply performance multipliers to base rewards to get final daily rewards<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L260" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+261</span><span class="line-content">        let AdjustedRewardsResults { adjusted_rewards } = Self::apply_performance_adjustments(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L261" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+262</span><span class="line-content">            &amp;rewardable_nodes,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L262" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+263</span><span class="line-content">            &amp;base_rewards_per_node,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L263" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+264</span><span class="line-content">            &amp;performance_multiplier,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L264" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+265</span><span class="line-content">        );<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L265" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+266</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L266" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+267</span><span class="line-content">        // Combine all calculated values into the final NodeProviderRewards structure<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L267" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+268</span><span class="line-content">        Self::build_provider_rewards_summary(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L268" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+269</span><span class="line-content">            rewardable_nodes,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L269" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+270</span><span class="line-content">            provider_nodes_metrics_daily,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L270" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+271</span><span class="line-content">            extrapolated_fr,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L271" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+272</span><span class="line-content">            reward_reduction,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L272" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+273</span><span class="line-content">            performance_multiplier,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L273" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+274</span><span class="line-content">            base_rewards_per_node,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L274" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+275</span><span class="line-content">            adjusted_rewards,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L275" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+276</span><span class="line-content">            base_rewards,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L276" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+277</span><span class="line-content">            base_rewards_type3,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L277" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+278</span><span class="line-content">        )<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L278" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+279</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L279" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+280</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L280" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+281</span><span class="line-content">    // ------------------------------------------------------------------------------------------------<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L281" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+282</span><span class="line-content">    // Calculate failure rates for subnets and individual nodes<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L282" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+283</span><span class="line-content">    // ------------------------------------------------------------------------------------------------<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L283" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+284</span><span class="line-content">    fn calculate_failure_rates(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L284" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+285</span><span class="line-content">        daily_metrics_by_subnet: BTreeMap&lt;SubnetId, Vec&lt;NodeMetricsDailyRaw&gt;&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L285" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+286</span><span class="line-content">    ) -&gt; FailureRateResults {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L286" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+287</span><span class="line-content">        fn calculate_daily_node_fr(num_blocks_proposed: u64, num_blocks_failed: u64) -&gt; Decimal {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L287" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+288</span><span class="line-content">            let total_blocks = Decimal::from(num_blocks_proposed + num_blocks_failed);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L288" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+289</span><span class="line-content">            if total_blocks == Decimal::ZERO {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L289" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+290</span><span class="line-content">                Decimal::ZERO<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L290" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+291</span><span class="line-content">            } else {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L291" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+292</span><span class="line-content">                let num_blocks_failed = Decimal::from(num_blocks_failed);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L292" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+293</span><span class="line-content">                num_blocks_failed / total_blocks<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L293" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+294</span><span class="line-content">            }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L294" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+295</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L295" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+296</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L296" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+297</span><span class="line-content">        let mut result = FailureRateResults::default();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L297" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+298</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L298" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+299</span><span class="line-content">        for (subnet_id, subnet_nodes_metrics) in daily_metrics_by_subnet {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L299" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+300</span><span class="line-content">            let nodes_original_fr = subnet_nodes_metrics<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L300" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+301</span><span class="line-content">                .iter()<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L301" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+302</span><span class="line-content">                .map(|metrics| {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L302" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+303</span><span class="line-content">                    let original_fr = calculate_daily_node_fr(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L303" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+304</span><span class="line-content">                        metrics.num_blocks_proposed,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L304" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+305</span><span class="line-content">                        metrics.num_blocks_failed,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L305" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+306</span><span class="line-content">                    );<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L306" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+307</span><span class="line-content">                    (metrics.node_id, original_fr)<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L307" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+308</span><span class="line-content">                })<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L308" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+309</span><span class="line-content">                .collect::&lt;BTreeMap&lt;_, _&gt;&gt;();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L309" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+310</span><span class="line-content">            let nodes_fr = nodes_original_fr.values().cloned().collect::&lt;Vec&lt;_&gt;&gt;();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L310" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+311</span><span class="line-content">            let failure_rates = nodes_fr.iter().sorted().collect::&lt;Vec&lt;_&gt;&gt;();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L311" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+312</span><span class="line-content">            let index = ((nodes_fr.len() as f64) * Self::SUBNET_FAILURE_RATE_PERCENTILE).ceil()<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L312" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+313</span><span class="line-content">                as usize<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L313" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+314</span><span class="line-content">                - 1;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L314" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+315</span><span class="line-content">            let subnet_fr = *failure_rates[index];<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L315" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+316</span><span class="line-content">            result.subnets_fr.insert(subnet_id, subnet_fr);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L316" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+317</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L317" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+318</span><span class="line-content">            for NodeMetricsDailyRaw {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L318" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+319</span><span class="line-content">                node_id,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L319" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+320</span><span class="line-content">                num_blocks_proposed,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L320" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+321</span><span class="line-content">                num_blocks_failed,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L321" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+322</span><span class="line-content">            } in subnet_nodes_metrics<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L322" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+323</span><span class="line-content">            {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L323" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+324</span><span class="line-content">                let original_fr = nodes_original_fr[&amp;node_id];<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L324" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+325</span><span class="line-content">                let relative_fr = max(Decimal::ZERO, original_fr - subnet_fr);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L325" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+326</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L326" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+327</span><span class="line-content">                result.nodes_metrics_daily.insert(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L327" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+328</span><span class="line-content">                    node_id,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L328" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+329</span><span class="line-content">                    NodeMetricsDaily {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L329" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+330</span><span class="line-content">                        subnet_assigned: subnet_id,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L330" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+331</span><span class="line-content">                        subnet_assigned_fr: subnet_fr,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L331" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+332</span><span class="line-content">                        num_blocks_proposed,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L332" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+333</span><span class="line-content">                        num_blocks_failed,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L333" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+334</span><span class="line-content">                        original_fr,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L334" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+335</span><span class="line-content">                        relative_fr,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L335" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+336</span><span class="line-content">                    },<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L336" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+337</span><span class="line-content">                );<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L337" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+338</span><span class="line-content">            }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L338" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+339</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L339" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+340</span><span class="line-content">        result<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L340" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+341</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L341" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+342</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L342" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+343</span><span class="line-content">    fn calculate_performance_multipliers(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L343" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+344</span><span class="line-content">        rewardable_nodes: &amp;[RewardableNode],<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L344" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+345</span><span class="line-content">        relative_nodes_fr: &amp;BTreeMap&lt;NodeId, Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L345" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+346</span><span class="line-content">        extrapolated_fr: &amp;Decimal,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L346" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+347</span><span class="line-content">    ) -&gt; PerformanceMultiplierResults {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L347" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+348</span><span class="line-content">        let mut reward_reduction = BTreeMap::new();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L348" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+349</span><span class="line-content">        let mut performance_multiplier = BTreeMap::new();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L349" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+350</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L350" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+351</span><span class="line-content">        let calculate_rewards_reduction = |fr: Decimal| -&gt; Decimal {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L351" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+352</span><span class="line-content">            if fr &lt; Self::MIN_FAILURE_RATE {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L352" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+353</span><span class="line-content">                Self::MIN_REWARDS_REDUCTION<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L353" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+354</span><span class="line-content">            } else if fr &gt; Self::MAX_FAILURE_RATE {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L354" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+355</span><span class="line-content">                Self::MAX_REWARDS_REDUCTION<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L355" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+356</span><span class="line-content">            } else {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L356" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+357</span><span class="line-content">                // Linear interpolation between MIN_REWARDS_REDUCTION and MAX_REWARDS_REDUCTION<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L357" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+358</span><span class="line-content">                (fr - Self::MIN_FAILURE_RATE) / (Self::MAX_FAILURE_RATE - Self::MIN_FAILURE_RATE)<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L358" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+359</span><span class="line-content">                    * Self::MAX_REWARDS_REDUCTION<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L359" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+360</span><span class="line-content">            }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L360" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+361</span><span class="line-content">        };<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L361" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+362</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L362" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+363</span><span class="line-content">        for node in rewardable_nodes {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L363" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+364</span><span class="line-content">            let daily_fr_used = relative_nodes_fr<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L364" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+365</span><span class="line-content">                .get(&amp;node.node_id)<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L365" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+366</span><span class="line-content">                .copied()<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L366" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+367</span><span class="line-content">                .unwrap_or(*extrapolated_fr);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L367" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+368</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L368" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+369</span><span class="line-content">            let rewards_reduction = calculate_rewards_reduction(daily_fr_used);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L369" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+370</span><span class="line-content">            let performance_mult = dec!(1) - rewards_reduction;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L370" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+371</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L371" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+372</span><span class="line-content">            reward_reduction.insert(node.node_id, rewards_reduction);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L372" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+373</span><span class="line-content">            performance_multiplier.insert(node.node_id, performance_mult);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L373" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+374</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L374" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+375</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L375" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+376</span><span class="line-content">        PerformanceMultiplierResults {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L376" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+377</span><span class="line-content">            reward_reduction,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L377" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+378</span><span class="line-content">            performance_multiplier,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L378" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+379</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L379" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+380</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L380" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+381</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L381" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+382</span><span class="line-content">    // ------------------------------------------------------------------------------------------------<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L382" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+383</span><span class="line-content">    // Calculate base rewards for each node based on region and node type<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L383" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+384</span><span class="line-content">    // ------------------------------------------------------------------------------------------------<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L384" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+385</span><span class="line-content">    fn calculate_base_rewards_by_region_and_type(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L385" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+386</span><span class="line-content">        node_rewards_table: &amp;NodeRewardsTable,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L386" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+387</span><span class="line-content">        rewardable_nodes: &amp;[RewardableNode],<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L387" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+388</span><span class="line-content">    ) -&gt; BaseRewardsResults {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L388" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+389</span><span class="line-content">        fn get_monthly_rate(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L389" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+390</span><span class="line-content">            rewards_table: &amp;NodeRewardsTable,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L390" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+391</span><span class="line-content">            region: &amp;Region,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L391" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+392</span><span class="line-content">            node_reward_type: &amp;NodeRewardType,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L392" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+393</span><span class="line-content">        ) -&gt; (Decimal, RewardsCoefficientPercent) {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L393" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+394</span><span class="line-content">            rewards_table<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L394" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+395</span><span class="line-content">                .get_rate(region, &amp;node_reward_type.to_string())<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L395" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+396</span><span class="line-content">                .map(|rate| {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L396" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+397</span><span class="line-content">                    let base_rewards_monthly = Decimal::from(rate.xdr_permyriad_per_node_per_month);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L397" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+398</span><span class="line-content">                    // Default reward_coefficient_percent is set to 80%, which is used as a fallback only in the<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L398" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+399</span><span class="line-content">                    // unlikely case that the type3 entry in the reward table:<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L399" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+400</span><span class="line-content">                    // a) has xdr_permyriad_per_node_per_month entry set for this region, but<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L400" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+401</span><span class="line-content">                    // b) does NOT have the reward_coefficient_percent value set<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L401" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+402</span><span class="line-content">                    let reward_coefficient_percent =<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L402" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+403</span><span class="line-content">                        Decimal::from(rate.reward_coefficient_percent.unwrap_or(80)) / dec!(100);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L403" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+404</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L404" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+405</span><span class="line-content">                    (base_rewards_monthly, reward_coefficient_percent)<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L405" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+406</span><span class="line-content">                })<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L406" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+407</span><span class="line-content">                .unwrap_or((dec!(1), dec!(1)))<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L407" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+408</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L408" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+409</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L409" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+410</span><span class="line-content">        fn is_type3(node_type: &amp;NodeRewardType) -&gt; bool {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L410" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+411</span><span class="line-content">            node_type == &amp;NodeRewardType::Type3 || node_type == &amp;NodeRewardType::Type3dot1<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L411" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+412</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L412" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+413</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L413" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+414</span><span class="line-content">        fn type3_region_key(region: &amp;Region) -&gt; String {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L414" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+415</span><span class="line-content">            region<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L415" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+416</span><span class="line-content">                .splitn(3, &#x27;,&#x27;)<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L416" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+417</span><span class="line-content">                .take(2)<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L417" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+418</span><span class="line-content">                .collect::&lt;Vec&lt;&amp;str&gt;&gt;()<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L418" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+419</span><span class="line-content">                .join(&quot;:&quot;)<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L419" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+420</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L420" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+421</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L421" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+422</span><span class="line-content">        let mut base_rewards = BTreeMap::new();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L422" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+423</span><span class="line-content">        let mut base_rewards_type3 = BTreeMap::new();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L423" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+424</span><span class="line-content">        let mut base_rewards_per_node = BTreeMap::new();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L424" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+425</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L425" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+426</span><span class="line-content">        for node in rewardable_nodes {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L426" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+427</span><span class="line-content">            let (base_rewards_monthly, coefficient) =<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L427" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+428</span><span class="line-content">                get_monthly_rate(node_rewards_table, &amp;node.region, &amp;node.node_reward_type);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L428" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+429</span><span class="line-content">            let base_rewards_daily = base_rewards_monthly / Self::REWARDS_TABLE_DAYS;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L429" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+430</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L430" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+431</span><span class="line-content">            base_rewards<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L431" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+432</span><span class="line-content">                .entry((node.node_reward_type, node.region.clone()))<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L432" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+433</span><span class="line-content">                .or_insert((base_rewards_daily, base_rewards_monthly));<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L433" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+434</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L434" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+435</span><span class="line-content">            // For nodes which are type3* the base rewards for the single node is computed as the average of base rewards<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L435" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+436</span><span class="line-content">            // on DC Country level. Moreover, to de-stimulate the same NP having too many nodes in the same country,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L436" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+437</span><span class="line-content">            // the node rewards is reduced for each node the NP has in the given country. The reduction coefficient is<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L437" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+438</span><span class="line-content">            // computed as the average of reduction coefficients on DC Country level.<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L438" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+439</span><span class="line-content">            if is_type3(&amp;node.node_reward_type) {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L439" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+440</span><span class="line-content">                // The rewards table contains entries of this form DC Continent + DC Country + DC State/City.<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L440" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+441</span><span class="line-content">                // The grouping for type3* nodes will be on DC Continent + DC Country level. This group is used for computing<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L441" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+442</span><span class="line-content">                // the reduction coefficient and base reward for the group.<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L442" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+443</span><span class="line-content">                let region_key = type3_region_key(&amp;node.region);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L443" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+444</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L444" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+445</span><span class="line-content">                base_rewards_type3<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L445" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+446</span><span class="line-content">                    .entry(region_key.clone())<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L446" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+447</span><span class="line-content">                    .and_modify(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L447" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+448</span><span class="line-content">                        |(rates, coeffs): &amp;mut (Vec&lt;Decimal&gt;, Vec&lt;RewardsCoefficientPercent&gt;)| {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L448" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+449</span><span class="line-content">                            rates.push(base_rewards_daily);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L449" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+450</span><span class="line-content">                            coeffs.push(coefficient);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L450" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+451</span><span class="line-content">                        },<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L451" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+452</span><span class="line-content">                    )<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L452" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+453</span><span class="line-content">                    .or_insert((vec![base_rewards_daily], vec![coefficient]));<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L453" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+454</span><span class="line-content">            }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L454" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+455</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L455" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+456</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L456" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+457</span><span class="line-content">        let base_rewards_type3 = base_rewards_type3<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L457" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+458</span><span class="line-content">            .into_iter()<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L458" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+459</span><span class="line-content">            .map(|(region, (rates, coeff))| {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L459" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+460</span><span class="line-content">                let nodes_count = rates.len();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L460" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+461</span><span class="line-content">                let avg_rate = avg(rates.as_slice()).unwrap_or_default();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L461" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+462</span><span class="line-content">                let avg_coeff = avg(coeff.as_slice()).unwrap_or_default();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L462" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+463</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L463" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+464</span><span class="line-content">                let mut running_coefficient = dec!(1);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L464" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+465</span><span class="line-content">                let mut region_rewards = Vec::new();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L465" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+466</span><span class="line-content">                for _ in 0..nodes_count {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L466" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+467</span><span class="line-content">                    region_rewards.push(avg_rate * running_coefficient);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L467" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+468</span><span class="line-content">                    running_coefficient *= avg_coeff;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L468" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+469</span><span class="line-content">                }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L469" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+470</span><span class="line-content">                let region_rewards_avg = avg(&amp;region_rewards).unwrap_or_default();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L470" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+471</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L471" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+472</span><span class="line-content">                (<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L472" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+473</span><span class="line-content">                    region,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L473" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+474</span><span class="line-content">                    (region_rewards_avg, nodes_count, avg_rate, avg_coeff),<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L474" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+475</span><span class="line-content">                )<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L475" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+476</span><span class="line-content">            })<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L476" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+477</span><span class="line-content">            .collect::&lt;BTreeMap&lt;_, _&gt;&gt;();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L477" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+478</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L478" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+479</span><span class="line-content">        for node in rewardable_nodes {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L479" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+480</span><span class="line-content">            let base_rewards_for_day = if is_type3(&amp;node.node_reward_type) {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L480" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+481</span><span class="line-content">                let region_key = type3_region_key(&amp;node.region);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L481" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+482</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L482" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+483</span><span class="line-content">                let (base_rewards_daily, _, _, _) = base_rewards_type3<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L483" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+484</span><span class="line-content">                    .get(&amp;region_key)<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L484" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+485</span><span class="line-content">                    .expect(&quot;Type3 base rewards expected for provider&quot;);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L485" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+486</span><span class="line-content">                base_rewards_daily<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L486" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+487</span><span class="line-content">            } else {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L487" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+488</span><span class="line-content">                let (base_rewards_daily, _) = base_rewards<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L488" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+489</span><span class="line-content">                    .get(&amp;(node.node_reward_type, node.region.clone()))<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L489" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+490</span><span class="line-content">                    .expect(&quot;base rewards expected for each node&quot;);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L490" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+491</span><span class="line-content">                base_rewards_daily<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L491" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+492</span><span class="line-content">            };<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L492" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+493</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L493" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+494</span><span class="line-content">            base_rewards_per_node.insert(node.node_id, *base_rewards_for_day);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L494" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+495</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L495" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+496</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L496" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+497</span><span class="line-content">        let base_rewards_type3 = base_rewards_type3<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L497" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+498</span><span class="line-content">            .into_iter()<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L498" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+499</span><span class="line-content">            .map(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L499" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+500</span><span class="line-content">                |(region, (daily_rewards, nodes_count, avg_rewards, avg_coefficient))| {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L500" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+501</span><span class="line-content">                    BaseRewardsType3 {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L501" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+502</span><span class="line-content">                        region,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L502" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+503</span><span class="line-content">                        nodes_count,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L503" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+504</span><span class="line-content">                        avg_rewards,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L504" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+505</span><span class="line-content">                        avg_coefficient,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L505" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+506</span><span class="line-content">                        value: daily_rewards,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L506" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+507</span><span class="line-content">                    }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L507" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+508</span><span class="line-content">                },<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L508" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+509</span><span class="line-content">            )<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L509" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+510</span><span class="line-content">            .collect();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L510" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+511</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L511" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+512</span><span class="line-content">        let base_rewards = base_rewards<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L512" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+513</span><span class="line-content">            .into_iter()<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L513" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+514</span><span class="line-content">            .map(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L514" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+515</span><span class="line-content">                |((node_reward_type, region), (daily_rewards, monthly_rewards))| BaseRewards {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L515" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+516</span><span class="line-content">                    node_reward_type,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L516" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+517</span><span class="line-content">                    region,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L517" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+518</span><span class="line-content">                    monthly: monthly_rewards,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L518" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+519</span><span class="line-content">                    daily: daily_rewards,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L519" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+520</span><span class="line-content">                },<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L520" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+521</span><span class="line-content">            )<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L521" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+522</span><span class="line-content">            .collect();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L522" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+523</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L523" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+524</span><span class="line-content">        BaseRewardsResults {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L524" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+525</span><span class="line-content">            base_rewards_per_node,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L525" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+526</span><span class="line-content">            base_rewards_type3,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L526" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+527</span><span class="line-content">            base_rewards,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L527" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+528</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L528" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+529</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L529" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+530</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L530" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+531</span><span class="line-content">    fn apply_performance_adjustments(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L531" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+532</span><span class="line-content">        rewardable_nodes: &amp;[RewardableNode],<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L532" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+533</span><span class="line-content">        base_rewards: &amp;BTreeMap&lt;NodeId, Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L533" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+534</span><span class="line-content">        performance_multiplier: &amp;BTreeMap&lt;NodeId, Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L534" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+535</span><span class="line-content">    ) -&gt; AdjustedRewardsResults {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L535" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+536</span><span class="line-content">        let mut adjusted_rewards = BTreeMap::new();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L536" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+537</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L537" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+538</span><span class="line-content">        for node in rewardable_nodes {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L538" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+539</span><span class="line-content">            let base_rewards_for_day = base_rewards<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L539" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+540</span><span class="line-content">                .get(&amp;node.node_id)<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L540" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+541</span><span class="line-content">                .expect(&quot;Base rewards expected for each node&quot;);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L541" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+542</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L542" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+543</span><span class="line-content">            let performance_mult = performance_multiplier<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L543" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+544</span><span class="line-content">                .get(&amp;node.node_id)<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L544" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+545</span><span class="line-content">                .expect(&quot;Performance multiplier expected for every node&quot;);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L545" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+546</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L546" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+547</span><span class="line-content">            let adjusted_rewards_for_day = base_rewards_for_day * performance_mult;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L547" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+548</span><span class="line-content">            adjusted_rewards.insert(node.node_id, adjusted_rewards_for_day);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L548" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+549</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L549" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+550</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L550" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+551</span><span class="line-content">        AdjustedRewardsResults { adjusted_rewards }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L551" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+552</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L552" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+553</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L553" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+554</span><span class="line-content">    /// Build provider rewards summary using BTreeMap for consistency and better performance<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L554" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+555</span><span class="line-content">    fn build_provider_rewards_summary(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L555" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+556</span><span class="line-content">        rewardable_nodes: Vec&lt;RewardableNode&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L556" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+557</span><span class="line-content">        mut provider_nodes_metrics_daily: BTreeMap&lt;NodeId, NodeMetricsDaily&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L557" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+558</span><span class="line-content">        extrapolated_fr: Percent,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L558" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+559</span><span class="line-content">        mut reward_reduction: BTreeMap&lt;NodeId, Percent&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L559" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+560</span><span class="line-content">        mut performance_multiplier: BTreeMap&lt;NodeId, Percent&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L560" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+561</span><span class="line-content">        mut base_rewards_per_node: BTreeMap&lt;NodeId, XDRPermyriad&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L561" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+562</span><span class="line-content">        mut adjusted_rewards: BTreeMap&lt;NodeId, XDRPermyriad&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L562" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+563</span><span class="line-content">        base_rewards: Vec&lt;BaseRewards&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L563" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+564</span><span class="line-content">        base_rewards_type3: Vec&lt;BaseRewardsType3&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L564" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+565</span><span class="line-content">    ) -&gt; NodeProviderRewards {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L565" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+566</span><span class="line-content">        let mut results_by_node = Vec::new();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L566" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+567</span><span class="line-content">        let mut rewards_total = Decimal::ZERO;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L567" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+568</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L568" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+569</span><span class="line-content">        for node in rewardable_nodes {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L569" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+570</span><span class="line-content">            let node_status =<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L570" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+571</span><span class="line-content">                if let Some(node_metrics) = provider_nodes_metrics_daily.remove(&amp;node.node_id) {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L571" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+572</span><span class="line-content">                    NodeStatus::Assigned { node_metrics }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L572" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+573</span><span class="line-content">                } else {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L573" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+574</span><span class="line-content">                    NodeStatus::Unassigned { extrapolated_fr }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L574" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+575</span><span class="line-content">                };<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L575" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+576</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L576" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+577</span><span class="line-content">            let rewards_reduction_percent = reward_reduction<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L577" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+578</span><span class="line-content">                .remove(&amp;node.node_id)<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L578" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+579</span><span class="line-content">                .expect(&quot;Rewards reduction should be present in rewards&quot;);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L579" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+580</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L580" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+581</span><span class="line-content">            let performance_multiplier_percent = performance_multiplier<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L581" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+582</span><span class="line-content">                .remove(&amp;node.node_id)<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L582" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+583</span><span class="line-content">                .expect(&quot;Performance multiplier should be present in rewards&quot;);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L583" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+584</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L584" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+585</span><span class="line-content">            let base_rewards_xdr_permyriad = base_rewards_per_node<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L585" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+586</span><span class="line-content">                .remove(&amp;node.node_id)<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L586" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+587</span><span class="line-content">                .expect(&quot;Base rewards should be present in rewards&quot;);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L587" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+588</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L588" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+589</span><span class="line-content">            let adjusted_rewards_xdr_permyriad = adjusted_rewards<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L589" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+590</span><span class="line-content">                .remove(&amp;node.node_id)<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L590" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+591</span><span class="line-content">                .expect(&quot;Adjusted rewards should be present in rewards&quot;);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L591" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+592</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L592" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+593</span><span class="line-content">            rewards_total += adjusted_rewards_xdr_permyriad;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L593" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+594</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L594" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+595</span><span class="line-content">            results_by_node.push(NodeResults {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L595" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+596</span><span class="line-content">                node_id: node.node_id,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L596" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+597</span><span class="line-content">                node_reward_type: node.node_reward_type,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L597" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+598</span><span class="line-content">                region: node.region,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L598" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+599</span><span class="line-content">                dc_id: node.dc_id,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L599" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+600</span><span class="line-content">                node_status,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L600" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+601</span><span class="line-content">                performance_multiplier: performance_multiplier_percent,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L601" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+602</span><span class="line-content">                rewards_reduction: rewards_reduction_percent,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L602" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+603</span><span class="line-content">                base_rewards: base_rewards_xdr_permyriad,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L603" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+604</span><span class="line-content">                adjusted_rewards: adjusted_rewards_xdr_permyriad,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L604" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+605</span><span class="line-content">            });<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L605" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+606</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L606" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+607</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L607" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+608</span><span class="line-content">        NodeProviderRewards {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L608" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+609</span><span class="line-content">            rewards_total,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L609" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+610</span><span class="line-content">            base_rewards,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L610" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+611</span><span class="line-content">            base_rewards_type3,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L611" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+612</span><span class="line-content">            nodes_results: results_by_node,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L612" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+613</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L613" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+614</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L614" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+615</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L615" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+616</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L616" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+617</span><span class="line-content">// ------------------------------------------------------------------------------------------------<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L617" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+618</span><span class="line-content">// Helpers<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L618" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+619</span><span class="line-content">// ------------------------------------------------------------------------------------------------<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L619" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+620</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L620" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+621</span><span class="line-content">fn avg(values: &amp;[Decimal]) -&gt; Option&lt;Decimal&gt; {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L621" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+622</span><span class="line-content">    if values.is_empty() {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L622" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+623</span><span class="line-content">        None<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L623" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+624</span><span class="line-content">    } else {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L624" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+625</span><span class="line-content">        Some(values.iter().sum::&lt;Decimal&gt;() / Decimal::from(values.len()))<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L625" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+626</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L626" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+627</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L627" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">628</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L628" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">629</span><span class="line-content">new file mode 100644<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L629" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">630</span><span class="line-content">index 0000000000..a5201b3a24<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/mod.rs#L630" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- /dev/null</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs</div>
<div class="hunk-header">@@ -0,0 +1,77 @@</div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">#![allow(dead_code)]<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+2</span><span class="line-content">use crate::types::DayUtc;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+3</span><span class="line-content">use ic_base_types::{NodeId, PrincipalId, SubnetId};<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+4</span><span class="line-content">use ic_protobuf::registry::node::v1::NodeRewardType;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+5</span><span class="line-content">use rust_decimal::Decimal;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+6</span><span class="line-content">use serde::{Deserialize, Serialize};<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+7</span><span class="line-content">use std::collections::BTreeMap;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+9</span><span class="line-content">pub type XDRPermyriad = Decimal;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+10</span><span class="line-content">pub type Percent = Decimal;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+11</span><span class="line-content">pub type Region = String;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+12</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+13</span><span class="line-content">#[derive(Serialize, Deserialize, Clone, Debug, PartialEq)]<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+14</span><span class="line-content">pub struct NodeMetricsDaily {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+15</span><span class="line-content">    pub subnet_assigned: SubnetId,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+16</span><span class="line-content">    pub subnet_assigned_fr: Percent,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+17</span><span class="line-content">    pub num_blocks_proposed: u64,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+18</span><span class="line-content">    pub num_blocks_failed: u64,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+19</span><span class="line-content">    pub original_fr: Percent,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+20</span><span class="line-content">    pub relative_fr: Percent,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+21</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+22</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+23</span><span class="line-content">#[derive(Serialize, Deserialize, Debug, PartialEq, Clone)]<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+24</span><span class="line-content">pub enum NodeStatus {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+25</span><span class="line-content">    Assigned { node_metrics: NodeMetricsDaily },<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+26</span><span class="line-content">    Unassigned { extrapolated_fr: Percent },<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+27</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+28</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+29</span><span class="line-content">#[derive(Serialize, Deserialize, Debug, PartialEq, Clone)]<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+30</span><span class="line-content">pub struct NodeResults {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+31</span><span class="line-content">    pub node_id: NodeId,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+32</span><span class="line-content">    pub node_reward_type: NodeRewardType,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+33</span><span class="line-content">    pub region: String,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+34</span><span class="line-content">    pub dc_id: String,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+35</span><span class="line-content">    pub node_status: NodeStatus,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+36</span><span class="line-content">    pub performance_multiplier: Percent,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+37</span><span class="line-content">    pub rewards_reduction: Percent,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+38</span><span class="line-content">    pub base_rewards: XDRPermyriad,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+39</span><span class="line-content">    pub adjusted_rewards: XDRPermyriad,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+40</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+41</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+42</span><span class="line-content">#[derive(Serialize, Deserialize, Debug, PartialEq, Clone)]<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+43</span><span class="line-content">pub struct BaseRewards {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+44</span><span class="line-content">    pub node_reward_type: NodeRewardType,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+45</span><span class="line-content">    pub region: Region,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+46</span><span class="line-content">    pub monthly: XDRPermyriad,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+47</span><span class="line-content">    pub daily: XDRPermyriad,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+48</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+49</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+50</span><span class="line-content">#[derive(Serialize, Deserialize, Debug, PartialEq, Clone)]<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+51</span><span class="line-content">pub struct BaseRewardsType3 {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+52</span><span class="line-content">    pub region: Region,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+53</span><span class="line-content">    pub nodes_count: usize,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+54</span><span class="line-content">    pub avg_rewards: XDRPermyriad,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+55</span><span class="line-content">    pub avg_coefficient: Percent,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+56</span><span class="line-content">    pub value: XDRPermyriad,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+57</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+58</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+59</span><span class="line-content">#[derive(Serialize, Deserialize, Debug, PartialEq, Clone)]<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+60</span><span class="line-content">pub struct NodeProviderRewards {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+61</span><span class="line-content">    pub rewards_total: XDRPermyriad,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+62</span><span class="line-content">    pub base_rewards: Vec&lt;BaseRewards&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+63</span><span class="line-content">    pub base_rewards_type3: Vec&lt;BaseRewardsType3&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+64</span><span class="line-content">    pub nodes_results: Vec&lt;NodeResults&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+65</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+66</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+67</span><span class="line-content">#[derive(Serialize, Deserialize)]<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+68</span><span class="line-content">pub struct DailyResults {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+69</span><span class="line-content">    pub subnets_fr: BTreeMap&lt;SubnetId, Percent&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+70</span><span class="line-content">    pub provider_results: BTreeMap&lt;PrincipalId, NodeProviderRewards&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+71</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+72</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+73</span><span class="line-content">#[derive(Serialize, Deserialize)]<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+74</span><span class="line-content">pub struct RewardsCalculatorResults {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+75</span><span class="line-content">    pub total_rewards_xdr_permyriad: BTreeMap&lt;PrincipalId, u64&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+76</span><span class="line-content">    pub daily_results: BTreeMap&lt;DayUtc, DailyResults&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+77</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">78</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">79</span><span class="line-content">new file mode 100644<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">80</span><span class="line-content">index 0000000000..ea7ee0e044<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/results.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- /dev/null</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs</div>
<div class="hunk-header">@@ -0,0 +1,101 @@</div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">#![allow(dead_code)]<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+2</span><span class="line-content">use crate::types::{NodeMetricsDailyRaw, Region};<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+3</span><span class="line-content">use ic_base_types::{NodeId, PrincipalId, SubnetId};<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+4</span><span class="line-content">use ic_protobuf::registry::node::v1::NodeRewardType;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+5</span><span class="line-content">use ic_protobuf::registry::node_rewards::v2::{NodeRewardRate, NodeRewardRates, NodeRewardsTable};<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+6</span><span class="line-content">use maplit::btreemap;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+7</span><span class="line-content">use std::collections::BTreeMap;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+9</span><span class="line-content">pub fn test_node_id(id: u64) -&gt; NodeId {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+10</span><span class="line-content">    NodeId::from(PrincipalId::new_node_test_id(id))<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+11</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+12</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+13</span><span class="line-content">pub fn test_provider_id(id: u64) -&gt; PrincipalId {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+14</span><span class="line-content">    PrincipalId::new_user_test_id(id)<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+15</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+16</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+17</span><span class="line-content">pub fn test_subnet_id(id: u64) -&gt; SubnetId {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+18</span><span class="line-content">    SubnetId::from(PrincipalId::new_subnet_test_id(id))<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+19</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+20</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+21</span><span class="line-content">#[derive(Eq, Hash, PartialEq, Clone, Ord, PartialOrd, Debug)]<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+22</span><span class="line-content">pub struct RewardableNode {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+23</span><span class="line-content">    pub node_id: NodeId,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+24</span><span class="line-content">    pub region: Region,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+25</span><span class="line-content">    pub node_reward_type: NodeRewardType,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+26</span><span class="line-content">    pub dc_id: String,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+27</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+28</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+29</span><span class="line-content">impl Default for RewardableNode {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+30</span><span class="line-content">    fn default() -&gt; Self {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+31</span><span class="line-content">        RewardableNode {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+32</span><span class="line-content">            node_id: NodeId::from(PrincipalId::new_node_test_id(0)),<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+33</span><span class="line-content">            region: Region::default(),<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+34</span><span class="line-content">            node_reward_type: NodeRewardType::default(),<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+35</span><span class="line-content">            dc_id: &quot;default_dc&quot;.into(),<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+36</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+37</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+38</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+39</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+40</span><span class="line-content">pub fn build_daily_metrics(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+41</span><span class="line-content">    subnet_id: SubnetId,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+42</span><span class="line-content">    nodes_data: &amp;[(NodeId, u64, u64)],<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+43</span><span class="line-content">) -&gt; (SubnetId, Vec&lt;NodeMetricsDailyRaw&gt;) {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+44</span><span class="line-content">    let metrics = nodes_data<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+45</span><span class="line-content">        .iter()<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+46</span><span class="line-content">        .map(|(node_id, proposed, failed)| NodeMetricsDailyRaw {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+47</span><span class="line-content">            node_id: *node_id,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+48</span><span class="line-content">            num_blocks_proposed: *proposed,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+49</span><span class="line-content">            num_blocks_failed: *failed,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+50</span><span class="line-content">        })<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+51</span><span class="line-content">        .collect();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+52</span><span class="line-content">    (subnet_id, metrics)<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+53</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+54</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+55</span><span class="line-content">pub fn generate_rewardable_nodes(nodes_with_rewardable_days: Vec&lt;NodeId&gt;) -&gt; Vec&lt;RewardableNode&gt; {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+56</span><span class="line-content">    nodes_with_rewardable_days<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+57</span><span class="line-content">        .into_iter()<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+58</span><span class="line-content">        .map(|node_id| RewardableNode {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+59</span><span class="line-content">            node_id,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+60</span><span class="line-content">            ..Default::default()<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+61</span><span class="line-content">        })<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+62</span><span class="line-content">        .collect()<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+63</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+64</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+65</span><span class="line-content">pub fn create_rewards_table_for_region_test() -&gt; NodeRewardsTable {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+66</span><span class="line-content">    let mut table = BTreeMap::new();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+67</span><span class="line-content">    table.insert(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+68</span><span class="line-content">        &quot;Europe,Switzerland&quot;.to_string(),<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+69</span><span class="line-content">        NodeRewardRates {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+70</span><span class="line-content">            rates: btreemap! {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+71</span><span class="line-content">                NodeRewardType::Type1.to_string() =&gt; NodeRewardRate {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+72</span><span class="line-content">                    xdr_permyriad_per_node_per_month: 304375, // -&gt; 10000 / day<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+73</span><span class="line-content">                    reward_coefficient_percent: None,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+74</span><span class="line-content">                },<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+75</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+76</span><span class="line-content">        },<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+77</span><span class="line-content">    );<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+78</span><span class="line-content">    table.insert(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+79</span><span class="line-content">        &quot;North America,USA,California&quot;.to_string(),<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+80</span><span class="line-content">        NodeRewardRates {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+81</span><span class="line-content">            rates: btreemap! {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+82</span><span class="line-content">                NodeRewardType::Type3.to_string() =&gt; NodeRewardRate {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+83</span><span class="line-content">                    xdr_permyriad_per_node_per_month: 913125, // -&gt; 30000 / day<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+84</span><span class="line-content">                    reward_coefficient_percent: Some(90),<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+85</span><span class="line-content">                },<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+86</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+87</span><span class="line-content">        },<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+88</span><span class="line-content">    );<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+89</span><span class="line-content">    table.insert(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+90</span><span class="line-content">        &quot;North America,USA,Nevada&quot;.to_string(),<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+91</span><span class="line-content">        NodeRewardRates {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+92</span><span class="line-content">            rates: btreemap! {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+93</span><span class="line-content">                NodeRewardType::Type3dot1.to_string() =&gt; NodeRewardRate {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+94</span><span class="line-content">                    xdr_permyriad_per_node_per_month: 1217500, // -&gt; 40000 / day<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L94" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+95</span><span class="line-content">                    reward_coefficient_percent: Some(70),<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+96</span><span class="line-content">                },<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L96" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+97</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+98</span><span class="line-content">        },<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L98" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+99</span><span class="line-content">    );<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+100</span><span class="line-content">    NodeRewardsTable { table }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L100" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+101</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L101" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">102</span><span class="line-content">diff --git a/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">103</span><span class="line-content">new file mode 100644<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">104</span><span class="line-content">index 0000000000..06e233718f<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/test_utils.rs#L104" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- /dev/null</div>
<div class="file-header">+++ b/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs</div>
<div class="hunk-header">@@ -0,0 +1,325 @@</div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">#![allow(dead_code)]<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+2</span><span class="line-content">#![allow(unused_imports)]<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+3</span><span class="line-content">use crate::performance_based_algorithm::results::RewardsCalculatorResults;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+4</span><span class="line-content">use crate::performance_based_algorithm::{DataProvider, PerformanceBasedAlgorithm};<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+5</span><span class="line-content">use crate::types::DayUtc;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+6</span><span class="line-content">use ic_base_types::PrincipalId;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+7</span><span class="line-content">use rust_decimal::Decimal;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content">use rust_decimal_macros::dec;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+9</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+10</span><span class="line-content">// ================================================================================================<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+11</span><span class="line-content">// VERSIONING SAFETY WARNING<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+12</span><span class="line-content">// ================================================================================================<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+13</span><span class="line-content">//<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+14</span><span class="line-content">// CRITICAL: This RewardsCalculationV1 implementation must maintain historical reproducibility.<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+15</span><span class="line-content">//<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+16</span><span class="line-content">// Any changes to the calculation logic, constants, or data structures in this version MUST NOT<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+17</span><span class="line-content">// affect the results of previously calculated rewards. This is essential for:<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+18</span><span class="line-content">//<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+19</span><span class="line-content">// 1. **Audit Trail Integrity**: Historical reward calculations must remain verifiable<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+20</span><span class="line-content">// 3. **Financial Accuracy**: Incorrect historical calculations could have legal implications<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+21</span><span class="line-content">// 4. **System Reliability**: Users depend on consistent reward calculations over time<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+22</span><span class="line-content">//<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+23</span><span class="line-content">// If you need to change the calculation logic, create a new version (V2, V3, etc.) instead<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+24</span><span class="line-content">// of modifying this V1 implementation. This ensures backward compatibility and historical<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+25</span><span class="line-content">// reproducibility while allowing for future algorithm improvements.<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+26</span><span class="line-content">//<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+27</span><span class="line-content">// ================================================================================================<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+28</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+29</span><span class="line-content">pub struct RewardsCalculationV1;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+30</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+31</span><span class="line-content">impl PerformanceBasedAlgorithm for RewardsCalculationV1 {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+32</span><span class="line-content">    const SUBNET_FAILURE_RATE_PERCENTILE: f64 = 0.75;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+33</span><span class="line-content">    const MIN_FAILURE_RATE: Decimal = dec!(0.1);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+34</span><span class="line-content">    const MAX_FAILURE_RATE: Decimal = dec!(0.6);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+35</span><span class="line-content">    const MIN_REWARDS_REDUCTION: Decimal = dec!(0);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+36</span><span class="line-content">    const MAX_REWARDS_REDUCTION: Decimal = dec!(0.8);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+37</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+38</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+39</span><span class="line-content">impl RewardsCalculationV1 {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+40</span><span class="line-content">    pub fn calculate_rewards(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+41</span><span class="line-content">        from_day: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+42</span><span class="line-content">        to_day: &amp;DayUtc,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+43</span><span class="line-content">        node_provider_filter: Option&lt;PrincipalId&gt;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+44</span><span class="line-content">        data_provider: impl DataProvider,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+45</span><span class="line-content">    ) -&gt; Result&lt;RewardsCalculatorResults, String&gt; {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+46</span><span class="line-content">        &lt;RewardsCalculationV1 as PerformanceBasedAlgorithm&gt;::calculate_rewards(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+47</span><span class="line-content">            from_day,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+48</span><span class="line-content">            to_day,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+49</span><span class="line-content">            node_provider_filter,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+50</span><span class="line-content">            data_provider,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+51</span><span class="line-content">        )<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+52</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+53</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+54</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+55</span><span class="line-content">mod tests {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+56</span><span class="line-content">    #![allow(dead_code)]<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+57</span><span class="line-content">    use crate::performance_based_algorithm::test_utils::{<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+58</span><span class="line-content">        build_daily_metrics, create_rewards_table_for_region_test, generate_rewardable_nodes,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+59</span><span class="line-content">        test_node_id, test_subnet_id, RewardableNode,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+60</span><span class="line-content">    };<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+61</span><span class="line-content">    use crate::performance_based_algorithm::v1::RewardsCalculationV1;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+62</span><span class="line-content">    use crate::performance_based_algorithm::PerformanceBasedAlgorithm;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+63</span><span class="line-content">    use crate::performance_based_algorithm::{AdjustedRewardsResults, BaseRewardsResults};<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+64</span><span class="line-content">    use ic_protobuf::registry::node::v1::NodeRewardType;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+65</span><span class="line-content">    use maplit::btreemap;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+66</span><span class="line-content">    use rust_decimal_macros::dec;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+67</span><span class="line-content">    use std::collections::BTreeMap;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+68</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+69</span><span class="line-content">    // ------------------------------------------------------------------------------------------------<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+70</span><span class="line-content">    // Step 0: Pre-compute subnets and nodes failure rates<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+71</span><span class="line-content">    // ------------------------------------------------------------------------------------------------<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+72</span><span class="line-content">    #[test]<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+73</span><span class="line-content">    fn test_compute_subnets_nodes_fr() {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+74</span><span class="line-content">        let subnet1 = test_subnet_id(1);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+75</span><span class="line-content">        let subnet2 = test_subnet_id(2);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+76</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+77</span><span class="line-content">        // Nodes for Subnet 1<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+78</span><span class="line-content">        let s1_node1 = test_node_id(11);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+79</span><span class="line-content">        let s1_node2 = test_node_id(12);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+80</span><span class="line-content">        let s1_node3 = test_node_id(13);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+81</span><span class="line-content">        let s1_node4 = test_node_id(14);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+82</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+83</span><span class="line-content">        // Nodes for Subnet 2<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+84</span><span class="line-content">        let s2_node1 = test_node_id(21);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+85</span><span class="line-content">        let s2_node2 = test_node_id(22);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+86</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+87</span><span class="line-content">        // --- Data Setup ---<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+88</span><span class="line-content">        let daily_metrics_by_subnet = BTreeMap::from_iter(vec![<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+89</span><span class="line-content">            build_daily_metrics(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+90</span><span class="line-content">                subnet1,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+91</span><span class="line-content">                &amp;[<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+92</span><span class="line-content">                    (s1_node1, 75, 25), // FR = 0.25<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+93</span><span class="line-content">                    (s1_node2, 90, 10), // FR = 0.10<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+94</span><span class="line-content">                    (s1_node3, 95, 5),  // FR = 0.05<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L94" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+95</span><span class="line-content">                    (s1_node4, 50, 50), // FR = 0.50<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+96</span><span class="line-content">                ],<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L96" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+97</span><span class="line-content">            ),<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+98</span><span class="line-content">            build_daily_metrics(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L98" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+99</span><span class="line-content">                subnet2,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+100</span><span class="line-content">                &amp;[<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L100" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+101</span><span class="line-content">                    (s2_node1, 80, 20), // FR = 0.20<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L101" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+102</span><span class="line-content">                    (s2_node2, 60, 40), // FR = 0.40<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+103</span><span class="line-content">                ],<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+104</span><span class="line-content">            ),<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L104" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+105</span><span class="line-content">        ]);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L105" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+106</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L106" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+107</span><span class="line-content">        // --- Execution ---<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L107" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+108</span><span class="line-content">        let result = RewardsCalculationV1::calculate_failure_rates(daily_metrics_by_subnet);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L108" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+109</span><span class="line-content">        let subnets_fr = result.subnets_fr;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L109" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+110</span><span class="line-content">        let original_nodes_fr: BTreeMap&lt;_, _&gt; = result<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L110" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+111</span><span class="line-content">            .nodes_metrics_daily<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L111" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+112</span><span class="line-content">            .iter()<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L112" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+113</span><span class="line-content">            .map(|(k, v)| (*k, v.original_fr))<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L113" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+114</span><span class="line-content">            .collect();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L114" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+115</span><span class="line-content">        let relative_nodes_fr: BTreeMap&lt;_, _&gt; = result<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L115" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+116</span><span class="line-content">            .nodes_metrics_daily<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L116" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+117</span><span class="line-content">            .iter()<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L117" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+118</span><span class="line-content">            .map(|(k, v)| (*k, v.relative_fr))<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L118" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+119</span><span class="line-content">            .collect();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L119" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+120</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L120" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+121</span><span class="line-content">        // --- Assertions for Day 1, Subnet 1 ---<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L121" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+122</span><span class="line-content">        // Sorted FRs: 0.05, 0.10, 0.25, 0.50<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L122" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+123</span><span class="line-content">        // 75th percentile index = ceil(4 * 0.75) - 1 = 2. Value is 0.25<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L123" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+124</span><span class="line-content">        let expected_subnet1_day1_fr = dec!(0.25);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L124" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+125</span><span class="line-content">        assert_eq!(subnets_fr.get(&amp;subnet1), Some(&amp;expected_subnet1_day1_fr));<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L125" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+126</span><span class="line-content">        assert_eq!(original_nodes_fr.get(&amp;s1_node1), Some(&amp;dec!(0.25)));<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L126" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+127</span><span class="line-content">        // Relative FR = max(0, original - subnet_fr)<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L127" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+128</span><span class="line-content">        assert_eq!(relative_nodes_fr.get(&amp;s1_node1), Some(&amp;dec!(0.0))); // 0.25 - 0.25 = 0<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L128" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+129</span><span class="line-content">        assert_eq!(relative_nodes_fr.get(&amp;s1_node2), Some(&amp;dec!(0.0))); // 0.10 - 0.25 &lt; 0<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L129" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+130</span><span class="line-content">        assert_eq!(relative_nodes_fr.get(&amp;s1_node4), Some(&amp;dec!(0.25))); // 0.50 - 0.25 = 0.25<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L130" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+131</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L131" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+132</span><span class="line-content">        // --- Assertions for Day 1, Subnet 2 ---<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L132" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+133</span><span class="line-content">        // Sorted FRs: 0.20, 0.40<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L133" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+134</span><span class="line-content">        // 75th percentile index = ceil(2 * 0.75) - 1 = 1. Value is 0.40<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L134" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+135</span><span class="line-content">        let expected_subnet2_day1_fr = dec!(0.40);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L135" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+136</span><span class="line-content">        assert_eq!(subnets_fr.get(&amp;subnet2), Some(&amp;expected_subnet2_day1_fr));<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L136" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+137</span><span class="line-content">        assert_eq!(original_nodes_fr.get(&amp;s2_node1), Some(&amp;dec!(0.20)));<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L137" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+138</span><span class="line-content">        assert_eq!(relative_nodes_fr.get(&amp;s2_node1), Some(&amp;dec!(0.0))); // 0.20 - 0.40 &lt; 0<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L138" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+139</span><span class="line-content">        assert_eq!(relative_nodes_fr.get(&amp;s2_node1), Some(&amp;dec!(0.0))); // 0.40 - 0.40 = 0<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L139" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+140</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L140" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+141</span><span class="line-content">        // --- Data Setup ---<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L141" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+142</span><span class="line-content">        let daily_metrics_by_subnet = BTreeMap::from_iter(vec![build_daily_metrics(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L142" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+143</span><span class="line-content">            subnet1,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L143" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+144</span><span class="line-content">            &amp;[<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L144" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+145</span><span class="line-content">                (s1_node1, 99, 1), // FR = 0.01<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L145" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+146</span><span class="line-content">                (s1_node2, 0, 0),  // FR = 0.0, but not in rewardable_nodes for day2 so ignored<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+147</span><span class="line-content">            ],<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L147" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+148</span><span class="line-content">        )]);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L148" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+149</span><span class="line-content">        let result = RewardsCalculationV1::calculate_failure_rates(daily_metrics_by_subnet);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+150</span><span class="line-content">        let subnets_fr = result.subnets_fr;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L150" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+151</span><span class="line-content">        let original_nodes_fr: BTreeMap&lt;_, _&gt; = result<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L151" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+152</span><span class="line-content">            .nodes_metrics_daily<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L152" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+153</span><span class="line-content">            .iter()<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L153" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+154</span><span class="line-content">            .map(|(k, v)| (*k, v.original_fr))<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L154" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+155</span><span class="line-content">            .collect();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L155" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+156</span><span class="line-content">        let relative_nodes_fr: BTreeMap&lt;_, _&gt; = result<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L156" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+157</span><span class="line-content">            .nodes_metrics_daily<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L157" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+158</span><span class="line-content">            .iter()<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L158" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+159</span><span class="line-content">            .map(|(k, v)| (*k, v.relative_fr))<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L159" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+160</span><span class="line-content">            .collect();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L160" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+161</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L161" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+162</span><span class="line-content">        // --- Assertions for Day 2, Subnet 1 ---<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L162" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+163</span><span class="line-content">        // Sorted FRs: 0.0, 0.01<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L163" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+164</span><span class="line-content">        // 75th percentile index = ceil(2 * 0.75) - 1 = 1. Value is 0.01<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L164" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+165</span><span class="line-content">        let expected_subnet1_day2_fr = dec!(0.01);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L165" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+166</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L166" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+167</span><span class="line-content">        assert_eq!(subnets_fr.get(&amp;subnet1), Some(&amp;expected_subnet1_day2_fr));<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L167" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+168</span><span class="line-content">        assert_eq!(original_nodes_fr.get(&amp;s1_node1), Some(&amp;dec!(0.01)));<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L168" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+169</span><span class="line-content">        assert_eq!(relative_nodes_fr.get(&amp;s1_node1), Some(&amp;dec!(0.0))); // 0.01 - 0.01 = 0<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L169" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+170</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L170" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+171</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L171" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+172</span><span class="line-content">    // ------------------------------------------------------------------------------------------------<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L172" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+173</span><span class="line-content">    // Step 3: Compute performance multiplier for each node for each provider<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L173" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+174</span><span class="line-content">    // ------------------------------------------------------------------------------------------------<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L174" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+175</span><span class="line-content">    #[test]<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L175" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+176</span><span class="line-content">    fn test_compute_nodes_performance_multiplier() {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L176" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+177</span><span class="line-content">        let node_good = test_node_id(1); // FR below threshold<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L177" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+178</span><span class="line-content">        let node_mid = test_node_id(2); // FR in penalty zone<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L178" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+179</span><span class="line-content">        let node_bad = test_node_id(3); // FR above threshold<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L179" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+180</span><span class="line-content">        let node_unassigned = test_node_id(4); // Uses extrapolated FR<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L180" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+181</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L181" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+182</span><span class="line-content">        // --- Data Setup ---<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L182" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+183</span><span class="line-content">        let rewardable_nodes =<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L183" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+184</span><span class="line-content">            generate_rewardable_nodes(vec![node_good, node_mid, node_bad, node_unassigned]);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L184" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+185</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L185" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+186</span><span class="line-content">        // Assigned nodes&#x27; relative FR<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L186" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+187</span><span class="line-content">        let relative_nodes_fr = btreemap! {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L187" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+188</span><span class="line-content">            node_good =&gt; dec!(0.05), // &lt; 0.1<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L188" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+189</span><span class="line-content">            node_mid =&gt; dec!(0.35), // (0.35-0.1)/(0.6-0.1)*0.8 = 0.4<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L189" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+190</span><span class="line-content">            node_bad =&gt; dec!(0.7),  // &gt; 0.6<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L190" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+191</span><span class="line-content">        };<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L191" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+192</span><span class="line-content">        // Unassigned nodes use extrapolated FR<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L192" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+193</span><span class="line-content">        let extrapolated_fr = dec!(0.35);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L193" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+194</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L194" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+195</span><span class="line-content">        // --- Execution ---<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L195" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+196</span><span class="line-content">        let result = RewardsCalculationV1::calculate_performance_multipliers(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L196" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+197</span><span class="line-content">            &amp;rewardable_nodes,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L197" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+198</span><span class="line-content">            &amp;relative_nodes_fr,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L198" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+199</span><span class="line-content">            &amp;extrapolated_fr,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L199" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+200</span><span class="line-content">        );<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L200" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+201</span><span class="line-content">        let reward_reduction = result.reward_reduction;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L201" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+202</span><span class="line-content">        let performance_multiplier = result.performance_multiplier;<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L202" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+203</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L203" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+204</span><span class="line-content">        // --- Assertions ---<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L204" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+205</span><span class="line-content">        // Good node: reduction = 0, multiplier = 1<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L205" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+206</span><span class="line-content">        assert_eq!(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L206" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+207</span><span class="line-content">            reward_reduction.get(&amp;node_good),<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L207" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+208</span><span class="line-content">            Some(&amp;RewardsCalculationV1::MIN_REWARDS_REDUCTION)<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L208" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+209</span><span class="line-content">        );<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L209" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+210</span><span class="line-content">        assert_eq!(performance_multiplier.get(&amp;node_good), Some(&amp;dec!(1.0)));<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L210" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+211</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L211" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+212</span><span class="line-content">        // Mid node: reduction = 0.4, multiplier = 0.6<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L212" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+213</span><span class="line-content">        assert_eq!(reward_reduction.get(&amp;node_mid), Some(&amp;dec!(0.4)));<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L213" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+214</span><span class="line-content">        assert_eq!(performance_multiplier.get(&amp;node_mid), Some(&amp;dec!(0.6)));<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L214" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+215</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L215" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+216</span><span class="line-content">        // Bad node: reduction = 0.8, multiplier = 0.2<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L216" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+217</span><span class="line-content">        assert_eq!(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L217" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+218</span><span class="line-content">            reward_reduction.get(&amp;node_bad),<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L218" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+219</span><span class="line-content">            Some(&amp;RewardsCalculationV1::MAX_REWARDS_REDUCTION)<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L219" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+220</span><span class="line-content">        );<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L220" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+221</span><span class="line-content">        assert_eq!(performance_multiplier.get(&amp;node_bad), Some(&amp;dec!(0.2)));<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L221" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+222</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L222" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+223</span><span class="line-content">        // Unassigned node (uses extrapolated FR, same as mid)<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L223" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+224</span><span class="line-content">        assert_eq!(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L224" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+225</span><span class="line-content">            performance_multiplier.get(&amp;node_unassigned),<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L225" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+226</span><span class="line-content">            Some(&amp;dec!(0.6))<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L226" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+227</span><span class="line-content">        );<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L227" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+228</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L228" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+229</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L229" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+230</span><span class="line-content">    // ------------------------------------------------------------------------------------------------<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L230" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+231</span><span class="line-content">    // Step 4: Compute base rewards for each node based on its region and node type<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L231" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+232</span><span class="line-content">    // ------------------------------------------------------------------------------------------------<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L232" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+233</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L233" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+234</span><span class="line-content">    #[test]<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L234" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+235</span><span class="line-content">    fn test_compute_base_rewards() {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L235" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+236</span><span class="line-content">        let type1_node = test_node_id(1);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L236" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+237</span><span class="line-content">        let type3_node_ca = test_node_id(2);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L237" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+238</span><span class="line-content">        let type3_node_nv = test_node_id(3);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L238" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+239</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L239" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+240</span><span class="line-content">        let rewardable_nodes = vec![<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L240" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+241</span><span class="line-content">            RewardableNode {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L241" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+242</span><span class="line-content">                node_id: type1_node,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L242" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+243</span><span class="line-content">                node_reward_type: NodeRewardType::Type1,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L243" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+244</span><span class="line-content">                region: &quot;Europe,Switzerland&quot;.into(),<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L244" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+245</span><span class="line-content">                dc_id: &quot;dc1&quot;.into(),<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L245" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+246</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L246" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+247</span><span class="line-content">            RewardableNode {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L247" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+248</span><span class="line-content">                node_id: type3_node_ca,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L248" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+249</span><span class="line-content">                node_reward_type: NodeRewardType::Type3,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L249" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+250</span><span class="line-content">                region: &quot;North America,USA,California&quot;.into(),<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L250" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+251</span><span class="line-content">                dc_id: &quot;dc2&quot;.into(),<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L251" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+252</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L252" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+253</span><span class="line-content">            RewardableNode {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L253" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+254</span><span class="line-content">                node_id: type3_node_nv,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L254" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+255</span><span class="line-content">                node_reward_type: NodeRewardType::Type3dot1,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L255" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+256</span><span class="line-content">                region: &quot;North America,USA,Nevada&quot;.into(),<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L256" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+257</span><span class="line-content">                dc_id: &quot;dc3&quot;.into(),<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L257" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+258</span><span class="line-content">            },<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L258" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+259</span><span class="line-content">        ];<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L259" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+260</span><span class="line-content">        let rewards_table = create_rewards_table_for_region_test();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L260" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+261</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L261" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+262</span><span class="line-content">        // --- Execution ---<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L262" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+263</span><span class="line-content">        let BaseRewardsResults {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L263" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+264</span><span class="line-content">            base_rewards_per_node,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L264" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+265</span><span class="line-content">            ..<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L265" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+266</span><span class="line-content">        } = RewardsCalculationV1::calculate_base_rewards_by_region_and_type(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L266" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+267</span><span class="line-content">            &amp;rewards_table,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L267" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+268</span><span class="line-content">            &amp;rewardable_nodes,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L268" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+269</span><span class="line-content">        );<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L269" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+270</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L270" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+271</span><span class="line-content">        // --- Assertions ---<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L271" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+272</span><span class="line-content">        assert_eq!(base_rewards_per_node.get(&amp;type1_node), Some(&amp;dec!(10000)));<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L272" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+273</span><span class="line-content">        assert_eq!(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L273" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+274</span><span class="line-content">            base_rewards_per_node.get(&amp;type3_node_ca),<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L274" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+275</span><span class="line-content">            Some(&amp;dec!(31500))<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L275" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+276</span><span class="line-content">        );<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L276" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+277</span><span class="line-content">        assert_eq!(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L277" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+278</span><span class="line-content">            base_rewards_per_node.get(&amp;type3_node_nv),<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L278" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+279</span><span class="line-content">            Some(&amp;dec!(31500))<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L279" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+280</span><span class="line-content">        );<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L280" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+281</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L281" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+282</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L282" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+283</span><span class="line-content">    // ------------------------------------------------------------------------------------------------<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L283" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+284</span><span class="line-content">    // Step 5: Adjust nodes rewards based on performance and number of nodes<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L284" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+285</span><span class="line-content">    // ------------------------------------------------------------------------------------------------<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L285" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+286</span><span class="line-content">    #[test]<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L286" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+287</span><span class="line-content">    fn test_adjust_nodes_rewards() {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L287" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+288</span><span class="line-content">        let node1 = test_node_id(1);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L288" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+289</span><span class="line-content">        let node2 = test_node_id(2);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L289" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+290</span><span class="line-content">        let node3 = test_node_id(3);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L290" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+291</span><span class="line-content">        let node4 = test_node_id(4);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L291" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+292</span><span class="line-content">        let node5 = test_node_id(5);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L292" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+293</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L293" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+294</span><span class="line-content">        // Day 1 has 5 nodes, Day 2 and Day 3 has 3 nodes.<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L294" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+295</span><span class="line-content">        let rewardable_nodes = generate_rewardable_nodes(vec![node1, node2, node3, node4, node5]);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L295" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+296</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L296" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+297</span><span class="line-content">        let mut base_rewards = BTreeMap::new();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L297" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+298</span><span class="line-content">        let mut performance_multiplier = BTreeMap::new();<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L298" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+299</span><span class="line-content">        for node in &amp;rewardable_nodes {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L299" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+300</span><span class="line-content">            base_rewards.insert(node.node_id, dec!(1000));<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L300" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+301</span><span class="line-content">            // Assigned nodes<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L301" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+302</span><span class="line-content">            performance_multiplier.insert(node.node_id, dec!(0.5));<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L302" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+303</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L303" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+304</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L304" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+305</span><span class="line-content">        // --- Execution ---<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L305" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+306</span><span class="line-content">        let AdjustedRewardsResults { adjusted_rewards } =<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L306" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+307</span><span class="line-content">            RewardsCalculationV1::apply_performance_adjustments(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L307" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+308</span><span class="line-content">                &amp;rewardable_nodes,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L308" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+309</span><span class="line-content">                &amp;base_rewards,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L309" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+310</span><span class="line-content">                &amp;performance_multiplier,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L310" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+311</span><span class="line-content">            );<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L311" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+312</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L312" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+313</span><span class="line-content">        // --- Assertions ---<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L313" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+314</span><span class="line-content">        let expected = dec!(1000) * dec!(0.5);<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L314" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+315</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L315" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+316</span><span class="line-content">        for node in &amp;[node1, node2, node3, node4, node5] {<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L316" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+317</span><span class="line-content">            assert_eq!(<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L317" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+318</span><span class="line-content">                adjusted_rewards.get(node),<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L318" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+319</span><span class="line-content">                Some(&amp;expected),<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L319" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+320</span><span class="line-content">                &quot;Unexpected reward for node {:?}&quot;,<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L320" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+321</span><span class="line-content">                node<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L321" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+322</span><span class="line-content">            );<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L322" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+323</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L323" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+324</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L324" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+325</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/0226e886d73fa5396d39d71d297e2527cb8cb43f/rs/node_rewards/rewards_calculation/src/performance_based_algorithm/v1.rs#L325" class="github-link" target="_blank">🔗</a></span></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="commit-detail">
                    <div class="commit-header">
                        <div class="commit-title">
                            <a href="https://github.com/dfinity/ic/commit/861616d46ded00091fecbfe01f441b38b56b483c" class="commit-hash-large" target="_blank">861616d46ded00091fecbfe01f441b38b56b483c</a>
                            <span class="badge fix">fix</span>
                        </div>
                        <div class="commit-meta">
                            <span>👤 pietrodimarco-dfinity &lt;124565147+pietrodimarco-dfinity@users.noreply.github.com&gt;</span>
                            <span>📅 2025-09-11</span>
                            <span>📁 24 files</span>
                        </div>
                        <div style="margin-top: 8px; color: #e6edf3; font-size: 0.9em;">
                            fix(NRC): Remove API types from proto (#6693)
                        </div>
                        <div class="commit-actions">
                            <button class="toggle-button secondary" onclick="toggleFiles('files-11')">📁 Files (24)</button>
                            <button class="toggle-button" onclick="toggleDiff('diff-11')">🔍 Code Changes</button>
                        </div>
                        <div id="files-11" class="collapsible">
                            <div class="files-list">
                                <ul><li>rs/node_rewards/canister/BUILD.bazel</li><li>rs/node_rewards/canister/Cargo.toml</li><li>rs/node_rewards/canister/api/BUILD.bazel</li><li>rs/node_rewards/canister/api/Cargo.toml</li><li>rs/node_rewards/canister/api/src/provider_rewards_calculation.rs</li><li>rs/node_rewards/canister/proto/rewards_calculator/pb/v1/types.proto</li><li>rs/node_rewards/canister/protobuf/BUILD.bazel</li><li>rs/node_rewards/canister/protobuf/Cargo.toml</li><li>rs/node_rewards/canister/protobuf/src/conversions.rs</li><li>rs/node_rewards/canister/protobuf/src/gen/rewards_calculator.pb.v1.rs</li><li>rs/node_rewards/canister/protobuf/src/lib.rs</li><li>rs/node_rewards/canister/protobuf/src/pb/ic_node_rewards/mod.rs</li><li>rs/node_rewards/canister/protobuf/src/pb/mod.rs</li><li>rs/node_rewards/canister/protobuf/src/pb/rewards_calculator/mod.rs</li><li>rs/node_rewards/canister/protobuf_generator/src/lib.rs</li><li>rs/node_rewards/canister/protobuf_generator/src/main.rs</li><li>rs/node_rewards/canister/src/api_conversion.rs</li><li>rs/node_rewards/canister/src/canister/mod.rs</li><li>rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs</li><li>rs/node_rewards/canister/src/gen/ic_node_rewards.pb.v1.rs</li><li>rs/node_rewards/canister/src/lib.rs</li><li>rs/node_rewards/canister/src/metrics.rs</li><li>rs/node_rewards/canister/src/metrics/tests.rs</li><li>rs/node_rewards/canister/src/pb/mod.rs</li></ul></div></div>
                        <div id="diff-11" class="collapsible">
                            <div class="diff-container">
                                <div class="line context"><span class="line-number">1</span><span class="line-content">commit 861616d46ded00091fecbfe01f441b38b56b483c</span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content">Author: pietrodimarco-dfinity &lt;124565147+pietrodimarco-dfinity@users.noreply.github.com&gt;</span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content">Date:   Thu Sep 11 08:59:40 2025 +0200</span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content">    fix(NRC): Remove API types from proto (#6693)</span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content">    Changes:</span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content">    - Moved API types in `ic-node-rewards-canister-api`</span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content">    - Removed `protobuf` module</span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content">    - Handled conversion `rewards-calculation` to</span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content">    `ic-node-rewards-canister-api` types within the canister</span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content">diff --git a/rs/node_rewards/canister/BUILD.bazel b/rs/node_rewards/canister/BUILD.bazel</span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content">index 45c9b72f61..f640f6783a 100644</span></div>
<div class="file-header">--- a/rs/node_rewards/canister/BUILD.bazel</div>
<div class="file-header">+++ b/rs/node_rewards/canister/BUILD.bazel</div>
<div class="hunk-header">@@ -11,7 +11,6 @@ DEPENDENCIES = [</div>
<div class="line context"><span class="line-number">11</span><span class="line-content">     &quot;//rs/nervous_system/common&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/BUILD.bazel#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">     &quot;//rs/nns/constants&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/BUILD.bazel#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content">     &quot;//rs/node_rewards/canister/api&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/BUILD.bazel#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-14</span><span class="line-content">    &quot;//rs/node_rewards/canister/protobuf&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/BUILD.bazel#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content">     &quot;//rs/node_rewards/rewards_calculation&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/BUILD.bazel#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content">     &quot;//rs/protobuf&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/BUILD.bazel#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content">     &quot;//rs/registry/canister-client&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/BUILD.bazel#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content">diff --git a/rs/node_rewards/canister/Cargo.toml b/rs/node_rewards/canister/Cargo.toml<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/BUILD.bazel#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content">index 524c28e7dc..c1df86922c 100644<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/BUILD.bazel#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/Cargo.toml</div>
<div class="file-header">+++ b/rs/node_rewards/canister/Cargo.toml</div>
<div class="hunk-header">@@ -26,7 +26,6 @@ ic-nervous-system-canisters = { path = &quot;../../nervous_system/canisters&quot; }</div>
<div class="line context"><span class="line-number">26</span><span class="line-content"> ic-nervous-system-common = { path = &quot;../../nervous_system/common&quot; }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/Cargo.toml#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">27</span><span class="line-content"> ic-nns-constants = { path = &quot;../../nns/constants&quot; }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/Cargo.toml#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">28</span><span class="line-content"> ic-node-rewards-canister-api = { path = &quot;./api&quot; }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/Cargo.toml#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-29</span><span class="line-content">ic-node-rewards-canister-protobuf = { path = &quot;./protobuf&quot; }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/Cargo.toml#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">29</span><span class="line-content"> ic-registry-canister-client = { path = &quot;../../registry/canister-client&quot; }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/Cargo.toml#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">30</span><span class="line-content"> ic-registry-keys = { path = &quot;../../registry/keys&quot; }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/Cargo.toml#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">31</span><span class="line-content"> ic-registry-node-provider-rewards = { path = &quot;../../registry/node_provider_rewards&quot; }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/Cargo.toml#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">32</span><span class="line-content">diff --git a/rs/node_rewards/canister/api/BUILD.bazel b/rs/node_rewards/canister/api/BUILD.bazel<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/Cargo.toml#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">33</span><span class="line-content">index 1594106175..5cede2d4c8 100644<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/Cargo.toml#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/api/BUILD.bazel</div>
<div class="file-header">+++ b/rs/node_rewards/canister/api/BUILD.bazel</div>
<div class="hunk-header">@@ -4,8 +4,8 @@ package(default_visibility = [&quot;//visibility:public&quot;])</div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/BUILD.bazel#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> DEPENDENCIES = [<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/BUILD.bazel#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content">     # Keep sorted.<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/BUILD.bazel#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content">    &quot;//rs/node_rewards/canister/protobuf&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/api/BUILD.bazel#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-8</span><span class="line-content">    &quot;//rs/node_rewards/rewards_calculation&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/api/BUILD.bazel#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+7</span><span class="line-content">    &quot;//rs/nervous_system/proto&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/BUILD.bazel#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content">    &quot;//rs/types/base_types&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/BUILD.bazel#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content">     &quot;@crate_index//:candid&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/BUILD.bazel#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content">     &quot;@crate_index//:ic-cdk&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/BUILD.bazel#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content">     &quot;@crate_index//:serde&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/BUILD.bazel#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">diff --git a/rs/node_rewards/canister/api/Cargo.toml b/rs/node_rewards/canister/api/Cargo.toml<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/BUILD.bazel#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content">index e5067938a8..4c7ddb9b62 100644<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/BUILD.bazel#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/api/Cargo.toml</div>
<div class="file-header">+++ b/rs/node_rewards/canister/api/Cargo.toml</div>
<div class="hunk-header">@@ -11,6 +11,6 @@ path = &quot;src/lib.rs&quot;</div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/Cargo.toml#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> [dependencies]<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/Cargo.toml#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> candid = { workspace = true }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/Cargo.toml#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-14</span><span class="line-content">ic-node-rewards-canister-protobuf = { path = &quot;../protobuf&quot; }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/api/Cargo.toml#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-15</span><span class="line-content">rewards-calculation = { path = &quot;../../rewards_calculation&quot; }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/api/Cargo.toml#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+14</span><span class="line-content">ic-base-types = { path = &quot;../../../types/base_types&quot; }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/Cargo.toml#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+15</span><span class="line-content">ic-nervous-system-proto = { path = &quot;../../../nervous_system/proto&quot; }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/Cargo.toml#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> serde = { workspace = true }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/Cargo.toml#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content">diff --git a/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs b/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/Cargo.toml#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content">index 57bf86c85b..3d674857e3 100644<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/Cargo.toml#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs</div>
<div class="hunk-header">@@ -1,6 +1,4 @@</div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> use candid::{CandidType, Deserialize, Principal};<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content">use ic_node_rewards_canister_protobuf::pb::rewards_calculator::v1::NodeProviderRewards;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-3</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> #[derive(CandidType, Clone, Deserialize)]<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> pub struct GetNodeProviderRewardsCalculationRequest {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content">     pub from_nanos: u64,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -9,3 +7,89 @@ pub struct GetNodeProviderRewardsCalculationRequest {</div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> pub type GetNodeProviderRewardsCalculationResponse = Result&lt;NodeProviderRewards, String&gt;;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+10</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+11</span><span class="line-content">#[derive(<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+12</span><span class="line-content">    PartialOrd, Ord, Eq, candid::CandidType, candid::Deserialize, Clone, Copy, PartialEq, Debug,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+13</span><span class="line-content">)]<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+14</span><span class="line-content">pub struct DayUtc {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+15</span><span class="line-content">    pub value: Option&lt;u64&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+16</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+17</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+18</span><span class="line-content">#[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+19</span><span class="line-content">pub struct NodeMetricsDaily {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+20</span><span class="line-content">    pub subnet_assigned: Option&lt;::ic_base_types::PrincipalId&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+21</span><span class="line-content">    pub subnet_assigned_fr_percent: Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+22</span><span class="line-content">    pub num_blocks_proposed: Option&lt;u64&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+23</span><span class="line-content">    pub num_blocks_failed: Option&lt;u64&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+24</span><span class="line-content">    pub original_fr_percent: Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+25</span><span class="line-content">    pub relative_fr_percent: Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+26</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+27</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+28</span><span class="line-content">#[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+29</span><span class="line-content">pub struct Assigned {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+30</span><span class="line-content">    pub node_metrics: Option&lt;NodeMetricsDaily&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+31</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+32</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+33</span><span class="line-content">#[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+34</span><span class="line-content">pub struct Unassigned {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+35</span><span class="line-content">    pub extrapolated_fr_percent: Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+36</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+37</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+38</span><span class="line-content">#[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+39</span><span class="line-content">pub struct NodeStatus {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+40</span><span class="line-content">    pub status: Option&lt;node_status::Status&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+41</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+42</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+43</span><span class="line-content">/// Nested message and enum types in `NodeStatus`.<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+44</span><span class="line-content">pub mod node_status {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+45</span><span class="line-content">    #[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+46</span><span class="line-content">    pub enum Status {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+47</span><span class="line-content">        Assigned(super::Assigned),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+48</span><span class="line-content">        Unassigned(super::Unassigned),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+49</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+50</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+51</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+52</span><span class="line-content">#[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+53</span><span class="line-content">pub struct DailyResults {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+54</span><span class="line-content">    pub day: Option&lt;DayUtc&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+55</span><span class="line-content">    pub node_status: Option&lt;NodeStatus&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+56</span><span class="line-content">    pub performance_multiplier_percent: Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+57</span><span class="line-content">    pub rewards_reduction_percent: Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+58</span><span class="line-content">    pub base_rewards_xdr_permyriad: Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+59</span><span class="line-content">    pub adjusted_rewards_xdr_permyriad: Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+60</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+61</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+62</span><span class="line-content">#[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+63</span><span class="line-content">pub struct NodeResults {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+64</span><span class="line-content">    pub node_id: Option&lt;::ic_base_types::PrincipalId&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+65</span><span class="line-content">    pub node_reward_type: Option&lt;String&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+66</span><span class="line-content">    pub region: Option&lt;String&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+67</span><span class="line-content">    pub dc_id: Option&lt;String&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+68</span><span class="line-content">    pub daily_results: Vec&lt;DailyResults&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+69</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+70</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+71</span><span class="line-content">#[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+72</span><span class="line-content">pub struct BaseRewards {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+73</span><span class="line-content">    pub monthly_xdr_permyriad: Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+74</span><span class="line-content">    pub daily_xdr_permyriad: Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+75</span><span class="line-content">    pub node_reward_type: Option&lt;String&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+76</span><span class="line-content">    pub region: Option&lt;String&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+77</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+78</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+79</span><span class="line-content">#[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+80</span><span class="line-content">pub struct DailyBaseRewardsType3 {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+81</span><span class="line-content">    pub day: Option&lt;DayUtc&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+82</span><span class="line-content">    pub region: Option&lt;String&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+83</span><span class="line-content">    pub nodes_count: Option&lt;u64&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+84</span><span class="line-content">    pub avg_rewards_xdr_permyriad: Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+85</span><span class="line-content">    pub avg_coefficient_percent: Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+86</span><span class="line-content">    pub value_xdr_permyriad: Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+87</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+88</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+89</span><span class="line-content">#[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, Debug)]<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+90</span><span class="line-content">pub struct NodeProviderRewards {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+91</span><span class="line-content">    pub rewards_total_xdr_permyriad: Option&lt;u64&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+92</span><span class="line-content">    pub base_rewards: Vec&lt;BaseRewards&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+93</span><span class="line-content">    pub base_rewards_type3: Vec&lt;DailyBaseRewardsType3&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+94</span><span class="line-content">    pub nodes_results: Vec&lt;NodeResults&gt;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L94" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+95</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">96</span><span class="line-content">diff --git a/rs/node_rewards/canister/proto/rewards_calculator/pb/v1/types.proto b/rs/node_rewards/canister/proto/rewards_calculator/pb/v1/types.proto<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L96" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">97</span><span class="line-content">deleted file mode 100644<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">98</span><span class="line-content">index bdcaaab580..0000000000<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/api/src/provider_rewards_calculation.rs#L98" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/proto/rewards_calculator/pb/v1/types.proto</div>
<div class="file-header">+++ /dev/null</div>
<div class="hunk-header">@@ -1,74 +0,0 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">syntax = &quot;proto3&quot;;</span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-3</span><span class="line-content">package rewards_calculator.pb.v1;</span></div>
<div class="line removed"><span class="line-number">-4</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-5</span><span class="line-content">import &quot;ic_base_types/pb/v1/types.proto&quot;;</span></div>
<div class="line removed"><span class="line-number">-6</span><span class="line-content">import &quot;ic_nervous_system/pb/v1/nervous_system.proto&quot;;</span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-8</span><span class="line-content">message DayUtc {</span></div>
<div class="line removed"><span class="line-number">-9</span><span class="line-content">  optional uint64 value = 1;</span></div>
<div class="line removed"><span class="line-number">-10</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-11</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-12</span><span class="line-content">message NodeMetricsDaily {</span></div>
<div class="line removed"><span class="line-number">-13</span><span class="line-content">  ic_base_types.pb.v1.PrincipalId subnet_assigned = 1;</span></div>
<div class="line removed"><span class="line-number">-14</span><span class="line-content">  ic_nervous_system.pb.v1.Decimal subnet_assigned_fr_percent = 2;</span></div>
<div class="line removed"><span class="line-number">-15</span><span class="line-content">  optional uint64 num_blocks_proposed = 3;</span></div>
<div class="line removed"><span class="line-number">-16</span><span class="line-content">  optional uint64 num_blocks_failed = 4;</span></div>
<div class="line removed"><span class="line-number">-17</span><span class="line-content">  ic_nervous_system.pb.v1.Decimal original_fr_percent = 5;</span></div>
<div class="line removed"><span class="line-number">-18</span><span class="line-content">  ic_nervous_system.pb.v1.Decimal relative_fr_percent = 6;</span></div>
<div class="line removed"><span class="line-number">-19</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-20</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-21</span><span class="line-content">message Assigned {</span></div>
<div class="line removed"><span class="line-number">-22</span><span class="line-content">  optional NodeMetricsDaily node_metrics = 1;</span></div>
<div class="line removed"><span class="line-number">-23</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-24</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-25</span><span class="line-content">message Unassigned {</span></div>
<div class="line removed"><span class="line-number">-26</span><span class="line-content">  ic_nervous_system.pb.v1.Decimal extrapolated_fr_percent = 1;</span></div>
<div class="line removed"><span class="line-number">-27</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-28</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-29</span><span class="line-content">message NodeStatus {</span></div>
<div class="line removed"><span class="line-number">-30</span><span class="line-content">  oneof status {</span></div>
<div class="line removed"><span class="line-number">-31</span><span class="line-content">    Assigned assigned = 1;</span></div>
<div class="line removed"><span class="line-number">-32</span><span class="line-content">    Unassigned unassigned = 2;</span></div>
<div class="line removed"><span class="line-number">-33</span><span class="line-content">  }</span></div>
<div class="line removed"><span class="line-number">-34</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-35</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-36</span><span class="line-content">message DailyResults {</span></div>
<div class="line removed"><span class="line-number">-37</span><span class="line-content">  DayUtc day = 1;</span></div>
<div class="line removed"><span class="line-number">-38</span><span class="line-content">  optional NodeStatus node_status = 2;</span></div>
<div class="line removed"><span class="line-number">-39</span><span class="line-content">  ic_nervous_system.pb.v1.Decimal performance_multiplier_percent = 3;</span></div>
<div class="line removed"><span class="line-number">-40</span><span class="line-content">  ic_nervous_system.pb.v1.Decimal rewards_reduction_percent = 4;</span></div>
<div class="line removed"><span class="line-number">-41</span><span class="line-content">  ic_nervous_system.pb.v1.Decimal base_rewards_xdr_permyriad = 5;</span></div>
<div class="line removed"><span class="line-number">-42</span><span class="line-content">  ic_nervous_system.pb.v1.Decimal adjusted_rewards_xdr_permyriad = 6;</span></div>
<div class="line removed"><span class="line-number">-43</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-44</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-45</span><span class="line-content">message NodeResults {</span></div>
<div class="line removed"><span class="line-number">-46</span><span class="line-content">  ic_base_types.pb.v1.PrincipalId node_id = 1;</span></div>
<div class="line removed"><span class="line-number">-47</span><span class="line-content">  optional string node_reward_type = 2;</span></div>
<div class="line removed"><span class="line-number">-48</span><span class="line-content">  optional string region = 3;</span></div>
<div class="line removed"><span class="line-number">-49</span><span class="line-content">  optional string dc_id = 4;</span></div>
<div class="line removed"><span class="line-number">-50</span><span class="line-content">  repeated DailyResults daily_results = 5;</span></div>
<div class="line removed"><span class="line-number">-51</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-52</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-53</span><span class="line-content">message BaseRewards {</span></div>
<div class="line removed"><span class="line-number">-54</span><span class="line-content">  ic_nervous_system.pb.v1.Decimal monthly_xdr_permyriad = 1;</span></div>
<div class="line removed"><span class="line-number">-55</span><span class="line-content">  ic_nervous_system.pb.v1.Decimal daily_xdr_permyriad = 2;</span></div>
<div class="line removed"><span class="line-number">-56</span><span class="line-content">  optional string node_reward_type = 3;</span></div>
<div class="line removed"><span class="line-number">-57</span><span class="line-content">  optional string region = 4;</span></div>
<div class="line removed"><span class="line-number">-58</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-59</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-60</span><span class="line-content">message DailyBaseRewardsType3 {</span></div>
<div class="line removed"><span class="line-number">-61</span><span class="line-content">  DayUtc day = 1;</span></div>
<div class="line removed"><span class="line-number">-62</span><span class="line-content">  optional string region = 2;</span></div>
<div class="line removed"><span class="line-number">-63</span><span class="line-content">  optional uint64 nodes_count = 3;</span></div>
<div class="line removed"><span class="line-number">-64</span><span class="line-content">  ic_nervous_system.pb.v1.Decimal avg_rewards_xdr_permyriad = 4;</span></div>
<div class="line removed"><span class="line-number">-65</span><span class="line-content">  ic_nervous_system.pb.v1.Decimal avg_coefficient_percent = 5;</span></div>
<div class="line removed"><span class="line-number">-66</span><span class="line-content">  ic_nervous_system.pb.v1.Decimal value_xdr_permyriad = 6;</span></div>
<div class="line removed"><span class="line-number">-67</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-68</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-69</span><span class="line-content">message NodeProviderRewards {</span></div>
<div class="line removed"><span class="line-number">-70</span><span class="line-content">  optional uint64 rewards_total_xdr_permyriad = 1;</span></div>
<div class="line removed"><span class="line-number">-71</span><span class="line-content">  repeated BaseRewards base_rewards = 2;</span></div>
<div class="line removed"><span class="line-number">-72</span><span class="line-content">  repeated DailyBaseRewardsType3 base_rewards_type3 = 3;</span></div>
<div class="line removed"><span class="line-number">-73</span><span class="line-content">  repeated NodeResults nodes_results = 4;</span></div>
<div class="line removed"><span class="line-number">-74</span><span class="line-content">}</span></div>
<div class="line context"><span class="line-number">0</span><span class="line-content">diff --git a/rs/node_rewards/canister/protobuf/BUILD.bazel b/rs/node_rewards/canister/protobuf/BUILD.bazel</span></div>
<div class="line context"><span class="line-number">1</span><span class="line-content">deleted file mode 100644</span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content">index bb07cab601..0000000000</span></div>
<div class="file-header">--- a/rs/node_rewards/canister/protobuf/BUILD.bazel</div>
<div class="file-header">+++ /dev/null</div>
<div class="hunk-header">@@ -1,36 +0,0 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">load(&quot;@rules_rust//rust:defs.bzl&quot;, &quot;rust_library&quot;)</span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-3</span><span class="line-content">package(default_visibility = [&quot;//visibility:public&quot;])</span></div>
<div class="line removed"><span class="line-number">-4</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-5</span><span class="line-content">DEPENDENCIES = [</span></div>
<div class="line removed"><span class="line-number">-6</span><span class="line-content">    # Keep sorted.</span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content">    &quot;//rs/nervous_system/proto&quot;,</span></div>
<div class="line removed"><span class="line-number">-8</span><span class="line-content">    &quot;//rs/node_rewards/rewards_calculation&quot;,</span></div>
<div class="line removed"><span class="line-number">-9</span><span class="line-content">    &quot;//rs/types/base_types&quot;,</span></div>
<div class="line removed"><span class="line-number">-10</span><span class="line-content">    &quot;@crate_index//:candid&quot;,</span></div>
<div class="line removed"><span class="line-number">-11</span><span class="line-content">    &quot;@crate_index//:ic-cdk&quot;,</span></div>
<div class="line removed"><span class="line-number">-12</span><span class="line-content">    &quot;@crate_index//:ic-management-canister-types&quot;,</span></div>
<div class="line removed"><span class="line-number">-13</span><span class="line-content">    &quot;@crate_index//:ic-stable-structures&quot;,</span></div>
<div class="line removed"><span class="line-number">-14</span><span class="line-content">    &quot;@crate_index//:prost&quot;,</span></div>
<div class="line removed"><span class="line-number">-15</span><span class="line-content">    &quot;@crate_index//:serde&quot;,</span></div>
<div class="line removed"><span class="line-number">-16</span><span class="line-content">]</span></div>
<div class="line removed"><span class="line-number">-17</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-18</span><span class="line-content">MACRO_DEPENDENCIES = [</span></div>
<div class="line removed"><span class="line-number">-19</span><span class="line-content">    # Keep sorted.</span></div>
<div class="line removed"><span class="line-number">-20</span><span class="line-content">]</span></div>
<div class="line removed"><span class="line-number">-21</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-22</span><span class="line-content">LIB_SRCS = glob(</span></div>
<div class="line removed"><span class="line-number">-23</span><span class="line-content">    [</span></div>
<div class="line removed"><span class="line-number">-24</span><span class="line-content">        &quot;src/**/*.rs&quot;,</span></div>
<div class="line removed"><span class="line-number">-25</span><span class="line-content">    ],</span></div>
<div class="line removed"><span class="line-number">-26</span><span class="line-content">    exclude = [&quot;**/*tests*/**&quot;],</span></div>
<div class="line removed"><span class="line-number">-27</span><span class="line-content">)</span></div>
<div class="line removed"><span class="line-number">-28</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-29</span><span class="line-content">rust_library(</span></div>
<div class="line removed"><span class="line-number">-30</span><span class="line-content">    name = &quot;protobuf&quot;,</span></div>
<div class="line removed"><span class="line-number">-31</span><span class="line-content">    srcs = LIB_SRCS,</span></div>
<div class="line removed"><span class="line-number">-32</span><span class="line-content">    crate_name = &quot;ic_node_rewards_canister_protobuf&quot;,</span></div>
<div class="line removed"><span class="line-number">-33</span><span class="line-content">    proc_macro_deps = MACRO_DEPENDENCIES,</span></div>
<div class="line removed"><span class="line-number">-34</span><span class="line-content">    version = &quot;0.9.0&quot;,</span></div>
<div class="line removed"><span class="line-number">-35</span><span class="line-content">    deps = DEPENDENCIES,</span></div>
<div class="line removed"><span class="line-number">-36</span><span class="line-content">)</span></div>
<div class="line context"><span class="line-number">0</span><span class="line-content">diff --git a/rs/node_rewards/canister/protobuf/Cargo.toml b/rs/node_rewards/canister/protobuf/Cargo.toml</span></div>
<div class="line context"><span class="line-number">1</span><span class="line-content">deleted file mode 100644</span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content">index 71a1ddfb5d..0000000000</span></div>
<div class="file-header">--- a/rs/node_rewards/canister/protobuf/Cargo.toml</div>
<div class="file-header">+++ /dev/null</div>
<div class="hunk-header">@@ -1,20 +0,0 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">[package]</span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content">name = &quot;ic-node-rewards-canister-protobuf&quot;</span></div>
<div class="line removed"><span class="line-number">-3</span><span class="line-content">version.workspace = true</span></div>
<div class="line removed"><span class="line-number">-4</span><span class="line-content">authors.workspace = true</span></div>
<div class="line removed"><span class="line-number">-5</span><span class="line-content">edition.workspace = true</span></div>
<div class="line removed"><span class="line-number">-6</span><span class="line-content">description.workspace = true</span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content">documentation.workspace = true</span></div>
<div class="line removed"><span class="line-number">-8</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-9</span><span class="line-content">[lib]</span></div>
<div class="line removed"><span class="line-number">-10</span><span class="line-content">path = &quot;src/lib.rs&quot;</span></div>
<div class="line removed"><span class="line-number">-11</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-12</span><span class="line-content">[dependencies]</span></div>
<div class="line removed"><span class="line-number">-13</span><span class="line-content">candid = { workspace = true }</span></div>
<div class="line removed"><span class="line-number">-14</span><span class="line-content">ic-base-types = { path = &quot;../../../types/base_types&quot; }</span></div>
<div class="line removed"><span class="line-number">-15</span><span class="line-content">ic-management-canister-types = { workspace = true }</span></div>
<div class="line removed"><span class="line-number">-16</span><span class="line-content">ic-nervous-system-proto = { path = &quot;../../../nervous_system/proto&quot; }</span></div>
<div class="line removed"><span class="line-number">-17</span><span class="line-content">ic-stable-structures = { workspace = true }</span></div>
<div class="line removed"><span class="line-number">-18</span><span class="line-content">prost = { workspace = true }</span></div>
<div class="line removed"><span class="line-number">-19</span><span class="line-content">rewards-calculation = { path = &quot;../../rewards_calculation&quot; }</span></div>
<div class="line removed"><span class="line-number">-20</span><span class="line-content">serde = { workspace = true }</span></div>
<div class="line context"><span class="line-number">0</span><span class="line-content">diff --git a/rs/node_rewards/canister/protobuf/src/conversions.rs b/rs/node_rewards/canister/protobuf/src/conversions.rs</span></div>
<div class="line context"><span class="line-number">1</span><span class="line-content">deleted file mode 100644</span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content">index 605186f2b7..0000000000</span></div>
<div class="file-header">--- a/rs/node_rewards/canister/protobuf/src/conversions.rs</div>
<div class="file-header">+++ /dev/null</div>
<div class="hunk-header">@@ -1,192 +0,0 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">use crate::pb;</span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content">use ic_base_types::SubnetId;</span></div>
<div class="line removed"><span class="line-number">-3</span><span class="line-content">use ic_management_canister_types::NodeMetrics;</span></div>
<div class="line removed"><span class="line-number">-4</span><span class="line-content">use rewards_calculation::rewards_calculator_results::{</span></div>
<div class="line removed"><span class="line-number">-5</span><span class="line-content">    BaseRewards, DailyBaseRewardsType3, DailyResults, NodeMetricsDaily, NodeProviderRewards,</span></div>
<div class="line removed"><span class="line-number">-6</span><span class="line-content">    NodeResults, NodeStatus,</span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content">};</span></div>
<div class="line removed"><span class="line-number">-8</span><span class="line-content">use rewards_calculation::types::{DayUtc, SubnetMetricsDailyKey};</span></div>
<div class="line removed"><span class="line-number">-9</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-10</span><span class="line-content">impl From&lt;SubnetId&gt; for pb::ic_node_rewards::v1::SubnetIdKey {</span></div>
<div class="line removed"><span class="line-number">-11</span><span class="line-content">    fn from(subnet_id: SubnetId) -&gt; Self {</span></div>
<div class="line removed"><span class="line-number">-12</span><span class="line-content">        Self {</span></div>
<div class="line removed"><span class="line-number">-13</span><span class="line-content">            subnet_id: Some(subnet_id.get()),</span></div>
<div class="line removed"><span class="line-number">-14</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-15</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-16</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-17</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-18</span><span class="line-content">impl From&lt;pb::ic_node_rewards::v1::SubnetIdKey&gt; for SubnetId {</span></div>
<div class="line removed"><span class="line-number">-19</span><span class="line-content">    fn from(subnet_id: pb::ic_node_rewards::v1::SubnetIdKey) -&gt; Self {</span></div>
<div class="line removed"><span class="line-number">-20</span><span class="line-content">        subnet_id.subnet_id.unwrap().into()</span></div>
<div class="line removed"><span class="line-number">-21</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-22</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-23</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-24</span><span class="line-content">impl From&lt;pb::ic_node_rewards::v1::SubnetMetricsKey&gt; for SubnetMetricsDailyKey {</span></div>
<div class="line removed"><span class="line-number">-25</span><span class="line-content">    fn from(key: pb::ic_node_rewards::v1::SubnetMetricsKey) -&gt; Self {</span></div>
<div class="line removed"><span class="line-number">-26</span><span class="line-content">        Self {</span></div>
<div class="line removed"><span class="line-number">-27</span><span class="line-content">            day: key.timestamp_nanos.into(),</span></div>
<div class="line removed"><span class="line-number">-28</span><span class="line-content">            subnet_id: SubnetId::from(key.subnet_id.unwrap()),</span></div>
<div class="line removed"><span class="line-number">-29</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-30</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-31</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-32</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-33</span><span class="line-content">impl From&lt;NodeMetrics&gt; for pb::ic_node_rewards::v1::NodeMetrics {</span></div>
<div class="line removed"><span class="line-number">-34</span><span class="line-content">    fn from(metrics: NodeMetrics) -&gt; Self {</span></div>
<div class="line removed"><span class="line-number">-35</span><span class="line-content">        pb::ic_node_rewards::v1::NodeMetrics {</span></div>
<div class="line removed"><span class="line-number">-36</span><span class="line-content">            node_id: Some(metrics.node_id.into()),</span></div>
<div class="line removed"><span class="line-number">-37</span><span class="line-content">            num_blocks_proposed_total: metrics.num_blocks_proposed_total,</span></div>
<div class="line removed"><span class="line-number">-38</span><span class="line-content">            num_blocks_failed_total: metrics.num_block_failures_total,</span></div>
<div class="line removed"><span class="line-number">-39</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-40</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-41</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-42</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-43</span><span class="line-content">impl From&lt;NodeProviderRewards&gt; for pb::rewards_calculator::v1::NodeProviderRewards {</span></div>
<div class="line removed"><span class="line-number">-44</span><span class="line-content">    fn from(</span></div>
<div class="line removed"><span class="line-number">-45</span><span class="line-content">        NodeProviderRewards {</span></div>
<div class="line removed"><span class="line-number">-46</span><span class="line-content">            rewards_total_xdr_permyriad,</span></div>
<div class="line removed"><span class="line-number">-47</span><span class="line-content">            base_rewards,</span></div>
<div class="line removed"><span class="line-number">-48</span><span class="line-content">            base_rewards_type3,</span></div>
<div class="line removed"><span class="line-number">-49</span><span class="line-content">            nodes_results,</span></div>
<div class="line removed"><span class="line-number">-50</span><span class="line-content">        }: NodeProviderRewards,</span></div>
<div class="line removed"><span class="line-number">-51</span><span class="line-content">    ) -&gt; Self {</span></div>
<div class="line removed"><span class="line-number">-52</span><span class="line-content">        Self {</span></div>
<div class="line removed"><span class="line-number">-53</span><span class="line-content">            rewards_total_xdr_permyriad: rewards_total_xdr_permyriad.into(),</span></div>
<div class="line removed"><span class="line-number">-54</span><span class="line-content">            base_rewards: base_rewards.into_iter().map(Into::into).collect(),</span></div>
<div class="line removed"><span class="line-number">-55</span><span class="line-content">            base_rewards_type3: base_rewards_type3.into_iter().map(Into::into).collect(),</span></div>
<div class="line removed"><span class="line-number">-56</span><span class="line-content">            nodes_results: nodes_results.into_iter().map(Into::into).collect(),</span></div>
<div class="line removed"><span class="line-number">-57</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-58</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-59</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-60</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-61</span><span class="line-content">impl From&lt;NodeResults&gt; for pb::rewards_calculator::v1::NodeResults {</span></div>
<div class="line removed"><span class="line-number">-62</span><span class="line-content">    fn from(</span></div>
<div class="line removed"><span class="line-number">-63</span><span class="line-content">        NodeResults {</span></div>
<div class="line removed"><span class="line-number">-64</span><span class="line-content">            node_id,</span></div>
<div class="line removed"><span class="line-number">-65</span><span class="line-content">            node_reward_type,</span></div>
<div class="line removed"><span class="line-number">-66</span><span class="line-content">            region,</span></div>
<div class="line removed"><span class="line-number">-67</span><span class="line-content">            dc_id,</span></div>
<div class="line removed"><span class="line-number">-68</span><span class="line-content">            daily_results,</span></div>
<div class="line removed"><span class="line-number">-69</span><span class="line-content">        }: NodeResults,</span></div>
<div class="line removed"><span class="line-number">-70</span><span class="line-content">    ) -&gt; Self {</span></div>
<div class="line removed"><span class="line-number">-71</span><span class="line-content">        Self {</span></div>
<div class="line removed"><span class="line-number">-72</span><span class="line-content">            node_id: Some(node_id.get()),</span></div>
<div class="line removed"><span class="line-number">-73</span><span class="line-content">            node_reward_type: Some(node_reward_type.to_string()),</span></div>
<div class="line removed"><span class="line-number">-74</span><span class="line-content">            region: Some(region),</span></div>
<div class="line removed"><span class="line-number">-75</span><span class="line-content">            dc_id: Some(dc_id),</span></div>
<div class="line removed"><span class="line-number">-76</span><span class="line-content">            daily_results: daily_results.into_iter().map(Into::into).collect(),</span></div>
<div class="line removed"><span class="line-number">-77</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-78</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-79</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-80</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-81</span><span class="line-content">impl From&lt;DailyResults&gt; for pb::rewards_calculator::v1::DailyResults {</span></div>
<div class="line removed"><span class="line-number">-82</span><span class="line-content">    fn from(</span></div>
<div class="line removed"><span class="line-number">-83</span><span class="line-content">        DailyResults {</span></div>
<div class="line removed"><span class="line-number">-84</span><span class="line-content">            day,</span></div>
<div class="line removed"><span class="line-number">-85</span><span class="line-content">            node_status,</span></div>
<div class="line removed"><span class="line-number">-86</span><span class="line-content">            performance_multiplier,</span></div>
<div class="line removed"><span class="line-number">-87</span><span class="line-content">            rewards_reduction,</span></div>
<div class="line removed"><span class="line-number">-88</span><span class="line-content">            base_rewards,</span></div>
<div class="line removed"><span class="line-number">-89</span><span class="line-content">            adjusted_rewards,</span></div>
<div class="line removed"><span class="line-number">-90</span><span class="line-content">        }: DailyResults,</span></div>
<div class="line removed"><span class="line-number">-91</span><span class="line-content">    ) -&gt; Self {</span></div>
<div class="line removed"><span class="line-number">-92</span><span class="line-content">        Self {</span></div>
<div class="line removed"><span class="line-number">-93</span><span class="line-content">            day: Some(day.into()),</span></div>
<div class="line removed"><span class="line-number">-94</span><span class="line-content">            node_status: Some(node_status.into()),</span></div>
<div class="line removed"><span class="line-number">-95</span><span class="line-content">            performance_multiplier_percent: Some(performance_multiplier.into()),</span></div>
<div class="line removed"><span class="line-number">-96</span><span class="line-content">            rewards_reduction_percent: Some(rewards_reduction.into()),</span></div>
<div class="line removed"><span class="line-number">-97</span><span class="line-content">            base_rewards_xdr_permyriad: Some(base_rewards.into()),</span></div>
<div class="line removed"><span class="line-number">-98</span><span class="line-content">            adjusted_rewards_xdr_permyriad: Some(adjusted_rewards.into()),</span></div>
<div class="line removed"><span class="line-number">-99</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-100</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-101</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-102</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-103</span><span class="line-content">impl From&lt;BaseRewards&gt; for pb::rewards_calculator::v1::BaseRewards {</span></div>
<div class="line removed"><span class="line-number">-104</span><span class="line-content">    fn from(</span></div>
<div class="line removed"><span class="line-number">-105</span><span class="line-content">        BaseRewards {</span></div>
<div class="line removed"><span class="line-number">-106</span><span class="line-content">            node_reward_type,</span></div>
<div class="line removed"><span class="line-number">-107</span><span class="line-content">            region,</span></div>
<div class="line removed"><span class="line-number">-108</span><span class="line-content">            monthly,</span></div>
<div class="line removed"><span class="line-number">-109</span><span class="line-content">            daily,</span></div>
<div class="line removed"><span class="line-number">-110</span><span class="line-content">        }: BaseRewards,</span></div>
<div class="line removed"><span class="line-number">-111</span><span class="line-content">    ) -&gt; Self {</span></div>
<div class="line removed"><span class="line-number">-112</span><span class="line-content">        Self {</span></div>
<div class="line removed"><span class="line-number">-113</span><span class="line-content">            node_reward_type: Some(node_reward_type.as_str_name().to_string()),</span></div>
<div class="line removed"><span class="line-number">-114</span><span class="line-content">            region: Some(region),</span></div>
<div class="line removed"><span class="line-number">-115</span><span class="line-content">            monthly_xdr_permyriad: Some(monthly.into()),</span></div>
<div class="line removed"><span class="line-number">-116</span><span class="line-content">            daily_xdr_permyriad: Some(daily.into()),</span></div>
<div class="line removed"><span class="line-number">-117</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-118</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-119</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-120</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-121</span><span class="line-content">impl From&lt;DailyBaseRewardsType3&gt; for pb::rewards_calculator::v1::DailyBaseRewardsType3 {</span></div>
<div class="line removed"><span class="line-number">-122</span><span class="line-content">    fn from(</span></div>
<div class="line removed"><span class="line-number">-123</span><span class="line-content">        DailyBaseRewardsType3 {</span></div>
<div class="line removed"><span class="line-number">-124</span><span class="line-content">            day,</span></div>
<div class="line removed"><span class="line-number">-125</span><span class="line-content">            region,</span></div>
<div class="line removed"><span class="line-number">-126</span><span class="line-content">            nodes_count,</span></div>
<div class="line removed"><span class="line-number">-127</span><span class="line-content">            avg_rewards,</span></div>
<div class="line removed"><span class="line-number">-128</span><span class="line-content">            avg_coefficient,</span></div>
<div class="line removed"><span class="line-number">-129</span><span class="line-content">            value,</span></div>
<div class="line removed"><span class="line-number">-130</span><span class="line-content">        }: DailyBaseRewardsType3,</span></div>
<div class="line removed"><span class="line-number">-131</span><span class="line-content">    ) -&gt; Self {</span></div>
<div class="line removed"><span class="line-number">-132</span><span class="line-content">        Self {</span></div>
<div class="line removed"><span class="line-number">-133</span><span class="line-content">            day: Some(day.into()),</span></div>
<div class="line removed"><span class="line-number">-134</span><span class="line-content">            region: Some(region),</span></div>
<div class="line removed"><span class="line-number">-135</span><span class="line-content">            nodes_count: Some(nodes_count as u64),</span></div>
<div class="line removed"><span class="line-number">-136</span><span class="line-content">            avg_rewards_xdr_permyriad: Some(avg_rewards.into()),</span></div>
<div class="line removed"><span class="line-number">-137</span><span class="line-content">            avg_coefficient_percent: Some(avg_coefficient.into()),</span></div>
<div class="line removed"><span class="line-number">-138</span><span class="line-content">            value_xdr_permyriad: Some(value.into()),</span></div>
<div class="line removed"><span class="line-number">-139</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-140</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-141</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-142</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-143</span><span class="line-content">impl From&lt;NodeStatus&gt; for pb::rewards_calculator::v1::NodeStatus {</span></div>
<div class="line removed"><span class="line-number">-144</span><span class="line-content">    fn from(value: NodeStatus) -&gt; Self {</span></div>
<div class="line removed"><span class="line-number">-145</span><span class="line-content">        match value {</span></div>
<div class="line removed"><span class="line-number">-146</span><span class="line-content">            NodeStatus::Assigned { node_metrics } =&gt; Self {</span></div>
<div class="line removed"><span class="line-number">-147</span><span class="line-content">                status: Some(pb::rewards_calculator::v1::node_status::Status::Assigned(</span></div>
<div class="line removed"><span class="line-number">-148</span><span class="line-content">                    pb::rewards_calculator::v1::Assigned {</span></div>
<div class="line removed"><span class="line-number">-149</span><span class="line-content">                        node_metrics: Some(node_metrics.into()),</span></div>
<div class="line removed"><span class="line-number">-150</span><span class="line-content">                    },</span></div>
<div class="line removed"><span class="line-number">-151</span><span class="line-content">                )),</span></div>
<div class="line removed"><span class="line-number">-152</span><span class="line-content">            },</span></div>
<div class="line removed"><span class="line-number">-153</span><span class="line-content">            NodeStatus::Unassigned { extrapolated_fr } =&gt; Self {</span></div>
<div class="line removed"><span class="line-number">-154</span><span class="line-content">                status: Some(pb::rewards_calculator::v1::node_status::Status::Unassigned(</span></div>
<div class="line removed"><span class="line-number">-155</span><span class="line-content">                    pb::rewards_calculator::v1::Unassigned {</span></div>
<div class="line removed"><span class="line-number">-156</span><span class="line-content">                        extrapolated_fr_percent: Some(extrapolated_fr.into()),</span></div>
<div class="line removed"><span class="line-number">-157</span><span class="line-content">                    },</span></div>
<div class="line removed"><span class="line-number">-158</span><span class="line-content">                )),</span></div>
<div class="line removed"><span class="line-number">-159</span><span class="line-content">            },</span></div>
<div class="line removed"><span class="line-number">-160</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-161</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-162</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-163</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-164</span><span class="line-content">impl From&lt;DayUtc&gt; for pb::rewards_calculator::v1::DayUtc {</span></div>
<div class="line removed"><span class="line-number">-165</span><span class="line-content">    fn from(day: DayUtc) -&gt; Self {</span></div>
<div class="line removed"><span class="line-number">-166</span><span class="line-content">        Self {</span></div>
<div class="line removed"><span class="line-number">-167</span><span class="line-content">            value: Some(day.unix_ts_at_day_end()),</span></div>
<div class="line removed"><span class="line-number">-168</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-169</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-170</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-171</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-172</span><span class="line-content">impl From&lt;NodeMetricsDaily&gt; for pb::rewards_calculator::v1::NodeMetricsDaily {</span></div>
<div class="line removed"><span class="line-number">-173</span><span class="line-content">    fn from(</span></div>
<div class="line removed"><span class="line-number">-174</span><span class="line-content">        NodeMetricsDaily {</span></div>
<div class="line removed"><span class="line-number">-175</span><span class="line-content">            subnet_assigned,</span></div>
<div class="line removed"><span class="line-number">-176</span><span class="line-content">            subnet_assigned_fr,</span></div>
<div class="line removed"><span class="line-number">-177</span><span class="line-content">            num_blocks_proposed,</span></div>
<div class="line removed"><span class="line-number">-178</span><span class="line-content">            num_blocks_failed,</span></div>
<div class="line removed"><span class="line-number">-179</span><span class="line-content">            original_fr,</span></div>
<div class="line removed"><span class="line-number">-180</span><span class="line-content">            relative_fr,</span></div>
<div class="line removed"><span class="line-number">-181</span><span class="line-content">        }: NodeMetricsDaily,</span></div>
<div class="line removed"><span class="line-number">-182</span><span class="line-content">    ) -&gt; Self {</span></div>
<div class="line removed"><span class="line-number">-183</span><span class="line-content">        Self {</span></div>
<div class="line removed"><span class="line-number">-184</span><span class="line-content">            subnet_assigned: Some(subnet_assigned.get()),</span></div>
<div class="line removed"><span class="line-number">-185</span><span class="line-content">            subnet_assigned_fr_percent: Some(subnet_assigned_fr.into()),</span></div>
<div class="line removed"><span class="line-number">-186</span><span class="line-content">            num_blocks_proposed: Some(num_blocks_proposed),</span></div>
<div class="line removed"><span class="line-number">-187</span><span class="line-content">            num_blocks_failed: Some(num_blocks_failed),</span></div>
<div class="line removed"><span class="line-number">-188</span><span class="line-content">            original_fr_percent: Some(original_fr.into()),</span></div>
<div class="line removed"><span class="line-number">-189</span><span class="line-content">            relative_fr_percent: Some(relative_fr.into()),</span></div>
<div class="line removed"><span class="line-number">-190</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-191</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-192</span><span class="line-content">}</span></div>
<div class="line context"><span class="line-number">0</span><span class="line-content">diff --git a/rs/node_rewards/canister/protobuf/src/gen/rewards_calculator.pb.v1.rs b/rs/node_rewards/canister/protobuf/src/gen/rewards_calculator.pb.v1.rs</span></div>
<div class="line context"><span class="line-number">1</span><span class="line-content">deleted file mode 100644</span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content">index 87931f0ba5..0000000000</span></div>
<div class="file-header">--- a/rs/node_rewards/canister/protobuf/src/gen/rewards_calculator.pb.v1.rs</div>
<div class="file-header">+++ /dev/null</div>
<div class="hunk-header">@@ -1,127 +0,0 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">// This file is @generated by prost-build.</span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content">#[derive(</span></div>
<div class="line removed"><span class="line-number">-3</span><span class="line-content">    PartialOrd,</span></div>
<div class="line removed"><span class="line-number">-4</span><span class="line-content">    Ord,</span></div>
<div class="line removed"><span class="line-number">-5</span><span class="line-content">    Eq,</span></div>
<div class="line removed"><span class="line-number">-6</span><span class="line-content">    candid::CandidType,</span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content">    candid::Deserialize,</span></div>
<div class="line removed"><span class="line-number">-8</span><span class="line-content">    Clone,</span></div>
<div class="line removed"><span class="line-number">-9</span><span class="line-content">    Copy,</span></div>
<div class="line removed"><span class="line-number">-10</span><span class="line-content">    PartialEq,</span></div>
<div class="line removed"><span class="line-number">-11</span><span class="line-content">    ::prost::Message,</span></div>
<div class="line removed"><span class="line-number">-12</span><span class="line-content">)]</span></div>
<div class="line removed"><span class="line-number">-13</span><span class="line-content">pub struct DayUtc {</span></div>
<div class="line removed"><span class="line-number">-14</span><span class="line-content">    #[prost(uint64, optional, tag = &quot;1&quot;)]</span></div>
<div class="line removed"><span class="line-number">-15</span><span class="line-content">    pub value: ::core::option::Option&lt;u64&gt;,</span></div>
<div class="line removed"><span class="line-number">-16</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-17</span><span class="line-content">#[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, ::prost::Message)]</span></div>
<div class="line removed"><span class="line-number">-18</span><span class="line-content">pub struct NodeMetricsDaily {</span></div>
<div class="line removed"><span class="line-number">-19</span><span class="line-content">    #[prost(message, optional, tag = &quot;1&quot;)]</span></div>
<div class="line removed"><span class="line-number">-20</span><span class="line-content">    pub subnet_assigned: ::core::option::Option&lt;::ic_base_types::PrincipalId&gt;,</span></div>
<div class="line removed"><span class="line-number">-21</span><span class="line-content">    #[prost(message, optional, tag = &quot;2&quot;)]</span></div>
<div class="line removed"><span class="line-number">-22</span><span class="line-content">    pub subnet_assigned_fr_percent:</span></div>
<div class="line removed"><span class="line-number">-23</span><span class="line-content">        ::core::option::Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,</span></div>
<div class="line removed"><span class="line-number">-24</span><span class="line-content">    #[prost(uint64, optional, tag = &quot;3&quot;)]</span></div>
<div class="line removed"><span class="line-number">-25</span><span class="line-content">    pub num_blocks_proposed: ::core::option::Option&lt;u64&gt;,</span></div>
<div class="line removed"><span class="line-number">-26</span><span class="line-content">    #[prost(uint64, optional, tag = &quot;4&quot;)]</span></div>
<div class="line removed"><span class="line-number">-27</span><span class="line-content">    pub num_blocks_failed: ::core::option::Option&lt;u64&gt;,</span></div>
<div class="line removed"><span class="line-number">-28</span><span class="line-content">    #[prost(message, optional, tag = &quot;5&quot;)]</span></div>
<div class="line removed"><span class="line-number">-29</span><span class="line-content">    pub original_fr_percent: ::core::option::Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,</span></div>
<div class="line removed"><span class="line-number">-30</span><span class="line-content">    #[prost(message, optional, tag = &quot;6&quot;)]</span></div>
<div class="line removed"><span class="line-number">-31</span><span class="line-content">    pub relative_fr_percent: ::core::option::Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,</span></div>
<div class="line removed"><span class="line-number">-32</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-33</span><span class="line-content">#[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, ::prost::Message)]</span></div>
<div class="line removed"><span class="line-number">-34</span><span class="line-content">pub struct Assigned {</span></div>
<div class="line removed"><span class="line-number">-35</span><span class="line-content">    #[prost(message, optional, tag = &quot;1&quot;)]</span></div>
<div class="line removed"><span class="line-number">-36</span><span class="line-content">    pub node_metrics: ::core::option::Option&lt;NodeMetricsDaily&gt;,</span></div>
<div class="line removed"><span class="line-number">-37</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-38</span><span class="line-content">#[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, ::prost::Message)]</span></div>
<div class="line removed"><span class="line-number">-39</span><span class="line-content">pub struct Unassigned {</span></div>
<div class="line removed"><span class="line-number">-40</span><span class="line-content">    #[prost(message, optional, tag = &quot;1&quot;)]</span></div>
<div class="line removed"><span class="line-number">-41</span><span class="line-content">    pub extrapolated_fr_percent: ::core::option::Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,</span></div>
<div class="line removed"><span class="line-number">-42</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-43</span><span class="line-content">#[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, ::prost::Message)]</span></div>
<div class="line removed"><span class="line-number">-44</span><span class="line-content">pub struct NodeStatus {</span></div>
<div class="line removed"><span class="line-number">-45</span><span class="line-content">    #[prost(oneof = &quot;node_status::Status&quot;, tags = &quot;1, 2&quot;)]</span></div>
<div class="line removed"><span class="line-number">-46</span><span class="line-content">    pub status: ::core::option::Option&lt;node_status::Status&gt;,</span></div>
<div class="line removed"><span class="line-number">-47</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-48</span><span class="line-content">/// Nested message and enum types in `NodeStatus`.</span></div>
<div class="line removed"><span class="line-number">-49</span><span class="line-content">pub mod node_status {</span></div>
<div class="line removed"><span class="line-number">-50</span><span class="line-content">    #[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, ::prost::Oneof)]</span></div>
<div class="line removed"><span class="line-number">-51</span><span class="line-content">    pub enum Status {</span></div>
<div class="line removed"><span class="line-number">-52</span><span class="line-content">        #[prost(message, tag = &quot;1&quot;)]</span></div>
<div class="line removed"><span class="line-number">-53</span><span class="line-content">        Assigned(super::Assigned),</span></div>
<div class="line removed"><span class="line-number">-54</span><span class="line-content">        #[prost(message, tag = &quot;2&quot;)]</span></div>
<div class="line removed"><span class="line-number">-55</span><span class="line-content">        Unassigned(super::Unassigned),</span></div>
<div class="line removed"><span class="line-number">-56</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-57</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-58</span><span class="line-content">#[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, ::prost::Message)]</span></div>
<div class="line removed"><span class="line-number">-59</span><span class="line-content">pub struct DailyResults {</span></div>
<div class="line removed"><span class="line-number">-60</span><span class="line-content">    #[prost(message, optional, tag = &quot;1&quot;)]</span></div>
<div class="line removed"><span class="line-number">-61</span><span class="line-content">    pub day: ::core::option::Option&lt;DayUtc&gt;,</span></div>
<div class="line removed"><span class="line-number">-62</span><span class="line-content">    #[prost(message, optional, tag = &quot;2&quot;)]</span></div>
<div class="line removed"><span class="line-number">-63</span><span class="line-content">    pub node_status: ::core::option::Option&lt;NodeStatus&gt;,</span></div>
<div class="line removed"><span class="line-number">-64</span><span class="line-content">    #[prost(message, optional, tag = &quot;3&quot;)]</span></div>
<div class="line removed"><span class="line-number">-65</span><span class="line-content">    pub performance_multiplier_percent:</span></div>
<div class="line removed"><span class="line-number">-66</span><span class="line-content">        ::core::option::Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,</span></div>
<div class="line removed"><span class="line-number">-67</span><span class="line-content">    #[prost(message, optional, tag = &quot;4&quot;)]</span></div>
<div class="line removed"><span class="line-number">-68</span><span class="line-content">    pub rewards_reduction_percent:</span></div>
<div class="line removed"><span class="line-number">-69</span><span class="line-content">        ::core::option::Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,</span></div>
<div class="line removed"><span class="line-number">-70</span><span class="line-content">    #[prost(message, optional, tag = &quot;5&quot;)]</span></div>
<div class="line removed"><span class="line-number">-71</span><span class="line-content">    pub base_rewards_xdr_permyriad:</span></div>
<div class="line removed"><span class="line-number">-72</span><span class="line-content">        ::core::option::Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,</span></div>
<div class="line removed"><span class="line-number">-73</span><span class="line-content">    #[prost(message, optional, tag = &quot;6&quot;)]</span></div>
<div class="line removed"><span class="line-number">-74</span><span class="line-content">    pub adjusted_rewards_xdr_permyriad:</span></div>
<div class="line removed"><span class="line-number">-75</span><span class="line-content">        ::core::option::Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,</span></div>
<div class="line removed"><span class="line-number">-76</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-77</span><span class="line-content">#[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, ::prost::Message)]</span></div>
<div class="line removed"><span class="line-number">-78</span><span class="line-content">pub struct NodeResults {</span></div>
<div class="line removed"><span class="line-number">-79</span><span class="line-content">    #[prost(message, optional, tag = &quot;1&quot;)]</span></div>
<div class="line removed"><span class="line-number">-80</span><span class="line-content">    pub node_id: ::core::option::Option&lt;::ic_base_types::PrincipalId&gt;,</span></div>
<div class="line removed"><span class="line-number">-81</span><span class="line-content">    #[prost(string, optional, tag = &quot;2&quot;)]</span></div>
<div class="line removed"><span class="line-number">-82</span><span class="line-content">    pub node_reward_type: ::core::option::Option&lt;::prost::alloc::string::String&gt;,</span></div>
<div class="line removed"><span class="line-number">-83</span><span class="line-content">    #[prost(string, optional, tag = &quot;3&quot;)]</span></div>
<div class="line removed"><span class="line-number">-84</span><span class="line-content">    pub region: ::core::option::Option&lt;::prost::alloc::string::String&gt;,</span></div>
<div class="line removed"><span class="line-number">-85</span><span class="line-content">    #[prost(string, optional, tag = &quot;4&quot;)]</span></div>
<div class="line removed"><span class="line-number">-86</span><span class="line-content">    pub dc_id: ::core::option::Option&lt;::prost::alloc::string::String&gt;,</span></div>
<div class="line removed"><span class="line-number">-87</span><span class="line-content">    #[prost(message, repeated, tag = &quot;5&quot;)]</span></div>
<div class="line removed"><span class="line-number">-88</span><span class="line-content">    pub daily_results: ::prost::alloc::vec::Vec&lt;DailyResults&gt;,</span></div>
<div class="line removed"><span class="line-number">-89</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-90</span><span class="line-content">#[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, ::prost::Message)]</span></div>
<div class="line removed"><span class="line-number">-91</span><span class="line-content">pub struct BaseRewards {</span></div>
<div class="line removed"><span class="line-number">-92</span><span class="line-content">    #[prost(message, optional, tag = &quot;1&quot;)]</span></div>
<div class="line removed"><span class="line-number">-93</span><span class="line-content">    pub monthly_xdr_permyriad: ::core::option::Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,</span></div>
<div class="line removed"><span class="line-number">-94</span><span class="line-content">    #[prost(message, optional, tag = &quot;2&quot;)]</span></div>
<div class="line removed"><span class="line-number">-95</span><span class="line-content">    pub daily_xdr_permyriad: ::core::option::Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,</span></div>
<div class="line removed"><span class="line-number">-96</span><span class="line-content">    #[prost(string, optional, tag = &quot;3&quot;)]</span></div>
<div class="line removed"><span class="line-number">-97</span><span class="line-content">    pub node_reward_type: ::core::option::Option&lt;::prost::alloc::string::String&gt;,</span></div>
<div class="line removed"><span class="line-number">-98</span><span class="line-content">    #[prost(string, optional, tag = &quot;4&quot;)]</span></div>
<div class="line removed"><span class="line-number">-99</span><span class="line-content">    pub region: ::core::option::Option&lt;::prost::alloc::string::String&gt;,</span></div>
<div class="line removed"><span class="line-number">-100</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-101</span><span class="line-content">#[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, ::prost::Message)]</span></div>
<div class="line removed"><span class="line-number">-102</span><span class="line-content">pub struct DailyBaseRewardsType3 {</span></div>
<div class="line removed"><span class="line-number">-103</span><span class="line-content">    #[prost(message, optional, tag = &quot;1&quot;)]</span></div>
<div class="line removed"><span class="line-number">-104</span><span class="line-content">    pub day: ::core::option::Option&lt;DayUtc&gt;,</span></div>
<div class="line removed"><span class="line-number">-105</span><span class="line-content">    #[prost(string, optional, tag = &quot;2&quot;)]</span></div>
<div class="line removed"><span class="line-number">-106</span><span class="line-content">    pub region: ::core::option::Option&lt;::prost::alloc::string::String&gt;,</span></div>
<div class="line removed"><span class="line-number">-107</span><span class="line-content">    #[prost(uint64, optional, tag = &quot;3&quot;)]</span></div>
<div class="line removed"><span class="line-number">-108</span><span class="line-content">    pub nodes_count: ::core::option::Option&lt;u64&gt;,</span></div>
<div class="line removed"><span class="line-number">-109</span><span class="line-content">    #[prost(message, optional, tag = &quot;4&quot;)]</span></div>
<div class="line removed"><span class="line-number">-110</span><span class="line-content">    pub avg_rewards_xdr_permyriad:</span></div>
<div class="line removed"><span class="line-number">-111</span><span class="line-content">        ::core::option::Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,</span></div>
<div class="line removed"><span class="line-number">-112</span><span class="line-content">    #[prost(message, optional, tag = &quot;5&quot;)]</span></div>
<div class="line removed"><span class="line-number">-113</span><span class="line-content">    pub avg_coefficient_percent: ::core::option::Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,</span></div>
<div class="line removed"><span class="line-number">-114</span><span class="line-content">    #[prost(message, optional, tag = &quot;6&quot;)]</span></div>
<div class="line removed"><span class="line-number">-115</span><span class="line-content">    pub value_xdr_permyriad: ::core::option::Option&lt;::ic_nervous_system_proto::pb::v1::Decimal&gt;,</span></div>
<div class="line removed"><span class="line-number">-116</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-117</span><span class="line-content">#[derive(candid::CandidType, candid::Deserialize, Clone, PartialEq, ::prost::Message)]</span></div>
<div class="line removed"><span class="line-number">-118</span><span class="line-content">pub struct NodeProviderRewards {</span></div>
<div class="line removed"><span class="line-number">-119</span><span class="line-content">    #[prost(uint64, optional, tag = &quot;1&quot;)]</span></div>
<div class="line removed"><span class="line-number">-120</span><span class="line-content">    pub rewards_total_xdr_permyriad: ::core::option::Option&lt;u64&gt;,</span></div>
<div class="line removed"><span class="line-number">-121</span><span class="line-content">    #[prost(message, repeated, tag = &quot;2&quot;)]</span></div>
<div class="line removed"><span class="line-number">-122</span><span class="line-content">    pub base_rewards: ::prost::alloc::vec::Vec&lt;BaseRewards&gt;,</span></div>
<div class="line removed"><span class="line-number">-123</span><span class="line-content">    #[prost(message, repeated, tag = &quot;3&quot;)]</span></div>
<div class="line removed"><span class="line-number">-124</span><span class="line-content">    pub base_rewards_type3: ::prost::alloc::vec::Vec&lt;DailyBaseRewardsType3&gt;,</span></div>
<div class="line removed"><span class="line-number">-125</span><span class="line-content">    #[prost(message, repeated, tag = &quot;4&quot;)]</span></div>
<div class="line removed"><span class="line-number">-126</span><span class="line-content">    pub nodes_results: ::prost::alloc::vec::Vec&lt;NodeResults&gt;,</span></div>
<div class="line removed"><span class="line-number">-127</span><span class="line-content">}</span></div>
<div class="line context"><span class="line-number">0</span><span class="line-content">diff --git a/rs/node_rewards/canister/protobuf/src/lib.rs b/rs/node_rewards/canister/protobuf/src/lib.rs</span></div>
<div class="line context"><span class="line-number">1</span><span class="line-content">deleted file mode 100644</span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content">index fa31b07d8f..0000000000</span></div>
<div class="file-header">--- a/rs/node_rewards/canister/protobuf/src/lib.rs</div>
<div class="file-header">+++ /dev/null</div>
<div class="hunk-header">@@ -1,131 +0,0 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">use candid::Principal;</span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content">use ic_base_types::PrincipalId;</span></div>
<div class="line removed"><span class="line-number">-3</span><span class="line-content">use ic_stable_structures::storable::Bound;</span></div>
<div class="line removed"><span class="line-number">-4</span><span class="line-content">use ic_stable_structures::Storable;</span></div>
<div class="line removed"><span class="line-number">-5</span><span class="line-content">use prost::Message;</span></div>
<div class="line removed"><span class="line-number">-6</span><span class="line-content">use std::borrow::Cow;</span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-8</span><span class="line-content">pub mod conversions;</span></div>
<div class="line removed"><span class="line-number">-9</span><span class="line-content">pub mod pb;</span></div>
<div class="line removed"><span class="line-number">-10</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-11</span><span class="line-content">// Maximum sizes for the storable types chosen as result of test `max_bound_size`</span></div>
<div class="line removed"><span class="line-number">-12</span><span class="line-content">const MAX_BYTES_SUBNET_ID_STORED: u32 = 33;</span></div>
<div class="line removed"><span class="line-number">-13</span><span class="line-content">const MAX_BYTES_NODE_METRICS_STORED_KEY: u32 = 44;</span></div>
<div class="line removed"><span class="line-number">-14</span><span class="line-content">const PRINCIPAL_MAX_LENGTH_IN_BYTES: usize = 29;</span></div>
<div class="line removed"><span class="line-number">-15</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-16</span><span class="line-content">pub const MIN_PRINCIPAL_ID: PrincipalId = PrincipalId(Principal::from_slice(&amp;[]));</span></div>
<div class="line removed"><span class="line-number">-17</span><span class="line-content">pub const MAX_PRINCIPAL_ID: PrincipalId = PrincipalId(Principal::from_slice(</span></div>
<div class="line removed"><span class="line-number">-18</span><span class="line-content">    &amp;[0xFF_u8; PRINCIPAL_MAX_LENGTH_IN_BYTES],</span></div>
<div class="line removed"><span class="line-number">-19</span><span class="line-content">));</span></div>
<div class="line removed"><span class="line-number">-20</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-21</span><span class="line-content">pub trait KeyRange {</span></div>
<div class="line removed"><span class="line-number">-22</span><span class="line-content">    fn min_key() -&gt; Self;</span></div>
<div class="line removed"><span class="line-number">-23</span><span class="line-content">    fn max_key() -&gt; Self;</span></div>
<div class="line removed"><span class="line-number">-24</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-25</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-26</span><span class="line-content">impl KeyRange for pb::ic_node_rewards::v1::SubnetMetricsKey {</span></div>
<div class="line removed"><span class="line-number">-27</span><span class="line-content">    fn min_key() -&gt; Self {</span></div>
<div class="line removed"><span class="line-number">-28</span><span class="line-content">        Self {</span></div>
<div class="line removed"><span class="line-number">-29</span><span class="line-content">            timestamp_nanos: u64::MIN,</span></div>
<div class="line removed"><span class="line-number">-30</span><span class="line-content">            subnet_id: Some(MIN_PRINCIPAL_ID),</span></div>
<div class="line removed"><span class="line-number">-31</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-32</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-33</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-34</span><span class="line-content">    fn max_key() -&gt; Self {</span></div>
<div class="line removed"><span class="line-number">-35</span><span class="line-content">        Self {</span></div>
<div class="line removed"><span class="line-number">-36</span><span class="line-content">            timestamp_nanos: u64::MAX,</span></div>
<div class="line removed"><span class="line-number">-37</span><span class="line-content">            subnet_id: Some(MAX_PRINCIPAL_ID),</span></div>
<div class="line removed"><span class="line-number">-38</span><span class="line-content">        }</span></div>
<div class="line removed"><span class="line-number">-39</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-40</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-41</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-42</span><span class="line-content">//------------ Storable Implementations ------------//</span></div>
<div class="line removed"><span class="line-number">-43</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-44</span><span class="line-content">impl Storable for pb::ic_node_rewards::v1::SubnetIdKey {</span></div>
<div class="line removed"><span class="line-number">-45</span><span class="line-content">    fn to_bytes(&amp;self) -&gt; std::borrow::Cow&lt;[u8]&gt; {</span></div>
<div class="line removed"><span class="line-number">-46</span><span class="line-content">        let mut buf = Vec::with_capacity(self.encoded_len());</span></div>
<div class="line removed"><span class="line-number">-47</span><span class="line-content">        self.encode(&amp;mut buf).unwrap();</span></div>
<div class="line removed"><span class="line-number">-48</span><span class="line-content">        Cow::Owned(self.encode_to_vec())</span></div>
<div class="line removed"><span class="line-number">-49</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-50</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-51</span><span class="line-content">    fn from_bytes(bytes: std::borrow::Cow&lt;[u8]&gt;) -&gt; Self {</span></div>
<div class="line removed"><span class="line-number">-52</span><span class="line-content">        Self::decode(bytes.as_ref()).unwrap()</span></div>
<div class="line removed"><span class="line-number">-53</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-54</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-55</span><span class="line-content">    const BOUND: Bound = Bound::Bounded {</span></div>
<div class="line removed"><span class="line-number">-56</span><span class="line-content">        max_size: MAX_BYTES_SUBNET_ID_STORED,</span></div>
<div class="line removed"><span class="line-number">-57</span><span class="line-content">        is_fixed_size: false,</span></div>
<div class="line removed"><span class="line-number">-58</span><span class="line-content">    };</span></div>
<div class="line removed"><span class="line-number">-59</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-60</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-61</span><span class="line-content">impl Storable for pb::ic_node_rewards::v1::SubnetMetricsKey {</span></div>
<div class="line removed"><span class="line-number">-62</span><span class="line-content">    fn to_bytes(&amp;self) -&gt; std::borrow::Cow&lt;[u8]&gt; {</span></div>
<div class="line removed"><span class="line-number">-63</span><span class="line-content">        Cow::Owned(self.encode_to_vec())</span></div>
<div class="line removed"><span class="line-number">-64</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-65</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-66</span><span class="line-content">    fn from_bytes(bytes: std::borrow::Cow&lt;[u8]&gt;) -&gt; Self {</span></div>
<div class="line removed"><span class="line-number">-67</span><span class="line-content">        Self::decode(bytes.as_ref()).unwrap()</span></div>
<div class="line removed"><span class="line-number">-68</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-69</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-70</span><span class="line-content">    const BOUND: Bound = Bound::Bounded {</span></div>
<div class="line removed"><span class="line-number">-71</span><span class="line-content">        max_size: 2 * MAX_BYTES_NODE_METRICS_STORED_KEY,</span></div>
<div class="line removed"><span class="line-number">-72</span><span class="line-content">        is_fixed_size: false,</span></div>
<div class="line removed"><span class="line-number">-73</span><span class="line-content">    };</span></div>
<div class="line removed"><span class="line-number">-74</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-75</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-76</span><span class="line-content">impl Storable for pb::ic_node_rewards::v1::SubnetMetricsValue {</span></div>
<div class="line removed"><span class="line-number">-77</span><span class="line-content">    fn to_bytes(&amp;self) -&gt; std::borrow::Cow&lt;[u8]&gt; {</span></div>
<div class="line removed"><span class="line-number">-78</span><span class="line-content">        Cow::Owned(self.encode_to_vec())</span></div>
<div class="line removed"><span class="line-number">-79</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-80</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-81</span><span class="line-content">    fn from_bytes(bytes: std::borrow::Cow&lt;[u8]&gt;) -&gt; Self {</span></div>
<div class="line removed"><span class="line-number">-82</span><span class="line-content">        Self::decode(bytes.as_ref()).unwrap()</span></div>
<div class="line removed"><span class="line-number">-83</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-84</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-85</span><span class="line-content">    const BOUND: Bound = Bound::Unbounded;</span></div>
<div class="line removed"><span class="line-number">-86</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-87</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-88</span><span class="line-content">impl Storable for pb::ic_node_rewards::v1::NodeMetrics {</span></div>
<div class="line removed"><span class="line-number">-89</span><span class="line-content">    fn to_bytes(&amp;self) -&gt; std::borrow::Cow&lt;[u8]&gt; {</span></div>
<div class="line removed"><span class="line-number">-90</span><span class="line-content">        Cow::Owned(self.encode_to_vec())</span></div>
<div class="line removed"><span class="line-number">-91</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-92</span><span class="line-content">    fn from_bytes(bytes: std::borrow::Cow&lt;[u8]&gt;) -&gt; Self {</span></div>
<div class="line removed"><span class="line-number">-93</span><span class="line-content">        Self::decode(bytes.as_ref()).unwrap()</span></div>
<div class="line removed"><span class="line-number">-94</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-95</span><span class="line-content">    const BOUND: Bound = Bound::Unbounded;</span></div>
<div class="line removed"><span class="line-number">-96</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-97</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-98</span><span class="line-content">impl Storable for pb::rewards_calculator::v1::NodeProviderRewards {</span></div>
<div class="line removed"><span class="line-number">-99</span><span class="line-content">    fn to_bytes(&amp;self) -&gt; std::borrow::Cow&lt;[u8]&gt; {</span></div>
<div class="line removed"><span class="line-number">-100</span><span class="line-content">        Cow::Owned(self.encode_to_vec())</span></div>
<div class="line removed"><span class="line-number">-101</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-102</span><span class="line-content">    fn from_bytes(bytes: std::borrow::Cow&lt;[u8]&gt;) -&gt; Self {</span></div>
<div class="line removed"><span class="line-number">-103</span><span class="line-content">        Self::decode(bytes.as_ref()).unwrap()</span></div>
<div class="line removed"><span class="line-number">-104</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-105</span><span class="line-content">    const BOUND: Bound = Bound::Unbounded;</span></div>
<div class="line removed"><span class="line-number">-106</span><span class="line-content">}</span></div>
<div class="line removed"><span class="line-number">-107</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-108</span><span class="line-content">#[cfg(test)]</span></div>
<div class="line removed"><span class="line-number">-109</span><span class="line-content">mod tests {</span></div>
<div class="line removed"><span class="line-number">-110</span><span class="line-content">    use super::*;</span></div>
<div class="line removed"><span class="line-number">-111</span><span class="line-content">    #[test]</span></div>
<div class="line removed"><span class="line-number">-112</span><span class="line-content">    fn max_bound_size() {</span></div>
<div class="line removed"><span class="line-number">-113</span><span class="line-content">        let max_subnet_id_stored = pb::ic_node_rewards::v1::SubnetIdKey {</span></div>
<div class="line removed"><span class="line-number">-114</span><span class="line-content">            subnet_id: MAX_PRINCIPAL_ID.into(),</span></div>
<div class="line removed"><span class="line-number">-115</span><span class="line-content">        };</span></div>
<div class="line removed"><span class="line-number">-116</span><span class="line-content">        let max_subnet_metrics_stored_key = pb::ic_node_rewards::v1::SubnetMetricsKey {</span></div>
<div class="line removed"><span class="line-number">-117</span><span class="line-content">            timestamp_nanos: u64::MAX,</span></div>
<div class="line removed"><span class="line-number">-118</span><span class="line-content">            subnet_id: MAX_PRINCIPAL_ID.into(),</span></div>
<div class="line removed"><span class="line-number">-119</span><span class="line-content">        };</span></div>
<div class="line removed"><span class="line-number">-120</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-121</span><span class="line-content">        assert_eq!(</span></div>
<div class="line removed"><span class="line-number">-122</span><span class="line-content">            max_subnet_id_stored.to_bytes().len(),</span></div>
<div class="line removed"><span class="line-number">-123</span><span class="line-content">            MAX_BYTES_SUBNET_ID_STORED as usize</span></div>
<div class="line removed"><span class="line-number">-124</span><span class="line-content">        );</span></div>
<div class="line removed"><span class="line-number">-125</span><span class="line-content"></span></div>
<div class="line removed"><span class="line-number">-126</span><span class="line-content">        assert_eq!(</span></div>
<div class="line removed"><span class="line-number">-127</span><span class="line-content">            max_subnet_metrics_stored_key.to_bytes().len(),</span></div>
<div class="line removed"><span class="line-number">-128</span><span class="line-content">            MAX_BYTES_NODE_METRICS_STORED_KEY as usize</span></div>
<div class="line removed"><span class="line-number">-129</span><span class="line-content">        );</span></div>
<div class="line removed"><span class="line-number">-130</span><span class="line-content">    }</span></div>
<div class="line removed"><span class="line-number">-131</span><span class="line-content">}</span></div>
<div class="line context"><span class="line-number">0</span><span class="line-content">diff --git a/rs/node_rewards/canister/protobuf/src/pb/ic_node_rewards/mod.rs b/rs/node_rewards/canister/protobuf/src/pb/ic_node_rewards/mod.rs</span></div>
<div class="line context"><span class="line-number">1</span><span class="line-content">deleted file mode 100644</span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content">index 4aee645c2b..0000000000</span></div>
<div class="file-header">--- a/rs/node_rewards/canister/protobuf/src/pb/ic_node_rewards/mod.rs</div>
<div class="file-header">+++ /dev/null</div>
<div class="hunk-header">@@ -1,3 +0,0 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">#[allow(clippy::all)]</span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content">#[path = &quot;../../gen/ic_node_rewards.pb.v1.rs&quot;]</span></div>
<div class="line removed"><span class="line-number">-3</span><span class="line-content">pub mod v1;</span></div>
<div class="line context"><span class="line-number">0</span><span class="line-content">diff --git a/rs/node_rewards/canister/protobuf/src/pb/mod.rs b/rs/node_rewards/canister/protobuf/src/pb/mod.rs</span></div>
<div class="line context"><span class="line-number">1</span><span class="line-content">deleted file mode 100644</span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content">index 33a6a6d5c1..0000000000</span></div>
<div class="file-header">--- a/rs/node_rewards/canister/protobuf/src/pb/mod.rs</div>
<div class="file-header">+++ /dev/null</div>
<div class="hunk-header">@@ -1,2 +0,0 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">pub mod ic_node_rewards;</span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content">pub mod rewards_calculator;</span></div>
<div class="line context"><span class="line-number">0</span><span class="line-content">diff --git a/rs/node_rewards/canister/protobuf/src/pb/rewards_calculator/mod.rs b/rs/node_rewards/canister/protobuf/src/pb/rewards_calculator/mod.rs</span></div>
<div class="line context"><span class="line-number">1</span><span class="line-content">deleted file mode 100644</span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content">index eb31b78efd..0000000000</span></div>
<div class="file-header">--- a/rs/node_rewards/canister/protobuf/src/pb/rewards_calculator/mod.rs</div>
<div class="file-header">+++ /dev/null</div>
<div class="hunk-header">@@ -1,3 +0,0 @@</div>
<div class="line removed"><span class="line-number">-1</span><span class="line-content">#[allow(clippy::all)]</span></div>
<div class="line removed"><span class="line-number">-2</span><span class="line-content">#[path = &quot;../../gen/rewards_calculator.pb.v1.rs&quot;]</span></div>
<div class="line removed"><span class="line-number">-3</span><span class="line-content">pub mod v1;</span></div>
<div class="line context"><span class="line-number">0</span><span class="line-content">diff --git a/rs/node_rewards/canister/protobuf_generator/src/lib.rs b/rs/node_rewards/canister/protobuf_generator/src/lib.rs</span></div>
<div class="line context"><span class="line-number">1</span><span class="line-content">index f6fd25e263..aa9d482d9a 100644</span></div>
<div class="file-header">--- a/rs/node_rewards/canister/protobuf_generator/src/lib.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/protobuf_generator/src/lib.rs</div>
<div class="hunk-header">@@ -4,64 +4,30 @@ use std::path::Path;</div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> pub struct ProtoPaths&lt;&#x27;a&gt; {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content">     pub base_types: &amp;&#x27;a Path,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content">     pub node_rewards: &amp;&#x27;a Path,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content">    pub nervous_system: &amp;&#x27;a Path,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+7</span><span class="line-content">    pub node_proto: &amp;&#x27;a Path,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> /// Build protos using prost_build.<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> pub fn generate_prost_files(proto: ProtoPaths&lt;&#x27;_&gt;, out: &amp;Path) {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-12</span><span class="line-content">    let proto_files = [<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-13</span><span class="line-content">        proto.node_rewards.join(&quot;node_rewards/pb/v1/types.proto&quot;),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-14</span><span class="line-content">        proto<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-15</span><span class="line-content">            .node_rewards<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-16</span><span class="line-content">            .join(&quot;rewards_calculator/pb/v1/types.proto&quot;),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-17</span><span class="line-content">    ];<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+12</span><span class="line-content">    let proto_files = [proto.node_rewards.join(&quot;node_rewards/pb/v1/types.proto&quot;)];<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content">     let mut config = Config::new();<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content">     config.extern_path(&quot;.ic_base_types.pb.v1&quot;, &quot;::ic-base-types&quot;);<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-21</span><span class="line-content">    config.extern_path(<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-22</span><span class="line-content">        &quot;.ic_nervous_system.pb.v1&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-23</span><span class="line-content">        &quot;::ic-nervous-system-proto::pb::v1&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-24</span><span class="line-content">    );<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+16</span><span class="line-content">    config.extern_path(&quot;.registry.node.v1&quot;, &quot;::ic-protobuf::registry::node::v1&quot;);<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-26</span><span class="line-content">    for message_name in [&quot;SubnetIdKey&quot;, &quot;SubnetMetricsKey&quot;] {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+18</span><span class="line-content">    for message_name in [&quot;SubnetIdKey&quot;, &quot;SubnetMetricsKey&quot;, &quot;RewardableNodesKey&quot;] {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content">         config.type_attribute(<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">20</span><span class="line-content">             format!(&quot;ic_node_rewards.pb.v1.{message_name}&quot;),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">21</span><span class="line-content">             [&quot;#[derive(PartialOrd, Ord, Eq)]&quot;].join(&quot; &quot;),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">22</span><span class="line-content">         );<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">23</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">24</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-33</span><span class="line-content">    for message_name in [&quot;NodeProviderRewardsKey&quot;, &quot;DayUtc&quot;, &quot;SubnetsFailureRateKey&quot;] {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-34</span><span class="line-content">        config.type_attribute(<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-35</span><span class="line-content">            format!(&quot;rewards_calculator.pb.v1.{message_name}&quot;),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-36</span><span class="line-content">            [&quot;#[derive(PartialOrd, Ord, Eq)]&quot;].join(&quot; &quot;),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-37</span><span class="line-content">        );<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-38</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-39</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-40</span><span class="line-content">    for message_name in [<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-41</span><span class="line-content">        &quot;DayUtc&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-42</span><span class="line-content">        &quot;NodeMetricsDaily&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-43</span><span class="line-content">        &quot;Assigned&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-44</span><span class="line-content">        &quot;Unassigned&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-45</span><span class="line-content">        &quot;NodeStatus.status&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-46</span><span class="line-content">        &quot;NodeStatus&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-47</span><span class="line-content">        &quot;DailyResults&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-48</span><span class="line-content">        &quot;NodeResults&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-49</span><span class="line-content">        &quot;BaseRewards&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-50</span><span class="line-content">        &quot;DailyBaseRewardsType3&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-51</span><span class="line-content">        &quot;NodeProviderRewards&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-52</span><span class="line-content">    ] {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-53</span><span class="line-content">        config.type_attribute(<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-54</span><span class="line-content">            format!(&quot;rewards_calculator.pb.v1.{message_name}&quot;),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-55</span><span class="line-content">            [&quot;#[derive(candid::CandidType, candid::Deserialize)]&quot;].join(&quot; &quot;),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-56</span><span class="line-content">        );<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-57</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-58</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">25</span><span class="line-content">     std::fs::create_dir_all(out).expect(&quot;failed to create output directory&quot;);<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">26</span><span class="line-content">     config.out_dir(out);<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">27</span><span class="line-content">     config<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">28</span><span class="line-content">         .compile_protos(<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">29</span><span class="line-content">             &amp;proto_files,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-64</span><span class="line-content">            &amp;[proto.node_rewards, proto.base_types, proto.nervous_system],<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+30</span><span class="line-content">            &amp;[proto.node_rewards, proto.base_types, proto.node_proto],<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">31</span><span class="line-content">         )<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">32</span><span class="line-content">         .unwrap();<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">33</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">34</span><span class="line-content">diff --git a/rs/node_rewards/canister/protobuf_generator/src/main.rs b/rs/node_rewards/canister/protobuf_generator/src/main.rs<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">35</span><span class="line-content">index 5ad5cce89e..8bc35247d6 100644<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/lib.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/protobuf_generator/src/main.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/protobuf_generator/src/main.rs</div>
<div class="hunk-header">@@ -6,10 +6,10 @@ fn main() {</div>
<div class="line context"><span class="line-number">6</span><span class="line-content">         std::env::var(&quot;CARGO_MANIFEST_DIR&quot;)<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/main.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content">             .expect(&quot;CARGO_MANIFEST_DIR env variable is not defined&quot;),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/main.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content">     );<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/main.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-9</span><span class="line-content">    let out = manifest_dir.join(&quot;../protobuf/src/gen&quot;);<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/main.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+9</span><span class="line-content">    let out = manifest_dir.join(&quot;../src/gen&quot;);<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/main.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content">     let node_rewards_proto = manifest_dir.join(&quot;../proto&quot;);<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/main.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content">     let base_types_proto = manifest_dir.join(&quot;../../../types/base_types/proto&quot;);<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/main.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-12</span><span class="line-content">    let nervous_system_proto = manifest_dir.join(&quot;../../../nervous_system/proto/proto&quot;);<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/main.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+12</span><span class="line-content">    let node_proto = manifest_dir.join(&quot;../../../protobuf&quot;);<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/main.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/main.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content">     match std::fs::remove_dir_all(&amp;out) {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/main.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content">         Ok(_) =&gt; (),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/main.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -24,7 +24,7 @@ fn main() {</div>
<div class="line context"><span class="line-number">24</span><span class="line-content">         ProtoPaths {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/main.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">25</span><span class="line-content">             node_rewards: &amp;node_rewards_proto,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/main.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">26</span><span class="line-content">             base_types: &amp;base_types_proto,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/main.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-27</span><span class="line-content">            nervous_system: &amp;nervous_system_proto,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/protobuf_generator/src/main.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+27</span><span class="line-content">            node_proto: &amp;node_proto,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/main.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">28</span><span class="line-content">         },<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/main.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">29</span><span class="line-content">         out.as_ref(),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/main.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">30</span><span class="line-content">     );<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/main.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">31</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/api_conversion.rs b/rs/node_rewards/canister/src/api_conversion.rs<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/main.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">32</span><span class="line-content">new file mode 100644<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/main.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">33</span><span class="line-content">index 0000000000..6c2a12443a<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/protobuf_generator/src/main.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- /dev/null</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/api_conversion.rs</div>
<div class="hunk-header">@@ -0,0 +1,83 @@</div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">use ic_node_rewards_canister_api::provider_rewards_calculation::{<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+2</span><span class="line-content">    node_status::Status as StatusCandid, Assigned as AssignedCandid,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+3</span><span class="line-content">    BaseRewards as BaseRewardsCandid, DailyBaseRewardsType3 as DailyBaseRewardsType3Candid,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+4</span><span class="line-content">    DailyResults as DailyResultsCandid, DayUtc as DayUtcCandid,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+5</span><span class="line-content">    NodeMetricsDaily as NodeMetricsDailyCandid, NodeProviderRewards as NodeProviderRewardsCandid,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+6</span><span class="line-content">    NodeResults as NodeResultsCandid, NodeStatus as NodeStatusCandid,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+7</span><span class="line-content">    Unassigned as UnassignedCandid,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+9</span><span class="line-content">use rewards_calculation::rewards_calculator_results::{NodeProviderRewards, NodeStatus};<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+10</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+11</span><span class="line-content">pub fn to_candid_type(rewards: NodeProviderRewards) -&gt; NodeProviderRewardsCandid {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+12</span><span class="line-content">    NodeProviderRewardsCandid {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+13</span><span class="line-content">        rewards_total_xdr_permyriad: Some(rewards.rewards_total_xdr_permyriad),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+14</span><span class="line-content">        base_rewards: rewards<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+15</span><span class="line-content">            .base_rewards<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+16</span><span class="line-content">            .into_iter()<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+17</span><span class="line-content">            .map(|br| BaseRewardsCandid {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+18</span><span class="line-content">                node_reward_type: Some(br.node_reward_type.to_string()),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+19</span><span class="line-content">                region: Some(br.region),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+20</span><span class="line-content">                monthly_xdr_permyriad: Some(br.monthly.into()),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+21</span><span class="line-content">                daily_xdr_permyriad: Some(br.daily.into()),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+22</span><span class="line-content">            })<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+23</span><span class="line-content">            .collect(),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+24</span><span class="line-content">        base_rewards_type3: rewards<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+25</span><span class="line-content">            .base_rewards_type3<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+26</span><span class="line-content">            .into_iter()<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+27</span><span class="line-content">            .map(|br3| DailyBaseRewardsType3Candid {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+28</span><span class="line-content">                day: Some(DayUtcCandid {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+29</span><span class="line-content">                    value: Some(br3.day.unix_ts_at_day_end()),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+30</span><span class="line-content">                }),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+31</span><span class="line-content">                region: Some(br3.region),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+32</span><span class="line-content">                nodes_count: Some(br3.nodes_count as u64),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+33</span><span class="line-content">                avg_rewards_xdr_permyriad: Some(br3.avg_rewards.into()),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+34</span><span class="line-content">                avg_coefficient_percent: Some(br3.avg_coefficient.into()),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+35</span><span class="line-content">                value_xdr_permyriad: Some(br3.value.into()),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+36</span><span class="line-content">            })<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+37</span><span class="line-content">            .collect(),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+38</span><span class="line-content">        nodes_results: rewards<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+39</span><span class="line-content">            .nodes_results<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+40</span><span class="line-content">            .into_iter()<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+41</span><span class="line-content">            .map(|nr| NodeResultsCandid {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+42</span><span class="line-content">                node_id: Some(nr.node_id.get()),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+43</span><span class="line-content">                node_reward_type: Some(nr.node_reward_type.to_string()),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+44</span><span class="line-content">                region: Some(nr.region),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+45</span><span class="line-content">                dc_id: Some(nr.dc_id),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+46</span><span class="line-content">                daily_results: nr<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+47</span><span class="line-content">                    .daily_results<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+48</span><span class="line-content">                    .into_iter()<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+49</span><span class="line-content">                    .map(|dr| DailyResultsCandid {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+50</span><span class="line-content">                        day: Some(DayUtcCandid {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+51</span><span class="line-content">                            value: Some(dr.day.unix_ts_at_day_end()),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+52</span><span class="line-content">                        }),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+53</span><span class="line-content">                        node_status: match dr.node_status {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+54</span><span class="line-content">                            NodeStatus::Assigned { node_metrics } =&gt; Some(NodeStatusCandid {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+55</span><span class="line-content">                                status: Some(StatusCandid::Assigned(AssignedCandid {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+56</span><span class="line-content">                                    node_metrics: Some(NodeMetricsDailyCandid {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+57</span><span class="line-content">                                        subnet_assigned: Some(node_metrics.subnet_assigned.get()),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+58</span><span class="line-content">                                        subnet_assigned_fr_percent: Some(<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+59</span><span class="line-content">                                            node_metrics.subnet_assigned_fr.into(),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+60</span><span class="line-content">                                        ),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+61</span><span class="line-content">                                        num_blocks_proposed: Some(node_metrics.num_blocks_proposed),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+62</span><span class="line-content">                                        num_blocks_failed: Some(node_metrics.num_blocks_failed),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+63</span><span class="line-content">                                        original_fr_percent: Some(node_metrics.original_fr.into()),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+64</span><span class="line-content">                                        relative_fr_percent: Some(node_metrics.relative_fr.into()),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+65</span><span class="line-content">                                    }),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+66</span><span class="line-content">                                })),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+67</span><span class="line-content">                            }),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+68</span><span class="line-content">                            NodeStatus::Unassigned { extrapolated_fr } =&gt; Some(NodeStatusCandid {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+69</span><span class="line-content">                                status: Some(StatusCandid::Unassigned(UnassignedCandid {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+70</span><span class="line-content">                                    extrapolated_fr_percent: Some(extrapolated_fr.into()),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+71</span><span class="line-content">                                })),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+72</span><span class="line-content">                            }),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+73</span><span class="line-content">                        },<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+74</span><span class="line-content">                        performance_multiplier_percent: Some(dr.performance_multiplier.into()),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+75</span><span class="line-content">                        rewards_reduction_percent: Some(dr.rewards_reduction.into()),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+76</span><span class="line-content">                        base_rewards_xdr_permyriad: Some(dr.base_rewards.into()),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+77</span><span class="line-content">                        adjusted_rewards_xdr_permyriad: Some(dr.adjusted_rewards.into()),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+78</span><span class="line-content">                    })<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+79</span><span class="line-content">                    .collect(),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+80</span><span class="line-content">            })<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+81</span><span class="line-content">            .collect(),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+82</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+83</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">84</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/canister/mod.rs b/rs/node_rewards/canister/src/canister/mod.rs<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">85</span><span class="line-content">index 4e0678d8ad..c0bec07e99 100644<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/api_conversion.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/canister/mod.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/canister/mod.rs</div>
<div class="hunk-header">@@ -1,3 +1,4 @@</div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">use crate::api_conversion::to_candid_type;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/mod.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use crate::metrics::MetricsManager;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/mod.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use crate::registry_querier::RegistryQuerier;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/mod.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use crate::storage::VM;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/mod.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -271,7 +272,7 @@ impl NodeRewardsCanister {</div>
<div class="line context"><span class="line-number">272</span><span class="line-content">             provider_id<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/mod.rs#L272" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">273</span><span class="line-content">         ))?;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/mod.rs#L273" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">274</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/mod.rs#L274" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-274</span><span class="line-content">        Ok(node_provider_rewards.into())<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/src/canister/mod.rs#L274" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+275</span><span class="line-content">        Ok(to_candid_type(node_provider_rewards))<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/mod.rs#L275" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">276</span><span class="line-content">     }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/mod.rs#L276" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">277</span><span class="line-content"> }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/mod.rs#L277" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">278</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/mod.rs#L278" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">279</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs b/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/mod.rs#L279" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">280</span><span class="line-content">index 7a81171f1b..eb3db428bf 100644<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/mod.rs#L280" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs</div>
<div class="hunk-header">@@ -1,17 +1,16 @@</div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">use crate::api_conversion::to_candid_type;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> use crate::canister::test::test_utils::{<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content">     setup_thread_local_canister_for_test, TestState, CANISTER_TEST, VM,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use crate::canister::NodeRewardsCanister;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use crate::metrics::MetricsManager;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+7</span><span class="line-content">use crate::pb::v1::{NodeMetrics, SubnetMetricsKey, SubnetMetricsValue};<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> use futures_util::FutureExt;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> use ic_nervous_system_canisters::registry::fake::FakeRegistry;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> use ic_node_rewards_canister_api::provider_rewards_calculation::GetNodeProviderRewardsCalculationRequest;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> use ic_node_rewards_canister_api::providers_rewards::{<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">     GetNodeProvidersRewardsRequest, NodeProvidersRewards,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-12</span><span class="line-content">use ic_node_rewards_canister_protobuf::pb::ic_node_rewards::v1::{<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-13</span><span class="line-content">    NodeMetrics, SubnetMetricsKey, SubnetMetricsValue,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-14</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> use ic_protobuf::registry::dc::v1::DataCenterRecord;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> use ic_protobuf::registry::node::v1::{NodeRecord, NodeRewardType};<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> use ic_protobuf::registry::node_operator::v1::NodeOperatorRecord;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="hunk-header">@@ -663,7 +662,7 @@ fn test_get_node_provider_rewards_calculation_historical() {</div>
<div class="line context"><span class="line-number">662</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L662" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">663</span><span class="line-content">         assert_eq!(<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L663" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">664</span><span class="line-content">             got,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L664" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-666</span><span class="line-content">            expected_rewards.into(),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L666" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+665</span><span class="line-content">            to_candid_type(expected_rewards),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L665" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">666</span><span class="line-content">             &quot;Mismatch for provider {:?}&quot;,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L666" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">667</span><span class="line-content">             provider_id<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L667" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">668</span><span class="line-content">         );<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L668" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">669</span><span class="line-content">diff --git a/rs/node_rewards/canister/protobuf/src/gen/ic_node_rewards.pb.v1.rs b/rs/node_rewards/canister/src/gen/ic_node_rewards.pb.v1.rs<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L669" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">670</span><span class="line-content">similarity index 100%<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L670" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">671</span><span class="line-content">rename from rs/node_rewards/canister/protobuf/src/gen/ic_node_rewards.pb.v1.rs<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L671" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">672</span><span class="line-content">rename to rs/node_rewards/canister/src/gen/ic_node_rewards.pb.v1.rs<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L672" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">673</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/lib.rs b/rs/node_rewards/canister/src/lib.rs<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L673" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">674</span><span class="line-content">index 9d51126275..37cb0670d6 100644<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/canister/test/get_node_providers_rewards.rs#L674" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/lib.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/lib.rs</div>
<div class="hunk-header">@@ -5,8 +5,162 @@</div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> // 4. Structure makes boundaries clear and easy to enforce<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> // 5. Simple Organization<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content">use candid::Principal;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+9</span><span class="line-content">use ic_base_types::{PrincipalId, SubnetId};<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+10</span><span class="line-content">use ic_management_canister_types::NodeMetrics;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+11</span><span class="line-content">use ic_stable_structures::storable::Bound;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+12</span><span class="line-content">use ic_stable_structures::Storable;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+13</span><span class="line-content">use prost::Message;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+14</span><span class="line-content">use rewards_calculation::types::SubnetMetricsDailyKey;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+15</span><span class="line-content">use std::borrow::Cow;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+16</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+17</span><span class="line-content">pub mod api_conversion;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">18</span><span class="line-content"> pub mod canister;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content"> pub mod metrics;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+20</span><span class="line-content">pub mod pb;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">21</span><span class="line-content"> pub mod registry_querier;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">22</span><span class="line-content"> pub mod storage;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L22" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">23</span><span class="line-content"> pub mod telemetry;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L23" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+24</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L24" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+25</span><span class="line-content">// Maximum sizes for the storable types chosen as result of test `max_bound_size`<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L25" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+26</span><span class="line-content">const MAX_BYTES_SUBNET_ID_STORED: u32 = 33;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L26" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+27</span><span class="line-content">const MAX_BYTES_NODE_METRICS_STORED_KEY: u32 = 44;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L27" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+28</span><span class="line-content">const PRINCIPAL_MAX_LENGTH_IN_BYTES: usize = 29;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L28" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+29</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L29" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+30</span><span class="line-content">pub const MIN_PRINCIPAL_ID: PrincipalId = PrincipalId(Principal::from_slice(&amp;[]));<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L30" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+31</span><span class="line-content">pub const MAX_PRINCIPAL_ID: PrincipalId = PrincipalId(Principal::from_slice(<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L31" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+32</span><span class="line-content">    &amp;[0xFF_u8; PRINCIPAL_MAX_LENGTH_IN_BYTES],<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L32" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+33</span><span class="line-content">));<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L33" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+34</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L34" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+35</span><span class="line-content">pub trait KeyRange {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L35" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+36</span><span class="line-content">    fn min_key() -&gt; Self;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L36" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+37</span><span class="line-content">    fn max_key() -&gt; Self;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L37" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+38</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L38" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+39</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L39" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+40</span><span class="line-content">impl KeyRange for pb::v1::SubnetMetricsKey {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L40" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+41</span><span class="line-content">    fn min_key() -&gt; Self {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L41" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+42</span><span class="line-content">        Self {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L42" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+43</span><span class="line-content">            timestamp_nanos: u64::MIN,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L43" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+44</span><span class="line-content">            subnet_id: Some(MIN_PRINCIPAL_ID),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L44" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+45</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L45" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+46</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L46" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+47</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L47" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+48</span><span class="line-content">    fn max_key() -&gt; Self {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L48" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+49</span><span class="line-content">        Self {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L49" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+50</span><span class="line-content">            timestamp_nanos: u64::MAX,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L50" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+51</span><span class="line-content">            subnet_id: Some(MAX_PRINCIPAL_ID),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L51" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+52</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L52" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+53</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L53" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+54</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L54" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+55</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L55" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+56</span><span class="line-content">//------------ Storable Implementations ------------//<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L56" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+57</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L57" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+58</span><span class="line-content">impl Storable for pb::v1::SubnetIdKey {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L58" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+59</span><span class="line-content">    fn to_bytes(&amp;self) -&gt; std::borrow::Cow&lt;[u8]&gt; {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L59" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+60</span><span class="line-content">        Cow::Owned(self.encode_to_vec())<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L60" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+61</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L61" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+62</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L62" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+63</span><span class="line-content">    fn from_bytes(bytes: std::borrow::Cow&lt;[u8]&gt;) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L63" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+64</span><span class="line-content">        Self::decode(bytes.as_ref()).unwrap()<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L64" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+65</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L65" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+66</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L66" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+67</span><span class="line-content">    const BOUND: Bound = Bound::Bounded {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L67" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+68</span><span class="line-content">        max_size: MAX_BYTES_SUBNET_ID_STORED,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L68" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+69</span><span class="line-content">        is_fixed_size: false,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L69" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+70</span><span class="line-content">    };<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L70" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+71</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L71" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+72</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L72" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+73</span><span class="line-content">impl Storable for pb::v1::SubnetMetricsKey {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L73" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+74</span><span class="line-content">    fn to_bytes(&amp;self) -&gt; std::borrow::Cow&lt;[u8]&gt; {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L74" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+75</span><span class="line-content">        Cow::Owned(self.encode_to_vec())<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L75" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+76</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L76" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+77</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L77" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+78</span><span class="line-content">    fn from_bytes(bytes: std::borrow::Cow&lt;[u8]&gt;) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L78" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+79</span><span class="line-content">        Self::decode(bytes.as_ref()).unwrap()<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L79" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+80</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L80" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+81</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L81" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+82</span><span class="line-content">    const BOUND: Bound = Bound::Bounded {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L82" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+83</span><span class="line-content">        max_size: 2 * MAX_BYTES_NODE_METRICS_STORED_KEY,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L83" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+84</span><span class="line-content">        is_fixed_size: false,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L84" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+85</span><span class="line-content">    };<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L85" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+86</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L86" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+87</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L87" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+88</span><span class="line-content">impl Storable for pb::v1::SubnetMetricsValue {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L88" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+89</span><span class="line-content">    fn to_bytes(&amp;self) -&gt; std::borrow::Cow&lt;[u8]&gt; {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L89" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+90</span><span class="line-content">        Cow::Owned(self.encode_to_vec())<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L90" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+91</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L91" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+92</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L92" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+93</span><span class="line-content">    fn from_bytes(bytes: std::borrow::Cow&lt;[u8]&gt;) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L93" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+94</span><span class="line-content">        Self::decode(bytes.as_ref()).unwrap()<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L94" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+95</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L95" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+96</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L96" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+97</span><span class="line-content">    const BOUND: Bound = Bound::Unbounded;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L97" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+98</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L98" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+99</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L99" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+100</span><span class="line-content">impl Storable for pb::v1::NodeMetrics {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L100" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+101</span><span class="line-content">    fn to_bytes(&amp;self) -&gt; std::borrow::Cow&lt;[u8]&gt; {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L101" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+102</span><span class="line-content">        Cow::Owned(self.encode_to_vec())<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L102" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+103</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L103" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+104</span><span class="line-content">    fn from_bytes(bytes: std::borrow::Cow&lt;[u8]&gt;) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L104" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+105</span><span class="line-content">        Self::decode(bytes.as_ref()).unwrap()<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L105" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+106</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L106" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+107</span><span class="line-content">    const BOUND: Bound = Bound::Unbounded;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L107" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+108</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L108" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+109</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L109" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+110</span><span class="line-content">impl From&lt;SubnetId&gt; for pb::v1::SubnetIdKey {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L110" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+111</span><span class="line-content">    fn from(subnet_id: SubnetId) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L111" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+112</span><span class="line-content">        Self {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L112" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+113</span><span class="line-content">            subnet_id: Some(subnet_id.get()),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L113" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+114</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L114" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+115</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L115" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+116</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L116" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+117</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L117" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+118</span><span class="line-content">impl From&lt;pb::v1::SubnetIdKey&gt; for SubnetId {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L118" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+119</span><span class="line-content">    fn from(subnet_id: pb::v1::SubnetIdKey) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L119" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+120</span><span class="line-content">        subnet_id.subnet_id.unwrap().into()<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L120" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+121</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L121" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+122</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L122" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+123</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L123" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+124</span><span class="line-content">impl From&lt;pb::v1::SubnetMetricsKey&gt; for SubnetMetricsDailyKey {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L124" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+125</span><span class="line-content">    fn from(key: pb::v1::SubnetMetricsKey) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L125" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+126</span><span class="line-content">        Self {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L126" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+127</span><span class="line-content">            day: key.timestamp_nanos.into(),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L127" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+128</span><span class="line-content">            subnet_id: SubnetId::from(key.subnet_id.unwrap()),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L128" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+129</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L129" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+130</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L130" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+131</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L131" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+132</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L132" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+133</span><span class="line-content">impl From&lt;NodeMetrics&gt; for pb::v1::NodeMetrics {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L133" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+134</span><span class="line-content">    fn from(metrics: NodeMetrics) -&gt; Self {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L134" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+135</span><span class="line-content">        pb::v1::NodeMetrics {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L135" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+136</span><span class="line-content">            node_id: Some(metrics.node_id.into()),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L136" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+137</span><span class="line-content">            num_blocks_proposed_total: metrics.num_blocks_proposed_total,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L137" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+138</span><span class="line-content">            num_blocks_failed_total: metrics.num_block_failures_total,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L138" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+139</span><span class="line-content">        }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L139" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+140</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L140" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+141</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L141" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+142</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L142" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+143</span><span class="line-content">#[cfg(test)]<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L143" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+144</span><span class="line-content">mod tests {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L144" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+145</span><span class="line-content">    use super::*;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L145" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+146</span><span class="line-content">    #[test]<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L146" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+147</span><span class="line-content">    fn max_bound_size() {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L147" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+148</span><span class="line-content">        let max_subnet_id_stored = pb::v1::SubnetIdKey {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L148" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+149</span><span class="line-content">            subnet_id: MAX_PRINCIPAL_ID.into(),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L149" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+150</span><span class="line-content">        };<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L150" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+151</span><span class="line-content">        let max_subnet_metrics_stored_key = pb::v1::SubnetMetricsKey {<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L151" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+152</span><span class="line-content">            timestamp_nanos: u64::MAX,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L152" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+153</span><span class="line-content">            subnet_id: MAX_PRINCIPAL_ID.into(),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L153" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+154</span><span class="line-content">        };<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L154" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+155</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L155" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+156</span><span class="line-content">        assert_eq!(<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L156" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+157</span><span class="line-content">            max_subnet_id_stored.to_bytes().len(),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L157" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+158</span><span class="line-content">            MAX_BYTES_SUBNET_ID_STORED as usize<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L158" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+159</span><span class="line-content">        );<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L159" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+160</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L160" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+161</span><span class="line-content">        assert_eq!(<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L161" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+162</span><span class="line-content">            max_subnet_metrics_stored_key.to_bytes().len(),<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L162" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+163</span><span class="line-content">            MAX_BYTES_NODE_METRICS_STORED_KEY as usize<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L163" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+164</span><span class="line-content">        );<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L164" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+165</span><span class="line-content">    }<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L165" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+166</span><span class="line-content">}<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L166" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">167</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/metrics.rs b/rs/node_rewards/canister/src/metrics.rs<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L167" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">168</span><span class="line-content">index ad76fa378e..8d9c7a6629 100644<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/lib.rs#L168" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/metrics.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/metrics.rs</div>
<div class="hunk-header">@@ -1,13 +1,11 @@</div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> #![allow(deprecated)]<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/metrics.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+2</span><span class="line-content">use crate::pb::v1::{SubnetIdKey, SubnetMetricsKey, SubnetMetricsValue};<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/metrics.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+3</span><span class="line-content">use crate::KeyRange;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/metrics.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use async_trait::async_trait;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/metrics.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use candid::Principal;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/metrics.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use ic_base_types::{NodeId, SubnetId};<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/metrics.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> use ic_cdk::api::call::CallResult;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/metrics.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> use ic_management_canister_types::{NodeMetricsHistoryArgs, NodeMetricsHistoryRecord};<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/metrics.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-7</span><span class="line-content">use ic_node_rewards_canister_protobuf::pb::ic_node_rewards::v1::{<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/src/metrics.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-8</span><span class="line-content">    SubnetIdKey, SubnetMetricsKey, SubnetMetricsValue,<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/src/metrics.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-9</span><span class="line-content">};<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/src/metrics.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-10</span><span class="line-content">use ic_node_rewards_canister_protobuf::KeyRange;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/src/metrics.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> use ic_stable_structures::StableBTreeMap;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/metrics.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> use itertools::Itertools;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/metrics.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content"> use rewards_calculation::types::{DayUtc, NodeMetricsDailyRaw, SubnetMetricsDailyKey, UnixTsNanos};<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/metrics.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/metrics/tests.rs b/rs/node_rewards/canister/src/metrics/tests.rs<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/metrics.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content">index 5870caa275..5813510bfc 100644<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/metrics.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- a/rs/node_rewards/canister/src/metrics/tests.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/metrics/tests.rs</div>
<div class="hunk-header">@@ -1,8 +1,8 @@</div>
<div class="line context"><span class="line-number">1</span><span class="line-content"> use crate::metrics::{MetricsManager, UnixTsNanos};<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/metrics/tests.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+2</span><span class="line-content">use crate::pb::v1::SubnetMetricsKey;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/metrics/tests.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> use ic_base_types::{NodeId, PrincipalId, SubnetId};<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/metrics/tests.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> use ic_cdk::api::call::{CallResult, RejectionCode};<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/metrics/tests.rs#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content"> use ic_management_canister_types::{NodeMetrics, NodeMetricsHistoryArgs, NodeMetricsHistoryRecord};<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/metrics/tests.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-5</span><span class="line-content">use ic_node_rewards_canister_protobuf::pb::ic_node_rewards::v1::SubnetMetricsKey;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c~1/rs/node_rewards/canister/src/metrics/tests.rs#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content"> use ic_stable_structures::memory_manager::{MemoryId, VirtualMemory};<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/metrics/tests.rs#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content"> use ic_stable_structures::DefaultMemoryImpl;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/metrics/tests.rs#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content"> use rewards_calculation::types::{DayUtc, NodeMetricsDailyRaw};<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/metrics/tests.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content">diff --git a/rs/node_rewards/canister/src/pb/mod.rs b/rs/node_rewards/canister/src/pb/mod.rs<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/metrics/tests.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content">new file mode 100644<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/metrics/tests.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content">index 0000000000..7982e71834<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/metrics/tests.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="file-header">--- /dev/null</div>
<div class="file-header">+++ b/rs/node_rewards/canister/src/pb/mod.rs</div>
<div class="hunk-header">@@ -0,0 +1,3 @@</div>
<div class="line added"><span class="line-number">+1</span><span class="line-content">#[allow(clippy::all)]<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/pb/mod.rs#L1" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+2</span><span class="line-content">#[path = &quot;../gen/ic_node_rewards.pb.v1.rs&quot;]<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/pb/mod.rs#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+3</span><span class="line-content">pub mod v1;<a href="https://github.com/dfinity/ic/blob/861616d46ded00091fecbfe01f441b38b56b483c/rs/node_rewards/canister/src/pb/mod.rs#L3" class="github-link" target="_blank">🔗</a></span></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="commit-detail">
                    <div class="commit-header">
                        <div class="commit-title">
                            <a href="https://github.com/dfinity/ic/commit/c4bf3da835f3407818b706cf2f7ae4485c7e032f" class="commit-hash-large" target="_blank">c4bf3da835f3407818b706cf2f7ae4485c7e032f</a>
                            <span class="badge chore">chore</span>
                        </div>
                        <div class="commit-meta">
                            <span>👤 mraszyk &lt;31483726+mraszyk@users.noreply.github.com&gt;</span>
                            <span>📅 2025-09-10</span>
                            <span>📁 1 files</span>
                        </div>
                        <div style="margin-top: 8px; color: #e6edf3; font-size: 0.9em;">
                            chore(PocketIC): replace EmptyConfig by better readable enumerations (#6630)
                        </div>
                        <div class="commit-actions">
                            <button class="toggle-button secondary" onclick="toggleFiles('files-12')">📁 Files (1)</button>
                            <button class="toggle-button" onclick="toggleDiff('diff-12')">🔍 Code Changes</button>
                        </div>
                        <div id="files-12" class="collapsible">
                            <div class="files-list">
                                <ul><li>rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs</li></ul></div></div>
                        <div id="diff-12" class="collapsible">
                            <div class="diff-container">
                                <div class="line context"><span class="line-number">1</span><span class="line-content">commit c4bf3da835f3407818b706cf2f7ae4485c7e032f</span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content">Author: mraszyk &lt;31483726+mraszyk@users.noreply.github.com&gt;</span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content">Date:   Wed Sep 10 11:37:13 2025 +0200</span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content">    chore(PocketIC): replace EmptyConfig by better readable enumerations (#6630)</span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content">    This PR replaces `EmptyConfig` in PocketIC public types with better</span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content">    readable enumerations that are less confusing to developers. It also</span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content">    renames nonmainnet features to ICP config.</span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content">diff --git a/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs b/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs</span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">index bfdb6e3d32..fb5983a549 100644</span></div>
<div class="file-header">--- a/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs</div>
<div class="file-header">+++ b/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs</div>
<div class="hunk-header">@@ -8,14 +8,14 @@ use ic_node_rewards_canister_api::provider_rewards_calculation::{</div>
<div class="line context"><span class="line-number">8</span><span class="line-content">     GetNodeProviderRewardsCalculationRequest, GetNodeProviderRewardsCalculationResponse,<a href="https://github.com/dfinity/ic/blob/c4bf3da835f3407818b706cf2f7ae4485c7e032f/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content"> };<a href="https://github.com/dfinity/ic/blob/c4bf3da835f3407818b706cf2f7ae4485c7e032f/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"> use ic_types::PrincipalId;<a href="https://github.com/dfinity/ic/blob/c4bf3da835f3407818b706cf2f7ae4485c7e032f/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-11</span><span class="line-content">use pocket_ic::common::rest::{EmptyConfig, IcpFeatures};<a href="https://github.com/dfinity/ic/blob/c4bf3da835f3407818b706cf2f7ae4485c7e032f~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+11</span><span class="line-content">use pocket_ic::common::rest::{IcpFeatures, IcpFeaturesConfig};<a href="https://github.com/dfinity/ic/blob/c4bf3da835f3407818b706cf2f7ae4485c7e032f/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content"> use pocket_ic::nonblocking::{query_candid, update_candid, PocketIc};<a href="https://github.com/dfinity/ic/blob/c4bf3da835f3407818b706cf2f7ae4485c7e032f/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">13</span><span class="line-content"> use pocket_ic::PocketIcBuilder;<a href="https://github.com/dfinity/ic/blob/c4bf3da835f3407818b706cf2f7ae4485c7e032f/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">14</span><span class="line-content"> use std::time::Duration;<a href="https://github.com/dfinity/ic/blob/c4bf3da835f3407818b706cf2f7ae4485c7e032f/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">15</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/c4bf3da835f3407818b706cf2f7ae4485c7e032f/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">16</span><span class="line-content"> async fn setup_env() -&gt; PocketIc {<a href="https://github.com/dfinity/ic/blob/c4bf3da835f3407818b706cf2f7ae4485c7e032f/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">17</span><span class="line-content">     let icp_features = IcpFeatures {<a href="https://github.com/dfinity/ic/blob/c4bf3da835f3407818b706cf2f7ae4485c7e032f/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line removed"><span class="line-number">-18</span><span class="line-content">        registry: Some(EmptyConfig {}),<a href="https://github.com/dfinity/ic/blob/c4bf3da835f3407818b706cf2f7ae4485c7e032f~1/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+18</span><span class="line-content">        registry: Some(IcpFeaturesConfig::DefaultConfig),<a href="https://github.com/dfinity/ic/blob/c4bf3da835f3407818b706cf2f7ae4485c7e032f/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">19</span><span class="line-content">         ..Default::default()<a href="https://github.com/dfinity/ic/blob/c4bf3da835f3407818b706cf2f7ae4485c7e032f/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">20</span><span class="line-content">     };<a href="https://github.com/dfinity/ic/blob/c4bf3da835f3407818b706cf2f7ae4485c7e032f/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">21</span><span class="line-content">     let pocket_ic = PocketIcBuilder::new()<a href="https://github.com/dfinity/ic/blob/c4bf3da835f3407818b706cf2f7ae4485c7e032f/rs/node_rewards/canister/tests/get_node_providers_monthly_xdr_rewards.rs#L21" class="github-link" target="_blank">🔗</a></span></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="commit-detail">
                    <div class="commit-header">
                        <div class="commit-title">
                            <a href="https://github.com/dfinity/ic/commit/db65a720ff4db47302d04d426e9abc414e73774b" class="commit-hash-large" target="_blank">db65a720ff4db47302d04d426e9abc414e73774b</a>
                            <span class="badge chore">chore</span>
                        </div>
                        <div class="commit-meta">
                            <span>👤 pietrodimarco-dfinity &lt;124565147+pietrodimarco-dfinity@users.noreply.github.com&gt;</span>
                            <span>📅 2025-09-06</span>
                            <span>📁 1 files</span>
                        </div>
                        <div style="margin-top: 8px; color: #e6edf3; font-size: 0.9em;">
                            chore(nns): Release notes (#6532)
                        </div>
                        <div class="commit-actions">
                            <button class="toggle-button secondary" onclick="toggleFiles('files-13')">📁 Files (1)</button>
                            <button class="toggle-button" onclick="toggleDiff('diff-13')">🔍 Code Changes</button>
                        </div>
                        <div id="files-13" class="collapsible">
                            <div class="files-list">
                                <ul><li>rs/node_rewards/canister/CHANGELOG.md</li></ul></div></div>
                        <div id="diff-13" class="collapsible">
                            <div class="diff-container">
                                <div class="line context"><span class="line-number">1</span><span class="line-content">commit db65a720ff4db47302d04d426e9abc414e73774b</span></div>
<div class="line context"><span class="line-number">2</span><span class="line-content">Author: pietrodimarco-dfinity &lt;124565147+pietrodimarco-dfinity@users.noreply.github.com&gt;</span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content">Date:   Sat Sep 6 07:47:11 2025 +0200</span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">5</span><span class="line-content">    chore(nns): Release notes (#6532)</span></div>
<div class="line context"><span class="line-number">6</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">7</span><span class="line-content">    Release notes for submitted proposals:</span></div>
<div class="line context"><span class="line-number">8</span><span class="line-content">    </span></div>
<div class="line context"><span class="line-number">9</span><span class="line-content">    https://dashboard.internetcomputer.org/proposal/138288</span></div>
<div class="line context"><span class="line-number">10</span><span class="line-content"></span></div>
<div class="line context"><span class="line-number">11</span><span class="line-content">diff --git a/rs/node_rewards/canister/CHANGELOG.md b/rs/node_rewards/canister/CHANGELOG.md</span></div>
<div class="line context"><span class="line-number">12</span><span class="line-content">index a0347f0adc..0ec4c84f0d 100644</span></div>
<div class="file-header">--- a/rs/node_rewards/canister/CHANGELOG.md</div>
<div class="file-header">+++ b/rs/node_rewards/canister/CHANGELOG.md</div>
<div class="hunk-header">@@ -2,6 +2,21 @@</div>
<div class="line context"><span class="line-number">2</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/db65a720ff4db47302d04d426e9abc414e73774b/rs/node_rewards/canister/CHANGELOG.md#L2" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">3</span><span class="line-content"> INSERT NEW RELEASES HERE<a href="https://github.com/dfinity/ic/blob/db65a720ff4db47302d04d426e9abc414e73774b/rs/node_rewards/canister/CHANGELOG.md#L3" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">4</span><span class="line-content"> <a href="https://github.com/dfinity/ic/blob/db65a720ff4db47302d04d426e9abc414e73774b/rs/node_rewards/canister/CHANGELOG.md#L4" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+5</span><span class="line-content"># 2025-08-30: Proposal 138288<a href="https://github.com/dfinity/ic/blob/db65a720ff4db47302d04d426e9abc414e73774b/rs/node_rewards/canister/CHANGELOG.md#L5" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+6</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/db65a720ff4db47302d04d426e9abc414e73774b/rs/node_rewards/canister/CHANGELOG.md#L6" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+7</span><span class="line-content">http://dashboard.internetcomputer.org/proposal/138288<a href="https://github.com/dfinity/ic/blob/db65a720ff4db47302d04d426e9abc414e73774b/rs/node_rewards/canister/CHANGELOG.md#L7" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+8</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/db65a720ff4db47302d04d426e9abc414e73774b/rs/node_rewards/canister/CHANGELOG.md#L8" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+9</span><span class="line-content">## Added<a href="https://github.com/dfinity/ic/blob/db65a720ff4db47302d04d426e9abc414e73774b/rs/node_rewards/canister/CHANGELOG.md#L9" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+10</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/db65a720ff4db47302d04d426e9abc414e73774b/rs/node_rewards/canister/CHANGELOG.md#L10" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+11</span><span class="line-content">* Add get_node_providers_rewards endpoint, to be used by the Governance to compute performance-based rewards.<a href="https://github.com/dfinity/ic/blob/db65a720ff4db47302d04d426e9abc414e73774b/rs/node_rewards/canister/CHANGELOG.md#L11" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+12</span><span class="line-content">* Store rewards (including intermediate results) in stable memory for client retrieval.<a href="https://github.com/dfinity/ic/blob/db65a720ff4db47302d04d426e9abc414e73774b/rs/node_rewards/canister/CHANGELOG.md#L12" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+13</span><span class="line-content">* Add get_node_provider_rewards_calculation endpoint to compute ongoing rewards and fetch historical ones.<a href="https://github.com/dfinity/ic/blob/db65a720ff4db47302d04d426e9abc414e73774b/rs/node_rewards/canister/CHANGELOG.md#L13" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+14</span><span class="line-content">* Add get_historical_reward_periods endpoint to fetch historical reward periods and the providers rewarded.<a href="https://github.com/dfinity/ic/blob/db65a720ff4db47302d04d426e9abc414e73774b/rs/node_rewards/canister/CHANGELOG.md#L14" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+15</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/db65a720ff4db47302d04d426e9abc414e73774b/rs/node_rewards/canister/CHANGELOG.md#L15" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+16</span><span class="line-content">## Fixed<a href="https://github.com/dfinity/ic/blob/db65a720ff4db47302d04d426e9abc414e73774b/rs/node_rewards/canister/CHANGELOG.md#L16" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+17</span><span class="line-content"><a href="https://github.com/dfinity/ic/blob/db65a720ff4db47302d04d426e9abc414e73774b/rs/node_rewards/canister/CHANGELOG.md#L17" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+18</span><span class="line-content">* Fix rewards calculation algorithm to extrapolate with 0% failure rate node&#x27;s performance for node providers with no<a href="https://github.com/dfinity/ic/blob/db65a720ff4db47302d04d426e9abc414e73774b/rs/node_rewards/canister/CHANGELOG.md#L18" class="github-link" target="_blank">🔗</a></span></div>
<div class="line added"><span class="line-number">+19</span><span class="line-content">  assigned nodes on a given day.<a href="https://github.com/dfinity/ic/blob/db65a720ff4db47302d04d426e9abc414e73774b/rs/node_rewards/canister/CHANGELOG.md#L19" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">20</span><span class="line-content"> * Replicated execution of the query endpoints `get_node_provider_rewards_calculation` and `get_historical_reward_periods`<a href="https://github.com/dfinity/ic/blob/db65a720ff4db47302d04d426e9abc414e73774b/rs/node_rewards/canister/CHANGELOG.md#L20" class="github-link" target="_blank">🔗</a></span></div>
<div class="line context"><span class="line-number">21</span><span class="line-content">   is disabled.<a href="https://github.com/dfinity/ic/blob/db65a720ff4db47302d04d426e9abc414e73774b/rs/node_rewards/canister/CHANGELOG.md#L21" class="github-link" target="_blank">🔗</a></span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <button class="scroll-to-top" onclick="scrollToTop()" id="scrollBtn">↑</button>
    
    <script>
        function toggleFiles(id) {
            const element = document.getElementById(id);
            element.classList.toggle('show');
        }
        
        function toggleDiff(id) {
            const element = document.getElementById(id);
            element.classList.toggle('show');
        }
        
        
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }
        
        // Show/hide scroll to top button
        window.addEventListener('scroll', function() {
            const scrollBtn = document.getElementById('scrollBtn');
            if (window.pageYOffset > 300) {
                scrollBtn.classList.add('show');
            } else {
                scrollBtn.classList.remove('show');
            }
        });
        
        // Auto-expand first commit for better UX
        document.addEventListener('DOMContentLoaded', function() {
            const firstDiff = document.getElementById('diff-0');
            if (firstDiff) {
                firstDiff.classList.add('show');
            }
            
            // Add keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case 'k':
                            e.preventDefault();
                            scrollToTop();
                            break;
                        case 'j':
                            e.preventDefault();
                            // Toggle first diff
                            const firstDiff = document.getElementById('diff-0');
                            if (firstDiff) {
                                firstDiff.classList.toggle('show');
                            }
                            break;
                    }
                }
            });
        });
    </script>
</body>
</html>